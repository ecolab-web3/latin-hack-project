<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts\BiodiversityCredits_LatinHack.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> BiodiversityCredits_LatinHack.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>29/29</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>30/30</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>12/12</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>40/40</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">19×</span>
<span class="cline-any cline-yes">18×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">22×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">21×</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">18×</span>
<span class="cline-any cline-yes">17×</span>
<span class="cline-any cline-yes">17×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-yes">15×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">14×</span>
<span class="cline-any cline-yes">14×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">14×</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">14×</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.28;
&nbsp;
/**
 * @title BiodiversityCredits_LatinHack
 * @author Equipo de desarrollo de E-co.lab
 * @notice Contrato diseñado para soportar múltiples proyectos, cada uno con su propio verificador.
 * Esta arquitectura permite alinear la experiencia del verificador (ej. biólogo marino, experto forestal)
 * con la naturaleza específica de cada proyecto de biodiversidad.
 */
contract BiodiversityCredits_LatinHack {
&nbsp;
    // --- Variables de Estado ---
&nbsp;
    address public admin;
&nbsp;
    enum Status { Pending, Approved, Rejected }
&nbsp;
    struct Project {
        address developer;
        address verifier; // El verificador específico para este proyecto
        string projectURI;
        bytes32 methodologyHash;
        Status status;
    }
&nbsp;
    struct CreditBatch {
        uint256 projectId; // Vínculo al proyecto que originó este lote de créditos
        uint256 timestamp;
        uint256 totalMinted;
    }
&nbsp;
    mapping(uint256 =&gt; Project) public projects;
    uint256 private _nextProjectId;
&nbsp;
    mapping(uint256 =&gt; CreditBatch) public creditBatchDetails;
    uint256 private _nextCreditId;
&nbsp;
    // Estructuras de datos ERC-1155
    mapping(uint256 =&gt; mapping(address =&gt; uint256)) private _balances;
    mapping(address =&gt; mapping(address =&gt; bool)) private _operatorApprovals;
&nbsp;
    // --- Eventos ---
&nbsp;
    event TransferSingle(address indexed operator, address indexed from, address indexed to, uint256 id, uint256 amount);
    event ApprovalForAll(address indexed owner, address indexed operator, bool approved);
    event ProjectRegistered(uint256 indexed projectId, address indexed developer, address indexed verifier);
    event ProjectStatusUpdated(uint256 indexed projectId, Status newStatus);
    event CreditBatchCertified(uint256 indexed creditId, uint256 indexed projectId, address indexed verifier, address creditOwner, uint256 amount);
    event CreditsRetired(uint256 indexed creditId, address indexed retiredBy, uint256 amount);
&nbsp;
    // --- Modificadores ---
&nbsp;
    modifier onlyAdmin() {
        require(msg.sender == admin, "Llamador no es el admin");
        _;
    }
&nbsp;
    // --- Constructor ---
&nbsp;
    /**
     * @dev El constructor establece los roles iniciales de administración y verificación.
     * @param _initialAdmin La dirección que gestionará el contrato.
     */
&nbsp;
    constructor(address _initialAdmin) {
        admin = _initialAdmin;
    }
&nbsp;
    // --- Gestión de Proyectos ---
&nbsp;
    /**
     * @notice INDICACIÓN CRÍTICA DE DISEÑO:
     * Para mitigar la centralización y el riesgo de un único punto de fallo, la dirección
     * '_verifier' DEBERÍA ser una cartera multi-firma (multisig) nativa de Polkadot (Substrate).
     * Esto asegura que la acuñación de nuevos créditos requiera el consenso de múltiples partes
     * independientes, aumentando la confianza y la robustez del sistema.
     */
&nbsp;
    function registerProject(address _verifier, string memory _projectURI, bytes32 _methodologyHash) external returns (uint256) {
        require(_verifier != address(0), "El verificador no puede ser la direccion cero");
        uint256 projectId = _nextProjectId++;
        projects[projectId] = Project({
            developer: msg.sender,
            verifier: _verifier,
            projectURI: _projectURI,
            methodologyHash: _methodologyHash,
            status: Status.Pending
        });
        emit ProjectRegistered(projectId, msg.sender, _verifier);
        return projectId;
    }
&nbsp;
    function updateProjectStatus(uint256 _projectId, Status _newStatus) external onlyAdmin {
        require(projects[_projectId].developer != address(0), "El proyecto no existe");
        projects[_projectId].status = _newStatus;
        emit ProjectStatusUpdated(_projectId, _newStatus);
    }
&nbsp;
    // --- Lógica Principal del Negocio ---
&nbsp;
    function certifyAndMintBatch(uint256 _projectId, address _creditOwner, uint256 _amount) external {
        Project storage project = projects[_projectId];
        require(project.status == Status.Approved, "El proyecto no esta aprobado");
        require(msg.sender == project.verifier, "Llamador no es el verificador de este proyecto");
&nbsp;
        uint256 creditId = _nextCreditId++;
        creditBatchDetails[creditId] = CreditBatch({
            projectId: _projectId,
            timestamp: block.timestamp,
            totalMinted: _amount
        });
&nbsp;
        _mint(_creditOwner, creditId, _amount);
        emit CreditBatchCertified(creditId, _projectId, msg.sender, _creditOwner, _amount);
    }
&nbsp;
    function retireCredits(uint256 creditId, uint256 amount) external {
        address owner = msg.sender;
        require(_balances[creditId][owner] &gt;= amount, "ERC1155: balance insuficiente para quemar");
&nbsp;
        _balances[creditId][owner] -= amount;
        
        emit TransferSingle(owner, owner, address(0), creditId, amount);
        emit CreditsRetired(creditId, owner, amount);
    }
&nbsp;
    // --- Implementación Mínima de ERC-1155 ---
&nbsp;
    function balanceOf(address _account, uint256 _id) public view returns (uint256) {
        return _balances[_id][_account];
    }
&nbsp;
    function setApprovalForAll(address _operator, bool _approved) public {
        _operatorApprovals[msg.sender][_operator] = _approved;
        emit ApprovalForAll(msg.sender, _operator, _approved);
    }
&nbsp;
    function isApprovedForAll(address _account, address _operator) public view returns (bool) {
        return _operatorApprovals[_account][_operator];
    }
&nbsp;
    function safeTransferFrom(address _from, address _to, uint256 _id, uint256 _amount, bytes memory _data) public {
        require(_from == msg.sender || isApprovedForAll(_from, msg.sender), "ERC1155: no autorizado para transferir");
        require(_to != address(0), "ERC1155: no se puede transferir a la direccion cero");
        require(_balances[_id][_from] &gt;= _amount, "ERC1155: balance insuficiente");
        _balances[_id][_from] -= _amount;
        _balances[_id][_to] += _amount;
        emit TransferSingle(msg.sender, _from, _to, _id, _amount);
    }
    
    function burn(address from, uint256 id, uint256 amount) public {
        require(from == msg.sender || isApprovedForAll(from, msg.sender), "ERC1155: no autorizado para quemar");
        require(_balances[id][from] &gt;= amount, "ERC1155: balance insuficiente para quemar");
&nbsp;
        _balances[id][from] -= amount;
        emit TransferSingle(msg.sender, from, address(0), id, amount);
    }
    
    function _mint(address _to, uint256 _id, uint256 _amount) private {
        require(_to != address(0), "ERC1155: no se puede acunar a la direccion cero");
        _balances[_id][_to] += _amount;
        emit TransferSingle(msg.sender, address(0), _to, _id, _amount);
    }
}</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Fri Oct 03 2025 22:24:34 GMT-0300 (Horário Padrão de Brasília)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>

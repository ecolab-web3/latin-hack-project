(function(re,Qt){typeof exports=="object"&&typeof module<"u"?Qt(exports):typeof define=="function"&&define.amd?define(["exports"],Qt):(re=typeof globalThis<"u"?globalThis:re||self,Qt(re["@walletconnect/sign-client"]={}))})(this,function(re){"use strict";var Qt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function jl(t){var e=t.default;if(typeof e=="function"){var n=function(){return e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var ft={exports:{}},Wr=typeof Reflect=="object"?Reflect:null,zl=Wr&&typeof Wr.apply=="function"?Wr.apply:function(e,n,r){return Function.prototype.apply.call(e,n,r)},ks;Wr&&typeof Wr.ownKeys=="function"?ks=Wr.ownKeys:Object.getOwnPropertySymbols?ks=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:ks=function(e){return Object.getOwnPropertyNames(e)};function Cy(t){console&&console.warn&&console.warn(t)}var Vl=Number.isNaN||function(e){return e!==e};function pe(){pe.init.call(this)}ft.exports=pe,ft.exports.once=ky,pe.EventEmitter=pe,pe.prototype._events=void 0,pe.prototype._eventsCount=0,pe.prototype._maxListeners=void 0;var Hl=10;function qs(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(pe,"defaultMaxListeners",{enumerable:!0,get:function(){return Hl},set:function(t){if(typeof t!="number"||t<0||Vl(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");Hl=t}}),pe.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},pe.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Vl(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Kl(t){return t._maxListeners===void 0?pe.defaultMaxListeners:t._maxListeners}pe.prototype.getMaxListeners=function(){return Kl(this)},pe.prototype.emit=function(e){for(var n=[],r=1;r<arguments.length;r++)n.push(arguments[r]);var i=e==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var o;if(n.length>0&&(o=n[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=s[e];if(c===void 0)return!1;if(typeof c=="function")zl(c,this,n);else for(var u=c.length,l=Xl(c,u),r=0;r<u;++r)zl(l[r],this,n);return!0};function Gl(t,e,n,r){var i,s,o;if(qs(n),s=t._events,s===void 0?(s=t._events=Object.create(null),t._eventsCount=0):(s.newListener!==void 0&&(t.emit("newListener",e,n.listener?n.listener:n),s=t._events),o=s[e]),o===void 0)o=s[e]=n,++t._eventsCount;else if(typeof o=="function"?o=s[e]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),i=Kl(t),i>0&&o.length>i&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=o.length,Cy(a)}return t}pe.prototype.addListener=function(e,n){return Gl(this,e,n,!1)},pe.prototype.on=pe.prototype.addListener,pe.prototype.prependListener=function(e,n){return Gl(this,e,n,!0)};function Uy(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Wl(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},i=Uy.bind(r);return i.listener=n,r.wrapFn=i,i}pe.prototype.once=function(e,n){return qs(n),this.on(e,Wl(this,e,n)),this},pe.prototype.prependOnceListener=function(e,n){return qs(n),this.prependListener(e,Wl(this,e,n)),this},pe.prototype.removeListener=function(e,n){var r,i,s,o,a;if(qs(n),i=this._events,i===void 0)return this;if(r=i[e],r===void 0)return this;if(r===n||r.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||n));else if(typeof r!="function"){for(s=-1,o=r.length-1;o>=0;o--)if(r[o]===n||r[o].listener===n){a=r[o].listener,s=o;break}if(s<0)return this;s===0?r.shift():Fy(r,s),r.length===1&&(i[e]=r[0]),i.removeListener!==void 0&&this.emit("removeListener",e,a||n)}return this},pe.prototype.off=pe.prototype.removeListener,pe.prototype.removeAllListeners=function(e){var n,r,i;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var s=Object.keys(r),o;for(i=0;i<s.length;++i)o=s[i],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=r[e],typeof n=="function")this.removeListener(e,n);else if(n!==void 0)for(i=n.length-1;i>=0;i--)this.removeListener(e,n[i]);return this};function Zl(t,e,n){var r=t._events;if(r===void 0)return[];var i=r[e];return i===void 0?[]:typeof i=="function"?n?[i.listener||i]:[i]:n?Ly(i):Xl(i,i.length)}pe.prototype.listeners=function(e){return Zl(this,e,!0)},pe.prototype.rawListeners=function(e){return Zl(this,e,!1)},pe.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):Yl.call(t,e)},pe.prototype.listenerCount=Yl;function Yl(t){var e=this._events;if(e!==void 0){var n=e[t];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}pe.prototype.eventNames=function(){return this._eventsCount>0?ks(this._events):[]};function Xl(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}function Fy(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function Ly(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}function ky(t,e){return new Promise(function(n,r){function i(o){t.removeListener(e,s),r(o)}function s(){typeof t.removeListener=="function"&&t.removeListener("error",i),n([].slice.call(arguments))}Jl(t,e,s,{once:!0}),e!=="error"&&qy(t,i,{once:!0})})}function qy(t,e,n){typeof t.on=="function"&&Jl(t,"error",e,n)}function Jl(t,e,n,r){if(typeof t.on=="function")r.once?t.once(e,n):t.on(e,n);else if(typeof t.addEventListener=="function")t.addEventListener(e,function i(s){r.once&&t.removeEventListener(e,i),n(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var K={};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var Ba=function(t,e){return Ba=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)r.hasOwnProperty(i)&&(n[i]=r[i])},Ba(t,e)};function My(t,e){Ba(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var Da=function(){return Da=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Da.apply(this,arguments)};function jy(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}function zy(t,e,n,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,n):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,n,s):o(e,n))||s);return i>3&&s&&Object.defineProperty(e,n,s),s}function Vy(t,e){return function(n,r){e(n,r,t)}}function Hy(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function Ky(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(l){try{u(r.next(l))}catch(h){o(h)}}function c(l){try{u(r.throw(l))}catch(h){o(h)}}function u(l){l.done?s(l.value):i(l.value).then(a,c)}u((r=r.apply(t,e||[])).next())})}function Gy(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(l){return c([u,l])}}function c(u){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,i=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){n.label=u[1];break}if(u[0]===6&&n.label<s[1]){n.label=s[1],s=u;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(u);break}s[2]&&n.ops.pop(),n.trys.pop();continue}u=e.call(t,n)}catch(l){u=[6,l],i=0}finally{r=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function Wy(t,e,n,r){r===void 0&&(r=n),t[r]=e[n]}function Zy(t,e){for(var n in t)n!=="default"&&!e.hasOwnProperty(n)&&(e[n]=t[n])}function $a(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ql(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}function Yy(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Ql(arguments[e]));return t}function Xy(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)r[i]=s[o];return r}function Ti(t){return this instanceof Ti?(this.v=t,this):new Ti(t)}function Jy(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(d){r[d]&&(i[d]=function(f){return new Promise(function(p,b){s.push([d,f,p,b])>1||a(d,f)})})}function a(d,f){try{c(r[d](f))}catch(p){h(s[0][3],p)}}function c(d){d.value instanceof Ti?Promise.resolve(d.value.v).then(u,l):h(s[0][2],d)}function u(d){a("next",d)}function l(d){a("throw",d)}function h(d,f){d(f),s.shift(),s.length&&a(s[0][0],s[0][1])}}function Qy(t){var e,n;return e={},r("next"),r("throw",function(i){throw i}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(i,s){e[i]=t[i]?function(o){return(n=!n)?{value:Ti(t[i](o)),done:i==="return"}:s?s(o):o}:s}}function eb(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof $a=="function"?$a(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(u){s({value:u,done:a})},o)}}function tb(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function nb(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function rb(t){return t&&t.__esModule?t:{default:t}}function ib(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function sb(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,n),n}var ob=Object.freeze({__proto__:null,__extends:My,get __assign(){return Da},__rest:jy,__decorate:zy,__param:Vy,__metadata:Hy,__awaiter:Ky,__generator:Gy,__createBinding:Wy,__exportStar:Zy,__values:$a,__read:Ql,__spread:Yy,__spreadArrays:Xy,__await:Ti,__asyncGenerator:Jy,__asyncDelegator:Qy,__asyncValues:eb,__makeTemplateObject:tb,__importStar:nb,__importDefault:rb,__classPrivateFieldGet:ib,__classPrivateFieldSet:sb}),Ms=jl(ob),Ta={},Pi={},ef;function ab(){if(ef)return Pi;ef=1,Object.defineProperty(Pi,"__esModule",{value:!0}),Pi.delay=void 0;function t(e){return new Promise(n=>{setTimeout(()=>{n(!0)},e)})}return Pi.delay=t,Pi}var mr={},Pa={},vr={},tf;function cb(){return tf||(tf=1,Object.defineProperty(vr,"__esModule",{value:!0}),vr.ONE_THOUSAND=vr.ONE_HUNDRED=void 0,vr.ONE_HUNDRED=100,vr.ONE_THOUSAND=1e3),vr}var Ra={},nf;function ub(){return nf||(nf=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365}(Ra)),Ra}var rf;function sf(){return rf||(rf=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Ms;e.__exportStar(cb(),t),e.__exportStar(ub(),t)}(Pa)),Pa}var of;function lb(){if(of)return mr;of=1,Object.defineProperty(mr,"__esModule",{value:!0}),mr.fromMiliseconds=mr.toMiliseconds=void 0;const t=sf();function e(r){return r*t.ONE_THOUSAND}mr.toMiliseconds=e;function n(r){return Math.floor(r/t.ONE_THOUSAND)}return mr.fromMiliseconds=n,mr}var af;function fb(){return af||(af=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Ms;e.__exportStar(ab(),t),e.__exportStar(lb(),t)}(Ta)),Ta}var Zr={},cf;function hb(){if(cf)return Zr;cf=1,Object.defineProperty(Zr,"__esModule",{value:!0}),Zr.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(n){if(this.timestamps.has(n))throw new Error(`Watch already started for label: ${n}`);this.timestamps.set(n,{started:Date.now()})}stop(n){const r=this.get(n);if(typeof r.elapsed<"u")throw new Error(`Watch already stopped for label: ${n}`);const i=Date.now()-r.started;this.timestamps.set(n,{started:r.started,elapsed:i})}get(n){const r=this.timestamps.get(n);if(typeof r>"u")throw new Error(`No timestamp found for label: ${n}`);return r}elapsed(n){const r=this.get(n);return r.elapsed||Date.now()-r.started}}return Zr.Watch=t,Zr.default=t,Zr}var Na={},Ri={},uf;function db(){if(uf)return Ri;uf=1,Object.defineProperty(Ri,"__esModule",{value:!0}),Ri.IWatch=void 0;class t{}return Ri.IWatch=t,Ri}var lf;function pb(){return lf||(lf=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),Ms.__exportStar(db(),t)}(Na)),Na}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Ms;e.__exportStar(fb(),t),e.__exportStar(hb(),t),e.__exportStar(pb(),t),e.__exportStar(sf(),t)})(K);class Er{}class gb extends Er{constructor(e){super()}}const ff=K.FIVE_SECONDS,xr={pulse:"heartbeat_pulse"};class Ca extends gb{constructor(e){super(e),this.events=new ft.exports.EventEmitter,this.interval=ff,this.interval=e?.interval||ff}static async init(e){const n=new Ca(e);return await n.init(),n}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,n){this.events.on(e,n)}once(e,n){this.events.once(e,n)}off(e,n){this.events.off(e,n)}removeListener(e,n){this.events.removeListener(e,n)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),K.toMiliseconds(this.interval))}pulse(){this.events.emit(xr.pulse)}}const yb=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,bb=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,wb=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function mb(t,e){if(t==="__proto__"||t==="constructor"&&e&&typeof e=="object"&&"prototype"in e){vb(t);return}return e}function vb(t){console.warn(`[destr] Dropping "${t}" key to prevent prototype pollution.`)}function js(t,e={}){if(typeof t!="string")return t;if(t[0]==='"'&&t[t.length-1]==='"'&&t.indexOf("\\")===-1)return t.slice(1,-1);const n=t.trim();if(n.length<=9)switch(n.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!wb.test(t)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return t}try{if(yb.test(t)||bb.test(t)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(t,mb)}return JSON.parse(t)}catch(r){if(e.strict)throw r;return t}}function Eb(t){return!t||typeof t.then!="function"?Promise.resolve(t):t}function Re(t,...e){try{return Eb(t(...e))}catch(n){return Promise.reject(n)}}function xb(t){const e=typeof t;return t===null||e!=="object"&&e!=="function"}function _b(t){const e=Object.getPrototypeOf(t);return!e||e.isPrototypeOf(Object)}function zs(t){if(xb(t))return String(t);if(_b(t)||Array.isArray(t))return JSON.stringify(t);if(typeof t.toJSON=="function")return zs(t.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const Ua="base64:";function Sb(t){return typeof t=="string"?t:Ua+Ab(t)}function Ib(t){return typeof t!="string"||!t.startsWith(Ua)?t:Ob(t.slice(Ua.length))}function Ob(t){return globalThis.Buffer?Buffer.from(t,"base64"):Uint8Array.from(globalThis.atob(t),e=>e.codePointAt(0))}function Ab(t){return globalThis.Buffer?Buffer.from(t).toString("base64"):globalThis.btoa(String.fromCodePoint(...t))}function ht(t){return t&&t.split("?")[0]?.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,"")||""}function Bb(...t){return ht(t.join(":"))}function Vs(t){return t=ht(t),t?t+":":""}function Db(t,e){if(e===void 0)return!0;let n=0,r=t.indexOf(":");for(;r>-1;)n++,r=t.indexOf(":",r+1);return n<=e}function $b(t,e){return e?t.startsWith(e)&&t[t.length-1]!=="$":t[t.length-1]!=="$"}function hD(t){return t}const Tb="memory",Pb=()=>{const t=new Map;return{name:Tb,getInstance:()=>t,hasItem(e){return t.has(e)},getItem(e){return t.get(e)??null},getItemRaw(e){return t.get(e)??null},setItem(e,n){t.set(e,n)},setItemRaw(e,n){t.set(e,n)},removeItem(e){t.delete(e)},getKeys(){return[...t.keys()]},clear(){t.clear()},dispose(){t.clear()}}};function Rb(t={}){const e={mounts:{"":t.driver||Pb()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},n=u=>{for(const l of e.mountpoints)if(u.startsWith(l))return{base:l,relativeKey:u.slice(l.length),driver:e.mounts[l]};return{base:"",relativeKey:u,driver:e.mounts[""]}},r=(u,l)=>e.mountpoints.filter(h=>h.startsWith(u)||l&&u.startsWith(h)).map(h=>({relativeBase:u.length>h.length?u.slice(h.length):void 0,mountpoint:h,driver:e.mounts[h]})),i=(u,l)=>{if(e.watching){l=ht(l);for(const h of e.watchListeners)h(u,l)}},s=async()=>{if(!e.watching){e.watching=!0;for(const u in e.mounts)e.unwatch[u]=await hf(e.mounts[u],i,u)}},o=async()=>{if(e.watching){for(const u in e.unwatch)await e.unwatch[u]();e.unwatch={},e.watching=!1}},a=(u,l,h)=>{const d=new Map,f=p=>{let b=d.get(p.base);return b||(b={driver:p.driver,base:p.base,items:[]},d.set(p.base,b)),b};for(const p of u){const b=typeof p=="string",v=ht(b?p:p.key),A=b?void 0:p.value,D=b||!p.options?l:{...l,...p.options},_=n(v);f(_).items.push({key:v,value:A,relativeKey:_.relativeKey,options:D})}return Promise.all([...d.values()].map(p=>h(p))).then(p=>p.flat())},c={hasItem(u,l={}){u=ht(u);const{relativeKey:h,driver:d}=n(u);return Re(d.hasItem,h,l)},getItem(u,l={}){u=ht(u);const{relativeKey:h,driver:d}=n(u);return Re(d.getItem,h,l).then(f=>js(f))},getItems(u,l={}){return a(u,l,h=>h.driver.getItems?Re(h.driver.getItems,h.items.map(d=>({key:d.relativeKey,options:d.options})),l).then(d=>d.map(f=>({key:Bb(h.base,f.key),value:js(f.value)}))):Promise.all(h.items.map(d=>Re(h.driver.getItem,d.relativeKey,d.options).then(f=>({key:d.key,value:js(f)})))))},getItemRaw(u,l={}){u=ht(u);const{relativeKey:h,driver:d}=n(u);return d.getItemRaw?Re(d.getItemRaw,h,l):Re(d.getItem,h,l).then(f=>Ib(f))},async setItem(u,l,h={}){if(l===void 0)return c.removeItem(u);u=ht(u);const{relativeKey:d,driver:f}=n(u);f.setItem&&(await Re(f.setItem,d,zs(l),h),f.watch||i("update",u))},async setItems(u,l){await a(u,l,async h=>{if(h.driver.setItems)return Re(h.driver.setItems,h.items.map(d=>({key:d.relativeKey,value:zs(d.value),options:d.options})),l);h.driver.setItem&&await Promise.all(h.items.map(d=>Re(h.driver.setItem,d.relativeKey,zs(d.value),d.options)))})},async setItemRaw(u,l,h={}){if(l===void 0)return c.removeItem(u,h);u=ht(u);const{relativeKey:d,driver:f}=n(u);if(f.setItemRaw)await Re(f.setItemRaw,d,l,h);else if(f.setItem)await Re(f.setItem,d,Sb(l),h);else return;f.watch||i("update",u)},async removeItem(u,l={}){typeof l=="boolean"&&(l={removeMeta:l}),u=ht(u);const{relativeKey:h,driver:d}=n(u);d.removeItem&&(await Re(d.removeItem,h,l),(l.removeMeta||l.removeMata)&&await Re(d.removeItem,h+"$",l),d.watch||i("remove",u))},async getMeta(u,l={}){typeof l=="boolean"&&(l={nativeOnly:l}),u=ht(u);const{relativeKey:h,driver:d}=n(u),f=Object.create(null);if(d.getMeta&&Object.assign(f,await Re(d.getMeta,h,l)),!l.nativeOnly){const p=await Re(d.getItem,h+"$",l).then(b=>js(b));p&&typeof p=="object"&&(typeof p.atime=="string"&&(p.atime=new Date(p.atime)),typeof p.mtime=="string"&&(p.mtime=new Date(p.mtime)),Object.assign(f,p))}return f},setMeta(u,l,h={}){return this.setItem(u+"$",l,h)},removeMeta(u,l={}){return this.removeItem(u+"$",l)},async getKeys(u,l={}){u=Vs(u);const h=r(u,!0);let d=[];const f=[];let p=!0;for(const v of h){v.driver.flags?.maxDepth||(p=!1);const A=await Re(v.driver.getKeys,v.relativeBase,l);for(const D of A){const _=v.mountpoint+ht(D);d.some(x=>_.startsWith(x))||f.push(_)}d=[v.mountpoint,...d.filter(D=>!D.startsWith(v.mountpoint))]}const b=l.maxDepth!==void 0&&!p;return f.filter(v=>(!b||Db(v,l.maxDepth))&&$b(v,u))},async clear(u,l={}){u=Vs(u),await Promise.all(r(u,!1).map(async h=>{if(h.driver.clear)return Re(h.driver.clear,h.relativeBase,l);if(h.driver.removeItem){const d=await h.driver.getKeys(h.relativeBase||"",l);return Promise.all(d.map(f=>h.driver.removeItem(f,l)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(u=>df(u)))},async watch(u){return await s(),e.watchListeners.push(u),async()=>{e.watchListeners=e.watchListeners.filter(l=>l!==u),e.watchListeners.length===0&&await o()}},async unwatch(){e.watchListeners=[],await o()},mount(u,l){if(u=Vs(u),u&&e.mounts[u])throw new Error(`already mounted at ${u}`);return u&&(e.mountpoints.push(u),e.mountpoints.sort((h,d)=>d.length-h.length)),e.mounts[u]=l,e.watching&&Promise.resolve(hf(l,i,u)).then(h=>{e.unwatch[u]=h}).catch(console.error),c},async unmount(u,l=!0){u=Vs(u),!(!u||!e.mounts[u])&&(e.watching&&u in e.unwatch&&(e.unwatch[u]?.(),delete e.unwatch[u]),l&&await df(e.mounts[u]),e.mountpoints=e.mountpoints.filter(h=>h!==u),delete e.mounts[u])},getMount(u=""){u=ht(u)+":";const l=n(u);return{driver:l.driver,base:l.base}},getMounts(u="",l={}){return u=ht(u),r(u,l.parents).map(d=>({driver:d.driver,base:d.mountpoint}))},keys:(u,l={})=>c.getKeys(u,l),get:(u,l={})=>c.getItem(u,l),set:(u,l,h={})=>c.setItem(u,l,h),has:(u,l={})=>c.hasItem(u,l),del:(u,l={})=>c.removeItem(u,l),remove:(u,l={})=>c.removeItem(u,l)};return c}function hf(t,e,n){return t.watch?t.watch((r,i)=>e(r,n+i)):()=>{}}async function df(t){typeof t.dispose=="function"&&await Re(t.dispose)}function _r(t){return new Promise((e,n)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>n(t.error)})}function pf(t,e){const n=indexedDB.open(t);n.onupgradeneeded=()=>n.result.createObjectStore(e);const r=_r(n);return(i,s)=>r.then(o=>s(o.transaction(e,i).objectStore(e)))}let Fa;function Ni(){return Fa||(Fa=pf("keyval-store","keyval")),Fa}function gf(t,e=Ni()){return e("readonly",n=>_r(n.get(t)))}function Nb(t,e,n=Ni()){return n("readwrite",r=>(r.put(e,t),_r(r.transaction)))}function Cb(t,e=Ni()){return e("readwrite",n=>(n.delete(t),_r(n.transaction)))}function Ub(t=Ni()){return t("readwrite",e=>(e.clear(),_r(e.transaction)))}function Fb(t,e){return t.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},_r(t.transaction)}function Lb(t=Ni()){return t("readonly",e=>{if(e.getAllKeys)return _r(e.getAllKeys());const n=[];return Fb(e,r=>n.push(r.key)).then(()=>n)})}const kb=t=>JSON.stringify(t,(e,n)=>typeof n=="bigint"?n.toString()+"n":n),qb=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,n=t.replace(e,'$1"$2n"$3');return JSON.parse(n,(r,i)=>typeof i=="string"&&i.match(/^\d+n$/)?BigInt(i.substring(0,i.length-1)):i)};function Yr(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return qb(t)}catch{return t}}function Sr(t){return typeof t=="string"?t:kb(t)||""}const Mb="idb-keyval";var jb=(t={})=>{const e=t.base&&t.base.length>0?`${t.base}:`:"",n=i=>e+i;let r;return t.dbName&&t.storeName&&(r=pf(t.dbName,t.storeName)),{name:Mb,options:t,async hasItem(i){return!(typeof await gf(n(i),r)>"u")},async getItem(i){return await gf(n(i),r)??null},setItem(i,s){return Nb(n(i),s,r)},removeItem(i){return Cb(n(i),r)},getKeys(){return Lb(r)},clear(){return Ub(r)}}};const zb="WALLET_CONNECT_V2_INDEXED_DB",Vb="keyvaluestorage";class Hb{constructor(){this.indexedDb=Rb({driver:jb({dbName:zb,storeName:Vb})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const n=await this.indexedDb.getItem(e);if(n!==null)return n}async setItem(e,n){await this.indexedDb.setItem(e,Sr(n))}async removeItem(e){await this.indexedDb.removeItem(e)}}var La=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Hs={exports:{}};(function(){let t;function e(){}t=e,t.prototype.getItem=function(n){return this.hasOwnProperty(n)?String(this[n]):null},t.prototype.setItem=function(n,r){this[n]=String(r)},t.prototype.removeItem=function(n){delete this[n]},t.prototype.clear=function(){const n=this;Object.keys(n).forEach(function(r){n[r]=void 0,delete n[r]})},t.prototype.key=function(n){return n=n||0,Object.keys(this)[n]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof La<"u"&&La.localStorage?Hs.exports=La.localStorage:typeof window<"u"&&window.localStorage?Hs.exports=window.localStorage:Hs.exports=new e})();function Kb(t){var e;return[t[0],Yr((e=t[1])!=null?e:"")]}class Gb{constructor(){this.localStorage=Hs.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(Kb)}async getItem(e){const n=this.localStorage.getItem(e);if(n!==null)return Yr(n)}async setItem(e,n){this.localStorage.setItem(e,Sr(n))}async removeItem(e){this.localStorage.removeItem(e)}}const Wb="wc_storage_version",yf=1,Zb=async(t,e,n)=>{const r=Wb,i=await e.getItem(r);if(i&&i>=yf){n(e);return}const s=await t.getKeys();if(!s.length){n(e);return}const o=[];for(;s.length;){const a=s.shift();if(!a)continue;const c=a.toLowerCase();if(c.includes("wc@")||c.includes("walletconnect")||c.includes("wc_")||c.includes("wallet_connect")){const u=await t.getItem(a);await e.setItem(a,u),o.push(a)}}await e.setItem(r,yf),n(e),Yb(t,o)},Yb=async(t,e)=>{e.length&&e.forEach(async n=>{await t.removeItem(n)})};class Xb{constructor(){this.initialized=!1,this.setInitialized=n=>{this.storage=n,this.initialized=!0};const e=new Gb;this.storage=e;try{const n=new Hb;Zb(e,n,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,n){return await this.initialize(),this.storage.setItem(e,n)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const n=setInterval(()=>{this.initialized&&(clearInterval(n),e())},20)})}}function Jb(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}var Qb=ew;function ew(t,e,n){var r=n&&n.stringify||Jb,i=1;if(typeof t=="object"&&t!==null){var s=e.length+i;if(s===1)return t;var o=new Array(s);o[0]=r(t);for(var a=1;a<s;a++)o[a]=r(e[a]);return o.join(" ")}if(typeof t!="string")return t;var c=e.length;if(c===0)return t;for(var u="",l=1-i,h=-1,d=t&&t.length||0,f=0;f<d;){if(t.charCodeAt(f)===37&&f+1<d){switch(h=h>-1?h:0,t.charCodeAt(f+1)){case 100:case 102:if(l>=c||e[l]==null)break;h<f&&(u+=t.slice(h,f)),u+=Number(e[l]),h=f+2,f++;break;case 105:if(l>=c||e[l]==null)break;h<f&&(u+=t.slice(h,f)),u+=Math.floor(Number(e[l])),h=f+2,f++;break;case 79:case 111:case 106:if(l>=c||e[l]===void 0)break;h<f&&(u+=t.slice(h,f));var p=typeof e[l];if(p==="string"){u+="'"+e[l]+"'",h=f+2,f++;break}if(p==="function"){u+=e[l].name||"<anonymous>",h=f+2,f++;break}u+=r(e[l]),h=f+2,f++;break;case 115:if(l>=c)break;h<f&&(u+=t.slice(h,f)),u+=String(e[l]),h=f+2,f++;break;case 37:h<f&&(u+=t.slice(h,f)),u+="%",h=f+2,f++,l--;break}++l}++f}return h===-1?t:(h<d&&(u+=t.slice(h)),u)}const bf=Qb;var hn=en;const Ci=lw().console||{},tw={mapHttpRequest:Gs,mapHttpResponse:Gs,wrapRequestSerializer:qa,wrapResponseSerializer:qa,wrapErrorSerializer:qa,req:Gs,res:Gs,err:ow};function nw(t,e){return Array.isArray(t)?t.filter(function(r){return r!=="!stdSerializers.err"}):t===!0?Object.keys(e):!1}function en(t){t=t||{},t.browser=t.browser||{};const e=t.browser.transmit;if(e&&typeof e.send!="function")throw Error("pino: transmit option must have a send function");const n=t.browser.write||Ci;t.browser.write&&(t.browser.asObject=!0);const r=t.serializers||{},i=nw(t.browser.serialize,r);let s=t.browser.serialize;Array.isArray(t.browser.serialize)&&t.browser.serialize.indexOf("!stdSerializers.err")>-1&&(s=!1);const o=["error","fatal","warn","info","debug","trace"];typeof n=="function"&&(n.error=n.fatal=n.warn=n.info=n.debug=n.trace=n),t.enabled===!1&&(t.level="silent");const a=t.level||"info",c=Object.create(n);c.log||(c.log=Ui),Object.defineProperty(c,"levelVal",{get:l}),Object.defineProperty(c,"level",{get:h,set:d});const u={transmit:e,serialize:i,asObject:t.browser.asObject,levels:o,timestamp:aw(t)};c.levels=en.levels,c.level=a,c.setMaxListeners=c.getMaxListeners=c.emit=c.addListener=c.on=c.prependListener=c.once=c.prependOnceListener=c.removeListener=c.removeAllListeners=c.listeners=c.listenerCount=c.eventNames=c.write=c.flush=Ui,c.serializers=r,c._serialize=i,c._stdErrSerialize=s,c.child=f,e&&(c._logEvent=ka());function l(){return this.level==="silent"?1/0:this.levels.values[this.level]}function h(){return this._level}function d(p){if(p!=="silent"&&!this.levels.values[p])throw Error("unknown level "+p);this._level=p,Xr(u,c,"error","log"),Xr(u,c,"fatal","error"),Xr(u,c,"warn","error"),Xr(u,c,"info","log"),Xr(u,c,"debug","log"),Xr(u,c,"trace","log")}function f(p,b){if(!p)throw new Error("missing bindings for child Pino");b=b||{},i&&p.serializers&&(b.serializers=p.serializers);const v=b.serializers;if(i&&v){var A=Object.assign({},r,v),D=t.browser.serialize===!0?Object.keys(A):i;delete p.serializers,Ks([p],D,A,this._stdErrSerialize)}function _(x){this._childLevel=(x._childLevel|0)+1,this.error=Jr(x,p,"error"),this.fatal=Jr(x,p,"fatal"),this.warn=Jr(x,p,"warn"),this.info=Jr(x,p,"info"),this.debug=Jr(x,p,"debug"),this.trace=Jr(x,p,"trace"),A&&(this.serializers=A,this._serialize=D),e&&(this._logEvent=ka([].concat(x._logEvent.bindings,p)))}return _.prototype=this,new _(this)}return c}en.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},en.stdSerializers=tw,en.stdTimeFunctions=Object.assign({},{nullTime:wf,epochTime:mf,unixTime:cw,isoTime:uw});function Xr(t,e,n,r){const i=Object.getPrototypeOf(e);e[n]=e.levelVal>e.levels.values[n]?Ui:i[n]?i[n]:Ci[n]||Ci[r]||Ui,rw(t,e,n)}function rw(t,e,n){!t.transmit&&e[n]===Ui||(e[n]=function(r){return function(){const s=t.timestamp(),o=new Array(arguments.length),a=Object.getPrototypeOf&&Object.getPrototypeOf(this)===Ci?Ci:this;for(var c=0;c<o.length;c++)o[c]=arguments[c];if(t.serialize&&!t.asObject&&Ks(o,this._serialize,this.serializers,this._stdErrSerialize),t.asObject?r.call(a,iw(this,n,o,s)):r.apply(a,o),t.transmit){const u=t.transmit.level||e.level,l=en.levels.values[u],h=en.levels.values[n];if(h<l)return;sw(this,{ts:s,methodLevel:n,methodValue:h,transmitLevel:u,transmitValue:en.levels.values[t.transmit.level||e.level],send:t.transmit.send,val:e.levelVal},o)}}}(e[n]))}function iw(t,e,n,r){t._serialize&&Ks(n,t._serialize,t.serializers,t._stdErrSerialize);const i=n.slice();let s=i[0];const o={};r&&(o.time=r),o.level=en.levels.values[e];let a=(t._childLevel|0)+1;if(a<1&&(a=1),s!==null&&typeof s=="object"){for(;a--&&typeof i[0]=="object";)Object.assign(o,i.shift());s=i.length?bf(i.shift(),i):void 0}else typeof s=="string"&&(s=bf(i.shift(),i));return s!==void 0&&(o.msg=s),o}function Ks(t,e,n,r){for(const i in t)if(r&&t[i]instanceof Error)t[i]=en.stdSerializers.err(t[i]);else if(typeof t[i]=="object"&&!Array.isArray(t[i]))for(const s in t[i])e&&e.indexOf(s)>-1&&s in n&&(t[i][s]=n[s](t[i][s]))}function Jr(t,e,n){return function(){const r=new Array(1+arguments.length);r[0]=e;for(var i=1;i<r.length;i++)r[i]=arguments[i-1];return t[n].apply(this,r)}}function sw(t,e,n){const r=e.send,i=e.ts,s=e.methodLevel,o=e.methodValue,a=e.val,c=t._logEvent.bindings;Ks(n,t._serialize||Object.keys(t.serializers),t.serializers,t._stdErrSerialize===void 0?!0:t._stdErrSerialize),t._logEvent.ts=i,t._logEvent.messages=n.filter(function(u){return c.indexOf(u)===-1}),t._logEvent.level.label=s,t._logEvent.level.value=o,r(s,t._logEvent,a),t._logEvent=ka(c)}function ka(t){return{ts:0,messages:[],bindings:t||[],level:{label:"",value:0}}}function ow(t){const e={type:t.constructor.name,msg:t.message,stack:t.stack};for(const n in t)e[n]===void 0&&(e[n]=t[n]);return e}function aw(t){return typeof t.timestamp=="function"?t.timestamp:t.timestamp===!1?wf:mf}function Gs(){return{}}function qa(t){return t}function Ui(){}function wf(){return!1}function mf(){return Date.now()}function cw(){return Math.round(Date.now()/1e3)}function uw(){return new Date(Date.now()).toISOString()}function lw(){function t(e){return typeof e<"u"&&e}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return t(self)||t(window)||t(this)||{}}}const fw={level:"info"},Fi="custom_context",Ma=1e3*1024;class hw{constructor(e){this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}}class vf{constructor(e){this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const n=new hw(e);if(n.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${n.size}`);for(;this.size+n.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=n),this.tail=n):(this.head=n,this.tail=n),this.lengthInNodes++,this.sizeInBytes+=n.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let n=this.head;for(;n!==null;)e.push(n.value),n=n.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const n=e.value;return e=e.next,{done:!1,value:n}}}}}class Ef{constructor(e,n=Ma){this.level=e??"error",this.levelValue=hn.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=n,this.logs=new vf(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,n){n===hn.levels.values.error?console.error(e):n===hn.levels.values.warn?console.warn(e):n===hn.levels.values.debug?console.debug(e):n===hn.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(Sr({timestamp:new Date().toISOString(),log:e}));const n=typeof e=="string"?JSON.parse(e).level:e.level;n>=this.levelValue&&this.forwardToConsole(e,n)}getLogs(){return this.logs}clearLogs(){this.logs=new vf(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const n=this.getLogArray();return n.push(Sr({extraMetadata:e})),new Blob(n,{type:"application/json"})}}class dw{constructor(e,n=Ma){this.baseChunkLogger=new Ef(e,n)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const n=URL.createObjectURL(this.logsToBlob(e)),r=document.createElement("a");r.href=n,r.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n)}}class pw{constructor(e,n=Ma){this.baseChunkLogger=new Ef(e,n)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}}var gw=Object.defineProperty,yw=Object.defineProperties,bw=Object.getOwnPropertyDescriptors,xf=Object.getOwnPropertySymbols,ww=Object.prototype.hasOwnProperty,mw=Object.prototype.propertyIsEnumerable,_f=(t,e,n)=>e in t?gw(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Ws=(t,e)=>{for(var n in e||(e={}))ww.call(e,n)&&_f(t,n,e[n]);if(xf)for(var n of xf(e))mw.call(e,n)&&_f(t,n,e[n]);return t},Zs=(t,e)=>yw(t,bw(e));function ja(t){return Zs(Ws({},t),{level:t?.level||fw.level})}function vw(t,e=Fi){return t[e]||""}function Ew(t,e,n=Fi){return t[n]=e,t}function dt(t,e=Fi){let n="";return typeof t.bindings>"u"?n=vw(t,e):n=t.bindings().context||"",n}function xw(t,e,n=Fi){const r=dt(t,n);return r.trim()?`${r}/${e}`:e}function nt(t,e,n=Fi){const r=xw(t,e,n),i=t.child({context:r});return Ew(i,r,n)}function _w(t){var e,n;const r=new dw((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:hn(Zs(Ws({},t.opts),{level:"trace",browser:Zs(Ws({},(n=t.opts)==null?void 0:n.browser),{write:i=>r.write(i)})})),chunkLoggerController:r}}function Sw(t){var e;const n=new pw((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:hn(Zs(Ws({},t.opts),{level:"trace"})),chunkLoggerController:n}}function Iw(t){return typeof t.loggerOverride<"u"&&typeof t.loggerOverride!="string"?{logger:t.loggerOverride,chunkLoggerController:null}:typeof window<"u"?_w(t):Sw(t)}var Ow=Object.defineProperty,Aw=(t,e,n)=>e in t?Ow(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Sf=(t,e,n)=>Aw(t,typeof e!="symbol"?e+"":e,n);class Bw extends Er{constructor(e){super(),this.opts=e,Sf(this,"protocol","wc"),Sf(this,"version",2)}}var Dw=Object.defineProperty,$w=(t,e,n)=>e in t?Dw(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Tw=(t,e,n)=>$w(t,typeof e!="symbol"?e+"":e,n);class Pw extends Er{constructor(e,n){super(),this.core=e,this.logger=n,Tw(this,"records",new Map)}}class Rw{constructor(e,n){this.logger=e,this.core=n}}class Nw extends Er{constructor(e,n){super(),this.relayer=e,this.logger=n}}class Cw extends Er{constructor(e){super()}}class Uw{constructor(e,n,r,i){this.core=e,this.logger=n,this.name=r}}class Fw extends Er{constructor(e,n){super(),this.relayer=e,this.logger=n}}class Lw extends Er{constructor(e,n){super(),this.core=e,this.logger=n}}class kw{constructor(e,n,r){this.core=e,this.logger=n,this.store=r}}class qw{constructor(e,n){this.projectId=e,this.logger=n}}class Mw{constructor(e,n,r){this.core=e,this.logger=n,this.telemetryEnabled=r}}var jw=Object.defineProperty,zw=(t,e,n)=>e in t?jw(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,If=(t,e,n)=>zw(t,typeof e!="symbol"?e+"":e,n);class Vw{constructor(e){this.opts=e,If(this,"protocol","wc"),If(this,"version",2)}}class Hw{constructor(e){this.client=e}}function Kw(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Of(t,...e){if(!Kw(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Af(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Gw(t,e){Of(t);const n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}const Qr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const za=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);function Ww(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function Bf(t){return typeof t=="string"&&(t=Ww(t)),Of(t),t}class Zw{clone(){return this._cloneInto()}}function Yw(t){const e=r=>t().update(Bf(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function Df(t=32){if(Qr&&typeof Qr.getRandomValues=="function")return Qr.getRandomValues(new Uint8Array(t));if(Qr&&typeof Qr.randomBytes=="function")return Qr.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}function Xw(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),c=r?4:0,u=r?0:4;t.setUint32(e+c,o,r),t.setUint32(e+u,a,r)}class Jw extends Zw{constructor(e,n,r,i){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=za(this.buffer)}update(e){Af(this);const{view:n,buffer:r,blockLen:i}=this;e=Bf(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=za(e);for(;i<=s-o;o+=i)this.process(c,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Af(this),Gw(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let h=o;h<i;h++)n[h]=0;Xw(r,i-8,BigInt(this.length*8),s),this.process(r,0);const a=za(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<u;h++)a.setUint32(4*h,l[h],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%n&&e.buffer.set(r),e}}const Ys=BigInt(2**32-1),Va=BigInt(32);function $f(t,e=!1){return e?{h:Number(t&Ys),l:Number(t>>Va&Ys)}:{h:Number(t>>Va&Ys)|0,l:Number(t&Ys)|0}}function Qw(t,e=!1){let n=new Uint32Array(t.length),r=new Uint32Array(t.length);for(let i=0;i<t.length;i++){const{h:s,l:o}=$f(t[i],e);[n[i],r[i]]=[s,o]}return[n,r]}const em=(t,e)=>BigInt(t>>>0)<<Va|BigInt(e>>>0),tm=(t,e,n)=>t>>>n,nm=(t,e,n)=>t<<32-n|e>>>n,rm=(t,e,n)=>t>>>n|e<<32-n,im=(t,e,n)=>t<<32-n|e>>>n,sm=(t,e,n)=>t<<64-n|e>>>n-32,om=(t,e,n)=>t>>>n-32|e<<64-n,am=(t,e)=>e,cm=(t,e)=>t,um=(t,e,n)=>t<<n|e>>>32-n,lm=(t,e,n)=>e<<n|t>>>32-n,fm=(t,e,n)=>e<<n-32|t>>>64-n,hm=(t,e,n)=>t<<n-32|e>>>64-n;function dm(t,e,n,r){const i=(e>>>0)+(r>>>0);return{h:t+n+(i/2**32|0)|0,l:i|0}}const pm=(t,e,n)=>(t>>>0)+(e>>>0)+(n>>>0),gm=(t,e,n,r)=>e+n+r+(t/2**32|0)|0,ym=(t,e,n,r)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0),bm=(t,e,n,r,i)=>e+n+r+i+(t/2**32|0)|0,wm=(t,e,n,r,i)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0)+(i>>>0),mm=(t,e,n,r,i,s)=>e+n+r+i+s+(t/2**32|0)|0,ne={fromBig:$f,split:Qw,toBig:em,shrSH:tm,shrSL:nm,rotrSH:rm,rotrSL:im,rotrBH:sm,rotrBL:om,rotr32H:am,rotr32L:cm,rotlSH:um,rotlSL:lm,rotlBH:fm,rotlBL:hm,add:dm,add3L:pm,add3H:gm,add4L:ym,add4H:bm,add5H:mm,add5L:wm},[vm,Em]=ne.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),qn=new Uint32Array(80),Mn=new Uint32Array(80);class xm extends Jw{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:n,Bh:r,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:u,El:l,Fh:h,Fl:d,Gh:f,Gl:p,Hh:b,Hl:v}=this;return[e,n,r,i,s,o,a,c,u,l,h,d,f,p,b,v]}set(e,n,r,i,s,o,a,c,u,l,h,d,f,p,b,v){this.Ah=e|0,this.Al=n|0,this.Bh=r|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=l|0,this.Fh=h|0,this.Fl=d|0,this.Gh=f|0,this.Gl=p|0,this.Hh=b|0,this.Hl=v|0}process(e,n){for(let _=0;_<16;_++,n+=4)qn[_]=e.getUint32(n),Mn[_]=e.getUint32(n+=4);for(let _=16;_<80;_++){const x=qn[_-15]|0,T=Mn[_-15]|0,R=ne.rotrSH(x,T,1)^ne.rotrSH(x,T,8)^ne.shrSH(x,T,7),F=ne.rotrSL(x,T,1)^ne.rotrSL(x,T,8)^ne.shrSL(x,T,7),U=qn[_-2]|0,$=Mn[_-2]|0,z=ne.rotrSH(U,$,19)^ne.rotrBH(U,$,61)^ne.shrSH(U,$,6),M=ne.rotrSL(U,$,19)^ne.rotrBL(U,$,61)^ne.shrSL(U,$,6),E=ne.add4L(F,M,Mn[_-7],Mn[_-16]),y=ne.add4H(E,R,z,qn[_-7],qn[_-16]);qn[_]=y|0,Mn[_]=E|0}let{Ah:r,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:u,Dl:l,Eh:h,El:d,Fh:f,Fl:p,Gh:b,Gl:v,Hh:A,Hl:D}=this;for(let _=0;_<80;_++){const x=ne.rotrSH(h,d,14)^ne.rotrSH(h,d,18)^ne.rotrBH(h,d,41),T=ne.rotrSL(h,d,14)^ne.rotrSL(h,d,18)^ne.rotrBL(h,d,41),R=h&f^~h&b,F=d&p^~d&v,U=ne.add5L(D,T,F,Em[_],Mn[_]),$=ne.add5H(U,A,x,R,vm[_],qn[_]),z=U|0,M=ne.rotrSH(r,i,28)^ne.rotrBH(r,i,34)^ne.rotrBH(r,i,39),E=ne.rotrSL(r,i,28)^ne.rotrBL(r,i,34)^ne.rotrBL(r,i,39),y=r&s^r&a^s&a,m=i&o^i&c^o&c;A=b|0,D=v|0,b=f|0,v=p|0,f=h|0,p=d|0,{h,l:d}=ne.add(u|0,l|0,$|0,z|0),u=a|0,l=c|0,a=s|0,c=o|0,s=r|0,o=i|0;const g=ne.add3L(z,E,m);r=ne.add3H(g,$,M,y),i=g|0}({h:r,l:i}=ne.add(this.Ah|0,this.Al|0,r|0,i|0)),{h:s,l:o}=ne.add(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=ne.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l}=ne.add(this.Dh|0,this.Dl|0,u|0,l|0),{h,l:d}=ne.add(this.Eh|0,this.El|0,h|0,d|0),{h:f,l:p}=ne.add(this.Fh|0,this.Fl|0,f|0,p|0),{h:b,l:v}=ne.add(this.Gh|0,this.Gl|0,b|0,v|0),{h:A,l:D}=ne.add(this.Hh|0,this.Hl|0,A|0,D|0),this.set(r,i,s,o,a,c,u,l,h,d,f,p,b,v,A,D)}roundClean(){qn.fill(0),Mn.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const _m=Yw(()=>new xm);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Ha=BigInt(0),Tf=BigInt(1),Sm=BigInt(2);function Ka(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Ga(t){if(!Ka(t))throw new Error("Uint8Array expected")}function Wa(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const Im=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Za(t){Ga(t);let e="";for(let n=0;n<t.length;n++)e+=Im[t[n]];return e}function Pf(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Ha:BigInt("0x"+t)}const dn={_0:48,_9:57,A:65,F:70,a:97,f:102};function Rf(t){if(t>=dn._0&&t<=dn._9)return t-dn._0;if(t>=dn.A&&t<=dn.F)return t-(dn.A-10);if(t>=dn.a&&t<=dn.f)return t-(dn.a-10)}function Nf(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,n=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(n);for(let i=0,s=0;i<n;i++,s+=2){const o=Rf(t.charCodeAt(s)),a=Rf(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}r[i]=o*16+a}return r}function Om(t){return Pf(Za(t))}function Xs(t){return Ga(t),Pf(Za(Uint8Array.from(t).reverse()))}function Cf(t,e){return Nf(t.toString(16).padStart(e*2,"0"))}function Ya(t,e){return Cf(t,e).reverse()}function pn(t,e,n){let r;if(typeof e=="string")try{r=Nf(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(Ka(e))r=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=r.length;if(typeof n=="number"&&i!==n)throw new Error(t+" of length "+n+" expected, got "+i);return r}function Uf(...t){let e=0;for(let r=0;r<t.length;r++){const i=t[r];Ga(i),e+=i.length}const n=new Uint8Array(e);for(let r=0,i=0;r<t.length;r++){const s=t[r];n.set(s,i),i+=s.length}return n}const Xa=t=>typeof t=="bigint"&&Ha<=t;function Am(t,e,n){return Xa(t)&&Xa(e)&&Xa(n)&&e<=t&&t<n}function Li(t,e,n,r){if(!Am(e,n,r))throw new Error("expected valid "+t+": "+n+" <= n < "+r+", got "+e)}function Bm(t){let e;for(e=0;t>Ha;t>>=Tf,e+=1);return e}const Dm=t=>(Sm<<BigInt(t-1))-Tf,$m={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||Ka(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Ja(t,e,n={}){const r=(i,s,o)=>{const a=$m[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[i];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(i)+" is invalid. Expected "+s+", got "+c)};for(const[i,s]of Object.entries(e))r(i,s,!1);for(const[i,s]of Object.entries(n))r(i,s,!0);return t}function Ff(t){const e=new WeakMap;return(n,...r)=>{const i=e.get(n);if(i!==void 0)return i;const s=t(n,...r);return e.set(n,s),s}}const Ne=BigInt(0),_e=BigInt(1),Ir=BigInt(2),Tm=BigInt(3),Qa=BigInt(4),Lf=BigInt(5),kf=BigInt(8);function Be(t,e){const n=t%e;return n>=Ne?n:e+n}function Pm(t,e,n){if(e<Ne)throw new Error("invalid exponent, negatives unsupported");if(n<=Ne)throw new Error("invalid modulus");if(n===_e)return Ne;let r=_e;for(;e>Ne;)e&_e&&(r=r*t%n),t=t*t%n,e>>=_e;return r}function tn(t,e,n){let r=t;for(;e-- >Ne;)r*=r,r%=n;return r}function qf(t,e){if(t===Ne)throw new Error("invert: expected non-zero number");if(e<=Ne)throw new Error("invert: expected positive modulus, got "+e);let n=Be(t,e),r=e,i=Ne,s=_e;for(;n!==Ne;){const o=r/n,a=r%n,c=i-s*o;r=n,n=a,i=s,s=c}if(r!==_e)throw new Error("invert: does not exist");return Be(i,e)}function Rm(t){const e=(t-_e)/Ir;let n,r,i;for(n=t-_e,r=0;n%Ir===Ne;n/=Ir,r++);for(i=Ir;i<t&&Pm(i,e,t)!==t-_e;i++)if(i>1e3)throw new Error("Cannot find square root: likely non-prime P");if(r===1){const o=(t+_e)/Qa;return function(a,c){const u=a.pow(c,o);if(!a.eql(a.sqr(u),c))throw new Error("Cannot find square root");return u}}const s=(n+_e)/Ir;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=r,u=o.pow(o.mul(o.ONE,i),n),l=o.pow(a,s),h=o.pow(a,n);for(;!o.eql(h,o.ONE);){if(o.eql(h,o.ZERO))return o.ZERO;let d=1;for(let p=o.sqr(h);d<c&&!o.eql(p,o.ONE);d++)p=o.sqr(p);const f=o.pow(u,_e<<BigInt(c-d-1));u=o.sqr(f),l=o.mul(l,f),h=o.mul(h,u),c=d}return l}}function Nm(t){if(t%Qa===Tm){const e=(t+_e)/Qa;return function(n,r){const i=n.pow(r,e);if(!n.eql(n.sqr(i),r))throw new Error("Cannot find square root");return i}}if(t%kf===Lf){const e=(t-Lf)/kf;return function(n,r){const i=n.mul(r,Ir),s=n.pow(i,e),o=n.mul(r,s),a=n.mul(n.mul(o,Ir),s),c=n.mul(o,n.sub(a,n.ONE));if(!n.eql(n.sqr(c),r))throw new Error("Cannot find square root");return c}}return Rm(t)}const Cm=(t,e)=>(Be(t,e)&_e)===_e,Um=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Fm(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=Um.reduce((r,i)=>(r[i]="function",r),e);return Ja(t,n)}function Lm(t,e,n){if(n<Ne)throw new Error("invalid exponent, negatives unsupported");if(n===Ne)return t.ONE;if(n===_e)return e;let r=t.ONE,i=e;for(;n>Ne;)n&_e&&(r=t.mul(r,i)),i=t.sqr(i),n>>=_e;return r}function km(t,e){const n=new Array(e.length),r=e.reduce((s,o,a)=>t.is0(o)?s:(n[a]=s,t.mul(s,o)),t.ONE),i=t.inv(r);return e.reduceRight((s,o,a)=>t.is0(o)?s:(n[a]=t.mul(s,n[a]),t.mul(s,o)),i),n}function Mf(t,e){const n=e!==void 0?e:t.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function jf(t,e,n=!1,r={}){if(t<=Ne)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:i,nByteLength:s}=Mf(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:n,BITS:i,BYTES:s,MASK:Dm(i),ZERO:Ne,ONE:_e,create:c=>Be(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return Ne<=c&&c<t},is0:c=>c===Ne,isOdd:c=>(c&_e)===_e,neg:c=>Be(-c,t),eql:(c,u)=>c===u,sqr:c=>Be(c*c,t),add:(c,u)=>Be(c+u,t),sub:(c,u)=>Be(c-u,t),mul:(c,u)=>Be(c*u,t),pow:(c,u)=>Lm(a,c,u),div:(c,u)=>Be(c*qf(u,t),t),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>qf(c,t),sqrt:r.sqrt||(c=>(o||(o=Nm(t)),o(a,c))),invertBatch:c=>km(a,c),cmov:(c,u,l)=>l?u:c,toBytes:c=>n?Ya(c,s):Cf(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return n?Xs(c):Om(c)}});return Object.freeze(a)}const zf=BigInt(0),Js=BigInt(1);function ec(t,e){const n=e.negate();return t?n:e}function Vf(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function tc(t,e){Vf(t,e);const n=Math.ceil(e/t)+1,r=2**(t-1);return{windows:n,windowSize:r}}function qm(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((n,r)=>{if(!(n instanceof e))throw new Error("invalid point at index "+r)})}function Mm(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((n,r)=>{if(!e.isValid(n))throw new Error("invalid scalar at index "+r)})}const nc=new WeakMap,Hf=new WeakMap;function rc(t){return Hf.get(t)||1}function jm(t,e){return{constTimeNegate:ec,hasPrecomputes(n){return rc(n)!==1},unsafeLadder(n,r,i=t.ZERO){let s=n;for(;r>zf;)r&Js&&(i=i.add(s)),s=s.double(),r>>=Js;return i},precomputeWindow(n,r){const{windows:i,windowSize:s}=tc(r,e),o=[];let a=n,c=a;for(let u=0;u<i;u++){c=a,o.push(c);for(let l=1;l<s;l++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(n,r,i){const{windows:s,windowSize:o}=tc(n,e);let a=t.ZERO,c=t.BASE;const u=BigInt(2**n-1),l=2**n,h=BigInt(n);for(let d=0;d<s;d++){const f=d*o;let p=Number(i&u);i>>=h,p>o&&(p-=l,i+=Js);const b=f,v=f+Math.abs(p)-1,A=d%2!==0,D=p<0;p===0?c=c.add(ec(A,r[b])):a=a.add(ec(D,r[v]))}return{p:a,f:c}},wNAFUnsafe(n,r,i,s=t.ZERO){const{windows:o,windowSize:a}=tc(n,e),c=BigInt(2**n-1),u=2**n,l=BigInt(n);for(let h=0;h<o;h++){const d=h*a;if(i===zf)break;let f=Number(i&c);if(i>>=l,f>a&&(f-=u,i+=Js),f===0)continue;let p=r[d+Math.abs(f)-1];f<0&&(p=p.negate()),s=s.add(p)}return s},getPrecomputes(n,r,i){let s=nc.get(r);return s||(s=this.precomputeWindow(r,n),n!==1&&nc.set(r,i(s))),s},wNAFCached(n,r,i){const s=rc(n);return this.wNAF(s,this.getPrecomputes(s,n,i),r)},wNAFCachedUnsafe(n,r,i,s){const o=rc(n);return o===1?this.unsafeLadder(n,r,s):this.wNAFUnsafe(o,this.getPrecomputes(o,n,i),r,s)},setWindowSize(n,r){Vf(r,e),Hf.set(n,r),nc.delete(n)}}}function zm(t,e,n,r){if(qm(n,t),Mm(r,e),n.length!==r.length)throw new Error("arrays of points and scalars must have equal length");const i=t.ZERO,s=Bm(BigInt(n.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=(1<<o)-1,c=new Array(a+1).fill(i),u=Math.floor((e.BITS-1)/o)*o;let l=i;for(let h=u;h>=0;h-=o){c.fill(i);for(let f=0;f<r.length;f++){const p=r[f],b=Number(p>>BigInt(h)&BigInt(a));c[b]=c[b].add(n[f])}let d=i;for(let f=c.length-1,p=i;f>0;f--)p=p.add(c[f]),d=d.add(p);if(l=l.add(d),h!==0)for(let f=0;f<o;f++)l=l.double()}return l}function Vm(t){return Fm(t.Fp),Ja(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Mf(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const zt=BigInt(0),pt=BigInt(1),Qs=BigInt(2),Hm=BigInt(8),Km={zip215:!0};function Gm(t){const e=Vm(t);return Ja(t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function Wm(t){const e=Gm(t),{Fp:n,n:r,prehash:i,hash:s,randomBytes:o,nByteLength:a,h:c}=e,u=Qs<<BigInt(a*8)-pt,l=n.create,h=jf(e.n,e.nBitLength),d=e.uvRatio||((g,w)=>{try{return{isValid:!0,value:n.sqrt(g*n.inv(w))}}catch{return{isValid:!1,value:zt}}}),f=e.adjustScalarBytes||(g=>g),p=e.domain||((g,w,S)=>{if(Wa("phflag",S),w.length||S)throw new Error("Contexts/pre-hash are not supported");return g});function b(g,w){Li("coordinate "+g,w,zt,u)}function v(g){if(!(g instanceof _))throw new Error("ExtendedPoint expected")}const A=Ff((g,w)=>{const{ex:S,ey:O,ez:I}=g,B=g.is0();w==null&&(w=B?Hm:n.inv(I));const P=l(S*w),L=l(O*w),C=l(I*w);if(B)return{x:zt,y:pt};if(C!==pt)throw new Error("invZ was invalid");return{x:P,y:L}}),D=Ff(g=>{const{a:w,d:S}=e;if(g.is0())throw new Error("bad point: ZERO");const{ex:O,ey:I,ez:B,et:P}=g,L=l(O*O),C=l(I*I),k=l(B*B),N=l(k*k),q=l(L*w),j=l(k*l(q+C)),W=l(N+l(S*l(L*C)));if(j!==W)throw new Error("bad point: equation left != right (1)");const H=l(O*I),Z=l(B*P);if(H!==Z)throw new Error("bad point: equation left != right (2)");return!0});class _{constructor(w,S,O,I){this.ex=w,this.ey=S,this.ez=O,this.et=I,b("x",w),b("y",S),b("z",O),b("t",I),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(w){if(w instanceof _)throw new Error("extended point not allowed");const{x:S,y:O}=w||{};return b("x",S),b("y",O),new _(S,O,pt,l(S*O))}static normalizeZ(w){const S=n.invertBatch(w.map(O=>O.ez));return w.map((O,I)=>O.toAffine(S[I])).map(_.fromAffine)}static msm(w,S){return zm(_,h,w,S)}_setWindowSize(w){R.setWindowSize(this,w)}assertValidity(){D(this)}equals(w){v(w);const{ex:S,ey:O,ez:I}=this,{ex:B,ey:P,ez:L}=w,C=l(S*L),k=l(B*I),N=l(O*L),q=l(P*I);return C===k&&N===q}is0(){return this.equals(_.ZERO)}negate(){return new _(l(-this.ex),this.ey,this.ez,l(-this.et))}double(){const{a:w}=e,{ex:S,ey:O,ez:I}=this,B=l(S*S),P=l(O*O),L=l(Qs*l(I*I)),C=l(w*B),k=S+O,N=l(l(k*k)-B-P),q=C+P,j=q-L,W=C-P,H=l(N*j),Z=l(q*W),Q=l(N*W),ee=l(j*q);return new _(H,Z,ee,Q)}add(w){v(w);const{a:S,d:O}=e,{ex:I,ey:B,ez:P,et:L}=this,{ex:C,ey:k,ez:N,et:q}=w;if(S===BigInt(-1)){const By=l((B-I)*(k+C)),Dy=l((B+I)*(k-C)),Ml=l(Dy-By);if(Ml===zt)return this.double();const $y=l(P*Qs*q),Ty=l(L*Qs*N),Py=Ty+$y,Ry=Dy+By,Ny=Ty-$y,cD=l(Py*Ml),uD=l(Ry*Ny),lD=l(Py*Ny),fD=l(Ml*Ry);return new _(cD,uD,fD,lD)}const j=l(I*C),W=l(B*k),H=l(L*O*q),Z=l(P*N),Q=l((I+B)*(C+k)-j-W),ee=Z-H,se=Z+H,he=l(W-S*j),Ee=l(Q*ee),kn=l(se*he),Aa=l(Q*he),aD=l(ee*se);return new _(Ee,kn,aD,Aa)}subtract(w){return this.add(w.negate())}wNAF(w){return R.wNAFCached(this,w,_.normalizeZ)}multiply(w){const S=w;Li("scalar",S,pt,r);const{p:O,f:I}=this.wNAF(S);return _.normalizeZ([O,I])[0]}multiplyUnsafe(w,S=_.ZERO){const O=w;return Li("scalar",O,zt,r),O===zt?T:this.is0()||O===pt?this:R.wNAFCachedUnsafe(this,O,_.normalizeZ,S)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return R.unsafeLadder(this,r).is0()}toAffine(w){return A(this,w)}clearCofactor(){const{h:w}=e;return w===pt?this:this.multiplyUnsafe(w)}static fromHex(w,S=!1){const{d:O,a:I}=e,B=n.BYTES;w=pn("pointHex",w,B),Wa("zip215",S);const P=w.slice(),L=w[B-1];P[B-1]=L&-129;const C=Xs(P),k=S?u:n.ORDER;Li("pointHex.y",C,zt,k);const N=l(C*C),q=l(N-pt),j=l(O*N-I);let{isValid:W,value:H}=d(q,j);if(!W)throw new Error("Point.fromHex: invalid y coordinate");const Z=(H&pt)===pt,Q=(L&128)!==0;if(!S&&H===zt&&Q)throw new Error("Point.fromHex: x=0 and x_0=1");return Q!==Z&&(H=l(-H)),_.fromAffine({x:H,y:C})}static fromPrivateKey(w){return $(w).point}toRawBytes(){const{x:w,y:S}=this.toAffine(),O=Ya(S,n.BYTES);return O[O.length-1]|=w&pt?128:0,O}toHex(){return Za(this.toRawBytes())}}_.BASE=new _(e.Gx,e.Gy,pt,l(e.Gx*e.Gy)),_.ZERO=new _(zt,pt,pt,zt);const{BASE:x,ZERO:T}=_,R=jm(_,a*8);function F(g){return Be(g,r)}function U(g){return F(Xs(g))}function $(g){const w=n.BYTES;g=pn("private key",g,w);const S=pn("hashed private key",s(g),2*w),O=f(S.slice(0,w)),I=S.slice(w,2*w),B=U(O),P=x.multiply(B),L=P.toRawBytes();return{head:O,prefix:I,scalar:B,point:P,pointBytes:L}}function z(g){return $(g).pointBytes}function M(g=new Uint8Array,...w){const S=Uf(...w);return U(s(p(S,pn("context",g),!!i)))}function E(g,w,S={}){g=pn("message",g),i&&(g=i(g));const{prefix:O,scalar:I,pointBytes:B}=$(w),P=M(S.context,O,g),L=x.multiply(P).toRawBytes(),C=M(S.context,L,B,g),k=F(P+C*I);Li("signature.s",k,zt,r);const N=Uf(L,Ya(k,n.BYTES));return pn("result",N,n.BYTES*2)}const y=Km;function m(g,w,S,O=y){const{context:I,zip215:B}=O,P=n.BYTES;g=pn("signature",g,2*P),w=pn("message",w),S=pn("publicKey",S,P),B!==void 0&&Wa("zip215",B),i&&(w=i(w));const L=Xs(g.slice(P,2*P));let C,k,N;try{C=_.fromHex(S,B),k=_.fromHex(g.slice(0,P),B),N=x.multiplyUnsafe(L)}catch{return!1}if(!B&&C.isSmallOrder())return!1;const q=M(I,k.toRawBytes(),C.toRawBytes(),w);return k.add(C.multiplyUnsafe(q)).subtract(N).clearCofactor().equals(_.ZERO)}return x._setWindowSize(8),{CURVE:e,getPublicKey:z,sign:E,verify:m,ExtendedPoint:_,utils:{getExtendedPublicKey:$,randomPrivateKey:()=>o(n.BYTES),precompute(g=8,w=_.BASE){return w._setWindowSize(g),w.multiply(BigInt(3)),w}}}}BigInt(0),BigInt(1);const ic=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Kf=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const Zm=BigInt(1),Gf=BigInt(2);BigInt(3);const Ym=BigInt(5),Xm=BigInt(8);function Jm(t){const e=BigInt(10),n=BigInt(20),r=BigInt(40),i=BigInt(80),s=ic,o=t*t%s*t%s,a=tn(o,Gf,s)*o%s,c=tn(a,Zm,s)*t%s,u=tn(c,Ym,s)*c%s,l=tn(u,e,s)*u%s,h=tn(l,n,s)*l%s,d=tn(h,r,s)*h%s,f=tn(d,i,s)*d%s,p=tn(f,i,s)*d%s,b=tn(p,e,s)*u%s;return{pow_p_5_8:tn(b,Gf,s)*t%s,b2:o}}function Qm(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function e2(t,e){const n=ic,r=Be(e*e*e,n),i=Be(r*r*e,n),s=Jm(t*i).pow_p_5_8;let o=Be(t*r*s,n);const a=Be(e*o*o,n),c=o,u=Be(o*Kf,n),l=a===t,h=a===Be(-t,n),d=a===Be(-t*Kf,n);return l&&(o=c),(h||d)&&(o=u),Cm(o,n)&&(o=Be(-o,n)),{isValid:l||h,value:o}}const t2=jf(ic,void 0,!0),n2={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:t2,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:Xm,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:_m,randomBytes:Df,adjustScalarBytes:Qm,uvRatio:e2},Wf=Wm(n2),r2="EdDSA",i2="JWT",eo=".",to="base64url",Zf="utf8",Yf="utf8",s2=":",o2="did",a2="key",Xf="base58btc",c2="z",u2="K36",l2=32;function sc(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function Jf(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?sc(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function Qf(t,e){e||(e=t.reduce((i,s)=>i+s.length,0));const n=Jf(e);let r=0;for(const i of t)n.set(i,r),r+=i.length;return sc(n)}function f2(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),o=s.charCodeAt(0);if(n[o]!==255)throw new TypeError(s+" is ambiguous");n[o]=i}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var b=0,v=0,A=0,D=p.length;A!==D&&p[A]===0;)A++,b++;for(var _=(D-A)*l+1>>>0,x=new Uint8Array(_);A!==D;){for(var T=p[A],R=0,F=_-1;(T!==0||R<v)&&F!==-1;F--,R++)T+=256*x[F]>>>0,x[F]=T%a>>>0,T=T/a>>>0;if(T!==0)throw new Error("Non-zero carry");v=R,A++}for(var U=_-v;U!==_&&x[U]===0;)U++;for(var $=c.repeat(b);U<_;++U)$+=t.charAt(x[U]);return $}function d(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var b=0;if(p[b]!==" "){for(var v=0,A=0;p[b]===c;)v++,b++;for(var D=(p.length-b)*u+1>>>0,_=new Uint8Array(D);p[b];){var x=n[p.charCodeAt(b)];if(x===255)return;for(var T=0,R=D-1;(x!==0||T<A)&&R!==-1;R--,T++)x+=a*_[R]>>>0,_[R]=x%256>>>0,x=x/256>>>0;if(x!==0)throw new Error("Non-zero carry");A=T,b++}if(p[b]!==" "){for(var F=D-A;F!==D&&_[F]===0;)F++;for(var U=new Uint8Array(v+(D-F)),$=v;F!==D;)U[$++]=_[F++];return U}}}function f(p){var b=d(p);if(b)return b;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:d,decode:f}}var h2=f2,d2=h2;const eh=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},p2=t=>new TextEncoder().encode(t),g2=t=>new TextDecoder().decode(t);class y2{constructor(e,n,r){this.name=e,this.prefix=n,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class b2{constructor(e,n,r){if(this.name=e,this.prefix=n,n.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=n.codePointAt(0),this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return th(this,e)}}class w2{constructor(e){this.decoders=e}or(e){return th(this,e)}decode(e){const n=e[0],r=this.decoders[n];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const th=(t,e)=>new w2({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class m2{constructor(e,n,r,i){this.name=e,this.prefix=n,this.baseEncode=r,this.baseDecode=i,this.encoder=new y2(e,n,r),this.decoder=new b2(e,n,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const no=({name:t,prefix:e,encode:n,decode:r})=>new m2(t,e,n,r),ki=({prefix:t,name:e,alphabet:n})=>{const{encode:r,decode:i}=d2(n,e);return no({prefix:t,name:e,encode:r,decode:s=>eh(i(s))})},v2=(t,e,n,r)=>{const i={};for(let l=0;l<e.length;++l)i[e[l]]=l;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*n/8|0);let a=0,c=0,u=0;for(let l=0;l<s;++l){const h=i[t[l]];if(h===void 0)throw new SyntaxError(`Non-${r} character`);c=c<<n|h,a+=n,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=n||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},E2=(t,e,n)=>{const r=e[e.length-1]==="=",i=(1<<n)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>n;)o-=n,s+=e[i&a>>o];if(o&&(s+=e[i&a<<n-o]),r)for(;s.length*n&7;)s+="=";return s},Le=({name:t,prefix:e,bitsPerChar:n,alphabet:r})=>no({prefix:e,name:t,encode(i){return E2(i,r,n)},decode(i){return v2(i,r,n,t)}}),x2=no({prefix:"\0",name:"identity",encode:t=>g2(t),decode:t=>p2(t)});var _2=Object.freeze({__proto__:null,identity:x2});const S2=Le({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var I2=Object.freeze({__proto__:null,base2:S2});const O2=Le({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var A2=Object.freeze({__proto__:null,base8:O2});const B2=ki({prefix:"9",name:"base10",alphabet:"0123456789"});var D2=Object.freeze({__proto__:null,base10:B2});const $2=Le({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),T2=Le({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var P2=Object.freeze({__proto__:null,base16:$2,base16upper:T2});const R2=Le({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),N2=Le({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),C2=Le({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),U2=Le({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),F2=Le({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),L2=Le({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),k2=Le({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),q2=Le({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),M2=Le({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var j2=Object.freeze({__proto__:null,base32:R2,base32upper:N2,base32pad:C2,base32padupper:U2,base32hex:F2,base32hexupper:L2,base32hexpad:k2,base32hexpadupper:q2,base32z:M2});const z2=ki({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),V2=ki({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var H2=Object.freeze({__proto__:null,base36:z2,base36upper:V2});const K2=ki({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),G2=ki({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var W2=Object.freeze({__proto__:null,base58btc:K2,base58flickr:G2});const Z2=Le({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Y2=Le({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),X2=Le({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),J2=Le({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Q2=Object.freeze({__proto__:null,base64:Z2,base64pad:Y2,base64url:X2,base64urlpad:J2});const nh=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),ev=nh.reduce((t,e,n)=>(t[n]=e,t),[]),tv=nh.reduce((t,e,n)=>(t[e.codePointAt(0)]=n,t),[]);function nv(t){return t.reduce((e,n)=>(e+=ev[n],e),"")}function rv(t){const e=[];for(const n of t){const r=tv[n.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${n}`);e.push(r)}return new Uint8Array(e)}const iv=no({prefix:"\u{1F680}",name:"base256emoji",encode:nv,decode:rv});var sv=Object.freeze({__proto__:null,base256emoji:iv}),ov=ih,rh=128,av=127,cv=~av,uv=Math.pow(2,31);function ih(t,e,n){e=e||[],n=n||0;for(var r=n;t>=uv;)e[n++]=t&255|rh,t/=128;for(;t&cv;)e[n++]=t&255|rh,t>>>=7;return e[n]=t|0,ih.bytes=n-r+1,e}var lv=oc,fv=128,sh=127;function oc(t,r){var n=0,r=r||0,i=0,s=r,o,a=t.length;do{if(s>=a)throw oc.bytes=0,new RangeError("Could not decode varint");o=t[s++],n+=i<28?(o&sh)<<i:(o&sh)*Math.pow(2,i),i+=7}while(o>=fv);return oc.bytes=s-r,n}var hv=Math.pow(2,7),dv=Math.pow(2,14),pv=Math.pow(2,21),gv=Math.pow(2,28),yv=Math.pow(2,35),bv=Math.pow(2,42),wv=Math.pow(2,49),mv=Math.pow(2,56),vv=Math.pow(2,63),Ev=function(t){return t<hv?1:t<dv?2:t<pv?3:t<gv?4:t<yv?5:t<bv?6:t<wv?7:t<mv?8:t<vv?9:10},xv={encode:ov,decode:lv,encodingLength:Ev},oh=xv;const ah=(t,e,n=0)=>(oh.encode(t,e,n),e),ch=t=>oh.encodingLength(t),ac=(t,e)=>{const n=e.byteLength,r=ch(t),i=r+ch(n),s=new Uint8Array(i+n);return ah(t,s,0),ah(n,s,r),s.set(e,i),new _v(t,n,e,s)};class _v{constructor(e,n,r,i){this.code=e,this.size=n,this.digest=r,this.bytes=i}}const uh=({name:t,code:e,encode:n})=>new Sv(t,e,n);class Sv{constructor(e,n,r){this.name=e,this.code=n,this.encode=r}digest(e){if(e instanceof Uint8Array){const n=this.encode(e);return n instanceof Uint8Array?ac(this.code,n):n.then(r=>ac(this.code,r))}else throw Error("Unknown type, must be binary type")}}const lh=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),Iv=uh({name:"sha2-256",code:18,encode:lh("SHA-256")}),Ov=uh({name:"sha2-512",code:19,encode:lh("SHA-512")});var Av=Object.freeze({__proto__:null,sha256:Iv,sha512:Ov});const fh=0,Bv="identity",hh=eh;var Dv=Object.freeze({__proto__:null,identity:{code:fh,name:Bv,encode:hh,digest:t=>ac(fh,hh(t))}});new TextEncoder,new TextDecoder;const dh={..._2,...I2,...A2,...D2,...P2,...j2,...H2,...W2,...Q2,...sv};({...Av,...Dv});function ph(t,e,n,r){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:n},decoder:{decode:r}}}const gh=ph("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),cc=ph("ascii","a",t=>{let e="a";for(let n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return e},t=>{t=t.substring(1);const e=Jf(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}),yh={utf8:gh,"utf-8":gh,hex:dh.base16,latin1:cc,ascii:cc,binary:cc,...dh};function ro(t,e="utf8"){const n=yh[e];if(!n)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):n.encoder.encode(t).substring(1)}function ei(t,e="utf8"){const n=yh[e];if(!n)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?sc(globalThis.Buffer.from(t,"utf-8")):n.decoder.decode(`${n.prefix}${t}`)}function bh(t){return Yr(ro(ei(t,to),Zf))}function io(t){return ro(ei(Sr(t),Zf),to)}function wh(t){const e=ei(u2,Xf),n=c2+ro(Qf([e,t]),Xf);return[o2,a2,n].join(s2)}function $v(t){return ro(t,to)}function Tv(t){return ei(t,to)}function Pv(t){return ei([io(t.header),io(t.payload)].join(eo),Yf)}function Rv(t){return[io(t.header),io(t.payload),$v(t.signature)].join(eo)}function uc(t){const e=t.split(eo),n=bh(e[0]),r=bh(e[1]),i=Tv(e[2]),s=ei(e.slice(0,2).join(eo),Yf);return{header:n,payload:r,signature:i,data:s}}function mh(t=Df(l2)){const e=Wf.getPublicKey(t);return{secretKey:Qf([t,e]),publicKey:e}}async function Nv(t,e,n,r,i=K.fromMiliseconds(Date.now())){const s={alg:r2,typ:i2},o=wh(r.publicKey),a=i+n,c={iss:o,sub:t,aud:e,iat:i,exp:a},u=Pv({header:s,payload:c}),l=Wf.sign(u,r.secretKey.slice(0,32));return Rv({header:s,payload:c,signature:l})}var vh=function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))},Cv=function(){function t(e,n,r){this.name=e,this.version=n,this.os=r,this.type="browser"}return t}(),Uv=function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return t}(),Fv=function(){function t(e,n,r,i){this.name=e,this.version=n,this.os=r,this.bot=i,this.type="bot-device"}return t}(),Lv=function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t}(),kv=function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t}(),qv=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,Mv=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,Eh=3,jv=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",qv]],xh=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function zv(t){return t?_h(t):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new kv:typeof navigator<"u"?_h(navigator.userAgent):Kv()}function Vv(t){return t!==""&&jv.reduce(function(e,n){var r=n[0],i=n[1];if(e)return e;var s=i.exec(t);return!!s&&[r,s]},!1)}function _h(t){var e=Vv(t);if(!e)return null;var n=e[0],r=e[1];if(n==="searchbot")return new Lv;var i=r[1]&&r[1].split(".").join("_").split("_").slice(0,3);i?i.length<Eh&&(i=vh(vh([],i,!0),Gv(Eh-i.length),!0)):i=[];var s=i.join("."),o=Hv(t),a=Mv.exec(t);return a&&a[1]?new Fv(n,s,o,a[1]):new Cv(n,s,o)}function Hv(t){for(var e=0,n=xh.length;e<n;e++){var r=xh[e],i=r[0],s=r[1],o=s.exec(t);if(o)return i}return null}function Kv(){var t=typeof process<"u"&&process.version;return t?new Uv(process.version.slice(1)):null}function Gv(t){for(var e=[],n=0;n<t;n++)e.push("0");return e}var we={};Object.defineProperty(we,"__esModule",{value:!0}),we.getLocalStorage=we.getLocalStorageOrThrow=we.getCrypto=we.getCryptoOrThrow=Sh=we.getLocation=we.getLocationOrThrow=lc=we.getNavigator=we.getNavigatorOrThrow=Ar=we.getDocument=we.getDocumentOrThrow=we.getFromWindowOrThrow=we.getFromWindow=void 0;function Or(t){let e;return typeof window<"u"&&typeof window[t]<"u"&&(e=window[t]),e}we.getFromWindow=Or;function ti(t){const e=Or(t);if(!e)throw new Error(`${t} is not defined in Window`);return e}we.getFromWindowOrThrow=ti;function Wv(){return ti("document")}we.getDocumentOrThrow=Wv;function Zv(){return Or("document")}var Ar=we.getDocument=Zv;function Yv(){return ti("navigator")}we.getNavigatorOrThrow=Yv;function Xv(){return Or("navigator")}var lc=we.getNavigator=Xv;function Jv(){return ti("location")}we.getLocationOrThrow=Jv;function Qv(){return Or("location")}var Sh=we.getLocation=Qv;function eE(){return ti("crypto")}we.getCryptoOrThrow=eE;function tE(){return Or("crypto")}we.getCrypto=tE;function nE(){return ti("localStorage")}we.getLocalStorageOrThrow=nE;function rE(){return Or("localStorage")}we.getLocalStorage=rE;var fc={};Object.defineProperty(fc,"__esModule",{value:!0});var Ih=fc.getWindowMetadata=void 0;const Oh=we;function iE(){let t,e;try{t=Oh.getDocumentOrThrow(),e=Oh.getLocationOrThrow()}catch{return null}function n(){const h=t.getElementsByTagName("link"),d=[];for(let f=0;f<h.length;f++){const p=h[f],b=p.getAttribute("rel");if(b&&b.toLowerCase().indexOf("icon")>-1){const v=p.getAttribute("href");if(v)if(v.toLowerCase().indexOf("https:")===-1&&v.toLowerCase().indexOf("http:")===-1&&v.indexOf("//")!==0){let A=e.protocol+"//"+e.host;if(v.indexOf("/")===0)A+=v;else{const D=e.pathname.split("/");D.pop();const _=D.join("/");A+=_+"/"+v}d.push(A)}else if(v.indexOf("//")===0){const A=e.protocol+v;d.push(A)}else d.push(v)}}return d}function r(...h){const d=t.getElementsByTagName("meta");for(let f=0;f<d.length;f++){const p=d[f],b=["itemprop","property","name"].map(v=>p.getAttribute(v)).filter(v=>v?h.includes(v):!1);if(b.length&&b){const v=p.getAttribute("content");if(v)return v}}return""}function i(){let h=r("name","og:site_name","og:title","twitter:title");return h||(h=t.title),h}function s(){return r("description","og:description","twitter:description","keywords")}const o=i(),a=s(),c=e.origin,u=n();return{description:a,url:c,icons:u,name:o}}Ih=fc.getWindowMetadata=iE;const sE="0.1.1";function oE(){return sE}class ye extends Error{constructor(e,n={}){const r=(()=>{if(n.cause instanceof ye){if(n.cause.details)return n.cause.details;if(n.cause.shortMessage)return n.cause.shortMessage}return n.cause&&"details"in n.cause&&typeof n.cause.details=="string"?n.cause.details:n.cause?.message?n.cause.message:n.details})(),i=n.cause instanceof ye&&n.cause.docsPath||n.docsPath,o=`https://oxlib.sh${i??""}`,a=[e||"An error occurred.",...n.metaMessages?["",...n.metaMessages]:[],...r||i?["",r?`Details: ${r}`:void 0,i?`See: ${o}`:void 0]:[]].filter(c=>typeof c=="string").join(`
`);super(a,n.cause?{cause:n.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:`ox@${oE()}`}),this.cause=n.cause,this.details=r,this.docs=o,this.docsPath=i,this.shortMessage=e}walk(e){return Ah(this,e)}}function Ah(t,e){return e?.(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause?Ah(t.cause,e):e?null:t}const ni=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function so(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function ri(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function gn(t,...e){if(!so(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Bh(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");ri(t.outputLen),ri(t.blockLen)}function ii(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Dh(t,e){gn(t);const n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function aE(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function jn(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function hc(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function nn(t,e){return t<<32-e|t>>>e}const cE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function uE(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function lE(t){for(let e=0;e<t.length;e++)t[e]=uE(t[e]);return t}const $h=cE?t=>t:lE,Th=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",fE=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function si(t){if(gn(t),Th)return t.toHex();let e="";for(let n=0;n<t.length;n++)e+=fE[t[n]];return e}const yn={_0:48,_9:57,A:65,F:70,a:97,f:102};function Ph(t){if(t>=yn._0&&t<=yn._9)return t-yn._0;if(t>=yn.A&&t<=yn.F)return t-(yn.A-10);if(t>=yn.a&&t<=yn.f)return t-(yn.a-10)}function oo(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(Th)return Uint8Array.fromHex(t);const e=t.length,n=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(n);for(let i=0,s=0;i<n;i++,s+=2){const o=Ph(t.charCodeAt(s)),a=Ph(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}r[i]=o*16+a}return r}function dc(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function ao(t){return typeof t=="string"&&(t=dc(t)),gn(t),t}function bn(...t){let e=0;for(let r=0;r<t.length;r++){const i=t[r];gn(i),e+=i.length}const n=new Uint8Array(e);for(let r=0,i=0;r<t.length;r++){const s=t[r];n.set(s,i),i+=s.length}return n}class pc{}function co(t){const e=r=>t().update(ao(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function uo(t=32){if(ni&&typeof ni.getRandomValues=="function")return ni.getRandomValues(new Uint8Array(t));if(ni&&typeof ni.randomBytes=="function")return Uint8Array.from(ni.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}function hE(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),c=r?4:0,u=r?0:4;t.setUint32(e+c,o,r),t.setUint32(e+u,a,r)}function dE(t,e,n){return t&e^~t&n}function pE(t,e,n){return t&e^t&n^e&n}class Rh extends pc{constructor(e,n,r,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.buffer=new Uint8Array(e),this.view=hc(this.buffer)}update(e){ii(this),e=ao(e),gn(e);const{view:n,buffer:r,blockLen:i}=this,s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=hc(e);for(;i<=s-o;o+=i)this.process(c,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){ii(this),Dh(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,jn(this.buffer.subarray(o)),this.padOffset>i-o&&(this.process(r,0),o=0);for(let h=o;h<i;h++)n[h]=0;hE(r,i-8,BigInt(this.length*8),s),this.process(r,0);const a=hc(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<u;h++)a.setUint32(4*h,l[h],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=s,e.length=i,e.pos=a,i%n&&e.buffer.set(r),e}clone(){return this._cloneInto()}}const wn=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),He=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),Ke=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),lo=BigInt(2**32-1),Nh=BigInt(32);function gE(t,e=!1){return e?{h:Number(t&lo),l:Number(t>>Nh&lo)}:{h:Number(t>>Nh&lo)|0,l:Number(t&lo)|0}}function Ch(t,e=!1){const n=t.length;let r=new Uint32Array(n),i=new Uint32Array(n);for(let s=0;s<n;s++){const{h:o,l:a}=gE(t[s],e);[r[s],i[s]]=[o,a]}return[r,i]}const Uh=(t,e,n)=>t>>>n,Fh=(t,e,n)=>t<<32-n|e>>>n,oi=(t,e,n)=>t>>>n|e<<32-n,ai=(t,e,n)=>t<<32-n|e>>>n,fo=(t,e,n)=>t<<64-n|e>>>n-32,ho=(t,e,n)=>t>>>n-32|e<<64-n,yE=(t,e,n)=>t<<n|e>>>32-n,bE=(t,e,n)=>e<<n|t>>>32-n,wE=(t,e,n)=>e<<n-32|t>>>64-n,mE=(t,e,n)=>t<<n-32|e>>>64-n;function mn(t,e,n,r){const i=(e>>>0)+(r>>>0);return{h:t+n+(i/2**32|0)|0,l:i|0}}const vE=(t,e,n)=>(t>>>0)+(e>>>0)+(n>>>0),EE=(t,e,n,r)=>e+n+r+(t/2**32|0)|0,xE=(t,e,n,r)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0),_E=(t,e,n,r,i)=>e+n+r+i+(t/2**32|0)|0,SE=(t,e,n,r,i)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0)+(i>>>0),IE=(t,e,n,r,i,s)=>e+n+r+i+s+(t/2**32|0)|0,OE=BigInt(0),qi=BigInt(1),AE=BigInt(2),BE=BigInt(7),DE=BigInt(256),$E=BigInt(113),Lh=[],kh=[],qh=[];for(let t=0,e=qi,n=1,r=0;t<24;t++){[n,r]=[r,(2*n+3*r)%5],Lh.push(2*(5*r+n)),kh.push((t+1)*(t+2)/2%64);let i=OE;for(let s=0;s<7;s++)e=(e<<qi^(e>>BE)*$E)%DE,e&AE&&(i^=qi<<(qi<<BigInt(s))-qi);qh.push(i)}const Mh=Ch(qh,!0),TE=Mh[0],PE=Mh[1],jh=(t,e,n)=>n>32?wE(t,e,n):yE(t,e,n),zh=(t,e,n)=>n>32?mE(t,e,n):bE(t,e,n);function RE(t,e=24){const n=new Uint32Array(10);for(let r=24-e;r<24;r++){for(let o=0;o<10;o++)n[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,u=n[c],l=n[c+1],h=jh(u,l,1)^n[a],d=zh(u,l,1)^n[a+1];for(let f=0;f<50;f+=10)t[o+f]^=h,t[o+f+1]^=d}let i=t[2],s=t[3];for(let o=0;o<24;o++){const a=kh[o],c=jh(i,s,a),u=zh(i,s,a),l=Lh[o];i=t[l],s=t[l+1],t[l]=c,t[l+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)n[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~n[(a+2)%10]&n[(a+4)%10]}t[0]^=TE[r],t[1]^=PE[r]}jn(n)}class gc extends pc{constructor(e,n,r,i=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=n,this.outputLen=r,this.enableXOF=i,this.rounds=s,ri(r),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=aE(this.state)}clone(){return this._cloneInto()}keccak(){$h(this.state32),RE(this.state32,this.rounds),$h(this.state32),this.posOut=0,this.pos=0}update(e){ii(this),e=ao(e),gn(e);const{blockLen:n,state:r}=this,i=e.length;for(let s=0;s<i;){const o=Math.min(n-this.pos,i-s);for(let a=0;a<o;a++)r[this.pos++]^=e[s++];this.pos===n&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:n,pos:r,blockLen:i}=this;e[r]^=n,(n&128)!==0&&r===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){ii(this,!1),gn(e),this.finish();const n=this.state,{blockLen:r}=this;for(let i=0,s=e.length;i<s;){this.posOut>=r&&this.keccak();const o=Math.min(r-this.posOut,s-i);e.set(n.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return ri(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Dh(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,jn(this.state)}_cloneInto(e){const{blockLen:n,suffix:r,outputLen:i,rounds:s,enableXOF:o}=this;return e||(e=new gc(n,r,i,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=r,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}}const NE=(t,e,n)=>co(()=>new gc(e,t,n)),CE=NE(1,136,256/8),UE=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),zn=new Uint32Array(64);class FE extends Rh{constructor(e=32){super(64,e,8,!1),this.A=wn[0]|0,this.B=wn[1]|0,this.C=wn[2]|0,this.D=wn[3]|0,this.E=wn[4]|0,this.F=wn[5]|0,this.G=wn[6]|0,this.H=wn[7]|0}get(){const{A:e,B:n,C:r,D:i,E:s,F:o,G:a,H:c}=this;return[e,n,r,i,s,o,a,c]}set(e,n,r,i,s,o,a,c){this.A=e|0,this.B=n|0,this.C=r|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,n){for(let h=0;h<16;h++,n+=4)zn[h]=e.getUint32(n,!1);for(let h=16;h<64;h++){const d=zn[h-15],f=zn[h-2],p=nn(d,7)^nn(d,18)^d>>>3,b=nn(f,17)^nn(f,19)^f>>>10;zn[h]=b+zn[h-7]+p+zn[h-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:c,G:u,H:l}=this;for(let h=0;h<64;h++){const d=nn(a,6)^nn(a,11)^nn(a,25),f=l+d+dE(a,c,u)+UE[h]+zn[h]|0,b=(nn(r,2)^nn(r,13)^nn(r,22))+pE(r,i,s)|0;l=u,u=c,c=a,a=o+f|0,o=s,s=i,i=r,r=f+b|0}r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(r,i,s,o,a,c,u,l)}roundClean(){jn(zn)}destroy(){this.set(0,0,0,0,0,0,0,0),jn(this.buffer)}}const Vh=Ch(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),LE=Vh[0],kE=Vh[1],Vn=new Uint32Array(80),Hn=new Uint32Array(80);class Hh extends Rh{constructor(e=64){super(128,e,16,!1),this.Ah=Ke[0]|0,this.Al=Ke[1]|0,this.Bh=Ke[2]|0,this.Bl=Ke[3]|0,this.Ch=Ke[4]|0,this.Cl=Ke[5]|0,this.Dh=Ke[6]|0,this.Dl=Ke[7]|0,this.Eh=Ke[8]|0,this.El=Ke[9]|0,this.Fh=Ke[10]|0,this.Fl=Ke[11]|0,this.Gh=Ke[12]|0,this.Gl=Ke[13]|0,this.Hh=Ke[14]|0,this.Hl=Ke[15]|0}get(){const{Ah:e,Al:n,Bh:r,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:u,El:l,Fh:h,Fl:d,Gh:f,Gl:p,Hh:b,Hl:v}=this;return[e,n,r,i,s,o,a,c,u,l,h,d,f,p,b,v]}set(e,n,r,i,s,o,a,c,u,l,h,d,f,p,b,v){this.Ah=e|0,this.Al=n|0,this.Bh=r|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=l|0,this.Fh=h|0,this.Fl=d|0,this.Gh=f|0,this.Gl=p|0,this.Hh=b|0,this.Hl=v|0}process(e,n){for(let _=0;_<16;_++,n+=4)Vn[_]=e.getUint32(n),Hn[_]=e.getUint32(n+=4);for(let _=16;_<80;_++){const x=Vn[_-15]|0,T=Hn[_-15]|0,R=oi(x,T,1)^oi(x,T,8)^Uh(x,T,7),F=ai(x,T,1)^ai(x,T,8)^Fh(x,T,7),U=Vn[_-2]|0,$=Hn[_-2]|0,z=oi(U,$,19)^fo(U,$,61)^Uh(U,$,6),M=ai(U,$,19)^ho(U,$,61)^Fh(U,$,6),E=xE(F,M,Hn[_-7],Hn[_-16]),y=_E(E,R,z,Vn[_-7],Vn[_-16]);Vn[_]=y|0,Hn[_]=E|0}let{Ah:r,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:u,Dl:l,Eh:h,El:d,Fh:f,Fl:p,Gh:b,Gl:v,Hh:A,Hl:D}=this;for(let _=0;_<80;_++){const x=oi(h,d,14)^oi(h,d,18)^fo(h,d,41),T=ai(h,d,14)^ai(h,d,18)^ho(h,d,41),R=h&f^~h&b,F=d&p^~d&v,U=SE(D,T,F,kE[_],Hn[_]),$=IE(U,A,x,R,LE[_],Vn[_]),z=U|0,M=oi(r,i,28)^fo(r,i,34)^fo(r,i,39),E=ai(r,i,28)^ho(r,i,34)^ho(r,i,39),y=r&s^r&a^s&a,m=i&o^i&c^o&c;A=b|0,D=v|0,b=f|0,v=p|0,f=h|0,p=d|0,{h,l:d}=mn(u|0,l|0,$|0,z|0),u=a|0,l=c|0,a=s|0,c=o|0,s=r|0,o=i|0;const g=vE(z,E,m);r=EE(g,$,M,y),i=g|0}({h:r,l:i}=mn(this.Ah|0,this.Al|0,r|0,i|0)),{h:s,l:o}=mn(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=mn(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l}=mn(this.Dh|0,this.Dl|0,u|0,l|0),{h,l:d}=mn(this.Eh|0,this.El|0,h|0,d|0),{h:f,l:p}=mn(this.Fh|0,this.Fl|0,f|0,p|0),{h:b,l:v}=mn(this.Gh|0,this.Gl|0,b|0,v|0),{h:A,l:D}=mn(this.Hh|0,this.Hl|0,A|0,D|0),this.set(r,i,s,o,a,c,u,l,h,d,f,p,b,v,A,D)}roundClean(){jn(Vn,Hn)}destroy(){jn(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class qE extends Hh{constructor(){super(48),this.Ah=He[0]|0,this.Al=He[1]|0,this.Bh=He[2]|0,this.Bl=He[3]|0,this.Ch=He[4]|0,this.Cl=He[5]|0,this.Dh=He[6]|0,this.Dl=He[7]|0,this.Eh=He[8]|0,this.El=He[9]|0,this.Fh=He[10]|0,this.Fl=He[11]|0,this.Gh=He[12]|0,this.Gl=He[13]|0,this.Hh=He[14]|0,this.Hl=He[15]|0}}const ci=co(()=>new FE),ME=co(()=>new Hh),jE=co(()=>new qE);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const yc=BigInt(0),po=BigInt(1);function Mi(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Kn(t){if(!Mi(t))throw new Error("Uint8Array expected")}function ji(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}function go(t){const e=t.toString(16);return e.length&1?"0"+e:e}function Kh(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?yc:BigInt("0x"+t)}const Gh=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",zE=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Br(t){if(Kn(t),Gh)return t.toHex();let e="";for(let n=0;n<t.length;n++)e+=zE[t[n]];return e}const vn={_0:48,_9:57,A:65,F:70,a:97,f:102};function Wh(t){if(t>=vn._0&&t<=vn._9)return t-vn._0;if(t>=vn.A&&t<=vn.F)return t-(vn.A-10);if(t>=vn.a&&t<=vn.f)return t-(vn.a-10)}function yo(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(Gh)return Uint8Array.fromHex(t);const e=t.length,n=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(n);for(let i=0,s=0;i<n;i++,s+=2){const o=Wh(t.charCodeAt(s)),a=Wh(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}r[i]=o*16+a}return r}function rt(t){return Kh(Br(t))}function Zh(t){return Kn(t),Kh(Br(Uint8Array.from(t).reverse()))}function De(t,e){return yo(t.toString(16).padStart(e*2,"0"))}function Yh(t,e){return De(t,e).reverse()}function Ge(t,e,n){let r;if(typeof e=="string")try{r=yo(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(Mi(e))r=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=r.length;if(typeof n=="number"&&i!==n)throw new Error(t+" of length "+n+" expected, got "+i);return r}function Se(...t){let e=0;for(let r=0;r<t.length;r++){const i=t[r];Kn(i),e+=i.length}const n=new Uint8Array(e);for(let r=0,i=0;r<t.length;r++){const s=t[r];n.set(s,i),i+=s.length}return n}function bc(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}const wc=t=>typeof t=="bigint"&&yc<=t;function mc(t,e,n){return wc(t)&&wc(e)&&wc(n)&&e<=t&&t<n}function ui(t,e,n,r){if(!mc(e,n,r))throw new Error("expected valid "+t+": "+n+" <= n < "+r+", got "+e)}function zi(t){let e;for(e=0;t>yc;t>>=po,e+=1);return e}function VE(t,e){return t>>BigInt(e)&po}const Dr=t=>(po<<BigInt(t))-po,vc=t=>new Uint8Array(t),Xh=t=>Uint8Array.from(t);function HE(t,e,n){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=vc(t),i=vc(t),s=0;const o=()=>{r.fill(1),i.fill(0),s=0},a=(...h)=>n(i,r,...h),c=(h=vc(0))=>{i=a(Xh([0]),h),r=a(),h.length!==0&&(i=a(Xh([1]),h),r=a())},u=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let h=0;const d=[];for(;h<e;){r=a();const f=r.slice();d.push(f),h+=r.length}return Se(...d)};return(h,d)=>{o(),c(h);let f;for(;!(f=d(u()));)c();return o(),f}}const KE={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||Mi(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Vi(t,e,n={}){const r=(i,s,o)=>{const a=KE[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[i];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(i)+" is invalid. Expected "+s+", got "+c)};for(const[i,s]of Object.entries(e))r(i,s,!1);for(const[i,s]of Object.entries(n))r(i,s,!0);return t}const Jh=()=>{throw new Error("not implemented")};function Ec(t){const e=new WeakMap;return(n,...r)=>{const i=e.get(n);if(i!==void 0)return i;const s=t(n,...r);return e.set(n,s),s}}function GE(t,e){if(id(t)>e)throw new g3({givenSize:id(t),maxSize:e})}const En={zero:48,nine:57,A:65,F:70,a:97,f:102};function Qh(t){if(t>=En.zero&&t<=En.nine)return t-En.zero;if(t>=En.A&&t<=En.F)return t-(En.A-10);if(t>=En.a&&t<=En.f)return t-(En.a-10)}function WE(t,e={}){const{dir:n,size:r=32}=e;if(r===0)return t;if(t.length>r)throw new y3({size:t.length,targetSize:r,type:"Bytes"});const i=new Uint8Array(r);for(let s=0;s<r;s++){const o=n==="right";i[o?s:r-s-1]=t[o?s:t.length-s-1]}return i}function xc(t,e){if(_n(t)>e)throw new s3({givenSize:_n(t),maxSize:e})}function ZE(t,e){if(typeof e=="number"&&e>0&&e>_n(t)-1)throw new rd({offset:e,position:"start",size:_n(t)})}function YE(t,e,n){if(typeof e=="number"&&typeof n=="number"&&_n(t)!==n-e)throw new rd({offset:n,position:"end",size:_n(t)})}function ed(t,e={}){const{dir:n,size:r=32}=e;if(r===0)return t;const i=t.replace("0x","");if(i.length>r*2)throw new o3({size:Math.ceil(i.length/2),targetSize:r,type:"Hex"});return`0x${i[n==="right"?"padEnd":"padStart"](r*2,"0")}`}const XE="#__bigint";function _c(t,e,n){return JSON.stringify(t,(r,i)=>typeof e=="function"?e(r,i):typeof i=="bigint"?i.toString()+XE:i,n)}const JE=new TextEncoder,QE=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function e3(t,e={}){const{strict:n=!1}=e;if(!t)throw new td(t);if(typeof t!="string")throw new td(t);if(n&&!/^0x[0-9a-fA-F]*$/.test(t))throw new nd(t);if(!t.startsWith("0x"))throw new nd(t)}function Sc(...t){return`0x${t.reduce((e,n)=>e+n.replace("0x",""),"")}`}function Ic(t){return t instanceof Uint8Array?Hi(t):Array.isArray(t)?Hi(new Uint8Array(t)):t}function t3(t,e={}){const n=`0x${Number(t)}`;return typeof e.size=="number"?(xc(n,e.size),wo(n,e.size)):n}function Hi(t,e={}){let n="";for(let i=0;i<t.length;i++)n+=QE[t[i]];const r=`0x${n}`;return typeof e.size=="number"?(xc(r,e.size),Oc(r,e.size)):r}function bo(t,e={}){const{signed:n,size:r}=e,i=BigInt(t);let s;r?n?s=(1n<<BigInt(r)*8n-1n)-1n:s=2n**(BigInt(r)*8n)-1n:typeof t=="number"&&(s=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof s=="bigint"&&n?-s-1n:0;if(s&&i>s||i<o){const u=typeof t=="bigint"?"n":"";throw new i3({max:s?`${s}${u}`:void 0,min:`${o}${u}`,signed:n,size:r,value:`${t}${u}`})}const c=`0x${(n&&i<0?(1n<<BigInt(r*8))+BigInt(i):i).toString(16)}`;return r?wo(c,r):c}function n3(t,e={}){return Hi(JE.encode(t),e)}function wo(t,e){return ed(t,{dir:"left",size:e})}function Oc(t,e){return ed(t,{dir:"right",size:e})}function xn(t,e,n,r={}){const{strict:i}=r;ZE(t,e);const s=`0x${t.replace("0x","").slice((e??0)*2,(n??t.length)*2)}`;return i&&YE(s,e,n),s}function _n(t){return Math.ceil((t.length-2)/2)}function r3(t,e={}){const{strict:n=!1}=e;try{return e3(t,{strict:n}),!0}catch{return!1}}class i3 extends ye{constructor({max:e,min:n,signed:r,size:i,value:s}){super(`Number \`${s}\` is not in safe${i?` ${i*8}-bit`:""}${r?" signed":" unsigned"} integer range ${e?`(\`${n}\` to \`${e}\`)`:`(above \`${n}\`)`}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.IntegerOutOfRangeError"})}}class td extends ye{constructor(e){super(`Value \`${typeof e=="object"?_c(e):e}\` of type \`${typeof e}\` is an invalid hex type.`,{metaMessages:['Hex types must be represented as `"0x${string}"`.']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexTypeError"})}}class nd extends ye{constructor(e){super(`Value \`${e}\` is an invalid hex value.`,{metaMessages:['Hex values must start with `"0x"` and contain only hexadecimal characters (0-9, a-f, A-F).']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexValueError"})}}class s3 extends ye{constructor({givenSize:e,maxSize:n}){super(`Size cannot exceed \`${n}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeOverflowError"})}}class rd extends ye{constructor({offset:e,position:n,size:r}){super(`Slice ${n==="start"?"starting":"ending"} at offset \`${e}\` is out-of-bounds (size: \`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SliceOffsetOutOfBoundsError"})}}class o3 extends ye{constructor({size:e,targetSize:n,type:r}){super(`${r.charAt(0).toUpperCase()}${r.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${n}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeExceedsPaddingSizeError"})}}const a3=new TextEncoder;function c3(t){if(!(t instanceof Uint8Array)){if(!t)throw new mo(t);if(typeof t!="object")throw new mo(t);if(!("BYTES_PER_ELEMENT"in t))throw new mo(t);if(t.BYTES_PER_ELEMENT!==1||t.constructor.name!=="Uint8Array")throw new mo(t)}}function u3(t){return t instanceof Uint8Array?t:typeof t=="string"?f3(t):l3(t)}function l3(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function f3(t,e={}){const{size:n}=e;let r=t;n&&(xc(t,n),r=Oc(t,n));let i=r.slice(2);i.length%2&&(i=`0${i}`);const s=i.length/2,o=new Uint8Array(s);for(let a=0,c=0;a<s;a++){const u=Qh(i.charCodeAt(c++)),l=Qh(i.charCodeAt(c++));if(u===void 0||l===void 0)throw new ye(`Invalid byte sequence ("${i[c-2]}${i[c-1]}" in "${i}").`);o[a]=u*16+l}return o}function h3(t,e={}){const{size:n}=e,r=a3.encode(t);return typeof n=="number"?(GE(r,n),d3(r,n)):r}function d3(t,e){return WE(t,{dir:"right",size:e})}function id(t){return t.length}function p3(t){try{return c3(t),!0}catch{return!1}}class mo extends ye{constructor(e){super(`Value \`${typeof e=="object"?_c(e):e}\` of type \`${typeof e}\` is an invalid Bytes value.`,{metaMessages:["Bytes values must be of type `Bytes`."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.InvalidBytesTypeError"})}}class g3 extends ye{constructor({givenSize:e,maxSize:n}){super(`Size cannot exceed \`${n}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeOverflowError"})}}class y3 extends ye{constructor({size:e,targetSize:n,type:r}){super(`${r.charAt(0).toUpperCase()}${r.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${n}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeExceedsPaddingSizeError"})}}function sd(t,e={}){const{as:n=typeof t=="string"?"Hex":"Bytes"}=e,r=CE(u3(t));return n==="Bytes"?r:Hi(r)}class b3 extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const n=super.get(e);return super.has(e)&&n!==void 0&&(this.delete(e),super.set(e,n)),n}set(e,n){if(super.set(e,n),this.maxSize&&this.size>this.maxSize){const r=this.keys().next().value;r&&this.delete(r)}return this}}const Ac={checksum:new b3(8192)}.checksum;function od(t,e={}){const{compressed:n}=e,{prefix:r,x:i,y:s}=t;if(n===!1||typeof i=="bigint"&&typeof s=="bigint"){if(r!==4)throw new cd({prefix:r,cause:new _3});return}if(n===!0||typeof i=="bigint"&&typeof s>"u"){if(r!==3&&r!==2)throw new cd({prefix:r,cause:new x3});return}throw new E3({publicKey:t})}function w3(t){const e=(()=>{if(r3(t))return ad(t);if(p3(t))return m3(t);const{prefix:n,x:r,y:i}=t;return typeof r=="bigint"&&typeof i=="bigint"?{prefix:n??4,x:r,y:i}:{prefix:n,x:r}})();return od(e),e}function m3(t){return ad(Hi(t))}function ad(t){if(t.length!==132&&t.length!==130&&t.length!==68)throw new S3({publicKey:t});if(t.length===130){const r=BigInt(xn(t,0,32)),i=BigInt(xn(t,32,64));return{prefix:4,x:r,y:i}}if(t.length===132){const r=Number(xn(t,0,1)),i=BigInt(xn(t,1,33)),s=BigInt(xn(t,33,65));return{prefix:r,x:i,y:s}}const e=Number(xn(t,0,1)),n=BigInt(xn(t,1,33));return{prefix:e,x:n}}function v3(t,e={}){od(t);const{prefix:n,x:r,y:i}=t,{includePrefix:s=!0}=e;return Sc(s?bo(n,{size:1}):"0x",bo(r,{size:32}),typeof i=="bigint"?bo(i,{size:32}):"0x")}class E3 extends ye{constructor({publicKey:e}){super(`Value \`${_c(e)}\` is not a valid public key.`,{metaMessages:["Public key must contain:","- an `x` and `prefix` value (compressed)","- an `x`, `y`, and `prefix` value (uncompressed)"]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidError"})}}class cd extends ye{constructor({prefix:e,cause:n}){super(`Prefix "${e}" is invalid.`,{cause:n}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidPrefixError"})}}class x3 extends ye{constructor(){super("Prefix must be 2 or 3 for compressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidCompressedPrefixError"})}}class _3 extends ye{constructor(){super("Prefix must be 4 for uncompressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidUncompressedPrefixError"})}}class S3 extends ye{constructor({publicKey:e}){super(`Value \`${e}\` is an invalid public key size.`,{metaMessages:["Expected: 33 bytes (compressed + prefix), 64 bytes (uncompressed) or 65 bytes (uncompressed + prefix).",`Received ${_n(Ic(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidSerializedSizeError"})}}const I3=/^0x[a-fA-F0-9]{40}$/;function Bc(t,e={}){const{strict:n=!0}=e;if(!I3.test(t))throw new ld({address:t,cause:new B3});if(n){if(t.toLowerCase()===t)return;if(ud(t)!==t)throw new ld({address:t,cause:new D3})}}function ud(t){if(Ac.has(t))return Ac.get(t);Bc(t,{strict:!1});const e=t.substring(2).toLowerCase(),n=sd(h3(e),{as:"Bytes"}),r=e.split("");for(let s=0;s<40;s+=2)n[s>>1]>>4>=8&&r[s]&&(r[s]=r[s].toUpperCase()),(n[s>>1]&15)>=8&&r[s+1]&&(r[s+1]=r[s+1].toUpperCase());const i=`0x${r.join("")}`;return Ac.set(t,i),i}function O3(t,e={}){const{checksum:n=!1}=e;return Bc(t),n?ud(t):t}function A3(t,e={}){const n=sd(`0x${v3(t).slice(4)}`).substring(26);return O3(`0x${n}`,e)}class ld extends ye{constructor({address:e,cause:n}){super(`Address "${e}" is invalid.`,{cause:n}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidAddressError"})}}class B3 extends ye{constructor(){super("Address is not a 20 byte (40 hexadecimal character) value."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidInputError"})}}class D3 extends ye{constructor(){super("Address does not match its checksum counterpart."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidChecksumError"})}}const $3=/^(.*)\[([0-9]*)\]$/,T3=/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/,P3=/^(u?int)(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/;function Dc(t,e){if(t.length!==e.length)throw new N3({expectedLength:t.length,givenLength:e.length});const n=[];for(let r=0;r<t.length;r++){const i=t[r],s=e[r];n.push(Dc.encode(i,s))}return Sc(...n)}(function(t){function e(n,r,i=!1){if(n==="address"){const c=r;return Bc(c),wo(c.toLowerCase(),i?32:0)}if(n==="string")return n3(r);if(n==="bytes")return r;if(n==="bool")return wo(t3(r),i?32:1);const s=n.match(P3);if(s){const[c,u,l="256"]=s,h=Number.parseInt(l,10)/8;return bo(r,{size:i?32:h,signed:u==="int"})}const o=n.match(T3);if(o){const[c,u]=o;if(Number.parseInt(u,10)!==(r.length-2)/2)throw new R3({expectedSize:Number.parseInt(u,10),value:r});return Oc(r,i?32:0)}const a=n.match($3);if(a&&Array.isArray(r)){const[c,u]=a,l=[];for(let h=0;h<r.length;h++)l.push(e(u,r[h],!0));return l.length===0?"0x":Sc(...l)}throw new C3(n)}t.encode=e})(Dc||(Dc={}));class R3 extends ye{constructor({expectedSize:e,value:n}){super(`Size of bytes "${n}" (bytes${_n(n)}) does not match expected size (bytes${e}).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.BytesSizeMismatchError"})}}class N3 extends ye{constructor({expectedLength:e,givenLength:n}){super(["ABI encoding parameters/values length mismatch.",`Expected length (parameters): ${e}`,`Given length (values): ${n}`].join(`
`)),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.LengthMismatchError"})}}class C3 extends ye{constructor(e){super(`Type \`${e}\` is not a valid ABI Type.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.InvalidTypeError"})}}class fd extends pc{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,Bh(e);const r=ao(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),jn(s)}update(e){return ii(this),this.iHash.update(e),this}digestInto(e){ii(this),gn(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const $c=(t,e,n)=>new fd(t,e).update(n).digest();$c.create=(t,e)=>new fd(t,e);const gt=BigInt(0),it=BigInt(1),$r=BigInt(2),U3=BigInt(3),hd=BigInt(4),dd=BigInt(5),pd=BigInt(8);function st(t,e){const n=t%e;return n>=gt?n:e+n}function Pt(t,e,n){let r=t;for(;e-- >gt;)r*=r,r%=n;return r}function Tc(t,e){if(t===gt)throw new Error("invert: expected non-zero number");if(e<=gt)throw new Error("invert: expected positive modulus, got "+e);let n=st(t,e),r=e,i=gt,s=it;for(;n!==gt;){const a=r/n,c=r%n,u=i-s*a;r=n,n=c,i=s,s=u}if(r!==it)throw new Error("invert: does not exist");return st(i,e)}function gd(t,e){const n=(t.ORDER+it)/hd,r=t.pow(e,n);if(!t.eql(t.sqr(r),e))throw new Error("Cannot find square root");return r}function F3(t,e){const n=(t.ORDER-dd)/pd,r=t.mul(e,$r),i=t.pow(r,n),s=t.mul(e,i),o=t.mul(t.mul(s,$r),i),a=t.mul(s,t.sub(o,t.ONE));if(!t.eql(t.sqr(a),e))throw new Error("Cannot find square root");return a}function L3(t){if(t<BigInt(3))throw new Error("sqrt is not defined for small field");let e=t-it,n=0;for(;e%$r===gt;)e/=$r,n++;let r=$r;const i=Gn(t);for(;Eo(i,r)===1;)if(r++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(n===1)return gd;let s=i.pow(r,e);const o=(e+it)/$r;return function(c,u){if(c.is0(u))return u;if(Eo(c,u)!==1)throw new Error("Cannot find square root");let l=n,h=c.mul(c.ONE,s),d=c.pow(u,e),f=c.pow(u,o);for(;!c.eql(d,c.ONE);){if(c.is0(d))return c.ZERO;let p=1,b=c.sqr(d);for(;!c.eql(b,c.ONE);)if(p++,b=c.sqr(b),p===l)throw new Error("Cannot find square root");const v=it<<BigInt(l-p-1),A=c.pow(h,v);l=p,h=c.sqr(A),d=c.mul(d,h),f=c.mul(f,A)}return f}}function k3(t){return t%hd===U3?gd:t%pd===dd?F3:L3(t)}const q3=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function yd(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=q3.reduce((r,i)=>(r[i]="function",r),e);return Vi(t,n)}function vo(t,e,n){if(n<gt)throw new Error("invalid exponent, negatives unsupported");if(n===gt)return t.ONE;if(n===it)return e;let r=t.ONE,i=e;for(;n>gt;)n&it&&(r=t.mul(r,i)),i=t.sqr(i),n>>=it;return r}function Tr(t,e,n=!1){const r=new Array(e.length).fill(n?t.ZERO:void 0),i=e.reduce((o,a,c)=>t.is0(a)?o:(r[c]=o,t.mul(o,a)),t.ONE),s=t.inv(i);return e.reduceRight((o,a,c)=>t.is0(a)?o:(r[c]=t.mul(o,r[c]),t.mul(o,a)),s),r}function Eo(t,e){const n=(t.ORDER-it)/$r,r=t.pow(e,n),i=t.eql(r,t.ONE),s=t.eql(r,t.ZERO),o=t.eql(r,t.neg(t.ONE));if(!i&&!s&&!o)throw new Error("invalid Legendre symbol result");return i?1:s?0:-1}function bd(t,e){e!==void 0&&ri(e);const n=e!==void 0?e:t.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function Gn(t,e,n=!1,r={}){if(t<=gt)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:i,nByteLength:s}=bd(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:n,BITS:i,BYTES:s,MASK:Dr(i),ZERO:gt,ONE:it,create:c=>st(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return gt<=c&&c<t},is0:c=>c===gt,isOdd:c=>(c&it)===it,neg:c=>st(-c,t),eql:(c,u)=>c===u,sqr:c=>st(c*c,t),add:(c,u)=>st(c+u,t),sub:(c,u)=>st(c-u,t),mul:(c,u)=>st(c*u,t),pow:(c,u)=>vo(a,c,u),div:(c,u)=>st(c*Tc(u,t),t),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>Tc(c,t),sqrt:r.sqrt||(c=>(o||(o=k3(t)),o(a,c))),toBytes:c=>n?Yh(c,s):De(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return n?Zh(c):rt(c)},invertBatch:c=>Tr(a,c),cmov:(c,u,l)=>l?u:c});return Object.freeze(a)}function wd(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function Pc(t){const e=wd(t);return e+Math.ceil(e/2)}function md(t,e,n=!1){const r=t.length,i=wd(e),s=Pc(e);if(r<16||r<s||r>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+r);const o=n?Zh(t):rt(t),a=st(o,e-it)+it;return n?Yh(a,i):De(a,i)}const vd=BigInt(0),Rc=BigInt(1);function Nc(t,e){const n=e.negate();return t?n:e}function Ed(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Cc(t,e){Ed(t,e);const n=Math.ceil(e/t)+1,r=2**(t-1),i=2**t,s=Dr(t),o=BigInt(t);return{windows:n,windowSize:r,mask:s,maxNumber:i,shiftBy:o}}function xd(t,e,n){const{windowSize:r,mask:i,maxNumber:s,shiftBy:o}=n;let a=Number(t&i),c=t>>o;a>r&&(a-=s,c+=Rc);const u=e*r,l=u+Math.abs(a)-1,h=a===0,d=a<0,f=e%2!==0;return{nextN:c,offset:l,isZero:h,isNeg:d,isNegF:f,offsetF:u}}function M3(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((n,r)=>{if(!(n instanceof e))throw new Error("invalid point at index "+r)})}function j3(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((n,r)=>{if(!e.isValid(n))throw new Error("invalid scalar at index "+r)})}const Uc=new WeakMap,_d=new WeakMap;function Fc(t){return _d.get(t)||1}function z3(t,e){return{constTimeNegate:Nc,hasPrecomputes(n){return Fc(n)!==1},unsafeLadder(n,r,i=t.ZERO){let s=n;for(;r>vd;)r&Rc&&(i=i.add(s)),s=s.double(),r>>=Rc;return i},precomputeWindow(n,r){const{windows:i,windowSize:s}=Cc(r,e),o=[];let a=n,c=a;for(let u=0;u<i;u++){c=a,o.push(c);for(let l=1;l<s;l++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(n,r,i){let s=t.ZERO,o=t.BASE;const a=Cc(n,e);for(let c=0;c<a.windows;c++){const{nextN:u,offset:l,isZero:h,isNeg:d,isNegF:f,offsetF:p}=xd(i,c,a);i=u,h?o=o.add(Nc(f,r[p])):s=s.add(Nc(d,r[l]))}return{p:s,f:o}},wNAFUnsafe(n,r,i,s=t.ZERO){const o=Cc(n,e);for(let a=0;a<o.windows&&i!==vd;a++){const{nextN:c,offset:u,isZero:l,isNeg:h}=xd(i,a,o);if(i=c,!l){const d=r[u];s=s.add(h?d.negate():d)}}return s},getPrecomputes(n,r,i){let s=Uc.get(r);return s||(s=this.precomputeWindow(r,n),n!==1&&Uc.set(r,i(s))),s},wNAFCached(n,r,i){const s=Fc(n);return this.wNAF(s,this.getPrecomputes(s,n,i),r)},wNAFCachedUnsafe(n,r,i,s){const o=Fc(n);return o===1?this.unsafeLadder(n,r,s):this.wNAFUnsafe(o,this.getPrecomputes(o,n,i),r,s)},setWindowSize(n,r){Ed(r,e),_d.set(n,r),Uc.delete(n)}}}function V3(t,e,n,r){M3(n,t),j3(r,e);const i=n.length,s=r.length;if(i!==s)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=zi(BigInt(i));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const u=Dr(c),l=new Array(Number(u)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c;let d=o;for(let f=h;f>=0;f-=c){l.fill(o);for(let b=0;b<s;b++){const v=r[b],A=Number(v>>BigInt(f)&u);l[A]=l[A].add(n[b])}let p=o;for(let b=l.length-1,v=o;b>0;b--)v=v.add(l[b]),p=p.add(v);if(d=d.add(p),f!==0)for(let b=0;b<c;b++)d=d.double()}return d}function Sd(t){return yd(t.Fp),Vi(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...bd(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}function Id(t){t.lowS!==void 0&&ji("lowS",t.lowS),t.prehash!==void 0&&ji("prehash",t.prehash)}function H3(t){const e=Sd(t);Vi(e,{a:"field",b:"field"},{allowInfinityPoint:"boolean",allowedPrivateKeyLengths:"array",clearCofactor:"function",fromBytes:"function",isTorsionFree:"function",toBytes:"function",wrapPrivateKey:"boolean"});const{endo:n,Fp:r,a:i}=e;if(n){if(!r.eql(i,r.ZERO))throw new Error("invalid endo: CURVE.a must be 0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function')}return Object.freeze({...e})}class K3 extends Error{constructor(e=""){super(e)}}const Sn={Err:K3,_tlv:{encode:(t,e)=>{const{Err:n}=Sn;if(t<0||t>256)throw new n("tlv.encode: wrong tag");if(e.length&1)throw new n("tlv.encode: unpadded data");const r=e.length/2,i=go(r);if(i.length/2&128)throw new n("tlv.encode: long form length too big");const s=r>127?go(i.length/2|128):"";return go(t)+s+i+e},decode(t,e){const{Err:n}=Sn;let r=0;if(t<0||t>256)throw new n("tlv.encode: wrong tag");if(e.length<2||e[r++]!==t)throw new n("tlv.decode: wrong tlv");const i=e[r++],s=!!(i&128);let o=0;if(!s)o=i;else{const c=i&127;if(!c)throw new n("tlv.decode(long): indefinite length not supported");if(c>4)throw new n("tlv.decode(long): byte length is too big");const u=e.subarray(r,r+c);if(u.length!==c)throw new n("tlv.decode: length bytes not complete");if(u[0]===0)throw new n("tlv.decode(long): zero leftmost byte");for(const l of u)o=o<<8|l;if(r+=c,o<128)throw new n("tlv.decode(long): not minimal encoding")}const a=e.subarray(r,r+o);if(a.length!==o)throw new n("tlv.decode: wrong value length");return{v:a,l:e.subarray(r+o)}}},_int:{encode(t){const{Err:e}=Sn;if(t<Vt)throw new e("integer: negative integers are not allowed");let n=go(t);if(Number.parseInt(n[0],16)&8&&(n="00"+n),n.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return n},decode(t){const{Err:e}=Sn;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return rt(t)}},toSig(t){const{Err:e,_int:n,_tlv:r}=Sn,i=Ge("signature",t),{v:s,l:o}=r.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=r.decode(2,s),{v:u,l}=r.decode(2,c);if(l.length)throw new e("invalid signature: left bytes after parsing");return{r:n.decode(a),s:n.decode(u)}},hexFromSig(t){const{_tlv:e,_int:n}=Sn,r=e.encode(2,n.encode(t.r)),i=e.encode(2,n.encode(t.s)),s=r+i;return e.encode(48,s)}};function Lc(t,e){return Br(De(t,e))}const Vt=BigInt(0),ge=BigInt(1),Wn=BigInt(2),Ki=BigInt(3),kc=BigInt(4);function qc(t){const e=H3(t),{Fp:n}=e,r=Gn(e.n,e.nBitLength),i=e.toBytes||((_,x,T)=>{const R=x.toAffine();return Se(Uint8Array.from([4]),n.toBytes(R.x),n.toBytes(R.y))}),s=e.fromBytes||(_=>{const x=_.subarray(1),T=n.fromBytes(x.subarray(0,n.BYTES)),R=n.fromBytes(x.subarray(n.BYTES,2*n.BYTES));return{x:T,y:R}});function o(_){const{a:x,b:T}=e,R=n.sqr(_),F=n.mul(R,_);return n.add(n.add(F,n.mul(_,x)),T)}function a(_,x){const T=n.sqr(x),R=o(_);return n.eql(T,R)}if(!a(e.Gx,e.Gy))throw new Error("bad curve params: generator point");const c=n.mul(n.pow(e.a,Ki),kc),u=n.mul(n.sqr(e.b),BigInt(27));if(n.is0(n.add(c,u)))throw new Error("bad curve params: a or b");function l(_){return mc(_,ge,e.n)}function h(_){const{allowedPrivateKeyLengths:x,nByteLength:T,wrapPrivateKey:R,n:F}=e;if(x&&typeof _!="bigint"){if(Mi(_)&&(_=Br(_)),typeof _!="string"||!x.includes(_.length))throw new Error("invalid private key");_=_.padStart(T*2,"0")}let U;try{U=typeof _=="bigint"?_:rt(Ge("private key",_,T))}catch{throw new Error("invalid private key, expected hex or "+T+" bytes, got "+typeof _)}return R&&(U=st(U,F)),ui("private key",U,ge,F),U}function d(_){if(!(_ instanceof b))throw new Error("ProjectivePoint expected")}const f=Ec((_,x)=>{const{px:T,py:R,pz:F}=_;if(n.eql(F,n.ONE))return{x:T,y:R};const U=_.is0();x==null&&(x=U?n.ONE:n.inv(F));const $=n.mul(T,x),z=n.mul(R,x),M=n.mul(F,x);if(U)return{x:n.ZERO,y:n.ZERO};if(!n.eql(M,n.ONE))throw new Error("invZ was invalid");return{x:$,y:z}}),p=Ec(_=>{if(_.is0()){if(e.allowInfinityPoint&&!n.is0(_.py))return;throw new Error("bad point: ZERO")}const{x,y:T}=_.toAffine();if(!n.isValid(x)||!n.isValid(T))throw new Error("bad point: x or y not FE");if(!a(x,T))throw new Error("bad point: equation left != right");if(!_.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class b{constructor(x,T,R){if(x==null||!n.isValid(x))throw new Error("x required");if(T==null||!n.isValid(T)||n.is0(T))throw new Error("y required");if(R==null||!n.isValid(R))throw new Error("z required");this.px=x,this.py=T,this.pz=R,Object.freeze(this)}static fromAffine(x){const{x:T,y:R}=x||{};if(!x||!n.isValid(T)||!n.isValid(R))throw new Error("invalid affine point");if(x instanceof b)throw new Error("projective point not allowed");const F=U=>n.eql(U,n.ZERO);return F(T)&&F(R)?b.ZERO:new b(T,R,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(x){const T=Tr(n,x.map(R=>R.pz));return x.map((R,F)=>R.toAffine(T[F])).map(b.fromAffine)}static fromHex(x){const T=b.fromAffine(s(Ge("pointHex",x)));return T.assertValidity(),T}static fromPrivateKey(x){return b.BASE.multiply(h(x))}static msm(x,T){return V3(b,r,x,T)}_setWindowSize(x){D.setWindowSize(this,x)}assertValidity(){p(this)}hasEvenY(){const{y:x}=this.toAffine();if(n.isOdd)return!n.isOdd(x);throw new Error("Field doesn't support isOdd")}equals(x){d(x);const{px:T,py:R,pz:F}=this,{px:U,py:$,pz:z}=x,M=n.eql(n.mul(T,z),n.mul(U,F)),E=n.eql(n.mul(R,z),n.mul($,F));return M&&E}negate(){return new b(this.px,n.neg(this.py),this.pz)}double(){const{a:x,b:T}=e,R=n.mul(T,Ki),{px:F,py:U,pz:$}=this;let z=n.ZERO,M=n.ZERO,E=n.ZERO,y=n.mul(F,F),m=n.mul(U,U),g=n.mul($,$),w=n.mul(F,U);return w=n.add(w,w),E=n.mul(F,$),E=n.add(E,E),z=n.mul(x,E),M=n.mul(R,g),M=n.add(z,M),z=n.sub(m,M),M=n.add(m,M),M=n.mul(z,M),z=n.mul(w,z),E=n.mul(R,E),g=n.mul(x,g),w=n.sub(y,g),w=n.mul(x,w),w=n.add(w,E),E=n.add(y,y),y=n.add(E,y),y=n.add(y,g),y=n.mul(y,w),M=n.add(M,y),g=n.mul(U,$),g=n.add(g,g),y=n.mul(g,w),z=n.sub(z,y),E=n.mul(g,m),E=n.add(E,E),E=n.add(E,E),new b(z,M,E)}add(x){d(x);const{px:T,py:R,pz:F}=this,{px:U,py:$,pz:z}=x;let M=n.ZERO,E=n.ZERO,y=n.ZERO;const m=e.a,g=n.mul(e.b,Ki);let w=n.mul(T,U),S=n.mul(R,$),O=n.mul(F,z),I=n.add(T,R),B=n.add(U,$);I=n.mul(I,B),B=n.add(w,S),I=n.sub(I,B),B=n.add(T,F);let P=n.add(U,z);return B=n.mul(B,P),P=n.add(w,O),B=n.sub(B,P),P=n.add(R,F),M=n.add($,z),P=n.mul(P,M),M=n.add(S,O),P=n.sub(P,M),y=n.mul(m,B),M=n.mul(g,O),y=n.add(M,y),M=n.sub(S,y),y=n.add(S,y),E=n.mul(M,y),S=n.add(w,w),S=n.add(S,w),O=n.mul(m,O),B=n.mul(g,B),S=n.add(S,O),O=n.sub(w,O),O=n.mul(m,O),B=n.add(B,O),w=n.mul(S,B),E=n.add(E,w),w=n.mul(P,B),M=n.mul(I,M),M=n.sub(M,w),w=n.mul(I,S),y=n.mul(P,y),y=n.add(y,w),new b(M,E,y)}subtract(x){return this.add(x.negate())}is0(){return this.equals(b.ZERO)}wNAF(x){return D.wNAFCached(this,x,b.normalizeZ)}multiplyUnsafe(x){const{endo:T,n:R}=e;ui("scalar",x,Vt,R);const F=b.ZERO;if(x===Vt)return F;if(this.is0()||x===ge)return this;if(!T||D.hasPrecomputes(this))return D.wNAFCachedUnsafe(this,x,b.normalizeZ);let{k1neg:U,k1:$,k2neg:z,k2:M}=T.splitScalar(x),E=F,y=F,m=this;for(;$>Vt||M>Vt;)$&ge&&(E=E.add(m)),M&ge&&(y=y.add(m)),m=m.double(),$>>=ge,M>>=ge;return U&&(E=E.negate()),z&&(y=y.negate()),y=new b(n.mul(y.px,T.beta),y.py,y.pz),E.add(y)}multiply(x){const{endo:T,n:R}=e;ui("scalar",x,ge,R);let F,U;if(T){const{k1neg:$,k1:z,k2neg:M,k2:E}=T.splitScalar(x);let{p:y,f:m}=this.wNAF(z),{p:g,f:w}=this.wNAF(E);y=D.constTimeNegate($,y),g=D.constTimeNegate(M,g),g=new b(n.mul(g.px,T.beta),g.py,g.pz),F=y.add(g),U=m.add(w)}else{const{p:$,f:z}=this.wNAF(x);F=$,U=z}return b.normalizeZ([F,U])[0]}multiplyAndAddUnsafe(x,T,R){const F=b.BASE,U=(z,M)=>M===Vt||M===ge||!z.equals(F)?z.multiplyUnsafe(M):z.multiply(M),$=U(this,T).add(U(x,R));return $.is0()?void 0:$}toAffine(x){return f(this,x)}isTorsionFree(){const{h:x,isTorsionFree:T}=e;if(x===ge)return!0;if(T)return T(b,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:x,clearCofactor:T}=e;return x===ge?this:T?T(b,this):this.multiplyUnsafe(e.h)}toRawBytes(x=!0){return ji("isCompressed",x),this.assertValidity(),i(b,this,x)}toHex(x=!0){return ji("isCompressed",x),Br(this.toRawBytes(x))}}b.BASE=new b(e.Gx,e.Gy,n.ONE),b.ZERO=new b(n.ZERO,n.ONE,n.ZERO);const{endo:v,nBitLength:A}=e,D=z3(b,v?Math.ceil(A/2):A);return{CURVE:e,ProjectivePoint:b,normPrivateKeyToScalar:h,weierstrassEquation:o,isWithinCurveOrder:l}}function G3(t){const e=Sd(t);return Vi(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function W3(t){const e=G3(t),{Fp:n,n:r,nByteLength:i,nBitLength:s}=e,o=n.BYTES+1,a=2*n.BYTES+1;function c(g){return st(g,r)}function u(g){return Tc(g,r)}const{ProjectivePoint:l,normPrivateKeyToScalar:h,weierstrassEquation:d,isWithinCurveOrder:f}=qc({...e,toBytes(g,w,S){const O=w.toAffine(),I=n.toBytes(O.x),B=Se;return ji("isCompressed",S),S?B(Uint8Array.from([w.hasEvenY()?2:3]),I):B(Uint8Array.from([4]),I,n.toBytes(O.y))},fromBytes(g){const w=g.length,S=g[0],O=g.subarray(1);if(w===o&&(S===2||S===3)){const I=rt(O);if(!mc(I,ge,n.ORDER))throw new Error("Point is not on curve");const B=d(I);let P;try{P=n.sqrt(B)}catch(k){const N=k instanceof Error?": "+k.message:"";throw new Error("Point is not on curve"+N)}const L=(P&ge)===ge;return(S&1)===1!==L&&(P=n.neg(P)),{x:I,y:P}}else if(w===a&&S===4){const I=n.fromBytes(O.subarray(0,n.BYTES)),B=n.fromBytes(O.subarray(n.BYTES,2*n.BYTES));return{x:I,y:B}}else{const I=o,B=a;throw new Error("invalid Point, expected length of "+I+", or uncompressed "+B+", got "+w)}}});function p(g){const w=r>>ge;return g>w}function b(g){return p(g)?c(-g):g}const v=(g,w,S)=>rt(g.slice(w,S));class A{constructor(w,S,O){ui("r",w,ge,r),ui("s",S,ge,r),this.r=w,this.s=S,O!=null&&(this.recovery=O),Object.freeze(this)}static fromCompact(w){const S=i;return w=Ge("compactSignature",w,S*2),new A(v(w,0,S),v(w,S,2*S))}static fromDER(w){const{r:S,s:O}=Sn.toSig(Ge("DER",w));return new A(S,O)}assertValidity(){}addRecoveryBit(w){return new A(this.r,this.s,w)}recoverPublicKey(w){const{r:S,s:O,recovery:I}=this,B=F(Ge("msgHash",w));if(I==null||![0,1,2,3].includes(I))throw new Error("recovery id invalid");const P=I===2||I===3?S+e.n:S;if(P>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const L=(I&1)===0?"02":"03",C=l.fromHex(L+Lc(P,n.BYTES)),k=u(P),N=c(-B*k),q=c(O*k),j=l.BASE.multiplyAndAddUnsafe(C,N,q);if(!j)throw new Error("point at infinify");return j.assertValidity(),j}hasHighS(){return p(this.s)}normalizeS(){return this.hasHighS()?new A(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return yo(this.toDERHex())}toDERHex(){return Sn.hexFromSig(this)}toCompactRawBytes(){return yo(this.toCompactHex())}toCompactHex(){const w=i;return Lc(this.r,w)+Lc(this.s,w)}}const D={isValidPrivateKey(g){try{return h(g),!0}catch{return!1}},normPrivateKeyToScalar:h,randomPrivateKey:()=>{const g=Pc(e.n);return md(e.randomBytes(g),e.n)},precompute(g=8,w=l.BASE){return w._setWindowSize(g),w.multiply(BigInt(3)),w}};function _(g,w=!0){return l.fromPrivateKey(g).toRawBytes(w)}function x(g){if(typeof g=="bigint")return!1;if(g instanceof l)return!0;const S=Ge("key",g).length,O=n.BYTES,I=O+1,B=2*O+1;if(!(e.allowedPrivateKeyLengths||i===I))return S===I||S===B}function T(g,w,S=!0){if(x(g)===!0)throw new Error("first arg must be private key");if(x(w)===!1)throw new Error("second arg must be public key");return l.fromHex(w).multiply(h(g)).toRawBytes(S)}const R=e.bits2int||function(g){if(g.length>8192)throw new Error("input is too large");const w=rt(g),S=g.length*8-s;return S>0?w>>BigInt(S):w},F=e.bits2int_modN||function(g){return c(R(g))},U=Dr(s);function $(g){return ui("num < 2^"+s,g,Vt,U),De(g,i)}function z(g,w,S=M){if(["recovered","canonical"].some(H=>H in S))throw new Error("sign() legacy options not supported");const{hash:O,randomBytes:I}=e;let{lowS:B,prehash:P,extraEntropy:L}=S;B==null&&(B=!0),g=Ge("msgHash",g),Id(S),P&&(g=Ge("prehashed msgHash",O(g)));const C=F(g),k=h(w),N=[$(k),$(C)];if(L!=null&&L!==!1){const H=L===!0?I(n.BYTES):L;N.push(Ge("extraEntropy",H))}const q=Se(...N),j=C;function W(H){const Z=R(H);if(!f(Z))return;const Q=u(Z),ee=l.BASE.multiply(Z).toAffine(),se=c(ee.x);if(se===Vt)return;const he=c(Q*c(j+se*k));if(he===Vt)return;let Ee=(ee.x===se?0:2)|Number(ee.y&ge),kn=he;return B&&p(he)&&(kn=b(he),Ee^=1),new A(se,kn,Ee)}return{seed:q,k2sig:W}}const M={lowS:e.lowS,prehash:!1},E={lowS:e.lowS,prehash:!1};function y(g,w,S=M){const{seed:O,k2sig:I}=z(g,w,S),B=e;return HE(B.hash.outputLen,B.nByteLength,B.hmac)(O,I)}l.BASE._setWindowSize(8);function m(g,w,S,O=E){const I=g;w=Ge("msgHash",w),S=Ge("publicKey",S);const{lowS:B,prehash:P,format:L}=O;if(Id(O),"strict"in O)throw new Error("options.strict was renamed to lowS");if(L!==void 0&&L!=="compact"&&L!=="der")throw new Error("format must be compact or der");const C=typeof I=="string"||Mi(I),k=!C&&!L&&typeof I=="object"&&I!==null&&typeof I.r=="bigint"&&typeof I.s=="bigint";if(!C&&!k)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let N,q;try{if(k&&(N=new A(I.r,I.s)),C){try{L!=="compact"&&(N=A.fromDER(I))}catch(Ee){if(!(Ee instanceof Sn.Err))throw Ee}!N&&L!=="der"&&(N=A.fromCompact(I))}q=l.fromHex(S)}catch{return!1}if(!N||B&&N.hasHighS())return!1;P&&(w=e.hash(w));const{r:j,s:W}=N,H=F(w),Z=u(W),Q=c(H*Z),ee=c(j*Z),se=l.BASE.multiplyAndAddUnsafe(q,Q,ee)?.toAffine();return se?c(se.x)===j:!1}return{CURVE:e,getPublicKey:_,getSharedSecret:T,sign:y,verify:m,ProjectivePoint:l,Signature:A,utils:D}}function Z3(t,e){const n=t.ORDER;let r=Vt;for(let p=n-ge;p%Wn===Vt;p/=Wn)r+=ge;const i=r,s=Wn<<i-ge-ge,o=s*Wn,a=(n-ge)/o,c=(a-ge)/Wn,u=o-ge,l=s,h=t.pow(e,a),d=t.pow(e,(a+ge)/Wn);let f=(p,b)=>{let v=h,A=t.pow(b,u),D=t.sqr(A);D=t.mul(D,b);let _=t.mul(p,D);_=t.pow(_,c),_=t.mul(_,A),A=t.mul(_,b),D=t.mul(_,p);let x=t.mul(D,A);_=t.pow(x,l);let T=t.eql(_,t.ONE);A=t.mul(D,d),_=t.mul(x,v),D=t.cmov(A,D,T),x=t.cmov(_,x,T);for(let R=i;R>ge;R--){let F=R-Wn;F=Wn<<F-ge;let U=t.pow(x,F);const $=t.eql(U,t.ONE);A=t.mul(D,v),v=t.mul(v,v),U=t.mul(x,v),D=t.cmov(A,D,$),x=t.cmov(U,x,$)}return{isValid:T,value:D}};if(t.ORDER%kc===Ki){const p=(t.ORDER-Ki)/kc,b=t.sqrt(t.neg(e));f=(v,A)=>{let D=t.sqr(A);const _=t.mul(v,A);D=t.mul(D,_);let x=t.pow(D,p);x=t.mul(x,_);const T=t.mul(x,b),R=t.mul(t.sqr(x),A),F=t.eql(R,v);let U=t.cmov(T,x,F);return{isValid:F,value:U}}}return f}function Od(t,e){if(yd(t),!t.isValid(e.A)||!t.isValid(e.B)||!t.isValid(e.Z))throw new Error("mapToCurveSimpleSWU: invalid opts");const n=Z3(t,e.Z);if(!t.isOdd)throw new Error("Fp.isOdd is not implemented!");return r=>{let i,s,o,a,c,u,l,h;i=t.sqr(r),i=t.mul(i,e.Z),s=t.sqr(i),s=t.add(s,i),o=t.add(s,t.ONE),o=t.mul(o,e.B),a=t.cmov(e.Z,t.neg(s),!t.eql(s,t.ZERO)),a=t.mul(a,e.A),s=t.sqr(o),u=t.sqr(a),c=t.mul(u,e.A),s=t.add(s,c),s=t.mul(s,o),u=t.mul(u,a),c=t.mul(u,e.B),s=t.add(s,c),l=t.mul(i,o);const{isValid:d,value:f}=n(s,u);h=t.mul(i,r),h=t.mul(h,f),l=t.cmov(l,o,d),h=t.cmov(h,f,d);const p=t.isOdd(r)===t.isOdd(h);h=t.cmov(t.neg(h),h,p);const b=Tr(t,[a],!0)[0];return l=t.mul(l,b),{x:l,y:h}}}function Y3(t){return{hash:t,hmac:(e,...n)=>$c(t,e,bn(...n)),randomBytes:uo}}function xo(t,e){const n=r=>W3({...t,...Y3(r)});return{...n(e),create:n}}const X3=rt;function Zn(t,e){if(Gi(t),Gi(e),t<0||t>=1<<8*e)throw new Error("invalid I2OSP input: "+t);const n=Array.from({length:e}).fill(0);for(let r=e-1;r>=0;r--)n[r]=t&255,t>>>=8;return new Uint8Array(n)}function J3(t,e){const n=new Uint8Array(t.length);for(let r=0;r<t.length;r++)n[r]=t[r]^e[r];return n}function Gi(t){if(!Number.isSafeInteger(t))throw new Error("number expected")}function Q3(t,e,n,r){Kn(t),Kn(e),Gi(n),e.length>255&&(e=r(Se(bc("H2C-OVERSIZE-DST-"),e)));const{outputLen:i,blockLen:s}=r,o=Math.ceil(n/i);if(n>65535||o>255)throw new Error("expand_message_xmd: invalid lenInBytes");const a=Se(e,Zn(e.length,1)),c=Zn(0,s),u=Zn(n,2),l=new Array(o),h=r(Se(c,t,u,Zn(0,1),a));l[0]=r(Se(h,Zn(1,1),a));for(let f=1;f<=o;f++){const p=[J3(h,l[f-1]),Zn(f+1,1),a];l[f]=r(Se(...p))}return Se(...l).slice(0,n)}function e8(t,e,n,r,i){if(Kn(t),Kn(e),Gi(n),e.length>255){const s=Math.ceil(2*r/8);e=i.create({dkLen:s}).update(bc("H2C-OVERSIZE-DST-")).update(e).digest()}if(n>65535||e.length>255)throw new Error("expand_message_xof: invalid lenInBytes");return i.create({dkLen:n}).update(t).update(Zn(n,2)).update(e).update(Zn(e.length,1)).digest()}function Ad(t,e,n){Vi(n,{DST:"stringOrUint8Array",p:"bigint",m:"isSafeInteger",k:"isSafeInteger",hash:"hash"});const{p:r,k:i,m:s,hash:o,expand:a,DST:c}=n;Kn(t),Gi(e);const u=typeof c=="string"?bc(c):c,l=r.toString(2).length,h=Math.ceil((l+i)/8),d=e*s*h;let f;if(a==="xmd")f=Q3(t,u,d,o);else if(a==="xof")f=e8(t,u,d,i,o);else if(a==="_internal_pass")f=t;else throw new Error('expand must be "xmd" or "xof"');const p=new Array(e);for(let b=0;b<e;b++){const v=new Array(s);for(let A=0;A<s;A++){const D=h*(A+b*s),_=f.subarray(D,D+h);v[A]=st(X3(_),r)}p[b]=v}return p}function Bd(t,e){const n=e.map(r=>Array.from(r).reverse());return(r,i)=>{const[s,o,a,c]=n.map(h=>h.reduce((d,f)=>t.add(t.mul(d,r),f))),[u,l]=Tr(t,[o,c],!0);return r=t.mul(s,u),i=t.mul(i,t.mul(a,l)),{x:r,y:i}}}function Dd(t,e,n){if(typeof e!="function")throw new Error("mapToCurve() must be defined");function r(s){return t.fromAffine(e(s))}function i(s){const o=s.clearCofactor();return o.equals(t.ZERO)?t.ZERO:(o.assertValidity(),o)}return{defaults:n,hashToCurve(s,o){const a=Ad(s,2,{...n,DST:n.DST,...o}),c=r(a[0]),u=r(a[1]);return i(c.add(u))},encodeToCurve(s,o){const a=Ad(s,1,{...n,DST:n.encodeDST,...o});return i(r(a[0]))},mapToCurve(s){if(!Array.isArray(s))throw new Error("expected array of bigints");for(const o of s)if(typeof o!="bigint")throw new Error("expected array of bigints");return i(r(s))}}}const $d=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Td=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),t8=BigInt(0),n8=BigInt(1),Mc=BigInt(2),Pd=(t,e)=>(t+e/Mc)/e;function r8(t){const e=$d,n=BigInt(3),r=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),u=t*t*t%e,l=u*u*t%e,h=Pt(l,n,e)*l%e,d=Pt(h,n,e)*l%e,f=Pt(d,Mc,e)*u%e,p=Pt(f,i,e)*f%e,b=Pt(p,s,e)*p%e,v=Pt(b,a,e)*b%e,A=Pt(v,c,e)*v%e,D=Pt(A,a,e)*b%e,_=Pt(D,n,e)*l%e,x=Pt(_,o,e)*p%e,T=Pt(x,r,e)*u%e,R=Pt(T,Mc,e);if(!jc.eql(jc.sqr(R),t))throw new Error("Cannot find square root");return R}const jc=Gn($d,void 0,void 0,{sqrt:r8}),i8=xo({a:t8,b:BigInt(7),Fp:jc,n:Td,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=Td,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-n8*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,o=BigInt("0x100000000000000000000000000000000"),a=Pd(s*t,e),c=Pd(-r*t,e);let u=st(t-a*n-c*i,e),l=st(-a*r-c*s,e);const h=u>o,d=l>o;if(h&&(u=e-u),d&&(l=e-l),u>o||l>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:h,k1:u,k2neg:d,k2:l}}}},ci);function s8(t){if(t.length!==130&&t.length!==132)throw new a8({signature:t});const e=BigInt(xn(t,0,32)),n=BigInt(xn(t,32,64)),r=(()=>{const i=+`0x${t.slice(130)}`;if(!Number.isNaN(i))try{return o8(i)}catch{throw new c8({value:i})}})();return typeof r>"u"?{r:e,s:n}:{r:e,s:n,yParity:r}}function o8(t){if(t===0||t===27)return 0;if(t===1||t===28)return 1;if(t>=35)return t%2===0?1:0;throw new u8({value:t})}class a8 extends ye{constructor({signature:e}){super(`Value \`${e}\` is an invalid signature size.`,{metaMessages:["Expected: 64 bytes or 65 bytes.",`Received ${_n(Ic(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSerializedSizeError"})}}class c8 extends ye{constructor({value:e}){super(`Value \`${e}\` is an invalid y-parity value. Y-parity must be 0 or 1.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidYParityError"})}}class u8 extends ye{constructor({value:e}){super(`Value \`${e}\` is an invalid v value. v must be 27, 28 or >=35.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidVError"})}}Object.freeze({1:0n,2:1n,3:2n,4:3n,5:4n,6:5n,7:6n,8:7n,9:8n,A:9n,B:10n,C:11n,D:12n,E:13n,F:14n,G:15n,H:16n,J:17n,K:18n,L:19n,M:20n,N:21n,P:22n,Q:23n,R:24n,S:25n,T:26n,U:27n,V:28n,W:29n,X:30n,Y:31n,Z:32n,a:33n,b:34n,c:35n,d:36n,e:37n,f:38n,g:39n,h:40n,i:41n,j:42n,k:43n,m:44n,n:45n,o:46n,p:47n,q:48n,r:49n,s:50n,t:51n,u:52n,v:53n,w:54n,x:55n,y:56n,z:57n}),Array.from("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/").map((t,e)=>[e,t.charCodeAt(0)]),{...Object.fromEntries(Array.from("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/").map((t,e)=>[t.charCodeAt(0),e]))},wn.slice();const l8=BigInt(0),_o=BigInt(1),Rd=BigInt(2),li=BigInt(3);function f8(t){const e=[];for(;t>_o;t>>=_o)(t&_o)===l8?e.unshift(0):(t&li)===li?(e.unshift(-1),t+=_o):e.unshift(1);return e}function h8(t){const{Fp:e,Fr:n,Fp2:r,Fp6:i,Fp12:s}=t.fields,o=t.params.xNegative,a=t.params.twistType,c=qc({n:n.ORDER,...t.G1}),u=Object.assign(c,Dd(c.ProjectivePoint,t.G1.mapToCurve,{...t.htfDefaults,...t.G1.htfDefaults})),l=qc({n:n.ORDER,...t.G2}),h=Object.assign(l,Dd(l.ProjectivePoint,t.G2.mapToCurve,{...t.htfDefaults,...t.G2.htfDefaults}));let d;if(a==="multiplicative")d=(C,k,N,q,j,W)=>s.mul014(q,C,r.mul(k,j),r.mul(N,W));else if(a==="divisive")d=(C,k,N,q,j,W)=>s.mul034(q,r.mul(N,W),r.mul(k,j),C);else throw new Error("bls: unknown twist type");const f=r.div(r.ONE,r.mul(r.ONE,Rd));function p(C,k,N,q){const j=r.sqr(N),W=r.sqr(q),H=r.mulByB(r.mul(W,li)),Z=r.mul(H,li),Q=r.sub(r.sub(r.sqr(r.add(N,q)),W),j),ee=r.sub(H,j),se=r.mul(r.sqr(k),li),he=r.neg(Q);return C.push([ee,se,he]),k=r.mul(r.mul(r.mul(r.sub(j,Z),k),N),f),N=r.sub(r.sqr(r.mul(r.add(j,Z),f)),r.mul(r.sqr(H),li)),q=r.mul(j,Q),{Rx:k,Ry:N,Rz:q}}function b(C,k,N,q,j,W){const H=r.sub(N,r.mul(W,q)),Z=r.sub(k,r.mul(j,q)),Q=r.sub(r.mul(H,j),r.mul(Z,W)),ee=r.neg(H),se=Z;C.push([Q,ee,se]);const he=r.sqr(Z),Ee=r.mul(he,Z),kn=r.mul(he,k),Aa=r.add(r.sub(Ee,r.mul(kn,Rd)),r.mul(r.sqr(H),q));return k=r.mul(Z,Aa),N=r.sub(r.mul(r.sub(kn,Aa),H),r.mul(Ee,N)),q=r.mul(q,Ee),{Rx:k,Ry:N,Rz:q}}const v=f8(t.params.ateLoopSize),A=Ec(C=>{const k=C,{x:N,y:q}=k.toAffine(),j=N,W=q,H=r.neg(q);let Z=j,Q=W,ee=r.ONE;const se=[];for(const he of v){const Ee=[];({Rx:Z,Ry:Q,Rz:ee}=p(Ee,Z,Q,ee)),he&&({Rx:Z,Ry:Q,Rz:ee}=b(Ee,Z,Q,ee,j,he===-1?H:W)),se.push(Ee)}if(t.postPrecompute){const he=se[se.length-1];t.postPrecompute(Z,Q,ee,j,W,b.bind(null,he))}return se});function D(C,k=!1){let N=s.ONE;if(C.length){const q=C[0][0].length;for(let j=0;j<q;j++){N=s.sqr(N);for(const[W,H,Z]of C)for(const[Q,ee,se]of W[j])N=d(Q,ee,se,N,H,Z)}}return o&&(N=s.conjugate(N)),k?s.finalExponentiate(N):N}function _(C,k=!0){const N=[];u.ProjectivePoint.normalizeZ(C.map(({g1:q})=>q)),h.ProjectivePoint.normalizeZ(C.map(({g2:q})=>q));for(const{g1:q,g2:j}of C){if(q.equals(u.ProjectivePoint.ZERO)||j.equals(h.ProjectivePoint.ZERO))throw new Error("pairing is not available for ZERO point");q.assertValidity(),j.assertValidity();const W=q.toAffine();N.push([A(j),W.x,W.y])}return D(N,k)}function x(C,k,N=!0){return _([{g1:C,g2:k}],N)}const T={randomPrivateKey:()=>{const C=Pc(n.ORDER);return md(t.randomBytes(C),n.ORDER)},calcPairingPrecomputes:A},{ShortSignature:R}=t.G1,{Signature:F}=t.G2;function U(C){return C instanceof u.ProjectivePoint?C:u.ProjectivePoint.fromHex(C)}function $(C,k){return C instanceof u.ProjectivePoint?C:u.hashToCurve(Ge("point",C),k)}function z(C){return C instanceof h.ProjectivePoint?C:F.fromHex(C)}function M(C,k){return C instanceof h.ProjectivePoint?C:h.hashToCurve(Ge("point",C),k)}function E(C){return u.ProjectivePoint.fromPrivateKey(C).toRawBytes(!0)}function y(C){return h.ProjectivePoint.fromPrivateKey(C).toRawBytes(!0)}function m(C,k,N){const q=M(C,N);q.assertValidity();const j=q.multiply(u.normPrivateKeyToScalar(k));return C instanceof h.ProjectivePoint?j:F.toRawBytes(j)}function g(C,k,N){const q=$(C,N);q.assertValidity();const j=q.multiply(u.normPrivateKeyToScalar(k));return C instanceof u.ProjectivePoint?j:R.toRawBytes(j)}function w(C,k,N,q){const j=U(N),W=M(k,q),H=u.ProjectivePoint.BASE,Z=z(C),Q=_([{g1:j.negate(),g2:W},{g1:H,g2:Z}]);return s.eql(Q,s.ONE)}function S(C,k,N,q){const j=z(N),W=$(k,q),H=h.ProjectivePoint.BASE,Z=U(C),Q=_([{g1:W,g2:j},{g1:Z,g2:H.negate()}]);return s.eql(Q,s.ONE)}function O(C){if(!Array.isArray(C)||C.length===0)throw new Error("expected non-empty array")}function I(C){O(C);const N=C.map(U).reduce((q,j)=>q.add(j),u.ProjectivePoint.ZERO);return C[0]instanceof u.ProjectivePoint?(N.assertValidity(),N):N.toRawBytes(!0)}function B(C){O(C);const N=C.map(z).reduce((q,j)=>q.add(j),h.ProjectivePoint.ZERO);return C[0]instanceof h.ProjectivePoint?(N.assertValidity(),N):F.toRawBytes(N)}function P(C){O(C);const N=C.map(U).reduce((q,j)=>q.add(j),u.ProjectivePoint.ZERO);return C[0]instanceof u.ProjectivePoint?(N.assertValidity(),N):R.toRawBytes(N)}function L(C,k,N,q){if(O(k),N.length!==k.length)throw new Error("amount of public keys and messages should be equal");const j=z(C),W=k.map(ee=>M(ee,q)),H=N.map(U),Z=new Map;for(let ee=0;ee<H.length;ee++){const se=H[ee],he=W[ee];let Ee=Z.get(he);Ee===void 0&&(Ee=[],Z.set(he,Ee)),Ee.push(se)}const Q=[];try{for(const[ee,se]of Z){const he=se.reduce((Ee,kn)=>Ee.add(kn));Q.push({g1:he,g2:ee})}return Q.push({g1:u.ProjectivePoint.BASE.negate(),g2:j}),s.eql(_(Q),s.ONE)}catch{return!1}}return u.ProjectivePoint.BASE._setWindowSize(4),{getPublicKey:E,getPublicKeyForShortSignatures:y,sign:m,signShortSignature:g,verify:w,verifyBatch:L,verifyShortSignature:S,aggregatePublicKeys:I,aggregateSignatures:B,aggregateShortSignatures:P,millerLoopBatch:D,pairing:x,pairingBatch:_,G1:u,G2:h,Signature:F,ShortSignature:R,fields:{Fr:n,Fp:e,Fp2:r,Fp6:i,Fp12:s},params:{ateLoopSize:t.params.ateLoopSize,r:t.params.r,G1b:t.G1.b,G2b:t.G2.b},utils:T}}const d8=BigInt(0),fi=BigInt(1),In=BigInt(2),Nd=BigInt(3);function zc(t,e,n,r,i=1,s){const o=BigInt(s===void 0?r:s),a=n**BigInt(r),c=[];for(let u=0;u<i;u++){const l=BigInt(u+1),h=[];for(let d=0,f=fi;d<r;d++){const p=(l*f-l)/o%a;h.push(t.pow(e,p)),f*=n}c.push(h)}return c}function p8(t,e,n){const r=e.pow(n,(t.ORDER-fi)/Nd),i=e.pow(n,(t.ORDER-fi)/In);function s(d,f){const p=e.mul(e.frobeniusMap(d,1),r),b=e.mul(e.frobeniusMap(f,1),i);return[p,b]}const o=e.pow(n,(t.ORDER**In-fi)/Nd),a=e.pow(n,(t.ORDER**In-fi)/In);if(!e.eql(a,e.neg(e.ONE)))throw new Error("psiFrobenius: PSI2_Y!==-1");function c(d,f){return[e.mul(d,o),e.neg(f)]}const u=d=>(f,p)=>{const b=p.toAffine(),v=d(b.x,b.y);return f.fromAffine({x:v[0],y:v[1]})},l=u(s),h=u(c);return{psi:s,psi2:c,G2psi:l,G2psi2:h,PSI_X:r,PSI_Y:i,PSI2_X:o,PSI2_Y:a}}function g8(t){const{ORDER:e}=t,n=Gn(e),r=n.create(t.NONRESIDUE||BigInt(-1)),i=n.div(n.ONE,In),s=zc(n,r,n.ORDER,2)[0],o=({c0:E,c1:y},{c0:m,c1:g})=>({c0:n.add(E,m),c1:n.add(y,g)}),a=({c0:E,c1:y},{c0:m,c1:g})=>({c0:n.sub(E,m),c1:n.sub(y,g)}),c=({c0:E,c1:y},m)=>{if(typeof m=="bigint")return{c0:n.mul(E,m),c1:n.mul(y,m)};const{c0:g,c1:w}=m;let S=n.mul(E,g),O=n.mul(y,w);const I=n.sub(S,O),B=n.sub(n.mul(n.add(E,y),n.add(g,w)),n.add(S,O));return{c0:I,c1:B}},u=({c0:E,c1:y})=>{const m=n.add(E,y),g=n.sub(E,y),w=n.add(E,E);return{c0:n.mul(m,g),c1:n.mul(w,y)}},l=E=>{if(E.length!==2)throw new Error("invalid tuple");const y=E.map(m=>n.create(m));return{c0:y[0],c1:y[1]}},h=e*e,d=l(t.FP2_NONRESIDUE),f={ORDER:h,isLE:n.isLE,NONRESIDUE:d,BITS:zi(h),BYTES:Math.ceil(zi(h)/8),MASK:Dr(zi(h)),ZERO:{c0:n.ZERO,c1:n.ZERO},ONE:{c0:n.ONE,c1:n.ZERO},create:E=>E,isValid:({c0:E,c1:y})=>typeof E=="bigint"&&typeof y=="bigint",is0:({c0:E,c1:y})=>n.is0(E)&&n.is0(y),eql:({c0:E,c1:y},{c0:m,c1:g})=>n.eql(E,m)&&n.eql(y,g),neg:({c0:E,c1:y})=>({c0:n.neg(E),c1:n.neg(y)}),pow:(E,y)=>vo(f,E,y),invertBatch:E=>Tr(f,E),add:o,sub:a,mul:c,sqr:u,addN:o,subN:a,mulN:c,sqrN:u,div:(E,y)=>f.mul(E,typeof y=="bigint"?n.inv(n.create(y)):f.inv(y)),inv:({c0:E,c1:y})=>{const m=n.inv(n.create(E*E+y*y));return{c0:n.mul(m,n.create(E)),c1:n.mul(m,n.create(-y))}},sqrt:E=>{if(t.Fp2sqrt)return t.Fp2sqrt(E);const{c0:y,c1:m}=E;if(n.is0(m))return Eo(n,y)===1?f.create({c0:n.sqrt(y),c1:n.ZERO}):f.create({c0:n.ZERO,c1:n.sqrt(n.div(y,r))});const g=n.sqrt(n.sub(n.sqr(y),n.mul(n.sqr(m),r)));let w=n.mul(n.add(g,y),i);Eo(n,w)===-1&&(w=n.sub(w,g));const O=n.sqrt(w),I=f.create({c0:O,c1:n.div(n.mul(m,i),O)});if(!f.eql(f.sqr(I),E))throw new Error("Cannot find square root");const B=I,P=f.neg(B),{re:L,im:C}=f.reim(B),{re:k,im:N}=f.reim(P);return C>N||C===N&&L>k?B:P},isOdd:E=>{const{re:y,im:m}=f.reim(E),g=y%In,w=y===d8,S=m%In;return BigInt(g||w&&S)==fi},fromBytes(E){if(E.length!==f.BYTES)throw new Error("fromBytes invalid length="+E.length);return{c0:n.fromBytes(E.subarray(0,n.BYTES)),c1:n.fromBytes(E.subarray(n.BYTES))}},toBytes:({c0:E,c1:y})=>Se(n.toBytes(E),n.toBytes(y)),cmov:({c0:E,c1:y},{c0:m,c1:g},w)=>({c0:n.cmov(E,m,w),c1:n.cmov(y,g,w)}),reim:({c0:E,c1:y})=>({re:E,im:y}),mulByNonresidue:({c0:E,c1:y})=>f.mul({c0:E,c1:y},d),mulByB:t.Fp2mulByB,fromBigTuple:l,frobeniusMap:({c0:E,c1:y},m)=>({c0:E,c1:n.mul(y,s[m%2])})},p=({c0:E,c1:y,c2:m},{c0:g,c1:w,c2:S})=>({c0:f.add(E,g),c1:f.add(y,w),c2:f.add(m,S)}),b=({c0:E,c1:y,c2:m},{c0:g,c1:w,c2:S})=>({c0:f.sub(E,g),c1:f.sub(y,w),c2:f.sub(m,S)}),v=({c0:E,c1:y,c2:m},g)=>{if(typeof g=="bigint")return{c0:f.mul(E,g),c1:f.mul(y,g),c2:f.mul(m,g)};const{c0:w,c1:S,c2:O}=g,I=f.mul(E,w),B=f.mul(y,S),P=f.mul(m,O);return{c0:f.add(I,f.mulByNonresidue(f.sub(f.mul(f.add(y,m),f.add(S,O)),f.add(B,P)))),c1:f.add(f.sub(f.mul(f.add(E,y),f.add(w,S)),f.add(I,B)),f.mulByNonresidue(P)),c2:f.sub(f.add(B,f.mul(f.add(E,m),f.add(w,O))),f.add(I,P))}},A=({c0:E,c1:y,c2:m})=>{let g=f.sqr(E),w=f.mul(f.mul(E,y),In),S=f.mul(f.mul(y,m),In),O=f.sqr(m);return{c0:f.add(f.mulByNonresidue(S),g),c1:f.add(f.mulByNonresidue(O),w),c2:f.sub(f.sub(f.add(f.add(w,f.sqr(f.add(f.sub(E,y),m))),S),g),O)}},[D,_]=zc(f,d,n.ORDER,6,2,3),x={ORDER:f.ORDER,isLE:f.isLE,BITS:3*f.BITS,BYTES:3*f.BYTES,MASK:Dr(3*f.BITS),ZERO:{c0:f.ZERO,c1:f.ZERO,c2:f.ZERO},ONE:{c0:f.ONE,c1:f.ZERO,c2:f.ZERO},create:E=>E,isValid:({c0:E,c1:y,c2:m})=>f.isValid(E)&&f.isValid(y)&&f.isValid(m),is0:({c0:E,c1:y,c2:m})=>f.is0(E)&&f.is0(y)&&f.is0(m),neg:({c0:E,c1:y,c2:m})=>({c0:f.neg(E),c1:f.neg(y),c2:f.neg(m)}),eql:({c0:E,c1:y,c2:m},{c0:g,c1:w,c2:S})=>f.eql(E,g)&&f.eql(y,w)&&f.eql(m,S),sqrt:Jh,div:(E,y)=>x.mul(E,typeof y=="bigint"?n.inv(n.create(y)):x.inv(y)),pow:(E,y)=>vo(x,E,y),invertBatch:E=>Tr(x,E),add:p,sub:b,mul:v,sqr:A,addN:p,subN:b,mulN:v,sqrN:A,inv:({c0:E,c1:y,c2:m})=>{let g=f.sub(f.sqr(E),f.mulByNonresidue(f.mul(m,y))),w=f.sub(f.mulByNonresidue(f.sqr(m)),f.mul(E,y)),S=f.sub(f.sqr(y),f.mul(E,m)),O=f.inv(f.add(f.mulByNonresidue(f.add(f.mul(m,w),f.mul(y,S))),f.mul(E,g)));return{c0:f.mul(O,g),c1:f.mul(O,w),c2:f.mul(O,S)}},fromBytes:E=>{if(E.length!==x.BYTES)throw new Error("fromBytes invalid length="+E.length);return{c0:f.fromBytes(E.subarray(0,f.BYTES)),c1:f.fromBytes(E.subarray(f.BYTES,2*f.BYTES)),c2:f.fromBytes(E.subarray(2*f.BYTES))}},toBytes:({c0:E,c1:y,c2:m})=>Se(f.toBytes(E),f.toBytes(y),f.toBytes(m)),cmov:({c0:E,c1:y,c2:m},{c0:g,c1:w,c2:S},O)=>({c0:f.cmov(E,g,O),c1:f.cmov(y,w,O),c2:f.cmov(m,S,O)}),fromBigSix:E=>{if(!Array.isArray(E)||E.length!==6)throw new Error("invalid Fp6 usage");return{c0:f.fromBigTuple(E.slice(0,2)),c1:f.fromBigTuple(E.slice(2,4)),c2:f.fromBigTuple(E.slice(4,6))}},frobeniusMap:({c0:E,c1:y,c2:m},g)=>({c0:f.frobeniusMap(E,g),c1:f.mul(f.frobeniusMap(y,g),D[g%6]),c2:f.mul(f.frobeniusMap(m,g),_[g%6])}),mulByFp2:({c0:E,c1:y,c2:m},g)=>({c0:f.mul(E,g),c1:f.mul(y,g),c2:f.mul(m,g)}),mulByNonresidue:({c0:E,c1:y,c2:m})=>({c0:f.mulByNonresidue(m),c1:E,c2:y}),mul1:({c0:E,c1:y,c2:m},g)=>({c0:f.mulByNonresidue(f.mul(m,g)),c1:f.mul(E,g),c2:f.mul(y,g)}),mul01({c0:E,c1:y,c2:m},g,w){let S=f.mul(E,g),O=f.mul(y,w);return{c0:f.add(f.mulByNonresidue(f.sub(f.mul(f.add(y,m),w),O)),S),c1:f.sub(f.sub(f.mul(f.add(g,w),f.add(E,y)),S),O),c2:f.add(f.sub(f.mul(f.add(E,m),g),S),O)}}},T=zc(f,d,n.ORDER,12,1,6)[0],R=({c0:E,c1:y},{c0:m,c1:g})=>({c0:x.add(E,m),c1:x.add(y,g)}),F=({c0:E,c1:y},{c0:m,c1:g})=>({c0:x.sub(E,m),c1:x.sub(y,g)}),U=({c0:E,c1:y},m)=>{if(typeof m=="bigint")return{c0:x.mul(E,m),c1:x.mul(y,m)};let{c0:g,c1:w}=m,S=x.mul(E,g),O=x.mul(y,w);return{c0:x.add(S,x.mulByNonresidue(O)),c1:x.sub(x.mul(x.add(E,y),x.add(g,w)),x.add(S,O))}},$=({c0:E,c1:y})=>{let m=x.mul(E,y);return{c0:x.sub(x.sub(x.mul(x.add(x.mulByNonresidue(y),E),x.add(E,y)),m),x.mulByNonresidue(m)),c1:x.add(m,m)}};function z(E,y){const m=f.sqr(E),g=f.sqr(y);return{first:f.add(f.mulByNonresidue(g),m),second:f.sub(f.sub(f.sqr(f.add(E,y)),m),g)}}const M={ORDER:f.ORDER,isLE:x.isLE,BITS:2*x.BITS,BYTES:2*x.BYTES,MASK:Dr(2*x.BITS),ZERO:{c0:x.ZERO,c1:x.ZERO},ONE:{c0:x.ONE,c1:x.ZERO},create:E=>E,isValid:({c0:E,c1:y})=>x.isValid(E)&&x.isValid(y),is0:({c0:E,c1:y})=>x.is0(E)&&x.is0(y),neg:({c0:E,c1:y})=>({c0:x.neg(E),c1:x.neg(y)}),eql:({c0:E,c1:y},{c0:m,c1:g})=>x.eql(E,m)&&x.eql(y,g),sqrt:Jh,inv:({c0:E,c1:y})=>{let m=x.inv(x.sub(x.sqr(E),x.mulByNonresidue(x.sqr(y))));return{c0:x.mul(E,m),c1:x.neg(x.mul(y,m))}},div:(E,y)=>M.mul(E,typeof y=="bigint"?n.inv(n.create(y)):M.inv(y)),pow:(E,y)=>vo(M,E,y),invertBatch:E=>Tr(M,E),add:R,sub:F,mul:U,sqr:$,addN:R,subN:F,mulN:U,sqrN:$,fromBytes:E=>{if(E.length!==M.BYTES)throw new Error("fromBytes invalid length="+E.length);return{c0:x.fromBytes(E.subarray(0,x.BYTES)),c1:x.fromBytes(E.subarray(x.BYTES))}},toBytes:({c0:E,c1:y})=>Se(x.toBytes(E),x.toBytes(y)),cmov:({c0:E,c1:y},{c0:m,c1:g},w)=>({c0:x.cmov(E,m,w),c1:x.cmov(y,g,w)}),fromBigTwelve:E=>({c0:x.fromBigSix(E.slice(0,6)),c1:x.fromBigSix(E.slice(6,12))}),frobeniusMap(E,y){const{c0:m,c1:g,c2:w}=x.frobeniusMap(E.c1,y),S=T[y%12];return{c0:x.frobeniusMap(E.c0,y),c1:x.create({c0:f.mul(m,S),c1:f.mul(g,S),c2:f.mul(w,S)})}},mulByFp2:({c0:E,c1:y},m)=>({c0:x.mulByFp2(E,m),c1:x.mulByFp2(y,m)}),conjugate:({c0:E,c1:y})=>({c0:E,c1:x.neg(y)}),mul014:({c0:E,c1:y},m,g,w)=>{let S=x.mul01(E,m,g),O=x.mul1(y,w);return{c0:x.add(x.mulByNonresidue(O),S),c1:x.sub(x.sub(x.mul01(x.add(y,E),m,f.add(g,w)),S),O)}},mul034:({c0:E,c1:y},m,g,w)=>{const S=x.create({c0:f.mul(E.c0,m),c1:f.mul(E.c1,m),c2:f.mul(E.c2,m)}),O=x.mul01(y,g,w),I=x.mul01(x.add(E,y),f.add(m,g),w);return{c0:x.add(x.mulByNonresidue(O),S),c1:x.sub(I,x.add(S,O))}},_cyclotomicSquare:t.Fp12cyclotomicSquare,_cyclotomicExp:t.Fp12cyclotomicExp,finalExponentiate:t.Fp12finalExponentiate};return{Fp:n,Fp2:f,Fp6:x,Fp4Square:z,Fp12:M}}const ot=BigInt(0),So=BigInt(1),Ce=BigInt(2),Io=BigInt(3),Wi=BigInt(4),Yn=BigInt("0xd201000000010000"),y8=zi(Yn),{Fp:X,Fp2:J,Fp6:Vc,Fp4Square:Hc,Fp12:ie}=g8({ORDER:BigInt("0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaaab"),FP2_NONRESIDUE:[So,So],Fp2mulByB:({c0:t,c1:e})=>{const n=X.mul(t,Wi),r=X.mul(e,Wi);return{c0:X.sub(n,r),c1:X.add(n,r)}},Fp12cyclotomicSquare:({c0:t,c1:e})=>{const{c0:n,c1:r,c2:i}=t,{c0:s,c1:o,c2:a}=e,{first:c,second:u}=Hc(n,o),{first:l,second:h}=Hc(s,i),{first:d,second:f}=Hc(r,a),p=J.mulByNonresidue(f);return{c0:Vc.create({c0:J.add(J.mul(J.sub(c,n),Ce),c),c1:J.add(J.mul(J.sub(l,r),Ce),l),c2:J.add(J.mul(J.sub(d,i),Ce),d)}),c1:Vc.create({c0:J.add(J.mul(J.add(p,s),Ce),p),c1:J.add(J.mul(J.add(u,o),Ce),u),c2:J.add(J.mul(J.add(h,a),Ce),h)})}},Fp12cyclotomicExp(t,e){let n=ie.ONE;for(let r=y8-1;r>=0;r--)n=ie._cyclotomicSquare(n),VE(e,r)&&(n=ie.mul(n,t));return n},Fp12finalExponentiate:t=>{const e=Yn,n=ie.div(ie.frobeniusMap(t,6),t),r=ie.mul(ie.frobeniusMap(n,2),n),i=ie.conjugate(ie._cyclotomicExp(r,e)),s=ie.mul(ie.conjugate(ie._cyclotomicSquare(r)),i),o=ie.conjugate(ie._cyclotomicExp(s,e)),a=ie.conjugate(ie._cyclotomicExp(o,e)),c=ie.mul(ie.conjugate(ie._cyclotomicExp(a,e)),ie._cyclotomicSquare(i)),u=ie.conjugate(ie._cyclotomicExp(c,e)),l=ie.frobeniusMap(ie.mul(i,a),2),h=ie.frobeniusMap(ie.mul(o,r),3),d=ie.frobeniusMap(ie.mul(c,ie.conjugate(r)),1),f=ie.mul(ie.mul(u,ie.conjugate(s)),r);return ie.mul(ie.mul(ie.mul(l,h),d),f)}}),Cd=Gn(BigInt("0x73eda753299d7d483339d80809a1d80553bda402fffe5bfeffffffff00000001")),b8=Bd(J,[[["0x5c759507e8e333ebb5b7a9a47d7ed8532c52d39fd3a042a88b58423c50ae15d5c2638e343d9c71c6238aaaaaaaa97d6","0x5c759507e8e333ebb5b7a9a47d7ed8532c52d39fd3a042a88b58423c50ae15d5c2638e343d9c71c6238aaaaaaaa97d6"],["0x0","0x11560bf17baa99bc32126fced787c88f984f87adf7ae0c7f9a208c6b4f20a4181472aaa9cb8d555526a9ffffffffc71a"],["0x11560bf17baa99bc32126fced787c88f984f87adf7ae0c7f9a208c6b4f20a4181472aaa9cb8d555526a9ffffffffc71e","0x8ab05f8bdd54cde190937e76bc3e447cc27c3d6fbd7063fcd104635a790520c0a395554e5c6aaaa9354ffffffffe38d"],["0x171d6541fa38ccfaed6dea691f5fb614cb14b4e7f4e810aa22d6108f142b85757098e38d0f671c7188e2aaaaaaaa5ed1","0x0"]],[["0x0","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaa63"],["0xc","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaa9f"],["0x1","0x0"]],[["0x1530477c7ab4113b59a4c18b076d11930f7da5d4a07f649bf54439d87d27e500fc8c25ebf8c92f6812cfc71c71c6d706","0x1530477c7ab4113b59a4c18b076d11930f7da5d4a07f649bf54439d87d27e500fc8c25ebf8c92f6812cfc71c71c6d706"],["0x0","0x5c759507e8e333ebb5b7a9a47d7ed8532c52d39fd3a042a88b58423c50ae15d5c2638e343d9c71c6238aaaaaaaa97be"],["0x11560bf17baa99bc32126fced787c88f984f87adf7ae0c7f9a208c6b4f20a4181472aaa9cb8d555526a9ffffffffc71c","0x8ab05f8bdd54cde190937e76bc3e447cc27c3d6fbd7063fcd104635a790520c0a395554e5c6aaaa9354ffffffffe38f"],["0x124c9ad43b6cf79bfbf7043de3811ad0761b0f37a1e26286b0e977c69aa274524e79097a56dc4bd9e1b371c71c718b10","0x0"]],[["0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffa8fb","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffa8fb"],["0x0","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffa9d3"],["0x12","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaa99"],["0x1","0x0"]]].map(t=>t.map(e=>J.fromBigTuple(e.map(BigInt))))),w8=Bd(X,[["0x11a05f2b1e833340b809101dd99815856b303e88a2d7005ff2627b56cdb4e2c85610c2d5f2e62d6eaeac1662734649b7","0x17294ed3e943ab2f0588bab22147a81c7c17e75b2f6a8417f565e33c70d1e86b4838f2a6f318c356e834eef1b3cb83bb","0xd54005db97678ec1d1048c5d10a9a1bce032473295983e56878e501ec68e25c958c3e3d2a09729fe0179f9dac9edcb0","0x1778e7166fcc6db74e0609d307e55412d7f5e4656a8dbf25f1b33289f1b330835336e25ce3107193c5b388641d9b6861","0xe99726a3199f4436642b4b3e4118e5499db995a1257fb3f086eeb65982fac18985a286f301e77c451154ce9ac8895d9","0x1630c3250d7313ff01d1201bf7a74ab5db3cb17dd952799b9ed3ab9097e68f90a0870d2dcae73d19cd13c1c66f652983","0xd6ed6553fe44d296a3726c38ae652bfb11586264f0f8ce19008e218f9c86b2a8da25128c1052ecaddd7f225a139ed84","0x17b81e7701abdbe2e8743884d1117e53356de5ab275b4db1a682c62ef0f2753339b7c8f8c8f475af9ccb5618e3f0c88e","0x80d3cf1f9a78fc47b90b33563be990dc43b756ce79f5574a2c596c928c5d1de4fa295f296b74e956d71986a8497e317","0x169b1f8e1bcfa7c42e0c37515d138f22dd2ecb803a0c5c99676314baf4bb1b7fa3190b2edc0327797f241067be390c9e","0x10321da079ce07e272d8ec09d2565b0dfa7dccdde6787f96d50af36003b14866f69b771f8c285decca67df3f1605fb7b","0x6e08c248e260e70bd1e962381edee3d31d79d7e22c837bc23c0bf1bc24c6b68c24b1b80b64d391fa9c8ba2e8ba2d229"],["0x8ca8d548cff19ae18b2e62f4bd3fa6f01d5ef4ba35b48ba9c9588617fc8ac62b558d681be343df8993cf9fa40d21b1c","0x12561a5deb559c4348b4711298e536367041e8ca0cf0800c0126c2588c48bf5713daa8846cb026e9e5c8276ec82b3bff","0xb2962fe57a3225e8137e629bff2991f6f89416f5a718cd1fca64e00b11aceacd6a3d0967c94fedcfcc239ba5cb83e19","0x3425581a58ae2fec83aafef7c40eb545b08243f16b1655154cca8abc28d6fd04976d5243eecf5c4130de8938dc62cd8","0x13a8e162022914a80a6f1d5f43e7a07dffdfc759a12062bb8d6b44e833b306da9bd29ba81f35781d539d395b3532a21e","0xe7355f8e4e667b955390f7f0506c6e9395735e9ce9cad4d0a43bcef24b8982f7400d24bc4228f11c02df9a29f6304a5","0x772caacf16936190f3e0c63e0596721570f5799af53a1894e2e073062aede9cea73b3538f0de06cec2574496ee84a3a","0x14a7ac2a9d64a8b230b3f5b074cf01996e7f63c21bca68a81996e1cdf9822c580fa5b9489d11e2d311f7d99bbdcc5a5e","0xa10ecf6ada54f825e920b3dafc7a3cce07f8d1d7161366b74100da67f39883503826692abba43704776ec3a79a1d641","0x95fc13ab9e92ad4476d6e3eb3a56680f682b4ee96f7d03776df533978f31c1593174e4b4b7865002d6384d168ecdd0a","0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"],["0x90d97c81ba24ee0259d1f094980dcfa11ad138e48a869522b52af6c956543d3cd0c7aee9b3ba3c2be9845719707bb33","0x134996a104ee5811d51036d776fb46831223e96c254f383d0f906343eb67ad34d6c56711962fa8bfe097e75a2e41c696","0xcc786baa966e66f4a384c86a3b49942552e2d658a31ce2c344be4b91400da7d26d521628b00523b8dfe240c72de1f6","0x1f86376e8981c217898751ad8746757d42aa7b90eeb791c09e4a3ec03251cf9de405aba9ec61deca6355c77b0e5f4cb","0x8cc03fdefe0ff135caf4fe2a21529c4195536fbe3ce50b879833fd221351adc2ee7f8dc099040a841b6daecf2e8fedb","0x16603fca40634b6a2211e11db8f0a6a074a7d0d4afadb7bd76505c3d3ad5544e203f6326c95a807299b23ab13633a5f0","0x4ab0b9bcfac1bbcb2c977d027796b3ce75bb8ca2be184cb5231413c4d634f3747a87ac2460f415ec961f8855fe9d6f2","0x987c8d5333ab86fde9926bd2ca6c674170a05bfe3bdd81ffd038da6c26c842642f64550fedfe935a15e4ca31870fb29","0x9fc4018bd96684be88c9e221e4da1bb8f3abd16679dc26c1e8b6e6a1f20cabe69d65201c78607a360370e577bdba587","0xe1bba7a1186bdb5223abde7ada14a23c42a0ca7915af6fe06985e7ed1e4d43b9b3f7055dd4eba6f2bafaaebca731c30","0x19713e47937cd1be0dfd0b8f1d43fb93cd2fcbcb6caf493fd1183e416389e61031bf3a5cce3fbafce813711ad011c132","0x18b46a908f36f6deb918c143fed2edcc523559b8aaf0c2462e6bfe7f911f643249d9cdf41b44d606ce07c8a4d0074d8e","0xb182cac101b9399d155096004f53f447aa7b12a3426b08ec02710e807b4633f06c851c1919211f20d4c04f00b971ef8","0x245a394ad1eca9b72fc00ae7be315dc757b3b080d4c158013e6632d3c40659cc6cf90ad1c232a6442d9d3f5db980133","0x5c129645e44cf1102a159f748c4a3fc5e673d81d7e86568d9ab0f5d396a7ce46ba1049b6579afb7866b1e715475224b","0x15e6be4e990f03ce4ea50b3b42df2eb5cb181d8f84965a3957add4fa95af01b2b665027efec01c7704b456be69c8b604"],["0x16112c4c3a9c98b252181140fad0eae9601a6de578980be6eec3232b5be72e7a07f3688ef60c206d01479253b03663c1","0x1962d75c2381201e1a0cbd6c43c348b885c84ff731c4d59ca4a10356f453e01f78a4260763529e3532f6102c2e49a03d","0x58df3306640da276faaae7d6e8eb15778c4855551ae7f310c35a5dd279cd2eca6757cd636f96f891e2538b53dbf67f2","0x16b7d288798e5395f20d23bf89edb4d1d115c5dbddbcd30e123da489e726af41727364f2c28297ada8d26d98445f5416","0xbe0e079545f43e4b00cc912f8228ddcc6d19c9f0f69bbb0542eda0fc9dec916a20b15dc0fd2ededda39142311a5001d","0x8d9e5297186db2d9fb266eaac783182b70152c65550d881c5ecd87b6f0f5a6449f38db9dfa9cce202c6477faaf9b7ac","0x166007c08a99db2fc3ba8734ace9824b5eecfdfa8d0cf8ef5dd365bc400a0051d5fa9c01a58b1fb93d1a1399126a775c","0x16a3ef08be3ea7ea03bcddfabba6ff6ee5a4375efa1f4fd7feb34fd206357132b920f5b00801dee460ee415a15812ed9","0x1866c8ed336c61231a1be54fd1d74cc4f9fb0ce4c6af5920abc5750c4bf39b4852cfe2f7bb9248836b233d9d55535d4a","0x167a55cda70a6e1cea820597d94a84903216f763e13d87bb5308592e7ea7d4fbc7385ea3d529b35e346ef48bb8913f55","0x4d2f259eea405bd48f010a01ad2911d9c6dd039bb61a6290e591b36e636a5c871a5c29f4f83060400f8b49cba8f6aa8","0xaccbb67481d033ff5852c1e48c50c477f94ff8aefce42d28c0f9a88cea7913516f968986f7ebbea9684b529e2561092","0xad6b9514c767fe3c3613144b45f1496543346d98adf02267d5ceef9a00d9b8693000763e3b90ac11e99b138573345cc","0x2660400eb2e4f3b628bdd0d53cd76f2bf565b94e72927c1cb748df27942480e420517bd8714cc80d1fadc1326ed06f7","0xe0fa1d816ddc03e6b24255e0d7819c171c40f65e273b853324efcd6356caa205ca2f570f13497804415473a1d634b8f","0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"]].map(t=>t.map(e=>BigInt(e)))),m8=Od(J,{A:J.create({c0:X.create(ot),c1:X.create(BigInt(240))}),B:J.create({c0:X.create(BigInt(1012)),c1:X.create(BigInt(1012))}),Z:J.create({c0:X.create(BigInt(-2)),c1:X.create(BigInt(-1))})}),v8=Od(X,{A:X.create(BigInt("0x144698a3b8e9433d693a02c96d4982b0ea985383ee66a8d8e8981aefd881ac98936f8da0e0f97f5cf428082d584c1d")),B:X.create(BigInt("0x12e2908d11688030018b12e8753eee3b2016c1f0f24f4070a0b9c14fcef35ef55a23215a316ceaa5d1cc48e98e172be0")),Z:X.create(BigInt(11))}),{G2psi:Ud,G2psi2:E8}=p8(X,J,J.div(J.ONE,J.NONRESIDUE)),Kc=Object.freeze({DST:"BLS_SIG_BLS12381G2_XMD:SHA-256_SSWU_RO_NUL_",encodeDST:"BLS_SIG_BLS12381G2_XMD:SHA-256_SSWU_RO_NUL_",p:X.ORDER,m:2,k:128,expand:"xmd",hash:ci}),Oo=Zi(X.toBytes(ot),{infinity:!0,compressed:!0});function Ao(t){t=t.slice();const e=t[0]&224,n=!!(e>>7&1),r=!!(e>>6&1),i=!!(e>>5&1);return t[0]&=31,{compressed:n,infinity:r,sort:i,value:t}}function Zi(t,e){if(t[0]&224)throw new Error("setMask: non-empty mask");return e.compressed&&(t[0]|=128),e.infinity&&(t[0]|=64),e.sort&&(t[0]|=32),t}function Fd(t){t.assertValidity();const e=t.equals(Ht.G1.ProjectivePoint.ZERO),{x:n,y:r}=t.toAffine();if(e)return Oo.slice();const i=X.ORDER,s=!!(r*Ce/i);return Zi(De(n,X.BYTES),{compressed:!0,sort:s})}function Ld(t){t.assertValidity();const e=X.BYTES;if(t.equals(Ht.G2.ProjectivePoint.ZERO))return Se(Oo,De(ot,e));const{x:n,y:r}=t.toAffine(),{re:i,im:s}=J.reim(n),{re:o,im:a}=J.reim(r),u=!!((a>ot?a*Ce:o*Ce)/X.ORDER&So),l=i;return Se(Zi(De(s,e),{sort:u,compressed:!0}),De(l,e))}const Ht=h8({fields:{Fp:X,Fp2:J,Fp6:Vc,Fp12:ie,Fr:Cd},G1:{Fp:X,h:BigInt("0x396c8c005555e1568c00aaab0000aaab"),Gx:BigInt("0x17f1d3a73197d7942695638c4fa9ac0fc3688c4f9774b905a14e3a3f171bac586c55e83ff97a1aeffb3af00adb22c6bb"),Gy:BigInt("0x08b3f481e3aaa0f1a09e30ed741d8ae4fcf5e095d5d00af600db18cb2c04b3edd03cc744a2888ae40caa232946c5e7e1"),a:X.ZERO,b:Wi,htfDefaults:{...Kc,m:1,DST:"BLS_SIG_BLS12381G1_XMD:SHA-256_SSWU_RO_NUL_"},wrapPrivateKey:!0,allowInfinityPoint:!0,isTorsionFree:(t,e)=>{const n=BigInt("0x5f19672fdf76ce51ba69c6076a0f77eaddb3a93be6f89688de17d813620a00022e01fffffffefffe"),r=new t(X.mul(e.px,n),e.py,e.pz);return e.multiplyUnsafe(Yn).negate().multiplyUnsafe(Yn).equals(r)},clearCofactor:(t,e)=>e.multiplyUnsafe(Yn).add(e),mapToCurve:t=>{const{x:e,y:n}=v8(X.create(t[0]));return w8(e,n)},fromBytes:t=>{const{compressed:e,infinity:n,sort:r,value:i}=Ao(t);if(i.length===48&&e){const s=X.ORDER,o=rt(i),a=X.create(o&X.MASK);if(n){if(a!==ot)throw new Error("G1: non-empty compressed point at infinity");return{x:ot,y:ot}}const c=X.add(X.pow(a,Io),X.create(Ht.params.G1b));let u=X.sqrt(c);if(!u)throw new Error("invalid compressed G1 point");return u*Ce/s!==BigInt(r)&&(u=X.neg(u)),{x:X.create(a),y:X.create(u)}}else if(i.length===96&&!e){const s=rt(i.subarray(0,X.BYTES)),o=rt(i.subarray(X.BYTES));if(n){if(s!==ot||o!==ot)throw new Error("G1: non-empty point at infinity");return Ht.G1.ProjectivePoint.ZERO.toAffine()}return{x:X.create(s),y:X.create(o)}}else throw new Error("invalid point G1, expected 48/96 bytes")},toBytes:(t,e,n)=>{const r=e.equals(t.ZERO),{x:i,y:s}=e.toAffine();if(n){if(r)return Oo.slice();const o=X.ORDER,a=!!(s*Ce/o);return Zi(De(i,X.BYTES),{compressed:!0,sort:a})}else return r?Se(new Uint8Array([64]),new Uint8Array(2*X.BYTES-1)):Se(De(i,X.BYTES),De(s,X.BYTES))},ShortSignature:{fromHex(t){const{infinity:e,sort:n,value:r}=Ao(Ge("signatureHex",t,48)),i=X.ORDER,s=rt(r);if(e)return Ht.G1.ProjectivePoint.ZERO;const o=X.create(s&X.MASK),a=X.add(X.pow(o,Io),X.create(Ht.params.G1b));let c=X.sqrt(a);if(!c)throw new Error("invalid compressed G1 point");const u=BigInt(n);c*Ce/i!==u&&(c=X.neg(c));const l=Ht.G1.ProjectivePoint.fromAffine({x:o,y:c});return l.assertValidity(),l},toRawBytes(t){return Fd(t)},toHex(t){return Br(Fd(t))}}},G2:{Fp:J,h:BigInt("0x5d543a95414e7f1091d50792876a202cd91de4547085abaa68a205b2e5a7ddfa628f1cb4d9e82ef21537e293a6691ae1616ec6e786f0c70cf1c38e31c7238e5"),Gx:J.fromBigTuple([BigInt("0x024aa2b2f08f0a91260805272dc51051c6e47ad4fa403b02b4510b647ae3d1770bac0326a805bbefd48056c8c121bdb8"),BigInt("0x13e02b6052719f607dacd3a088274f65596bd0d09920b61ab5da61bbdc7f5049334cf11213945d57e5ac7d055d042b7e")]),Gy:J.fromBigTuple([BigInt("0x0ce5d527727d6e118cc9cdc6da2e351aadfd9baa8cbdd3a76d429a695160d12c923ac9cc3baca289e193548608b82801"),BigInt("0x0606c4a02ea734cc32acd2b02bc28b99cb3e287e85a763af267492ab572e99ab3f370d275cec1da1aaa9075ff05f79be")]),a:J.ZERO,b:J.fromBigTuple([Wi,Wi]),hEff:BigInt("0xbc69f08f2ee75b3584c6a0ea91b352888e2a8e9145ad7689986ff031508ffe1329c2f178731db956d82bf015d1212b02ec0ec69d7477c1ae954cbc06689f6a359894c0adebbf6b4e8020005aaa95551"),htfDefaults:{...Kc},wrapPrivateKey:!0,allowInfinityPoint:!0,mapToCurve:t=>{const{x:e,y:n}=m8(J.fromBigTuple(t));return b8(e,n)},isTorsionFree:(t,e)=>e.multiplyUnsafe(Yn).negate().equals(Ud(t,e)),clearCofactor:(t,e)=>{const n=Yn;let r=e.multiplyUnsafe(n).negate(),i=Ud(t,e),s=e.double();return s=E8(t,s),s=s.subtract(i),i=r.add(i),i=i.multiplyUnsafe(n).negate(),s=s.add(i),s=s.subtract(r),s.subtract(e)},fromBytes:t=>{const{compressed:e,infinity:n,sort:r,value:i}=Ao(t);if(!e&&!n&&r||!e&&n&&r||r&&n&&e)throw new Error("invalid encoding flag: "+(t[0]&224));const s=X.BYTES,o=(a,c,u)=>rt(a.slice(c,u));if(i.length===96&&e){const a=Ht.params.G2b,c=X.ORDER;if(n){if(i.reduce((b,v)=>b!==0?v+1:v,0)>0)throw new Error("invalid compressed G2 point");return{x:J.ZERO,y:J.ZERO}}const u=o(i,0,s),l=o(i,s,2*s),h=J.create({c0:X.create(l),c1:X.create(u)}),d=J.add(J.pow(h,Io),a);let f=J.sqrt(d);const p=f.c1===ot?f.c0*Ce/c:f.c1*Ce/c?So:ot;return f=r&&p>0?f:J.neg(f),{x:h,y:f}}else if(i.length===192&&!e){if(n){if(i.reduce((h,d)=>h!==0?d+1:d,0)>0)throw new Error("invalid uncompressed G2 point");return{x:J.ZERO,y:J.ZERO}}const a=o(i,0,s),c=o(i,s,2*s),u=o(i,2*s,3*s),l=o(i,3*s,4*s);return{x:J.fromBigTuple([c,a]),y:J.fromBigTuple([l,u])}}else throw new Error("invalid point G2, expected 96/192 bytes")},toBytes:(t,e,n)=>{const{BYTES:r,ORDER:i}=X,s=e.equals(t.ZERO),{x:o,y:a}=e.toAffine();if(n){if(s)return Se(Oo,De(ot,r));const c=!!(a.c1===ot?a.c0*Ce/i:a.c1*Ce/i);return Se(Zi(De(o.c1,r),{compressed:!0,sort:c}),De(o.c0,r))}else{if(s)return Se(new Uint8Array([64]),new Uint8Array(4*r-1));const{re:c,im:u}=J.reim(o),{re:l,im:h}=J.reim(a);return Se(De(u,r),De(c,r),De(h,r),De(l,r))}},Signature:{fromHex(t){const{infinity:e,sort:n,value:r}=Ao(Ge("signatureHex",t)),i=X.ORDER,s=r.length/2;if(s!==48&&s!==96)throw new Error("invalid compressed signature length, must be 96 or 192");const o=rt(r.slice(0,s)),a=rt(r.slice(s));if(e)return Ht.G2.ProjectivePoint.ZERO;const c=X.create(o&X.MASK),u=X.create(a),l=J.create({c0:u,c1:c}),h=J.add(J.pow(l,Io),Ht.params.G2b);let d=J.sqrt(h);if(!d)throw new Error("Failed to find a square root");const{re:f,im:p}=J.reim(d),b=BigInt(n),v=p>ot&&p*Ce/i!==b,A=p===ot&&f*Ce/i!==b;(v||A)&&(d=J.neg(d));const D=Ht.G2.ProjectivePoint.fromAffine({x:l,y:d});return D.assertValidity(),D},toRawBytes(t){return Ld(t)},toHex(t){return Br(Ld(t))}}},params:{ateLoopSize:Yn,r:Cd.ORDER,xNegative:!0,twistType:"multiplicative"},htfDefaults:Kc,hash:ci,randomBytes:uo});BigInt(0),BigInt(1),BigInt(2),BigInt(8),BigInt(0),BigInt(1),BigInt(2),BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),BigInt(0),BigInt(1),BigInt(2),BigInt(3),BigInt(5),BigInt(8);const Gc=BigInt(0),Wc=BigInt(1);function Bo(t,e=""){if(typeof t!="boolean"){const n=e&&`"${e}"`;throw new Error(n+"expected boolean, got type="+typeof t)}return t}function Pr(t,e,n=""){const r=so(t),i=t?.length,s=e!==void 0;if(!r||s&&i!==e){const o=n&&`"${n}" `,a=s?` of length ${e}`:"",c=r?`length=${i}`:`type=${typeof t}`;throw new Error(o+"expected Uint8Array"+a+", got "+c)}return t}function Do(t){const e=t.toString(16);return e.length&1?"0"+e:e}function kd(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Gc:BigInt("0x"+t)}function $o(t){return kd(si(t))}function qd(t){return gn(t),kd(si(Uint8Array.from(t).reverse()))}function Zc(t,e){return oo(t.toString(16).padStart(e*2,"0"))}function Md(t,e){return Zc(t,e).reverse()}function yt(t,e,n){let r;if(typeof e=="string")try{r=oo(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(so(e))r=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=r.length;if(typeof n=="number"&&i!==n)throw new Error(t+" of length "+n+" expected, got "+i);return r}const Yc=t=>typeof t=="bigint"&&Gc<=t;function x8(t,e,n){return Yc(t)&&Yc(e)&&Yc(n)&&e<=t&&t<n}function _8(t,e,n,r){if(!x8(e,n,r))throw new Error("expected valid "+t+": "+n+" <= n < "+r+", got "+e)}function jd(t){let e;for(e=0;t>Gc;t>>=Wc,e+=1);return e}const Yi=t=>(Wc<<BigInt(t))-Wc;function S8(t,e,n){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");const r=f=>new Uint8Array(f),i=f=>Uint8Array.of(f);let s=r(t),o=r(t),a=0;const c=()=>{s.fill(1),o.fill(0),a=0},u=(...f)=>n(o,s,...f),l=(f=r(0))=>{o=u(i(0),f),s=u(),f.length!==0&&(o=u(i(1),f),s=u())},h=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let f=0;const p=[];for(;f<e;){s=u();const b=s.slice();p.push(b),f+=s.length}return bn(...p)};return(f,p)=>{c(),l(f);let b;for(;!(b=p(h()));)l();return c(),b}}function Xc(t,e,n={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function r(i,s,o){const a=t[i];if(o&&a===void 0)return;const c=typeof a;if(c!==s||a===null)throw new Error(`param "${i}" is invalid: expected ${s}, got ${c}`)}Object.entries(e).forEach(([i,s])=>r(i,s,!1)),Object.entries(n).forEach(([i,s])=>r(i,s,!0))}function zd(t){const e=new WeakMap;return(n,...r)=>{const i=e.get(n);if(i!==void 0)return i;const s=t(n,...r);return e.set(n,s),s}}const bt=BigInt(0),at=BigInt(1),Rr=BigInt(2),Vd=BigInt(3),Hd=BigInt(4),Kd=BigInt(5),I8=BigInt(7),Gd=BigInt(8),O8=BigInt(9),Wd=BigInt(16);function Kt(t,e){const n=t%e;return n>=bt?n:e+n}function Rt(t,e,n){let r=t;for(;e-- >bt;)r*=r,r%=n;return r}function Zd(t,e){if(t===bt)throw new Error("invert: expected non-zero number");if(e<=bt)throw new Error("invert: expected positive modulus, got "+e);let n=Kt(t,e),r=e,i=bt,s=at;for(;n!==bt;){const a=r/n,c=r%n,u=i-s*a;r=n,n=c,i=s,s=u}if(r!==at)throw new Error("invert: does not exist");return Kt(i,e)}function Jc(t,e,n){if(!t.eql(t.sqr(e),n))throw new Error("Cannot find square root")}function Yd(t,e){const n=(t.ORDER+at)/Hd,r=t.pow(e,n);return Jc(t,r,e),r}function A8(t,e){const n=(t.ORDER-Kd)/Gd,r=t.mul(e,Rr),i=t.pow(r,n),s=t.mul(e,i),o=t.mul(t.mul(s,Rr),i),a=t.mul(s,t.sub(o,t.ONE));return Jc(t,a,e),a}function B8(t){const e=Xi(t),n=Xd(t),r=n(e,e.neg(e.ONE)),i=n(e,r),s=n(e,e.neg(r)),o=(t+I8)/Wd;return(a,c)=>{let u=a.pow(c,o),l=a.mul(u,r);const h=a.mul(u,i),d=a.mul(u,s),f=a.eql(a.sqr(l),c),p=a.eql(a.sqr(h),c);u=a.cmov(u,l,f),l=a.cmov(d,h,p);const b=a.eql(a.sqr(l),c),v=a.cmov(u,l,b);return Jc(a,v,c),v}}function Xd(t){if(t<Vd)throw new Error("sqrt is not defined for small field");let e=t-at,n=0;for(;e%Rr===bt;)e/=Rr,n++;let r=Rr;const i=Xi(t);for(;Qd(i,r)===1;)if(r++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(n===1)return Yd;let s=i.pow(r,e);const o=(e+at)/Rr;return function(c,u){if(c.is0(u))return u;if(Qd(c,u)!==1)throw new Error("Cannot find square root");let l=n,h=c.mul(c.ONE,s),d=c.pow(u,e),f=c.pow(u,o);for(;!c.eql(d,c.ONE);){if(c.is0(d))return c.ZERO;let p=1,b=c.sqr(d);for(;!c.eql(b,c.ONE);)if(p++,b=c.sqr(b),p===l)throw new Error("Cannot find square root");const v=at<<BigInt(l-p-1),A=c.pow(h,v);l=p,h=c.sqr(A),d=c.mul(d,h),f=c.mul(f,A)}return f}}function D8(t){return t%Hd===Vd?Yd:t%Gd===Kd?A8:t%Wd===O8?B8(t):Xd(t)}const $8=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function T8(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},n=$8.reduce((r,i)=>(r[i]="function",r),e);return Xc(t,n),t}function P8(t,e,n){if(n<bt)throw new Error("invalid exponent, negatives unsupported");if(n===bt)return t.ONE;if(n===at)return e;let r=t.ONE,i=e;for(;n>bt;)n&at&&(r=t.mul(r,i)),i=t.sqr(i),n>>=at;return r}function Jd(t,e,n=!1){const r=new Array(e.length).fill(n?t.ZERO:void 0),i=e.reduce((o,a,c)=>t.is0(a)?o:(r[c]=o,t.mul(o,a)),t.ONE),s=t.inv(i);return e.reduceRight((o,a,c)=>t.is0(a)?o:(r[c]=t.mul(o,r[c]),t.mul(o,a)),s),r}function Qd(t,e){const n=(t.ORDER-at)/Rr,r=t.pow(e,n),i=t.eql(r,t.ONE),s=t.eql(r,t.ZERO),o=t.eql(r,t.neg(t.ONE));if(!i&&!s&&!o)throw new Error("invalid Legendre symbol result");return i?1:s?0:-1}function ep(t,e){e!==void 0&&ri(e);const n=e!==void 0?e:t.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function Xi(t,e,n=!1,r={}){if(t<=bt)throw new Error("invalid field: expected ORDER > 0, got "+t);let i,s,o=!1,a;if(typeof e=="object"&&e!=null){if(r.sqrt||n)throw new Error("cannot specify opts in two arguments");const d=e;d.BITS&&(i=d.BITS),d.sqrt&&(s=d.sqrt),typeof d.isLE=="boolean"&&(n=d.isLE),typeof d.modFromBytes=="boolean"&&(o=d.modFromBytes),a=d.allowedLengths}else typeof e=="number"&&(i=e),r.sqrt&&(s=r.sqrt);const{nBitLength:c,nByteLength:u}=ep(t,i);if(u>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let l;const h=Object.freeze({ORDER:t,isLE:n,BITS:c,BYTES:u,MASK:Yi(c),ZERO:bt,ONE:at,allowedLengths:a,create:d=>Kt(d,t),isValid:d=>{if(typeof d!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof d);return bt<=d&&d<t},is0:d=>d===bt,isValidNot0:d=>!h.is0(d)&&h.isValid(d),isOdd:d=>(d&at)===at,neg:d=>Kt(-d,t),eql:(d,f)=>d===f,sqr:d=>Kt(d*d,t),add:(d,f)=>Kt(d+f,t),sub:(d,f)=>Kt(d-f,t),mul:(d,f)=>Kt(d*f,t),pow:(d,f)=>P8(h,d,f),div:(d,f)=>Kt(d*Zd(f,t),t),sqrN:d=>d*d,addN:(d,f)=>d+f,subN:(d,f)=>d-f,mulN:(d,f)=>d*f,inv:d=>Zd(d,t),sqrt:s||(d=>(l||(l=D8(t)),l(h,d))),toBytes:d=>n?Md(d,u):Zc(d,u),fromBytes:(d,f=!0)=>{if(a){if(!a.includes(d.length)||d.length>u)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+d.length);const b=new Uint8Array(u);b.set(d,n?0:b.length-d.length),d=b}if(d.length!==u)throw new Error("Field.fromBytes: expected "+u+" bytes, got "+d.length);let p=n?qd(d):$o(d);if(o&&(p=Kt(p,t)),!f&&!h.isValid(p))throw new Error("invalid field element: outside of range 0..ORDER");return p},invertBatch:d=>Jd(h,d),cmov:(d,f,p)=>p?f:d});return Object.freeze(h)}function tp(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function np(t){const e=tp(t);return e+Math.ceil(e/2)}function R8(t,e,n=!1){const r=t.length,i=tp(e),s=np(e);if(r<16||r<s||r>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+r);const o=n?qd(t):$o(t),a=Kt(o,e-at)+at;return n?Md(a,i):Zc(a,i)}const hi=BigInt(0),Nr=BigInt(1);function To(t,e){const n=e.negate();return t?n:e}function Qc(t,e){const n=Jd(t.Fp,e.map(r=>r.Z));return e.map((r,i)=>t.fromAffine(r.toAffine(n[i])))}function rp(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function eu(t,e){rp(t,e);const n=Math.ceil(e/t)+1,r=2**(t-1),i=2**t,s=Yi(t),o=BigInt(t);return{windows:n,windowSize:r,mask:s,maxNumber:i,shiftBy:o}}function ip(t,e,n){const{windowSize:r,mask:i,maxNumber:s,shiftBy:o}=n;let a=Number(t&i),c=t>>o;a>r&&(a-=s,c+=Nr);const u=e*r,l=u+Math.abs(a)-1,h=a===0,d=a<0,f=e%2!==0;return{nextN:c,offset:l,isZero:h,isNeg:d,isNegF:f,offsetF:u}}function N8(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((n,r)=>{if(!(n instanceof e))throw new Error("invalid point at index "+r)})}function C8(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((n,r)=>{if(!e.isValid(n))throw new Error("invalid scalar at index "+r)})}const tu=new WeakMap,sp=new WeakMap;function nu(t){return sp.get(t)||1}function op(t){if(t!==hi)throw new Error("invalid wNAF")}class U8{constructor(e,n){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=n}_unsafeLadder(e,n,r=this.ZERO){let i=e;for(;n>hi;)n&Nr&&(r=r.add(i)),i=i.double(),n>>=Nr;return r}precomputeWindow(e,n){const{windows:r,windowSize:i}=eu(n,this.bits),s=[];let o=e,a=o;for(let c=0;c<r;c++){a=o,s.push(a);for(let u=1;u<i;u++)a=a.add(o),s.push(a);o=a.double()}return s}wNAF(e,n,r){if(!this.Fn.isValid(r))throw new Error("invalid scalar");let i=this.ZERO,s=this.BASE;const o=eu(e,this.bits);for(let a=0;a<o.windows;a++){const{nextN:c,offset:u,isZero:l,isNeg:h,isNegF:d,offsetF:f}=ip(r,a,o);r=c,l?s=s.add(To(d,n[f])):i=i.add(To(h,n[u]))}return op(r),{p:i,f:s}}wNAFUnsafe(e,n,r,i=this.ZERO){const s=eu(e,this.bits);for(let o=0;o<s.windows&&r!==hi;o++){const{nextN:a,offset:c,isZero:u,isNeg:l}=ip(r,o,s);if(r=a,!u){const h=n[c];i=i.add(l?h.negate():h)}}return op(r),i}getPrecomputes(e,n,r){let i=tu.get(n);return i||(i=this.precomputeWindow(n,e),e!==1&&(typeof r=="function"&&(i=r(i)),tu.set(n,i))),i}cached(e,n,r){const i=nu(e);return this.wNAF(i,this.getPrecomputes(i,e,r),n)}unsafe(e,n,r,i){const s=nu(e);return s===1?this._unsafeLadder(e,n,i):this.wNAFUnsafe(s,this.getPrecomputes(s,e,r),n,i)}createCache(e,n){rp(n,this.bits),sp.set(e,n),tu.delete(e)}hasCache(e){return nu(e)!==1}}function F8(t,e,n,r){let i=e,s=t.ZERO,o=t.ZERO;for(;n>hi||r>hi;)n&Nr&&(s=s.add(i)),r&Nr&&(o=o.add(i)),i=i.double(),n>>=Nr,r>>=Nr;return{p1:s,p2:o}}function L8(t,e,n,r){N8(n,t),C8(r,e);const i=n.length,s=r.length;if(i!==s)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=jd(BigInt(i));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const u=Yi(c),l=new Array(Number(u)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c;let d=o;for(let f=h;f>=0;f-=c){l.fill(o);for(let b=0;b<s;b++){const v=r[b],A=Number(v>>BigInt(f)&u);l[A]=l[A].add(n[b])}let p=o;for(let b=l.length-1,v=o;b>0;b--)v=v.add(l[b]),p=p.add(v);if(d=d.add(p),f!==0)for(let b=0;b<c;b++)d=d.double()}return d}function ap(t,e,n){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return T8(e),e}else return Xi(t,{isLE:n})}function k8(t,e,n={},r){if(r===void 0&&(r=t==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(const c of["p","n","h"]){const u=e[c];if(!(typeof u=="bigint"&&u>hi))throw new Error(`CURVE.${c} must be positive bigint`)}const i=ap(e.p,n.Fp,r),s=ap(e.n,n.Fn,r),a=["Gx","Gy","a",t==="weierstrass"?"b":"d"];for(const c of a)if(!i.isValid(e[c]))throw new Error(`CURVE.${c} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:i,Fn:s}}const cp=(t,e)=>(t+(t>=0?e:-e)/up)/e;function q8(t,e,n){const[[r,i],[s,o]]=e,a=cp(o*t,n),c=cp(-i*t,n);let u=t-a*r-c*s,l=-a*i-c*o;const h=u<An,d=l<An;h&&(u=-u),d&&(l=-l);const f=Yi(Math.ceil(jd(n)/2))+di;if(u<An||u>=f||l<An||l>=f)throw new Error("splitScalar (endomorphism): failed, k="+t);return{k1neg:h,k1:u,k2neg:d,k2:l}}function ru(t){if(!["compact","recovered","der"].includes(t))throw new Error('Signature format must be "compact", "recovered", or "der"');return t}function iu(t,e){const n={};for(let r of Object.keys(e))n[r]=t[r]===void 0?e[r]:t[r];return Bo(n.lowS,"lowS"),Bo(n.prehash,"prehash"),n.format!==void 0&&ru(n.format),n}class M8 extends Error{constructor(e=""){super(e)}}const On={Err:M8,_tlv:{encode:(t,e)=>{const{Err:n}=On;if(t<0||t>256)throw new n("tlv.encode: wrong tag");if(e.length&1)throw new n("tlv.encode: unpadded data");const r=e.length/2,i=Do(r);if(i.length/2&128)throw new n("tlv.encode: long form length too big");const s=r>127?Do(i.length/2|128):"";return Do(t)+s+i+e},decode(t,e){const{Err:n}=On;let r=0;if(t<0||t>256)throw new n("tlv.encode: wrong tag");if(e.length<2||e[r++]!==t)throw new n("tlv.decode: wrong tlv");const i=e[r++],s=!!(i&128);let o=0;if(!s)o=i;else{const c=i&127;if(!c)throw new n("tlv.decode(long): indefinite length not supported");if(c>4)throw new n("tlv.decode(long): byte length is too big");const u=e.subarray(r,r+c);if(u.length!==c)throw new n("tlv.decode: length bytes not complete");if(u[0]===0)throw new n("tlv.decode(long): zero leftmost byte");for(const l of u)o=o<<8|l;if(r+=c,o<128)throw new n("tlv.decode(long): not minimal encoding")}const a=e.subarray(r,r+o);if(a.length!==o)throw new n("tlv.decode: wrong value length");return{v:a,l:e.subarray(r+o)}}},_int:{encode(t){const{Err:e}=On;if(t<An)throw new e("integer: negative integers are not allowed");let n=Do(t);if(Number.parseInt(n[0],16)&8&&(n="00"+n),n.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return n},decode(t){const{Err:e}=On;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return $o(t)}},toSig(t){const{Err:e,_int:n,_tlv:r}=On,i=yt("signature",t),{v:s,l:o}=r.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=r.decode(2,s),{v:u,l}=r.decode(2,c);if(l.length)throw new e("invalid signature: left bytes after parsing");return{r:n.decode(a),s:n.decode(u)}},hexFromSig(t){const{_tlv:e,_int:n}=On,r=e.encode(2,n.encode(t.r)),i=e.encode(2,n.encode(t.s)),s=r+i;return e.encode(48,s)}},An=BigInt(0),di=BigInt(1),up=BigInt(2),Po=BigInt(3),j8=BigInt(4);function pi(t,e){const{BYTES:n}=t;let r;if(typeof e=="bigint")r=e;else{let i=yt("private key",e);try{r=t.fromBytes(i)}catch{throw new Error(`invalid private key: expected ui8a of size ${n}, got ${typeof e}`)}}if(!t.isValidNot0(r))throw new Error("invalid private key: out of range [1..N-1]");return r}function z8(t,e={}){const n=k8("weierstrass",t,e),{Fp:r,Fn:i}=n;let s=n.CURVE;const{h:o,n:a}=s;Xc(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:c}=e;if(c&&(!r.is0(s.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const u=fp(r,i);function l(){if(!r.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function h(E,y,m){const{x:g,y:w}=y.toAffine(),S=r.toBytes(g);if(Bo(m,"isCompressed"),m){l();const O=!r.isOdd(w);return bn(lp(O),S)}else return bn(Uint8Array.of(4),S,r.toBytes(w))}function d(E){Pr(E,void 0,"Point");const{publicKey:y,publicKeyUncompressed:m}=u,g=E.length,w=E[0],S=E.subarray(1);if(g===y&&(w===2||w===3)){const O=r.fromBytes(S);if(!r.isValid(O))throw new Error("bad point: is not on curve, wrong x");const I=b(O);let B;try{B=r.sqrt(I)}catch(C){const k=C instanceof Error?": "+C.message:"";throw new Error("bad point: is not on curve, sqrt error"+k)}l();const P=r.isOdd(B);return(w&1)===1!==P&&(B=r.neg(B)),{x:O,y:B}}else if(g===m&&w===4){const O=r.BYTES,I=r.fromBytes(S.subarray(0,O)),B=r.fromBytes(S.subarray(O,O*2));if(!v(I,B))throw new Error("bad point: is not on curve");return{x:I,y:B}}else throw new Error(`bad point: got length ${g}, expected compressed=${y} or uncompressed=${m}`)}const f=e.toBytes||h,p=e.fromBytes||d;function b(E){const y=r.sqr(E),m=r.mul(y,E);return r.add(r.add(m,r.mul(E,s.a)),s.b)}function v(E,y){const m=r.sqr(y),g=b(E);return r.eql(m,g)}if(!v(s.Gx,s.Gy))throw new Error("bad curve params: generator point");const A=r.mul(r.pow(s.a,Po),j8),D=r.mul(r.sqr(s.b),BigInt(27));if(r.is0(r.add(A,D)))throw new Error("bad curve params: a or b");function _(E,y,m=!1){if(!r.isValid(y)||m&&r.is0(y))throw new Error(`bad point coordinate ${E}`);return y}function x(E){if(!(E instanceof $))throw new Error("ProjectivePoint expected")}function T(E){if(!c||!c.basises)throw new Error("no endo");return q8(E,c.basises,i.ORDER)}const R=zd((E,y)=>{const{X:m,Y:g,Z:w}=E;if(r.eql(w,r.ONE))return{x:m,y:g};const S=E.is0();y==null&&(y=S?r.ONE:r.inv(w));const O=r.mul(m,y),I=r.mul(g,y),B=r.mul(w,y);if(S)return{x:r.ZERO,y:r.ZERO};if(!r.eql(B,r.ONE))throw new Error("invZ was invalid");return{x:O,y:I}}),F=zd(E=>{if(E.is0()){if(e.allowInfinityPoint&&!r.is0(E.Y))return;throw new Error("bad point: ZERO")}const{x:y,y:m}=E.toAffine();if(!r.isValid(y)||!r.isValid(m))throw new Error("bad point: x or y not field elements");if(!v(y,m))throw new Error("bad point: equation left != right");if(!E.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function U(E,y,m,g,w){return m=new $(r.mul(m.X,E),m.Y,m.Z),y=To(g,y),m=To(w,m),y.add(m)}class ${constructor(y,m,g){this.X=_("x",y),this.Y=_("y",m,!0),this.Z=_("z",g),Object.freeze(this)}static CURVE(){return s}static fromAffine(y){const{x:m,y:g}=y||{};if(!y||!r.isValid(m)||!r.isValid(g))throw new Error("invalid affine point");if(y instanceof $)throw new Error("projective point not allowed");return r.is0(m)&&r.is0(g)?$.ZERO:new $(m,g,r.ONE)}static fromBytes(y){const m=$.fromAffine(p(Pr(y,void 0,"point")));return m.assertValidity(),m}static fromHex(y){return $.fromBytes(yt("pointHex",y))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(y=8,m=!0){return M.createCache(this,y),m||this.multiply(Po),this}assertValidity(){F(this)}hasEvenY(){const{y}=this.toAffine();if(!r.isOdd)throw new Error("Field doesn't support isOdd");return!r.isOdd(y)}equals(y){x(y);const{X:m,Y:g,Z:w}=this,{X:S,Y:O,Z:I}=y,B=r.eql(r.mul(m,I),r.mul(S,w)),P=r.eql(r.mul(g,I),r.mul(O,w));return B&&P}negate(){return new $(this.X,r.neg(this.Y),this.Z)}double(){const{a:y,b:m}=s,g=r.mul(m,Po),{X:w,Y:S,Z:O}=this;let I=r.ZERO,B=r.ZERO,P=r.ZERO,L=r.mul(w,w),C=r.mul(S,S),k=r.mul(O,O),N=r.mul(w,S);return N=r.add(N,N),P=r.mul(w,O),P=r.add(P,P),I=r.mul(y,P),B=r.mul(g,k),B=r.add(I,B),I=r.sub(C,B),B=r.add(C,B),B=r.mul(I,B),I=r.mul(N,I),P=r.mul(g,P),k=r.mul(y,k),N=r.sub(L,k),N=r.mul(y,N),N=r.add(N,P),P=r.add(L,L),L=r.add(P,L),L=r.add(L,k),L=r.mul(L,N),B=r.add(B,L),k=r.mul(S,O),k=r.add(k,k),L=r.mul(k,N),I=r.sub(I,L),P=r.mul(k,C),P=r.add(P,P),P=r.add(P,P),new $(I,B,P)}add(y){x(y);const{X:m,Y:g,Z:w}=this,{X:S,Y:O,Z:I}=y;let B=r.ZERO,P=r.ZERO,L=r.ZERO;const C=s.a,k=r.mul(s.b,Po);let N=r.mul(m,S),q=r.mul(g,O),j=r.mul(w,I),W=r.add(m,g),H=r.add(S,O);W=r.mul(W,H),H=r.add(N,q),W=r.sub(W,H),H=r.add(m,w);let Z=r.add(S,I);return H=r.mul(H,Z),Z=r.add(N,j),H=r.sub(H,Z),Z=r.add(g,w),B=r.add(O,I),Z=r.mul(Z,B),B=r.add(q,j),Z=r.sub(Z,B),L=r.mul(C,H),B=r.mul(k,j),L=r.add(B,L),B=r.sub(q,L),L=r.add(q,L),P=r.mul(B,L),q=r.add(N,N),q=r.add(q,N),j=r.mul(C,j),H=r.mul(k,H),q=r.add(q,j),j=r.sub(N,j),j=r.mul(C,j),H=r.add(H,j),N=r.mul(q,H),P=r.add(P,N),N=r.mul(Z,H),B=r.mul(W,B),B=r.sub(B,N),N=r.mul(W,q),L=r.mul(Z,L),L=r.add(L,N),new $(B,P,L)}subtract(y){return this.add(y.negate())}is0(){return this.equals($.ZERO)}multiply(y){const{endo:m}=e;if(!i.isValidNot0(y))throw new Error("invalid scalar: out of range");let g,w;const S=O=>M.cached(this,O,I=>Qc($,I));if(m){const{k1neg:O,k1:I,k2neg:B,k2:P}=T(y),{p:L,f:C}=S(I),{p:k,f:N}=S(P);w=C.add(N),g=U(m.beta,L,k,O,B)}else{const{p:O,f:I}=S(y);g=O,w=I}return Qc($,[g,w])[0]}multiplyUnsafe(y){const{endo:m}=e,g=this;if(!i.isValid(y))throw new Error("invalid scalar: out of range");if(y===An||g.is0())return $.ZERO;if(y===di)return g;if(M.hasCache(this))return this.multiply(y);if(m){const{k1neg:w,k1:S,k2neg:O,k2:I}=T(y),{p1:B,p2:P}=F8($,g,S,I);return U(m.beta,B,P,w,O)}else return M.unsafe(g,y)}multiplyAndAddUnsafe(y,m,g){const w=this.multiplyUnsafe(m).add(y.multiplyUnsafe(g));return w.is0()?void 0:w}toAffine(y){return R(this,y)}isTorsionFree(){const{isTorsionFree:y}=e;return o===di?!0:y?y($,this):M.unsafe(this,a).is0()}clearCofactor(){const{clearCofactor:y}=e;return o===di?this:y?y($,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes(y=!0){return Bo(y,"isCompressed"),this.assertValidity(),f($,this,y)}toHex(y=!0){return si(this.toBytes(y))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(y=!0){return this.toBytes(y)}_setWindowSize(y){this.precompute(y)}static normalizeZ(y){return Qc($,y)}static msm(y,m){return L8($,i,y,m)}static fromPrivateKey(y){return $.BASE.multiply(pi(i,y))}}$.BASE=new $(s.Gx,s.Gy,r.ONE),$.ZERO=new $(r.ZERO,r.ONE,r.ZERO),$.Fp=r,$.Fn=i;const z=i.BITS,M=new U8($,e.endo?Math.ceil(z/2):z);return $.BASE.precompute(8),$}function lp(t){return Uint8Array.of(t?2:3)}function fp(t,e){return{secretKey:e.BYTES,publicKey:1+t.BYTES,publicKeyUncompressed:1+2*t.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function V8(t,e={}){const{Fn:n}=t,r=e.randomBytes||uo,i=Object.assign(fp(t.Fp,n),{seed:np(n.ORDER)});function s(f){try{return!!pi(n,f)}catch{return!1}}function o(f,p){const{publicKey:b,publicKeyUncompressed:v}=i;try{const A=f.length;return p===!0&&A!==b||p===!1&&A!==v?!1:!!t.fromBytes(f)}catch{return!1}}function a(f=r(i.seed)){return R8(Pr(f,i.seed,"seed"),n.ORDER)}function c(f,p=!0){return t.BASE.multiply(pi(n,f)).toBytes(p)}function u(f){const p=a(f);return{secretKey:p,publicKey:c(p)}}function l(f){if(typeof f=="bigint")return!1;if(f instanceof t)return!0;const{secretKey:p,publicKey:b,publicKeyUncompressed:v}=i;if(n.allowedLengths||p===b)return;const A=yt("key",f).length;return A===b||A===v}function h(f,p,b=!0){if(l(f)===!0)throw new Error("first arg must be private key");if(l(p)===!1)throw new Error("second arg must be public key");const v=pi(n,f);return t.fromHex(p).multiply(v).toBytes(b)}return Object.freeze({getPublicKey:c,getSharedSecret:h,keygen:u,Point:t,utils:{isValidSecretKey:s,isValidPublicKey:o,randomSecretKey:a,isValidPrivateKey:s,randomPrivateKey:a,normPrivateKeyToScalar:f=>pi(n,f),precompute(f=8,p=t.BASE){return p.precompute(f,!1)}},lengths:i})}function H8(t,e,n={}){Bh(e),Xc(n,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const r=n.randomBytes||uo,i=n.hmac||((m,...g)=>$c(e,m,bn(...g))),{Fp:s,Fn:o}=t,{ORDER:a,BITS:c}=o,{keygen:u,getPublicKey:l,getSharedSecret:h,utils:d,lengths:f}=V8(t,n),p={prehash:!1,lowS:typeof n.lowS=="boolean"?n.lowS:!1,format:void 0,extraEntropy:!1},b="compact";function v(m){const g=a>>di;return m>g}function A(m,g){if(!o.isValidNot0(g))throw new Error(`invalid signature ${m}: out of range 1..Point.Fn.ORDER`);return g}function D(m,g){ru(g);const w=f.signature,S=g==="compact"?w:g==="recovered"?w+1:void 0;return Pr(m,S,`${g} signature`)}class _{constructor(g,w,S){this.r=A("r",g),this.s=A("s",w),S!=null&&(this.recovery=S),Object.freeze(this)}static fromBytes(g,w=b){D(g,w);let S;if(w==="der"){const{r:P,s:L}=On.toSig(Pr(g));return new _(P,L)}w==="recovered"&&(S=g[0],w="compact",g=g.subarray(1));const O=o.BYTES,I=g.subarray(0,O),B=g.subarray(O,O*2);return new _(o.fromBytes(I),o.fromBytes(B),S)}static fromHex(g,w){return this.fromBytes(oo(g),w)}addRecoveryBit(g){return new _(this.r,this.s,g)}recoverPublicKey(g){const w=s.ORDER,{r:S,s:O,recovery:I}=this;if(I==null||![0,1,2,3].includes(I))throw new Error("recovery id invalid");if(a*up<w&&I>1)throw new Error("recovery id is ambiguous for h>1 curve");const P=I===2||I===3?S+a:S;if(!s.isValid(P))throw new Error("recovery id 2 or 3 invalid");const L=s.toBytes(P),C=t.fromBytes(bn(lp((I&1)===0),L)),k=o.inv(P),N=T(yt("msgHash",g)),q=o.create(-N*k),j=o.create(O*k),W=t.BASE.multiplyUnsafe(q).add(C.multiplyUnsafe(j));if(W.is0())throw new Error("point at infinify");return W.assertValidity(),W}hasHighS(){return v(this.s)}toBytes(g=b){if(ru(g),g==="der")return oo(On.hexFromSig(this));const w=o.toBytes(this.r),S=o.toBytes(this.s);if(g==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return bn(Uint8Array.of(this.recovery),w,S)}return bn(w,S)}toHex(g){return si(this.toBytes(g))}assertValidity(){}static fromCompact(g){return _.fromBytes(yt("sig",g),"compact")}static fromDER(g){return _.fromBytes(yt("sig",g),"der")}normalizeS(){return this.hasHighS()?new _(this.r,o.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return si(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return si(this.toBytes("compact"))}}const x=n.bits2int||function(g){if(g.length>8192)throw new Error("input is too large");const w=$o(g),S=g.length*8-c;return S>0?w>>BigInt(S):w},T=n.bits2int_modN||function(g){return o.create(x(g))},R=Yi(c);function F(m){return _8("num < 2^"+c,m,An,R),o.toBytes(m)}function U(m,g){return Pr(m,void 0,"message"),g?Pr(e(m),void 0,"prehashed message"):m}function $(m,g,w){if(["recovered","canonical"].some(q=>q in w))throw new Error("sign() legacy options not supported");const{lowS:S,prehash:O,extraEntropy:I}=iu(w,p);m=U(m,O);const B=T(m),P=pi(o,g),L=[F(P),F(B)];if(I!=null&&I!==!1){const q=I===!0?r(f.secretKey):I;L.push(yt("extraEntropy",q))}const C=bn(...L),k=B;function N(q){const j=x(q);if(!o.isValidNot0(j))return;const W=o.inv(j),H=t.BASE.multiply(j).toAffine(),Z=o.create(H.x);if(Z===An)return;const Q=o.create(W*o.create(k+Z*P));if(Q===An)return;let ee=(H.x===Z?0:2)|Number(H.y&di),se=Q;return S&&v(Q)&&(se=o.neg(Q),ee^=1),new _(Z,se,ee)}return{seed:C,k2sig:N}}function z(m,g,w={}){m=yt("message",m);const{seed:S,k2sig:O}=$(m,g,w);return S8(e.outputLen,o.BYTES,i)(S,O)}function M(m){let g;const w=typeof m=="string"||so(m),S=!w&&m!==null&&typeof m=="object"&&typeof m.r=="bigint"&&typeof m.s=="bigint";if(!w&&!S)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(S)g=new _(m.r,m.s);else if(w){try{g=_.fromBytes(yt("sig",m),"der")}catch(O){if(!(O instanceof On.Err))throw O}if(!g)try{g=_.fromBytes(yt("sig",m),"compact")}catch{return!1}}return g||!1}function E(m,g,w,S={}){const{lowS:O,prehash:I,format:B}=iu(S,p);if(w=yt("publicKey",w),g=U(yt("message",g),I),"strict"in S)throw new Error("options.strict was renamed to lowS");const P=B===void 0?M(m):_.fromBytes(yt("sig",m),B);if(P===!1)return!1;try{const L=t.fromBytes(w);if(O&&P.hasHighS())return!1;const{r:C,s:k}=P,N=T(g),q=o.inv(k),j=o.create(N*q),W=o.create(C*q),H=t.BASE.multiplyUnsafe(j).add(L.multiplyUnsafe(W));return H.is0()?!1:o.create(H.x)===C}catch{return!1}}function y(m,g,w={}){const{prehash:S}=iu(w,p);return g=U(g,S),_.fromBytes(m,"recovered").recoverPublicKey(g).toBytes()}return Object.freeze({keygen:u,getPublicKey:l,getSharedSecret:h,utils:d,lengths:f,Point:t,sign:z,verify:E,recoverPublicKey:y,Signature:_,hash:e})}function K8(t){const e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},n=t.Fp;let r=t.allowedPrivateKeyLengths?Array.from(new Set(t.allowedPrivateKeyLengths.map(o=>Math.ceil(o/2)))):void 0;const i=Xi(e.n,{BITS:t.nBitLength,allowedLengths:r,modFromBytes:t.wrapPrivateKey}),s={Fp:n,Fn:i,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:s}}function G8(t){const{CURVE:e,curveOpts:n}=K8(t),r={hmac:t.hmac,randomBytes:t.randomBytes,lowS:t.lowS,bits2int:t.bits2int,bits2int_modN:t.bits2int_modN};return{CURVE:e,curveOpts:n,hash:t.hash,ecdsaOpts:r}}function W8(t,e){const n=e.Point;return Object.assign({},e,{ProjectivePoint:n,CURVE:Object.assign({},t,ep(n.Fn.ORDER,n.Fn.BITS))})}function Z8(t){const{CURVE:e,curveOpts:n,hash:r,ecdsaOpts:i}=G8(t),s=z8(e,n),o=H8(s,r,i);return W8(t,o)}function Y8(t,e){const n=r=>Z8({...t,hash:r});return{...n(e),create:n}}dc("HashToScalar-");const su={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},X8={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),basises:[[BigInt("0x3086d221a7d46bcde86c90e49284eb15"),-BigInt("0xe4437ed6010e88286f547fa90abfe4c3")],[BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),BigInt("0x3086d221a7d46bcde86c90e49284eb15")]]},hp=BigInt(2);function J8(t){const e=su.p,n=BigInt(3),r=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),u=t*t*t%e,l=u*u*t%e,h=Rt(l,n,e)*l%e,d=Rt(h,n,e)*l%e,f=Rt(d,hp,e)*u%e,p=Rt(f,i,e)*f%e,b=Rt(p,s,e)*p%e,v=Rt(b,a,e)*b%e,A=Rt(v,c,e)*v%e,D=Rt(A,a,e)*b%e,_=Rt(D,n,e)*l%e,x=Rt(_,o,e)*p%e,T=Rt(x,r,e)*u%e,R=Rt(T,hp,e);if(!ou.eql(ou.sqr(R),t))throw new Error("Cannot find square root");return R}const ou=Xi(su.p,{sqrt:J8});Y8({...su,Fp:ou,lowS:!0,endo:X8},ci);/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function gi(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function au(t,...e){if(!gi(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function dp(t,e){return Array.isArray(e)?e.length===0?!0:t?e.every(n=>typeof n=="string"):e.every(n=>Number.isSafeInteger(n)):!1}function cu(t){if(typeof t!="function")throw new Error("function expected");return!0}function Xn(t,e){if(typeof e!="string")throw new Error(`${t}: string expected`);return!0}function yi(t){if(!Number.isSafeInteger(t))throw new Error(`invalid integer: ${t}`)}function Ro(t){if(!Array.isArray(t))throw new Error("array expected")}function No(t,e){if(!dp(!0,e))throw new Error(`${t}: array of strings expected`)}function uu(t,e){if(!dp(!1,e))throw new Error(`${t}: array of numbers expected`)}function wt(...t){const e=s=>s,n=(s,o)=>a=>s(o(a)),r=t.map(s=>s.encode).reduceRight(n,e),i=t.map(s=>s.decode).reduce(n,e);return{encode:r,decode:i}}function It(t){const e=typeof t=="string"?t.split(""):t,n=e.length;No("alphabet",e);const r=new Map(e.map((i,s)=>[i,s]));return{encode:i=>(Ro(i),i.map(s=>{if(!Number.isSafeInteger(s)||s<0||s>=n)throw new Error(`alphabet.encode: digit index outside alphabet "${s}". Allowed: ${t}`);return e[s]})),decode:i=>(Ro(i),i.map(s=>{Xn("alphabet.decode",s);const o=r.get(s);if(o===void 0)throw new Error(`Unknown letter: "${s}". Allowed: ${t}`);return o}))}}function Ot(t=""){return Xn("join",t),{encode:e=>(No("join.decode",e),e.join(t)),decode:e=>(Xn("join.decode",e),e.split(t))}}function Co(t,e="="){return yi(t),Xn("padding",e),{encode(n){for(No("padding.encode",n);n.length*t%8;)n.push(e);return n},decode(n){No("padding.decode",n);let r=n.length;if(r*t%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;r>0&&n[r-1]===e;r--)if((r-1)*t%8===0)throw new Error("padding: invalid, string has too much padding");return n.slice(0,r)}}}function pp(t){return cu(t),{encode:e=>e,decode:e=>t(e)}}function gp(t,e,n){if(e<2)throw new Error(`convertRadix: invalid from=${e}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: invalid to=${n}, base cannot be less than 2`);if(Ro(t),!t.length)return[];let r=0;const i=[],s=Array.from(t,a=>{if(yi(a),a<0||a>=e)throw new Error(`invalid integer: ${a}`);return a}),o=s.length;for(;;){let a=0,c=!0;for(let u=r;u<o;u++){const l=s[u],h=e*a,d=h+l;if(!Number.isSafeInteger(d)||h/e!==a||d-l!==h)throw new Error("convertRadix: carry overflow");const f=d/n;a=d%n;const p=Math.floor(f);if(s[u]=p,!Number.isSafeInteger(p)||p*n+a!==d)throw new Error("convertRadix: carry overflow");if(c)p?c=!1:r=u;else continue}if(i.push(a),c)break}for(let a=0;a<t.length-1&&t[a]===0;a++)i.push(0);return i.reverse()}const yp=(t,e)=>e===0?t:yp(e,t%e),Uo=(t,e)=>t+(e-yp(t,e)),Fo=(()=>{let t=[];for(let e=0;e<40;e++)t.push(2**e);return t})();function lu(t,e,n,r){if(Ro(t),e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(Uo(e,n)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${n} carryBits=${Uo(e,n)}`);let i=0,s=0;const o=Fo[e],a=Fo[n]-1,c=[];for(const u of t){if(yi(u),u>=o)throw new Error(`convertRadix2: invalid data word=${u} from=${e}`);if(i=i<<e|u,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=n;s-=n)c.push((i>>s-n&a)>>>0);const l=Fo[s];if(l===void 0)throw new Error("invalid carry");i&=l-1}if(i=i<<n-s&a,!r&&s>=e)throw new Error("Excess padding");if(!r&&i>0)throw new Error(`Non-zero padding: ${i}`);return r&&s>0&&c.push(i>>>0),c}function Q8(t){yi(t);const e=2**8;return{encode:n=>{if(!gi(n))throw new Error("radix.encode input should be Uint8Array");return gp(Array.from(n),e,t)},decode:n=>(uu("radix.decode",n),Uint8Array.from(gp(n,t,e)))}}function Nt(t,e=!1){if(yi(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(Uo(8,t)>32||Uo(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!gi(n))throw new Error("radix2.encode input should be Uint8Array");return lu(Array.from(n),8,t,!e)},decode:n=>(uu("radix2.decode",n),Uint8Array.from(lu(n,t,8,e)))}}function bp(t){return cu(t),function(...e){try{return t.apply(null,e)}catch{}}}function ex(t,e){return yi(t),cu(e),{encode(n){if(!gi(n))throw new Error("checksum.encode: input should be Uint8Array");const r=e(n).slice(0,t),i=new Uint8Array(n.length+t);return i.set(n),i.set(r,n.length),i},decode(n){if(!gi(n))throw new Error("checksum.decode: input should be Uint8Array");const r=n.slice(0,-t),i=n.slice(-t),s=e(r).slice(0,t);for(let o=0;o<t;o++)if(s[o]!==i[o])throw new Error("Invalid checksum");return r}}}const tx=wt(Nt(5),It("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),Co(5),Ot("")),wp=typeof Uint8Array.from([]).toBase64=="function"&&typeof Uint8Array.fromBase64=="function",mp=(t,e)=>{Xn("base64",t);const n=e?/^[A-Za-z0-9=_-]+$/:/^[A-Za-z0-9=+/]+$/,r=e?"base64url":"base64";if(t.length>0&&!n.test(t))throw new Error("invalid base64");return Uint8Array.fromBase64(t,{alphabet:r,lastChunkHandling:"strict"})},fu=t=>wt(Q8(58),It(t),Ot("")),nx=fu("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),rx=t=>wt(ex(4,e=>t(t(e))),nx),hu=wt(It("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),Ot("")),vp=[996825010,642813549,513874426,1027748829,705979059];function Ji(t){const e=t>>25;let n=(t&33554431)<<5;for(let r=0;r<vp.length;r++)(e>>r&1)===1&&(n^=vp[r]);return n}function Ep(t,e,n=1){const r=t.length;let i=1;for(let s=0;s<r;s++){const o=t.charCodeAt(s);if(o<33||o>126)throw new Error(`Invalid prefix (${t})`);i=Ji(i)^o>>5}i=Ji(i);for(let s=0;s<r;s++)i=Ji(i)^t.charCodeAt(s)&31;for(let s of e)i=Ji(i)^s;for(let s=0;s<6;s++)i=Ji(i);return i^=n,hu.encode(lu([i%Fo[30]],30,5,!1))}function xp(t){const e=t==="bech32"?1:734539939,n=Nt(5),r=n.decode,i=n.encode,s=bp(r);function o(h,d,f=90){Xn("bech32.encode prefix",h),gi(d)&&(d=Array.from(d)),uu("bech32.encode",d);const p=h.length;if(p===0)throw new TypeError(`Invalid prefix length ${p}`);const b=p+7+d.length;if(f!==!1&&b>f)throw new TypeError(`Length ${b} exceeds limit ${f}`);const v=h.toLowerCase(),A=Ep(v,d,e);return`${v}1${hu.encode(d)}${A}`}function a(h,d=90){Xn("bech32.decode input",h);const f=h.length;if(f<8||d!==!1&&f>d)throw new TypeError(`invalid string length: ${f} (${h}). Expected (8..${d})`);const p=h.toLowerCase();if(h!==p&&h!==h.toUpperCase())throw new Error("String must be lowercase or uppercase");const b=p.lastIndexOf("1");if(b===0||b===-1)throw new Error('Letter "1" must be present between prefix and data only');const v=p.slice(0,b),A=p.slice(b+1);if(A.length<6)throw new Error("Data must be at least 6 characters long");const D=hu.decode(A).slice(0,-6),_=Ep(v,D,e);if(!A.endsWith(_))throw new Error(`Invalid checksum in ${h}: expected "${_}"`);return{prefix:v,words:D}}const c=bp(a);function u(h){const{prefix:d,words:f}=a(h,!1);return{prefix:d,words:f,bytes:r(f)}}function l(h,d){return o(h,i(d))}return{encode:o,decode:a,encodeFromBytes:l,decodeToBytes:u,decodeUnsafe:c,fromWords:r,fromWordsUnsafe:s,toWords:i}}const ix=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",sx={encode(t){return au(t),t.toHex()},decode(t){return Xn("hex",t),Uint8Array.fromHex(t)}};rx(ci),dc("Bitcoin seed");function ox(t){return A3(ax(t))}function ax(t){const{payload:e,signature:n}=t,{r,s:i,yParity:s}=n,a=new i8.Signature(BigInt(r),BigInt(i)).addRecoveryBit(s).recoverPublicKey(Ic(e).substring(2));return w3(a)}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */function _p(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Lo(t,...e){if(!_p(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function ko(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Sp(t,e){Lo(t);const n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function Qi(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function du(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function cx(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function ux(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function es(t){if(typeof t=="string")t=ux(t);else if(_p(t))t=Ip(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function Ip(t){return Uint8Array.from(t)}const Bn=16,pu=new Uint8Array(16),rn=Qi(pu),lx=225,fx=(t,e,n,r)=>{const i=r&1;return{s3:n<<31|r>>>1,s2:e<<31|n>>>1,s1:t<<31|e>>>1,s0:t>>>1^lx<<24&-(i&1)}},Ct=t=>(t>>>0&255)<<24|(t>>>8&255)<<16|(t>>>16&255)<<8|t>>>24&255|0;function hx(t){t.reverse();const e=t[15]&1;let n=0;for(let r=0;r<t.length;r++){const i=t[r];t[r]=i>>>1|n,n=(i&1)<<7}return t[0]^=-e&225,t}const dx=t=>t>64*1024?8:t>1024?4:2;class Op{constructor(e,n){this.blockLen=Bn,this.outputLen=Bn,this.s0=0,this.s1=0,this.s2=0,this.s3=0,this.finished=!1,e=es(e),Lo(e,16);const r=cx(e);let i=r.getUint32(0,!1),s=r.getUint32(4,!1),o=r.getUint32(8,!1),a=r.getUint32(12,!1);const c=[];for(let p=0;p<128;p++)c.push({s0:Ct(i),s1:Ct(s),s2:Ct(o),s3:Ct(a)}),{s0:i,s1:s,s2:o,s3:a}=fx(i,s,o,a);const u=dx(n||1024);if(![1,2,4,8].includes(u))throw new Error("ghash: invalid window size, expected 2, 4 or 8");this.W=u;const h=128/u,d=this.windowSize=2**u,f=[];for(let p=0;p<h;p++)for(let b=0;b<d;b++){let v=0,A=0,D=0,_=0;for(let x=0;x<u;x++){if(!(b>>>u-x-1&1))continue;const{s0:R,s1:F,s2:U,s3:$}=c[u*p+x];v^=R,A^=F,D^=U,_^=$}f.push({s0:v,s1:A,s2:D,s3:_})}this.t=f}_updateBlock(e,n,r,i){e^=this.s0,n^=this.s1,r^=this.s2,i^=this.s3;const{W:s,t:o,windowSize:a}=this;let c=0,u=0,l=0,h=0;const d=(1<<s)-1;let f=0;for(const p of[e,n,r,i])for(let b=0;b<4;b++){const v=p>>>8*b&255;for(let A=8/s-1;A>=0;A--){const D=v>>>s*A&d,{s0:_,s1:x,s2:T,s3:R}=o[f*a+D];c^=_,u^=x,l^=T,h^=R,f+=1}}this.s0=c,this.s1=u,this.s2=l,this.s3=h}update(e){ko(this),e=es(e),Lo(e);const n=Qi(e),r=Math.floor(e.length/Bn),i=e.length%Bn;for(let s=0;s<r;s++)this._updateBlock(n[s*4+0],n[s*4+1],n[s*4+2],n[s*4+3]);return i&&(pu.set(e.subarray(r*Bn)),this._updateBlock(rn[0],rn[1],rn[2],rn[3]),du(rn)),this}destroy(){const{t:e}=this;for(const n of e)n.s0=0,n.s1=0,n.s2=0,n.s3=0}digestInto(e){ko(this),Sp(e,this),this.finished=!0;const{s0:n,s1:r,s2:i,s3:s}=this,o=Qi(e);return o[0]=n,o[1]=r,o[2]=i,o[3]=s,e}digest(){const e=new Uint8Array(Bn);return this.digestInto(e),this.destroy(),e}}class px extends Op{constructor(e,n){e=es(e),Lo(e);const r=hx(Ip(e));super(r,n),du(r)}update(e){e=es(e),ko(this);const n=Qi(e),r=e.length%Bn,i=Math.floor(e.length/Bn);for(let s=0;s<i;s++)this._updateBlock(Ct(n[s*4+3]),Ct(n[s*4+2]),Ct(n[s*4+1]),Ct(n[s*4+0]));return r&&(pu.set(e.subarray(i*Bn)),this._updateBlock(Ct(rn[3]),Ct(rn[2]),Ct(rn[1]),Ct(rn[0])),du(rn)),this}digestInto(e){ko(this),Sp(e,this),this.finished=!0;const{s0:n,s1:r,s2:i,s3:s}=this,o=Qi(e);return o[0]=n,o[1]=r,o[2]=i,o[3]=s,e.reverse()}}function Ap(t){const e=(r,i)=>t(i,r.length).update(es(r)).digest(),n=t(new Uint8Array(16),0);return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=(r,i)=>t(r,i),e}Ap((t,e)=>new Op(t,e)),Ap((t,e)=>new px(t,e));const Bp=Gn(BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff")),gx=Bp.create(BigInt("-3")),yx=BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b");xo({a:gx,b:yx,Fp:Bp,n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),h:BigInt(1),lowS:!1},ci);const Dp=Gn(BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff")),bx=Dp.create(BigInt("-3")),wx=BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef");xo({a:bx,b:wx,Fp:Dp,n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f"),h:BigInt(1),lowS:!1},jE);const $p=Gn(BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff")),mx=$p.create(BigInt("-3")),vx=BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00");xo({a:mx,b:vx,Fp:$p,n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650"),h:BigInt(1),lowS:!1,allowedPrivateKeyLengths:[130,131,132]},ME);var Ex={exports:{}};(function(t){var e=Object.prototype.hasOwnProperty,n="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(n=!1));function i(c,u,l){this.fn=c,this.context=u,this.once=l||!1}function s(c,u,l,h,d){if(typeof l!="function")throw new TypeError("The listener must be a function");var f=new i(l,h||c,d),p=n?n+u:u;return c._events[p]?c._events[p].fn?c._events[p]=[c._events[p],f]:c._events[p].push(f):(c._events[p]=f,c._eventsCount++),c}function o(c,u){--c._eventsCount===0?c._events=new r:delete c._events[u]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var u=[],l,h;if(this._eventsCount===0)return u;for(h in l=this._events)e.call(l,h)&&u.push(n?h.slice(1):h);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(l)):u},a.prototype.listeners=function(u){var l=n?n+u:u,h=this._events[l];if(!h)return[];if(h.fn)return[h.fn];for(var d=0,f=h.length,p=new Array(f);d<f;d++)p[d]=h[d].fn;return p},a.prototype.listenerCount=function(u){var l=n?n+u:u,h=this._events[l];return h?h.fn?1:h.length:0},a.prototype.emit=function(u,l,h,d,f,p){var b=n?n+u:u;if(!this._events[b])return!1;var v=this._events[b],A=arguments.length,D,_;if(v.fn){switch(v.once&&this.removeListener(u,v.fn,void 0,!0),A){case 1:return v.fn.call(v.context),!0;case 2:return v.fn.call(v.context,l),!0;case 3:return v.fn.call(v.context,l,h),!0;case 4:return v.fn.call(v.context,l,h,d),!0;case 5:return v.fn.call(v.context,l,h,d,f),!0;case 6:return v.fn.call(v.context,l,h,d,f,p),!0}for(_=1,D=new Array(A-1);_<A;_++)D[_-1]=arguments[_];v.fn.apply(v.context,D)}else{var x=v.length,T;for(_=0;_<x;_++)switch(v[_].once&&this.removeListener(u,v[_].fn,void 0,!0),A){case 1:v[_].fn.call(v[_].context);break;case 2:v[_].fn.call(v[_].context,l);break;case 3:v[_].fn.call(v[_].context,l,h);break;case 4:v[_].fn.call(v[_].context,l,h,d);break;default:if(!D)for(T=1,D=new Array(A-1);T<A;T++)D[T-1]=arguments[T];v[_].fn.apply(v[_].context,D)}}return!0},a.prototype.on=function(u,l,h){return s(this,u,l,h,!1)},a.prototype.once=function(u,l,h){return s(this,u,l,h,!0)},a.prototype.removeListener=function(u,l,h,d){var f=n?n+u:u;if(!this._events[f])return this;if(!l)return o(this,f),this;var p=this._events[f];if(p.fn)p.fn===l&&(!d||p.once)&&(!h||p.context===h)&&o(this,f);else{for(var b=0,v=[],A=p.length;b<A;b++)(p[b].fn!==l||d&&!p[b].once||h&&p[b].context!==h)&&v.push(p[b]);v.length?this._events[f]=v.length===1?v[0]:v:o(this,f)}return this},a.prototype.removeAllListeners=function(u){var l;return u?(l=n?n+u:u,this._events[l]&&o(this,l)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,t.exports=a})(Ex);function xx(t){if(t.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let u=0;u<e.length;u++)e[u]=255;for(let u=0;u<t.length;u++){const l=t.charAt(u),h=l.charCodeAt(0);if(e[h]!==255)throw new TypeError(l+" is ambiguous");e[h]=u}const n=t.length,r=t.charAt(0),i=Math.log(n)/Math.log(256),s=Math.log(256)/Math.log(n);function o(u){if(u instanceof Uint8Array||(ArrayBuffer.isView(u)?u=new Uint8Array(u.buffer,u.byteOffset,u.byteLength):Array.isArray(u)&&(u=Uint8Array.from(u))),!(u instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(u.length===0)return"";let l=0,h=0,d=0;const f=u.length;for(;d!==f&&u[d]===0;)d++,l++;const p=(f-d)*s+1>>>0,b=new Uint8Array(p);for(;d!==f;){let D=u[d],_=0;for(let x=p-1;(D!==0||_<h)&&x!==-1;x--,_++)D+=256*b[x]>>>0,b[x]=D%n>>>0,D=D/n>>>0;if(D!==0)throw new Error("Non-zero carry");h=_,d++}let v=p-h;for(;v!==p&&b[v]===0;)v++;let A=r.repeat(l);for(;v<p;++v)A+=t.charAt(b[v]);return A}function a(u){if(typeof u!="string")throw new TypeError("Expected String");if(u.length===0)return new Uint8Array;let l=0,h=0,d=0;for(;u[l]===r;)h++,l++;const f=(u.length-l)*i+1>>>0,p=new Uint8Array(f);for(;l<u.length;){const D=u.charCodeAt(l);if(D>255)return;let _=e[D];if(_===255)return;let x=0;for(let T=f-1;(_!==0||x<d)&&T!==-1;T--,x++)_+=n*p[T]>>>0,p[T]=_%256>>>0,_=_/256>>>0;if(_!==0)throw new Error("Non-zero carry");d=x,l++}let b=f-d;for(;b!==f&&p[b]===0;)b++;const v=new Uint8Array(h+(f-b));let A=h;for(;b!==f;)v[A++]=p[b++];return v}function c(u){const l=a(u);if(l)return l;throw new Error("Non-base"+n+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var _x="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",ts=xx(_x);function Sx(t){const e=t.length;let n=0,r=0;for(;r<e;){let i=t.charCodeAt(r++);if((i&4294967168)===0){n++;continue}else if((i&4294965248)===0)n+=2;else{if(i>=55296&&i<=56319&&r<e){const s=t.charCodeAt(r);(s&64512)===56320&&(++r,i=((i&1023)<<10)+(s&1023)+65536)}(i&4294901760)===0?n+=3:n+=4}}return n}function Ix(t,e,n){const r=t.length;let i=n,s=0;for(;s<r;){let o=t.charCodeAt(s++);if((o&4294967168)===0){e[i++]=o;continue}else if((o&4294965248)===0)e[i++]=o>>6&31|192;else{if(o>=55296&&o<=56319&&s<r){const a=t.charCodeAt(s);(a&64512)===56320&&(++s,o=((o&1023)<<10)+(a&1023)+65536)}(o&4294901760)===0?(e[i++]=o>>12&15|224,e[i++]=o>>6&63|128):(e[i++]=o>>18&7|240,e[i++]=o>>12&63|128,e[i++]=o>>6&63|128)}e[i++]=o&63|128}}const Ox=new TextEncoder,Ax=50;function Bx(t,e,n){Ox.encodeInto(t,e.subarray(n))}function Dx(t,e,n){t.length>Ax?Bx(t,e,n):Ix(t,e,n)}const $x=4096;function Tp(t,e,n){let r=e;const i=r+n,s=[];let o="";for(;r<i;){const a=t[r++];if((a&128)===0)s.push(a);else if((a&224)===192){const c=t[r++]&63;s.push((a&31)<<6|c)}else if((a&240)===224){const c=t[r++]&63,u=t[r++]&63;s.push((a&31)<<12|c<<6|u)}else if((a&248)===240){const c=t[r++]&63,u=t[r++]&63,l=t[r++]&63;let h=(a&7)<<18|c<<12|u<<6|l;h>65535&&(h-=65536,s.push(h>>>10&1023|55296),h=56320|h&1023),s.push(h)}else s.push(a);s.length>=$x&&(o+=String.fromCharCode(...s),s.length=0)}return s.length>0&&(o+=String.fromCharCode(...s)),o}const Tx=new TextDecoder,Px=200;function Rx(t,e,n){const r=t.subarray(e,e+n);return Tx.decode(r)}function Nx(t,e,n){return n>Px?Rx(t,e,n):Tp(t,e,n)}class qo{constructor(e,n){this.type=e,this.data=n}}class At extends Error{constructor(e){super(e);const n=Object.create(At.prototype);Object.setPrototypeOf(this,n),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:At.name})}}const ns=4294967295;function Cx(t,e,n){const r=n/4294967296,i=n;t.setUint32(e,r),t.setUint32(e+4,i)}function Pp(t,e,n){const r=Math.floor(n/4294967296),i=n;t.setUint32(e,r),t.setUint32(e+4,i)}function Rp(t,e){const n=t.getInt32(e),r=t.getUint32(e+4);return n*4294967296+r}function Ux(t,e){const n=t.getUint32(e),r=t.getUint32(e+4);return n*4294967296+r}const Fx=-1,Lx=4294967296-1,kx=17179869184-1;function qx({sec:t,nsec:e}){if(t>=0&&e>=0&&t<=kx)if(e===0&&t<=Lx){const n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,t),n}else{const n=t/4294967296,r=t&4294967295,i=new Uint8Array(8),s=new DataView(i.buffer);return s.setUint32(0,e<<2|n&3),s.setUint32(4,r),i}else{const n=new Uint8Array(12),r=new DataView(n.buffer);return r.setUint32(0,e),Pp(r,4,t),n}}function Mx(t){const e=t.getTime(),n=Math.floor(e/1e3),r=(e-n*1e3)*1e6,i=Math.floor(r/1e9);return{sec:n+i,nsec:r-i*1e9}}function jx(t){if(t instanceof Date){const e=Mx(t);return qx(e)}else return null}function zx(t){const e=new DataView(t.buffer,t.byteOffset,t.byteLength);switch(t.byteLength){case 4:return{sec:e.getUint32(0),nsec:0};case 8:{const n=e.getUint32(0),r=e.getUint32(4),i=(n&3)*4294967296+r,s=n>>>2;return{sec:i,nsec:s}}case 12:{const n=Rp(e,4),r=e.getUint32(0);return{sec:n,nsec:r}}default:throw new At(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${t.length}`)}}function Vx(t){const e=zx(t);return new Date(e.sec*1e3+e.nsec/1e6)}const Hx={type:Fx,encode:jx,decode:Vx};class Mo{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(Hx)}register({type:e,encode:n,decode:r}){if(e>=0)this.encoders[e]=n,this.decoders[e]=r;else{const i=-1-e;this.builtInEncoders[i]=n,this.builtInDecoders[i]=r}}tryToEncode(e,n){for(let r=0;r<this.builtInEncoders.length;r++){const i=this.builtInEncoders[r];if(i!=null){const s=i(e,n);if(s!=null){const o=-1-r;return new qo(o,s)}}}for(let r=0;r<this.encoders.length;r++){const i=this.encoders[r];if(i!=null){const s=i(e,n);if(s!=null){const o=r;return new qo(o,s)}}}return e instanceof qo?e:null}decode(e,n,r){const i=n<0?this.builtInDecoders[-1-n]:this.decoders[n];return i?i(e,n,r):new qo(n,e)}}Mo.defaultCodec=new Mo;function Kx(t){return t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer}function gu(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Kx(t)?new Uint8Array(t):Uint8Array.from(t)}const Gx=100,Wx=2048;class yu{constructor(e){this.entered=!1,this.extensionCodec=e?.extensionCodec??Mo.defaultCodec,this.context=e?.context,this.useBigInt64=e?.useBigInt64??!1,this.maxDepth=e?.maxDepth??Gx,this.initialBufferSize=e?.initialBufferSize??Wx,this.sortKeys=e?.sortKeys??!1,this.forceFloat32=e?.forceFloat32??!1,this.ignoreUndefined=e?.ignoreUndefined??!1,this.forceIntegerToFloat=e?.forceIntegerToFloat??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new yu({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(e){if(this.entered)return this.clone().encodeSharedRef(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(e){if(this.entered)return this.clone().encode(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(e,n){if(n>this.maxDepth)throw new Error(`Too deep objects in depth ${n}`);e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.useBigInt64&&typeof e=="bigint"?this.encodeBigInt64(e):this.encodeObject(e,n)}ensureBufferSizeToWrite(e){const n=this.pos+e;this.view.byteLength<n&&this.resizeBuffer(n*2)}resizeBuffer(e){const n=new ArrayBuffer(e),r=new Uint8Array(n),i=new DataView(n);r.set(this.bytes),this.view=i,this.bytes=r}encodeNil(){this.writeU8(192)}encodeBoolean(e){e===!1?this.writeU8(194):this.writeU8(195)}encodeNumber(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)}encodeNumberAsFloat(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}encodeBigInt64(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error(`Too long string: ${e} bytes in UTF-8`)}encodeString(e){const r=Sx(e);this.ensureBufferSizeToWrite(5+r),this.writeStringHeader(r),Dx(e,this.bytes,this.pos),this.pos+=r}encodeObject(e,n){const r=this.extensionCodec.tryToEncode(e,this.context);if(r!=null)this.encodeExtension(r);else if(Array.isArray(e))this.encodeArray(e,n);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,n);else throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`)}encodeBinary(e){const n=e.byteLength;if(n<256)this.writeU8(196),this.writeU8(n);else if(n<65536)this.writeU8(197),this.writeU16(n);else if(n<4294967296)this.writeU8(198),this.writeU32(n);else throw new Error(`Too large binary: ${n}`);const r=gu(e);this.writeU8a(r)}encodeArray(e,n){const r=e.length;if(r<16)this.writeU8(144+r);else if(r<65536)this.writeU8(220),this.writeU16(r);else if(r<4294967296)this.writeU8(221),this.writeU32(r);else throw new Error(`Too large array: ${r}`);for(const i of e)this.doEncode(i,n+1)}countWithoutUndefined(e,n){let r=0;for(const i of n)e[i]!==void 0&&r++;return r}encodeMap(e,n){const r=Object.keys(e);this.sortKeys&&r.sort();const i=this.ignoreUndefined?this.countWithoutUndefined(e,r):r.length;if(i<16)this.writeU8(128+i);else if(i<65536)this.writeU8(222),this.writeU16(i);else if(i<4294967296)this.writeU8(223),this.writeU32(i);else throw new Error(`Too large map object: ${i}`);for(const s of r){const o=e[s];this.ignoreUndefined&&o===void 0||(this.encodeString(s),this.doEncode(o,n+1))}}encodeExtension(e){if(typeof e.data=="function"){const r=e.data(this.pos+6),i=r.length;if(i>=4294967296)throw new Error(`Too large extension object: ${i}`);this.writeU8(201),this.writeU32(i),this.writeI8(e.type),this.writeU8a(r);return}const n=e.data.length;if(n===1)this.writeU8(212);else if(n===2)this.writeU8(213);else if(n===4)this.writeU8(214);else if(n===8)this.writeU8(215);else if(n===16)this.writeU8(216);else if(n<256)this.writeU8(199),this.writeU8(n);else if(n<65536)this.writeU8(200),this.writeU16(n);else if(n<4294967296)this.writeU8(201),this.writeU32(n);else throw new Error(`Too large extension object: ${n}`);this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){const n=e.length;this.ensureBufferSizeToWrite(n),this.bytes.set(e,this.pos),this.pos+=n}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){this.ensureBufferSizeToWrite(8),Cx(this.view,this.pos,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),Pp(this.view,this.pos,e),this.pos+=8}writeBigUint64(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8}writeBigInt64(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8}}function Zx(t,e){return new yu(e).encodeSharedRef(t)}function bu(t){return`${t<0?"-":""}0x${Math.abs(t).toString(16).padStart(2,"0")}`}const Yx=16,Xx=16;class Jx{constructor(e=Yx,n=Xx){this.hit=0,this.miss=0,this.maxKeyLength=e,this.maxLengthPerKey=n,this.caches=[];for(let r=0;r<this.maxKeyLength;r++)this.caches.push([])}canBeCached(e){return e>0&&e<=this.maxKeyLength}find(e,n,r){const i=this.caches[r-1];e:for(const s of i){const o=s.bytes;for(let a=0;a<r;a++)if(o[a]!==e[n+a])continue e;return s.str}return null}store(e,n){const r=this.caches[e.length-1],i={bytes:e,str:n};r.length>=this.maxLengthPerKey?r[Math.random()*r.length|0]=i:r.push(i)}decode(e,n,r){const i=this.find(e,n,r);if(i!=null)return this.hit++,i;this.miss++;const s=Tp(e,n,r),o=Uint8Array.prototype.slice.call(e,n,n+r);return this.store(o,s),s}}const wu="array",rs="map_key",Np="map_value",Qx=t=>{if(typeof t=="string"||typeof t=="number")return t;throw new At("The type of key must be string or number but "+typeof t)};class e6{constructor(){this.stack=[],this.stackHeadPosition=-1}get length(){return this.stackHeadPosition+1}top(){return this.stack[this.stackHeadPosition]}pushArrayState(e){const n=this.getUninitializedStateFromPool();n.type=wu,n.position=0,n.size=e,n.array=new Array(e)}pushMapState(e){const n=this.getUninitializedStateFromPool();n.type=rs,n.readCount=0,n.size=e,n.map={}}getUninitializedStateFromPool(){if(this.stackHeadPosition++,this.stackHeadPosition===this.stack.length){const e={type:void 0,size:0,array:void 0,position:0,readCount:0,map:void 0,key:null};this.stack.push(e)}return this.stack[this.stackHeadPosition]}release(e){if(this.stack[this.stackHeadPosition]!==e)throw new Error("Invalid stack state. Released state is not on top of the stack.");if(e.type===wu){const r=e;r.size=0,r.array=void 0,r.position=0,r.type=void 0}if(e.type===rs||e.type===Np){const r=e;r.size=0,r.map=void 0,r.readCount=0,r.type=void 0}this.stackHeadPosition--}reset(){this.stack.length=0,this.stackHeadPosition=-1}}const is=-1,mu=new DataView(new ArrayBuffer(0)),t6=new Uint8Array(mu.buffer);try{mu.getInt8(0)}catch(t){if(!(t instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}const Cp=new RangeError("Insufficient data"),n6=new Jx;class vu{constructor(e){this.totalPos=0,this.pos=0,this.view=mu,this.bytes=t6,this.headByte=is,this.stack=new e6,this.entered=!1,this.extensionCodec=e?.extensionCodec??Mo.defaultCodec,this.context=e?.context,this.useBigInt64=e?.useBigInt64??!1,this.rawStrings=e?.rawStrings??!1,this.maxStrLength=e?.maxStrLength??ns,this.maxBinLength=e?.maxBinLength??ns,this.maxArrayLength=e?.maxArrayLength??ns,this.maxMapLength=e?.maxMapLength??ns,this.maxExtLength=e?.maxExtLength??ns,this.keyDecoder=e?.keyDecoder!==void 0?e.keyDecoder:n6,this.mapKeyConverter=e?.mapKeyConverter??Qx}clone(){return new vu({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,rawStrings:this.rawStrings,maxStrLength:this.maxStrLength,maxBinLength:this.maxBinLength,maxArrayLength:this.maxArrayLength,maxMapLength:this.maxMapLength,maxExtLength:this.maxExtLength,keyDecoder:this.keyDecoder})}reinitializeState(){this.totalPos=0,this.headByte=is,this.stack.reset()}setBuffer(e){const n=gu(e);this.bytes=n,this.view=new DataView(n.buffer,n.byteOffset,n.byteLength),this.pos=0}appendBuffer(e){if(this.headByte===is&&!this.hasRemaining(1))this.setBuffer(e);else{const n=this.bytes.subarray(this.pos),r=gu(e),i=new Uint8Array(n.length+r.length);i.set(n),i.set(r,n.length),this.setBuffer(i)}}hasRemaining(e){return this.view.byteLength-this.pos>=e}createExtraByteError(e){const{view:n,pos:r}=this;return new RangeError(`Extra ${n.byteLength-r} of ${n.byteLength} byte(s) found at buffer[${e}]`)}decode(e){if(this.entered)return this.clone().decode(e);try{this.entered=!0,this.reinitializeState(),this.setBuffer(e);const n=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return n}finally{this.entered=!1}}*decodeMulti(e){if(this.entered){yield*this.clone().decodeMulti(e);return}try{for(this.entered=!0,this.reinitializeState(),this.setBuffer(e);this.hasRemaining(1);)yield this.doDecodeSync()}finally{this.entered=!1}}async decodeAsync(e){if(this.entered)return this.clone().decodeAsync(e);try{this.entered=!0;let n=!1,r;for await(const a of e){if(n)throw this.entered=!1,this.createExtraByteError(this.totalPos);this.appendBuffer(a);try{r=this.doDecodeSync(),n=!0}catch(c){if(!(c instanceof RangeError))throw c}this.totalPos+=this.pos}if(n){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return r}const{headByte:i,pos:s,totalPos:o}=this;throw new RangeError(`Insufficient data in parsing ${bu(i)} at ${o} (${s} in the current buffer)`)}finally{this.entered=!1}}decodeArrayStream(e){return this.decodeMultiAsync(e,!0)}decodeStream(e){return this.decodeMultiAsync(e,!1)}async*decodeMultiAsync(e,n){if(this.entered){yield*this.clone().decodeMultiAsync(e,n);return}try{this.entered=!0;let r=n,i=-1;for await(const s of e){if(n&&i===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(s),r&&(i=this.readArraySize(),r=!1,this.complete());try{for(;yield this.doDecodeSync(),--i!==0;);}catch(o){if(!(o instanceof RangeError))throw o}this.totalPos+=this.pos}}finally{this.entered=!1}}doDecodeSync(){e:for(;;){const e=this.readHeadByte();let n;if(e>=224)n=e-256;else if(e<192)if(e<128)n=e;else if(e<144){const i=e-128;if(i!==0){this.pushMapState(i),this.complete();continue e}else n={}}else if(e<160){const i=e-144;if(i!==0){this.pushArrayState(i),this.complete();continue e}else n=[]}else{const i=e-160;n=this.decodeString(i,0)}else if(e===192)n=null;else if(e===194)n=!1;else if(e===195)n=!0;else if(e===202)n=this.readF32();else if(e===203)n=this.readF64();else if(e===204)n=this.readU8();else if(e===205)n=this.readU16();else if(e===206)n=this.readU32();else if(e===207)this.useBigInt64?n=this.readU64AsBigInt():n=this.readU64();else if(e===208)n=this.readI8();else if(e===209)n=this.readI16();else if(e===210)n=this.readI32();else if(e===211)this.useBigInt64?n=this.readI64AsBigInt():n=this.readI64();else if(e===217){const i=this.lookU8();n=this.decodeString(i,1)}else if(e===218){const i=this.lookU16();n=this.decodeString(i,2)}else if(e===219){const i=this.lookU32();n=this.decodeString(i,4)}else if(e===220){const i=this.readU16();if(i!==0){this.pushArrayState(i),this.complete();continue e}else n=[]}else if(e===221){const i=this.readU32();if(i!==0){this.pushArrayState(i),this.complete();continue e}else n=[]}else if(e===222){const i=this.readU16();if(i!==0){this.pushMapState(i),this.complete();continue e}else n={}}else if(e===223){const i=this.readU32();if(i!==0){this.pushMapState(i),this.complete();continue e}else n={}}else if(e===196){const i=this.lookU8();n=this.decodeBinary(i,1)}else if(e===197){const i=this.lookU16();n=this.decodeBinary(i,2)}else if(e===198){const i=this.lookU32();n=this.decodeBinary(i,4)}else if(e===212)n=this.decodeExtension(1,0);else if(e===213)n=this.decodeExtension(2,0);else if(e===214)n=this.decodeExtension(4,0);else if(e===215)n=this.decodeExtension(8,0);else if(e===216)n=this.decodeExtension(16,0);else if(e===199){const i=this.lookU8();n=this.decodeExtension(i,1)}else if(e===200){const i=this.lookU16();n=this.decodeExtension(i,2)}else if(e===201){const i=this.lookU32();n=this.decodeExtension(i,4)}else throw new At(`Unrecognized type byte: ${bu(e)}`);this.complete();const r=this.stack;for(;r.length>0;){const i=r.top();if(i.type===wu)if(i.array[i.position]=n,i.position++,i.position===i.size)n=i.array,r.release(i);else continue e;else if(i.type===rs){if(n==="__proto__")throw new At("The key __proto__ is not allowed");i.key=this.mapKeyConverter(n),i.type=Np;continue e}else if(i.map[i.key]=n,i.readCount++,i.readCount===i.size)n=i.map,r.release(i);else{i.key=null,i.type=rs;continue e}}return n}}readHeadByte(){return this.headByte===is&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=is}readArraySize(){const e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:{if(e<160)return e-144;throw new At(`Unrecognized array type byte: ${bu(e)}`)}}}pushMapState(e){if(e>this.maxMapLength)throw new At(`Max length exceeded: map length (${e}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.pushMapState(e)}pushArrayState(e){if(e>this.maxArrayLength)throw new At(`Max length exceeded: array length (${e}) > maxArrayLength (${this.maxArrayLength})`);this.stack.pushArrayState(e)}decodeString(e,n){return!this.rawStrings||this.stateIsMapKey()?this.decodeUtf8String(e,n):this.decodeBinary(e,n)}decodeUtf8String(e,n){if(e>this.maxStrLength)throw new At(`Max length exceeded: UTF-8 byte length (${e}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+n+e)throw Cp;const r=this.pos+n;let i;return this.stateIsMapKey()&&this.keyDecoder?.canBeCached(e)?i=this.keyDecoder.decode(this.bytes,r,e):i=Nx(this.bytes,r,e),this.pos+=n+e,i}stateIsMapKey(){return this.stack.length>0?this.stack.top().type===rs:!1}decodeBinary(e,n){if(e>this.maxBinLength)throw new At(`Max length exceeded: bin length (${e}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(e+n))throw Cp;const r=this.pos+n,i=this.bytes.subarray(r,r+e);return this.pos+=n+e,i}decodeExtension(e,n){if(e>this.maxExtLength)throw new At(`Max length exceeded: ext length (${e}) > maxExtLength (${this.maxExtLength})`);const r=this.view.getInt8(this.pos+n),i=this.decodeBinary(e,n+1);return this.extensionCodec.decode(i,r,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){const e=this.view.getUint8(this.pos);return this.pos++,e}readI8(){const e=this.view.getInt8(this.pos);return this.pos++,e}readU16(){const e=this.view.getUint16(this.pos);return this.pos+=2,e}readI16(){const e=this.view.getInt16(this.pos);return this.pos+=2,e}readU32(){const e=this.view.getUint32(this.pos);return this.pos+=4,e}readI32(){const e=this.view.getInt32(this.pos);return this.pos+=4,e}readU64(){const e=Ux(this.view,this.pos);return this.pos+=8,e}readI64(){const e=Rp(this.view,this.pos);return this.pos+=8,e}readU64AsBigInt(){const e=this.view.getBigUint64(this.pos);return this.pos+=8,e}readI64AsBigInt(){const e=this.view.getBigInt64(this.pos);return this.pos+=8,e}readF32(){const e=this.view.getFloat32(this.pos);return this.pos+=4,e}readF64(){const e=this.view.getFloat64(this.pos);return this.pos+=8,e}}function r6(t,e){return new vu(e).decode(t)}function Eu(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function Up(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Eu(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function ss(t,e){e||(e=t.reduce((i,s)=>i+s.length,0));const n=Up(e);let r=0;for(const i of t)n.set(i,r),r+=i.length;return Eu(n)}function i6(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),o=s.charCodeAt(0);if(n[o]!==255)throw new TypeError(s+" is ambiguous");n[o]=i}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var b=0,v=0,A=0,D=p.length;A!==D&&p[A]===0;)A++,b++;for(var _=(D-A)*l+1>>>0,x=new Uint8Array(_);A!==D;){for(var T=p[A],R=0,F=_-1;(T!==0||R<v)&&F!==-1;F--,R++)T+=256*x[F]>>>0,x[F]=T%a>>>0,T=T/a>>>0;if(T!==0)throw new Error("Non-zero carry");v=R,A++}for(var U=_-v;U!==_&&x[U]===0;)U++;for(var $=c.repeat(b);U<_;++U)$+=t.charAt(x[U]);return $}function d(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var b=0;if(p[b]!==" "){for(var v=0,A=0;p[b]===c;)v++,b++;for(var D=(p.length-b)*u+1>>>0,_=new Uint8Array(D);p[b];){var x=n[p.charCodeAt(b)];if(x===255)return;for(var T=0,R=D-1;(x!==0||T<A)&&R!==-1;R--,T++)x+=a*_[R]>>>0,_[R]=x%256>>>0,x=x/256>>>0;if(x!==0)throw new Error("Non-zero carry");A=T,b++}if(p[b]!==" "){for(var F=D-A;F!==D&&_[F]===0;)F++;for(var U=new Uint8Array(v+(D-F)),$=v;F!==D;)U[$++]=_[F++];return U}}}function f(p){var b=d(p);if(b)return b;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:d,decode:f}}var s6=i6,o6=s6;const Fp=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},a6=t=>new TextEncoder().encode(t),c6=t=>new TextDecoder().decode(t);class u6{constructor(e,n,r){this.name=e,this.prefix=n,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class l6{constructor(e,n,r){if(this.name=e,this.prefix=n,n.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=n.codePointAt(0),this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Lp(this,e)}}class f6{constructor(e){this.decoders=e}or(e){return Lp(this,e)}decode(e){const n=e[0],r=this.decoders[n];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Lp=(t,e)=>new f6({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class h6{constructor(e,n,r,i){this.name=e,this.prefix=n,this.baseEncode=r,this.baseDecode=i,this.encoder=new u6(e,n,r),this.decoder=new l6(e,n,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const jo=({name:t,prefix:e,encode:n,decode:r})=>new h6(t,e,n,r),os=({prefix:t,name:e,alphabet:n})=>{const{encode:r,decode:i}=o6(n,e);return jo({prefix:t,name:e,encode:r,decode:s=>Fp(i(s))})},d6=(t,e,n,r)=>{const i={};for(let l=0;l<e.length;++l)i[e[l]]=l;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*n/8|0);let a=0,c=0,u=0;for(let l=0;l<s;++l){const h=i[t[l]];if(h===void 0)throw new SyntaxError(`Non-${r} character`);c=c<<n|h,a+=n,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=n||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},p6=(t,e,n)=>{const r=e[e.length-1]==="=",i=(1<<n)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>n;)o-=n,s+=e[i&a>>o];if(o&&(s+=e[i&a<<n-o]),r)for(;s.length*n&7;)s+="=";return s},ke=({name:t,prefix:e,bitsPerChar:n,alphabet:r})=>jo({prefix:e,name:t,encode(i){return p6(i,r,n)},decode(i){return d6(i,r,n,t)}}),g6=jo({prefix:"\0",name:"identity",encode:t=>c6(t),decode:t=>a6(t)});var y6=Object.freeze({__proto__:null,identity:g6});const b6=ke({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var w6=Object.freeze({__proto__:null,base2:b6});const m6=ke({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var v6=Object.freeze({__proto__:null,base8:m6});const E6=os({prefix:"9",name:"base10",alphabet:"0123456789"});var x6=Object.freeze({__proto__:null,base10:E6});const _6=ke({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),S6=ke({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var I6=Object.freeze({__proto__:null,base16:_6,base16upper:S6});const O6=ke({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),A6=ke({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),B6=ke({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),D6=ke({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),$6=ke({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),T6=ke({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),P6=ke({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),R6=ke({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),N6=ke({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var C6=Object.freeze({__proto__:null,base32:O6,base32upper:A6,base32pad:B6,base32padupper:D6,base32hex:$6,base32hexupper:T6,base32hexpad:P6,base32hexpadupper:R6,base32z:N6});const U6=os({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),F6=os({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var L6=Object.freeze({__proto__:null,base36:U6,base36upper:F6});const k6=os({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),q6=os({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var M6=Object.freeze({__proto__:null,base58btc:k6,base58flickr:q6});const j6=ke({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),z6=ke({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),V6=ke({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),H6=ke({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var K6=Object.freeze({__proto__:null,base64:j6,base64pad:z6,base64url:V6,base64urlpad:H6});const kp=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),G6=kp.reduce((t,e,n)=>(t[n]=e,t),[]),W6=kp.reduce((t,e,n)=>(t[e.codePointAt(0)]=n,t),[]);function Z6(t){return t.reduce((e,n)=>(e+=G6[n],e),"")}function Y6(t){const e=[];for(const n of t){const r=W6[n.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${n}`);e.push(r)}return new Uint8Array(e)}const X6=jo({prefix:"\u{1F680}",name:"base256emoji",encode:Z6,decode:Y6});var J6=Object.freeze({__proto__:null,base256emoji:X6}),Q6=Mp,qp=128,e_=127,t_=~e_,n_=Math.pow(2,31);function Mp(t,e,n){e=e||[],n=n||0;for(var r=n;t>=n_;)e[n++]=t&255|qp,t/=128;for(;t&t_;)e[n++]=t&255|qp,t>>>=7;return e[n]=t|0,Mp.bytes=n-r+1,e}var r_=xu,i_=128,jp=127;function xu(t,r){var n=0,r=r||0,i=0,s=r,o,a=t.length;do{if(s>=a)throw xu.bytes=0,new RangeError("Could not decode varint");o=t[s++],n+=i<28?(o&jp)<<i:(o&jp)*Math.pow(2,i),i+=7}while(o>=i_);return xu.bytes=s-r,n}var s_=Math.pow(2,7),o_=Math.pow(2,14),a_=Math.pow(2,21),c_=Math.pow(2,28),u_=Math.pow(2,35),l_=Math.pow(2,42),f_=Math.pow(2,49),h_=Math.pow(2,56),d_=Math.pow(2,63),p_=function(t){return t<s_?1:t<o_?2:t<a_?3:t<c_?4:t<u_?5:t<l_?6:t<f_?7:t<h_?8:t<d_?9:10},g_={encode:Q6,decode:r_,encodingLength:p_},zp=g_;const Vp=(t,e,n=0)=>(zp.encode(t,e,n),e),Hp=t=>zp.encodingLength(t),_u=(t,e)=>{const n=e.byteLength,r=Hp(t),i=r+Hp(n),s=new Uint8Array(i+n);return Vp(t,s,0),Vp(n,s,r),s.set(e,i),new y_(t,n,e,s)};class y_{constructor(e,n,r,i){this.code=e,this.size=n,this.digest=r,this.bytes=i}}const Kp=({name:t,code:e,encode:n})=>new b_(t,e,n);class b_{constructor(e,n,r){this.name=e,this.code=n,this.encode=r}digest(e){if(e instanceof Uint8Array){const n=this.encode(e);return n instanceof Uint8Array?_u(this.code,n):n.then(r=>_u(this.code,r))}else throw Error("Unknown type, must be binary type")}}const Gp=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),w_=Kp({name:"sha2-256",code:18,encode:Gp("SHA-256")}),m_=Kp({name:"sha2-512",code:19,encode:Gp("SHA-512")});var v_=Object.freeze({__proto__:null,sha256:w_,sha512:m_});const Wp=0,E_="identity",Zp=Fp;var x_=Object.freeze({__proto__:null,identity:{code:Wp,name:E_,encode:Zp,digest:t=>_u(Wp,Zp(t))}});new TextEncoder,new TextDecoder;const Yp={...y6,...w6,...v6,...x6,...I6,...C6,...L6,...M6,...K6,...J6};({...v_,...x_});function Xp(t,e,n,r){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:n},decoder:{decode:r}}}const Jp=Xp("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Su=Xp("ascii","a",t=>{let e="a";for(let n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return e},t=>{t=t.substring(1);const e=Up(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}),Qp={utf8:Jp,"utf-8":Jp,hex:Yp.base16,latin1:Su,ascii:Su,binary:Su,...Yp};function Ut(t,e="utf8"){const n=Qp[e];if(!n)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Eu(globalThis.Buffer.from(t,"utf-8")):n.decoder.decode(`${n.prefix}${t}`)}function mt(t,e="utf8"){const n=Qp[e];if(!n)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):n.encoder.encode(t).substring(1)}const __={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}},S_="Input must be an string, Buffer or Uint8Array";function I_(t){let e;if(t instanceof Uint8Array)e=t;else if(typeof t=="string")e=new TextEncoder().encode(t);else throw new Error(S_);return e}function O_(t){return Array.prototype.map.call(t,function(e){return(e<16?"0":"")+e.toString(16)}).join("")}function zo(t){return(4294967296+t).toString(16).substring(1)}function A_(t,e,n){let r=`
`+t+" = ";for(let i=0;i<e.length;i+=2){if(n===32)r+=zo(e[i]).toUpperCase(),r+=" ",r+=zo(e[i+1]).toUpperCase();else if(n===64)r+=zo(e[i+1]).toUpperCase(),r+=zo(e[i]).toUpperCase();else throw new Error("Invalid size "+n);i%6===4?r+=`
`+new Array(t.length+4).join(" "):i<e.length-2&&(r+=" ")}console.log(r)}function B_(t,e,n){let r=new Date().getTime();const i=new Uint8Array(e);for(let o=0;o<e;o++)i[o]=o%256;const s=new Date().getTime();console.log("Generated random input in "+(s-r)+"ms"),r=s;for(let o=0;o<n;o++){const a=t(i),c=new Date().getTime(),u=c-r;r=c,console.log("Hashed in "+u+"ms: "+a.substring(0,20)+"..."),console.log(Math.round(e/(1<<20)/(u/1e3)*100)/100+" MB PER SECOND")}}var e0={normalizeInput:I_,toHex:O_,debugPrint:A_,testSpeed:B_};const Vo=e0;function Ho(t,e,n){const r=t[e]+t[n];let i=t[e+1]+t[n+1];r>=4294967296&&i++,t[e]=r,t[e+1]=i}function t0(t,e,n,r){let i=t[e]+n;n<0&&(i+=4294967296);let s=t[e+1]+r;i>=4294967296&&s++,t[e]=i,t[e+1]=s}function n0(t,e){return t[e]^t[e+1]<<8^t[e+2]<<16^t[e+3]<<24}function Jn(t,e,n,r,i,s){const o=as[i],a=as[i+1],c=as[s],u=as[s+1];Ho(te,t,e),t0(te,t,o,a);let l=te[r]^te[t],h=te[r+1]^te[t+1];te[r]=h,te[r+1]=l,Ho(te,n,r),l=te[e]^te[n],h=te[e+1]^te[n+1],te[e]=l>>>24^h<<8,te[e+1]=h>>>24^l<<8,Ho(te,t,e),t0(te,t,c,u),l=te[r]^te[t],h=te[r+1]^te[t+1],te[r]=l>>>16^h<<16,te[r+1]=h>>>16^l<<16,Ho(te,n,r),l=te[e]^te[n],h=te[e+1]^te[n+1],te[e]=h>>>31^l<<1,te[e+1]=l>>>31^h<<1}const r0=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),D_=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3],We=new Uint8Array(D_.map(function(t){return t*2})),te=new Uint32Array(32),as=new Uint32Array(32);function i0(t,e){let n=0;for(n=0;n<16;n++)te[n]=t.h[n],te[n+16]=r0[n];for(te[24]=te[24]^t.t,te[25]=te[25]^t.t/4294967296,e&&(te[28]=~te[28],te[29]=~te[29]),n=0;n<32;n++)as[n]=n0(t.b,4*n);for(n=0;n<12;n++)Jn(0,8,16,24,We[n*16+0],We[n*16+1]),Jn(2,10,18,26,We[n*16+2],We[n*16+3]),Jn(4,12,20,28,We[n*16+4],We[n*16+5]),Jn(6,14,22,30,We[n*16+6],We[n*16+7]),Jn(0,10,20,30,We[n*16+8],We[n*16+9]),Jn(2,12,22,24,We[n*16+10],We[n*16+11]),Jn(4,14,16,26,We[n*16+12],We[n*16+13]),Jn(6,8,18,28,We[n*16+14],We[n*16+15]);for(n=0;n<16;n++)t.h[n]=t.h[n]^te[n]^te[n+16]}const Qn=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function s0(t,e,n,r){if(t===0||t>64)throw new Error("Illegal output length, expected 0 < length <= 64");if(e&&e.length>64)throw new Error("Illegal key, expected Uint8Array with 0 < length <= 64");if(n&&n.length!==16)throw new Error("Illegal salt, expected Uint8Array with length is 16");if(r&&r.length!==16)throw new Error("Illegal personal, expected Uint8Array with length is 16");const i={b:new Uint8Array(128),h:new Uint32Array(16),t:0,c:0,outlen:t};Qn.fill(0),Qn[0]=t,e&&(Qn[1]=e.length),Qn[2]=1,Qn[3]=1,n&&Qn.set(n,32),r&&Qn.set(r,48);for(let s=0;s<16;s++)i.h[s]=r0[s]^n0(Qn,s*4);return e&&(Iu(i,e),i.c=128),i}function Iu(t,e){for(let n=0;n<e.length;n++)t.c===128&&(t.t+=t.c,i0(t,!1),t.c=0),t.b[t.c++]=e[n]}function o0(t){for(t.t+=t.c;t.c<128;)t.b[t.c++]=0;i0(t,!0);const e=new Uint8Array(t.outlen);for(let n=0;n<t.outlen;n++)e[n]=t.h[n>>2]>>8*(n&3);return e}function a0(t,e,n,r,i){n=n||64,t=Vo.normalizeInput(t),r&&(r=Vo.normalizeInput(r)),i&&(i=Vo.normalizeInput(i));const s=s0(n,e,r,i);return Iu(s,t),o0(s)}function $_(t,e,n,r,i){const s=a0(t,e,n,r,i);return Vo.toHex(s)}var T_={blake2b:a0,blake2bHex:$_,blake2bInit:s0,blake2bUpdate:Iu,blake2bFinal:o0};const c0=e0;function P_(t,e){return t[e]^t[e+1]<<8^t[e+2]<<16^t[e+3]<<24}function er(t,e,n,r,i,s){ce[t]=ce[t]+ce[e]+i,ce[r]=Ko(ce[r]^ce[t],16),ce[n]=ce[n]+ce[r],ce[e]=Ko(ce[e]^ce[n],12),ce[t]=ce[t]+ce[e]+s,ce[r]=Ko(ce[r]^ce[t],8),ce[n]=ce[n]+ce[r],ce[e]=Ko(ce[e]^ce[n],7)}function Ko(t,e){return t>>>e^t<<32-e}const u0=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ze=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0]),ce=new Uint32Array(16),qe=new Uint32Array(16);function l0(t,e){let n=0;for(n=0;n<8;n++)ce[n]=t.h[n],ce[n+8]=u0[n];for(ce[12]^=t.t,ce[13]^=t.t/4294967296,e&&(ce[14]=~ce[14]),n=0;n<16;n++)qe[n]=P_(t.b,4*n);for(n=0;n<10;n++)er(0,4,8,12,qe[Ze[n*16+0]],qe[Ze[n*16+1]]),er(1,5,9,13,qe[Ze[n*16+2]],qe[Ze[n*16+3]]),er(2,6,10,14,qe[Ze[n*16+4]],qe[Ze[n*16+5]]),er(3,7,11,15,qe[Ze[n*16+6]],qe[Ze[n*16+7]]),er(0,5,10,15,qe[Ze[n*16+8]],qe[Ze[n*16+9]]),er(1,6,11,12,qe[Ze[n*16+10]],qe[Ze[n*16+11]]),er(2,7,8,13,qe[Ze[n*16+12]],qe[Ze[n*16+13]]),er(3,4,9,14,qe[Ze[n*16+14]],qe[Ze[n*16+15]]);for(n=0;n<8;n++)t.h[n]^=ce[n]^ce[n+8]}function f0(t,e){if(!(t>0&&t<=32))throw new Error("Incorrect output length, should be in [1, 32]");const n=e?e.length:0;if(e&&!(n>0&&n<=32))throw new Error("Incorrect key length, should be in [1, 32]");const r={h:new Uint32Array(u0),b:new Uint8Array(64),c:0,t:0,outlen:t};return r.h[0]^=16842752^n<<8^t,n>0&&(Ou(r,e),r.c=64),r}function Ou(t,e){for(let n=0;n<e.length;n++)t.c===64&&(t.t+=t.c,l0(t,!1),t.c=0),t.b[t.c++]=e[n]}function h0(t){for(t.t+=t.c;t.c<64;)t.b[t.c++]=0;l0(t,!0);const e=new Uint8Array(t.outlen);for(let n=0;n<t.outlen;n++)e[n]=t.h[n>>2]>>8*(n&3)&255;return e}function d0(t,e,n){n=n||32,t=c0.normalizeInput(t);const r=f0(n,e);return Ou(r,t),h0(r)}function R_(t,e,n){const r=d0(t,e,n);return c0.toHex(r)}var N_={blake2s:d0,blake2sHex:R_,blake2sInit:f0,blake2sUpdate:Ou,blake2sFinal:h0};const cs=T_,us=N_;var C_={blake2b:cs.blake2b,blake2bHex:cs.blake2bHex,blake2bInit:cs.blake2bInit,blake2bUpdate:cs.blake2bUpdate,blake2bFinal:cs.blake2bFinal,blake2s:us.blake2s,blake2sHex:us.blake2sHex,blake2sInit:us.blake2sInit,blake2sUpdate:us.blake2sUpdate,blake2sFinal:us.blake2sFinal},U_=Object.defineProperty,F_=Object.defineProperties,L_=Object.getOwnPropertyDescriptors,p0=Object.getOwnPropertySymbols,k_=Object.prototype.hasOwnProperty,q_=Object.prototype.propertyIsEnumerable,g0=(t,e,n)=>e in t?U_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,bi=(t,e)=>{for(var n in e||(e={}))k_.call(e,n)&&g0(t,n,e[n]);if(p0)for(var n of p0(e))q_.call(e,n)&&g0(t,n,e[n]);return t},ls=(t,e)=>F_(t,L_(e));const M_=":";function Go(t){const[e,n]=t.split(M_);return{namespace:e,reference:n}}function y0(t,e){return t.includes(":")?[t]:e.chains||[]}var j_=Object.defineProperty,z_=Object.defineProperties,V_=Object.getOwnPropertyDescriptors,b0=Object.getOwnPropertySymbols,H_=Object.prototype.hasOwnProperty,K_=Object.prototype.propertyIsEnumerable,Au=(t,e,n)=>e in t?j_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,w0=(t,e)=>{for(var n in e||(e={}))H_.call(e,n)&&Au(t,n,e[n]);if(b0)for(var n of b0(e))K_.call(e,n)&&Au(t,n,e[n]);return t},G_=(t,e)=>z_(t,V_(e)),m0=(t,e,n)=>Au(t,typeof e!="symbol"?e+"":e,n);const W_="ReactNative",Bt={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},Z_="js";function Wo(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function tr(){return!Ar()&&!!lc()&&navigator.product===W_}function Y_(){return tr()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function X_(){return tr()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function wi(){return!Wo()&&!!lc()&&!!Ar()}function fs(){return tr()?Bt.reactNative:Wo()?Bt.node:wi()?Bt.browser:Bt.unknown}function v0(){var t;try{return tr()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(t=global.Application)==null?void 0:t.applicationId:void 0}catch{return}}function J_(t,e){const n=new URLSearchParams(t);return Object.entries(e).sort(([r],[i])=>r.localeCompare(i)).forEach(([r,i])=>{i!=null&&n.set(r,String(i))}),n.toString()}function Q_(t){var e,n;const r=E0();try{return t!=null&&t.url&&r.url&&new URL(t.url).host!==new URL(r.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${t.url} differs from the actual page url:${r.url}. This is probably unintended and can lead to issues.`),t.url=r.url),(e=t?.icons)!=null&&e.length&&t.icons.length>0&&(t.icons=t.icons.filter(i=>i!=="")),G_(w0(w0({},r),t),{url:t?.url||r.url,name:t?.name||r.name,description:t?.description||r.description,icons:(n=t?.icons)!=null&&n.length&&t.icons.length>0?t.icons:r.icons})}catch(i){return console.warn("Error populating app metadata",i),t||r}}function E0(){return Ih()||{name:"",description:"",url:"",icons:[""]}}function e4(){if(fs()===Bt.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:n,Version:r}=global.Platform;return[n,r].join("-")}const t=zv();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function t4(){var t;const e=fs();return e===Bt.browser?[e,((t=Sh())==null?void 0:t.host)||"unknown"].join(":"):e}function x0(t,e,n){const r=e4(),i=t4();return[[t,e].join("-"),[Z_,n].join("-"),r,i].join("/")}function n4({protocol:t,version:e,relayUrl:n,sdkVersion:r,auth:i,projectId:s,useOnCloseEvent:o,bundleId:a,packageName:c}){const u=n.split("?"),l=x0(t,e,r),h={auth:i,ua:l,projectId:s,useOnCloseEvent:o||void 0,packageName:c||void 0,bundleId:a||void 0},d=J_(u[1]||"",h);return u[0]+"?"+d}function Cr(t,e){return t.filter(n=>e.includes(n)).length===t.length}function Bu(t){return Object.fromEntries(t.entries())}function Du(t){return new Map(Object.entries(t))}function Ur(t=K.FIVE_MINUTES,e){const n=K.toMiliseconds(t||K.FIVE_MINUTES);let r,i,s,o;return{resolve:a=>{s&&r&&(clearTimeout(s),r(a),o=Promise.resolve(a))},reject:a=>{s&&i&&(clearTimeout(s),i(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);s=setTimeout(()=>{const u=new Error(e);o=Promise.reject(u),c(u)},n),r=a,i=c})}}function sn(t,e,n){return new Promise(async(r,i)=>{const s=setTimeout(()=>i(new Error(n)),e);try{const o=await t;r(o)}catch(o){i(o)}clearTimeout(s)})}function _0(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function r4(t){return _0("topic",t)}function i4(t){return _0("id",t)}function S0(t){const[e,n]=t.split(":"),r={id:void 0,topic:void 0};if(e==="topic"&&typeof n=="string")r.topic=n;else if(e==="id"&&Number.isInteger(Number(n)))r.id=Number(n);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${n}`);return r}function $e(t,e){return K.fromMiliseconds((e||Date.now())+K.toMiliseconds(t))}function nr(t){return Date.now()>=K.toMiliseconds(t)}function fe(t,e){return`${t}${e?`:${e}`:""}`}function Fr(t=[],e=[]){return[...new Set([...t,...e])]}async function s4({id:t,topic:e,wcDeepLink:n}){var r;try{if(!n)return;const i=typeof n=="string"?JSON.parse(n):n,s=i?.href;if(typeof s!="string")return;const o=o4(s,t,e),a=fs();if(a===Bt.browser){if(!((r=Ar())!=null&&r.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}a4(o)}else a===Bt.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(o)}catch(i){console.error(i)}}function o4(t,e,n){const r=`requestId=${e}&sessionTopic=${n}`;t.endsWith("/")&&(t=t.slice(0,-1));let i=`${t}`;if(t.startsWith("https://t.me")){const s=t.includes("?")?"&startapp=":"?startapp=";i=`${i}${s}${f4(r,!0)}`}else i=`${i}/wc?${r}`;return i}function a4(t){let e="_self";l4()?e="_top":(u4()||t.startsWith("https://")||t.startsWith("http://"))&&(e="_blank"),window.open(t,e,"noreferrer noopener")}async function c4(t,e){let n="";try{if(wi()&&(n=localStorage.getItem(e),n))return n;n=await t.getItem(e)}catch(r){console.error(r)}return n}function I0(t,e){if(!t.includes(e))return null;const n=t.split(/([&,?,=])/),r=n.indexOf(e);return n[r+2]}function O0(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function $u(){return typeof process<"u"&&process.env.IS_VITEST==="true"}function u4(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function l4(){try{return window.self!==window.top}catch{return!1}}function f4(t,e=!1){const n=Buffer.from(t).toString("base64");return e?n.replace(/[=]/g,""):n}function A0(t){return Buffer.from(t,"base64").toString("utf-8")}function h4(t){return new Promise(e=>setTimeout(e,t))}class d4{constructor({limit:e}){m0(this,"limit"),m0(this,"set"),this.limit=e,this.set=new Set}add(e){if(!this.set.has(e)){if(this.set.size>=this.limit){const n=this.set.values().next().value;n&&this.set.delete(n)}this.set.add(e)}}has(e){return this.set.has(e)}}const Zo=BigInt(2**32-1),B0=BigInt(32);function D0(t,e=!1){return e?{h:Number(t&Zo),l:Number(t>>B0&Zo)}:{h:Number(t>>B0&Zo)|0,l:Number(t&Zo)|0}}function $0(t,e=!1){const n=t.length;let r=new Uint32Array(n),i=new Uint32Array(n);for(let s=0;s<n;s++){const{h:o,l:a}=D0(t[s],e);[r[s],i[s]]=[o,a]}return[r,i]}const T0=(t,e,n)=>t>>>n,P0=(t,e,n)=>t<<32-n|e>>>n,rr=(t,e,n)=>t>>>n|e<<32-n,ir=(t,e,n)=>t<<32-n|e>>>n,hs=(t,e,n)=>t<<64-n|e>>>n-32,ds=(t,e,n)=>t>>>n-32|e<<64-n,p4=(t,e)=>e,g4=(t,e)=>t,y4=(t,e,n)=>t<<n|e>>>32-n,b4=(t,e,n)=>e<<n|t>>>32-n,w4=(t,e,n)=>e<<n-32|t>>>64-n,m4=(t,e,n)=>t<<n-32|e>>>64-n;function Gt(t,e,n,r){const i=(e>>>0)+(r>>>0);return{h:t+n+(i/2**32|0)|0,l:i|0}}const Tu=(t,e,n)=>(t>>>0)+(e>>>0)+(n>>>0),Pu=(t,e,n,r)=>e+n+r+(t/2**32|0)|0,v4=(t,e,n,r)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0),E4=(t,e,n,r,i)=>e+n+r+i+(t/2**32|0)|0,x4=(t,e,n,r,i)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0)+(i>>>0),_4=(t,e,n,r,i,s)=>e+n+r+i+s+(t/2**32|0)|0,mi=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Yo(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Dn(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Wt(t,...e){if(!Yo(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Xo(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");Dn(t.outputLen),Dn(t.blockLen)}function sr(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Ru(t,e){Wt(t);const n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function ps(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Ft(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function Nu(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function on(t,e){return t<<32-e|t>>>e}const R0=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function N0(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}const $n=R0?t=>t:t=>N0(t);function S4(t){for(let e=0;e<t.length;e++)t[e]=N0(t[e]);return t}const or=R0?t=>t:S4,C0=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",I4=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function vi(t){if(Wt(t),C0)return t.toHex();let e="";for(let n=0;n<t.length;n++)e+=I4[t[n]];return e}const Tn={_0:48,_9:57,A:65,F:70,a:97,f:102};function U0(t){if(t>=Tn._0&&t<=Tn._9)return t-Tn._0;if(t>=Tn.A&&t<=Tn.F)return t-(Tn.A-10);if(t>=Tn.a&&t<=Tn.f)return t-(Tn.a-10)}function Jo(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(C0)return Uint8Array.fromHex(t);const e=t.length,n=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(n);for(let i=0,s=0;i<n;i++,s+=2){const o=U0(t.charCodeAt(s)),a=U0(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}r[i]=o*16+a}return r}function F0(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Zt(t){return typeof t=="string"&&(t=F0(t)),Wt(t),t}function ar(...t){let e=0;for(let r=0;r<t.length;r++){const i=t[r];Wt(i),e+=i.length}const n=new Uint8Array(e);for(let r=0,i=0;r<t.length;r++){const s=t[r];n.set(s,i),i+=s.length}return n}class Qo{}function gs(t){const e=r=>t().update(Zt(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function O4(t){const e=(r,i)=>t(i).update(Zt(r)).digest(),n=t({});return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=r=>t(r),e}function Lr(t=32){if(mi&&typeof mi.getRandomValues=="function")return mi.getRandomValues(new Uint8Array(t));if(mi&&typeof mi.randomBytes=="function")return Uint8Array.from(mi.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}const A4=BigInt(0),ys=BigInt(1),B4=BigInt(2),D4=BigInt(7),$4=BigInt(256),T4=BigInt(113),L0=[],k0=[],q0=[];for(let t=0,e=ys,n=1,r=0;t<24;t++){[n,r]=[r,(2*n+3*r)%5],L0.push(2*(5*r+n)),k0.push((t+1)*(t+2)/2%64);let i=A4;for(let s=0;s<7;s++)e=(e<<ys^(e>>D4)*T4)%$4,e&B4&&(i^=ys<<(ys<<BigInt(s))-ys);q0.push(i)}const M0=$0(q0,!0),P4=M0[0],R4=M0[1],j0=(t,e,n)=>n>32?w4(t,e,n):y4(t,e,n),z0=(t,e,n)=>n>32?m4(t,e,n):b4(t,e,n);function N4(t,e=24){const n=new Uint32Array(10);for(let r=24-e;r<24;r++){for(let o=0;o<10;o++)n[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,u=n[c],l=n[c+1],h=j0(u,l,1)^n[a],d=z0(u,l,1)^n[a+1];for(let f=0;f<50;f+=10)t[o+f]^=h,t[o+f+1]^=d}let i=t[2],s=t[3];for(let o=0;o<24;o++){const a=k0[o],c=j0(i,s,a),u=z0(i,s,a),l=L0[o];i=t[l],s=t[l+1],t[l]=c,t[l+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)n[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~n[(a+2)%10]&n[(a+4)%10]}t[0]^=P4[r],t[1]^=R4[r]}Ft(n)}class Cu extends Qo{constructor(e,n,r,i=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=n,this.outputLen=r,this.enableXOF=i,this.rounds=s,Dn(r),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=ps(this.state)}clone(){return this._cloneInto()}keccak(){or(this.state32),N4(this.state32,this.rounds),or(this.state32),this.posOut=0,this.pos=0}update(e){sr(this),e=Zt(e),Wt(e);const{blockLen:n,state:r}=this,i=e.length;for(let s=0;s<i;){const o=Math.min(n-this.pos,i-s);for(let a=0;a<o;a++)r[this.pos++]^=e[s++];this.pos===n&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:n,pos:r,blockLen:i}=this;e[r]^=n,(n&128)!==0&&r===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){sr(this,!1),Wt(e),this.finish();const n=this.state,{blockLen:r}=this;for(let i=0,s=e.length;i<s;){this.posOut>=r&&this.keccak();const o=Math.min(r-this.posOut,s-i);e.set(n.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Dn(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Ru(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,Ft(this.state)}_cloneInto(e){const{blockLen:n,suffix:r,outputLen:i,rounds:s,enableXOF:o}=this;return e||(e=new Cu(n,r,i,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=r,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}}const C4=(t,e,n)=>gs(()=>new Cu(e,t,n)),U4=C4(1,136,256/8);function F4(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),c=r?4:0,u=r?0:4;t.setUint32(e+c,o,r),t.setUint32(e+u,a,r)}function L4(t,e,n){return t&e^~t&n}function k4(t,e,n){return t&e^t&n^e&n}class V0 extends Qo{constructor(e,n,r,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.buffer=new Uint8Array(e),this.view=Nu(this.buffer)}update(e){sr(this),e=Zt(e),Wt(e);const{view:n,buffer:r,blockLen:i}=this,s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=Nu(e);for(;i<=s-o;o+=i)this.process(c,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){sr(this),Ru(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,Ft(this.buffer.subarray(o)),this.padOffset>i-o&&(this.process(r,0),o=0);for(let h=o;h<i;h++)n[h]=0;F4(r,i-8,BigInt(this.length*8),s),this.process(r,0);const a=Nu(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<u;h++)a.setUint32(4*h,l[h],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=s,e.length=i,e.pos=a,i%n&&e.buffer.set(r),e}clone(){return this._cloneInto()}}const cr=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ye=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),Xe=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),q4=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ur=new Uint32Array(64);class M4 extends V0{constructor(e=32){super(64,e,8,!1),this.A=cr[0]|0,this.B=cr[1]|0,this.C=cr[2]|0,this.D=cr[3]|0,this.E=cr[4]|0,this.F=cr[5]|0,this.G=cr[6]|0,this.H=cr[7]|0}get(){const{A:e,B:n,C:r,D:i,E:s,F:o,G:a,H:c}=this;return[e,n,r,i,s,o,a,c]}set(e,n,r,i,s,o,a,c){this.A=e|0,this.B=n|0,this.C=r|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,n){for(let h=0;h<16;h++,n+=4)ur[h]=e.getUint32(n,!1);for(let h=16;h<64;h++){const d=ur[h-15],f=ur[h-2],p=on(d,7)^on(d,18)^d>>>3,b=on(f,17)^on(f,19)^f>>>10;ur[h]=b+ur[h-7]+p+ur[h-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:c,G:u,H:l}=this;for(let h=0;h<64;h++){const d=on(a,6)^on(a,11)^on(a,25),f=l+d+L4(a,c,u)+q4[h]+ur[h]|0,p=(on(r,2)^on(r,13)^on(r,22))+k4(r,i,s)|0;l=u,u=c,c=a,a=o+f|0,o=s,s=i,i=r,r=f+p|0}r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(r,i,s,o,a,c,u,l)}roundClean(){Ft(ur)}destroy(){this.set(0,0,0,0,0,0,0,0),Ft(this.buffer)}}const H0=$0(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),j4=H0[0],z4=H0[1],lr=new Uint32Array(80),fr=new Uint32Array(80);class Uu extends V0{constructor(e=64){super(128,e,16,!1),this.Ah=Xe[0]|0,this.Al=Xe[1]|0,this.Bh=Xe[2]|0,this.Bl=Xe[3]|0,this.Ch=Xe[4]|0,this.Cl=Xe[5]|0,this.Dh=Xe[6]|0,this.Dl=Xe[7]|0,this.Eh=Xe[8]|0,this.El=Xe[9]|0,this.Fh=Xe[10]|0,this.Fl=Xe[11]|0,this.Gh=Xe[12]|0,this.Gl=Xe[13]|0,this.Hh=Xe[14]|0,this.Hl=Xe[15]|0}get(){const{Ah:e,Al:n,Bh:r,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:u,El:l,Fh:h,Fl:d,Gh:f,Gl:p,Hh:b,Hl:v}=this;return[e,n,r,i,s,o,a,c,u,l,h,d,f,p,b,v]}set(e,n,r,i,s,o,a,c,u,l,h,d,f,p,b,v){this.Ah=e|0,this.Al=n|0,this.Bh=r|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=l|0,this.Fh=h|0,this.Fl=d|0,this.Gh=f|0,this.Gl=p|0,this.Hh=b|0,this.Hl=v|0}process(e,n){for(let _=0;_<16;_++,n+=4)lr[_]=e.getUint32(n),fr[_]=e.getUint32(n+=4);for(let _=16;_<80;_++){const x=lr[_-15]|0,T=fr[_-15]|0,R=rr(x,T,1)^rr(x,T,8)^T0(x,T,7),F=ir(x,T,1)^ir(x,T,8)^P0(x,T,7),U=lr[_-2]|0,$=fr[_-2]|0,z=rr(U,$,19)^hs(U,$,61)^T0(U,$,6),M=ir(U,$,19)^ds(U,$,61)^P0(U,$,6),E=v4(F,M,fr[_-7],fr[_-16]),y=E4(E,R,z,lr[_-7],lr[_-16]);lr[_]=y|0,fr[_]=E|0}let{Ah:r,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:u,Dl:l,Eh:h,El:d,Fh:f,Fl:p,Gh:b,Gl:v,Hh:A,Hl:D}=this;for(let _=0;_<80;_++){const x=rr(h,d,14)^rr(h,d,18)^hs(h,d,41),T=ir(h,d,14)^ir(h,d,18)^ds(h,d,41),R=h&f^~h&b,F=d&p^~d&v,U=x4(D,T,F,z4[_],fr[_]),$=_4(U,A,x,R,j4[_],lr[_]),z=U|0,M=rr(r,i,28)^hs(r,i,34)^hs(r,i,39),E=ir(r,i,28)^ds(r,i,34)^ds(r,i,39),y=r&s^r&a^s&a,m=i&o^i&c^o&c;A=b|0,D=v|0,b=f|0,v=p|0,f=h|0,p=d|0,{h,l:d}=Gt(u|0,l|0,$|0,z|0),u=a|0,l=c|0,a=s|0,c=o|0,s=r|0,o=i|0;const g=Tu(z,E,m);r=Pu(g,$,M,y),i=g|0}({h:r,l:i}=Gt(this.Ah|0,this.Al|0,r|0,i|0)),{h:s,l:o}=Gt(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=Gt(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l}=Gt(this.Dh|0,this.Dl|0,u|0,l|0),{h,l:d}=Gt(this.Eh|0,this.El|0,h|0,d|0),{h:f,l:p}=Gt(this.Fh|0,this.Fl|0,f|0,p|0),{h:b,l:v}=Gt(this.Gh|0,this.Gl|0,b|0,v|0),{h:A,l:D}=Gt(this.Hh|0,this.Hl|0,A|0,D|0),this.set(r,i,s,o,a,c,u,l,h,d,f,p,b,v,A,D)}roundClean(){Ft(lr,fr)}destroy(){Ft(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class V4 extends Uu{constructor(){super(48),this.Ah=Ye[0]|0,this.Al=Ye[1]|0,this.Bh=Ye[2]|0,this.Bl=Ye[3]|0,this.Ch=Ye[4]|0,this.Cl=Ye[5]|0,this.Dh=Ye[6]|0,this.Dl=Ye[7]|0,this.Eh=Ye[8]|0,this.El=Ye[9]|0,this.Fh=Ye[10]|0,this.Fl=Ye[11]|0,this.Gh=Ye[12]|0,this.Gl=Ye[13]|0,this.Hh=Ye[14]|0,this.Hl=Ye[15]|0}}const Je=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class H4 extends Uu{constructor(){super(32),this.Ah=Je[0]|0,this.Al=Je[1]|0,this.Bh=Je[2]|0,this.Bl=Je[3]|0,this.Ch=Je[4]|0,this.Cl=Je[5]|0,this.Dh=Je[6]|0,this.Dl=Je[7]|0,this.Eh=Je[8]|0,this.El=Je[9]|0,this.Fh=Je[10]|0,this.Fl=Je[11]|0,this.Gh=Je[12]|0,this.Gl=Je[13]|0,this.Hh=Je[14]|0,this.Hl=Je[15]|0}}const ea=gs(()=>new M4),K4=gs(()=>new Uu),G4=gs(()=>new V4),W4=gs(()=>new H4),Z4=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),Te=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),Y=new Uint32Array(32);function hr(t,e,n,r,i,s){const o=i[s],a=i[s+1];let c=Y[2*t],u=Y[2*t+1],l=Y[2*e],h=Y[2*e+1],d=Y[2*n],f=Y[2*n+1],p=Y[2*r],b=Y[2*r+1],v=Tu(c,l,o);u=Pu(v,u,h,a),c=v|0,{Dh:b,Dl:p}={Dh:b^u,Dl:p^c},{Dh:b,Dl:p}={Dh:p4(b,p),Dl:g4(b)},{h:f,l:d}=Gt(f,d,b,p),{Bh:h,Bl:l}={Bh:h^f,Bl:l^d},{Bh:h,Bl:l}={Bh:rr(h,l,24),Bl:ir(h,l,24)},Y[2*t]=c,Y[2*t+1]=u,Y[2*e]=l,Y[2*e+1]=h,Y[2*n]=d,Y[2*n+1]=f,Y[2*r]=p,Y[2*r+1]=b}function dr(t,e,n,r,i,s){const o=i[s],a=i[s+1];let c=Y[2*t],u=Y[2*t+1],l=Y[2*e],h=Y[2*e+1],d=Y[2*n],f=Y[2*n+1],p=Y[2*r],b=Y[2*r+1],v=Tu(c,l,o);u=Pu(v,u,h,a),c=v|0,{Dh:b,Dl:p}={Dh:b^u,Dl:p^c},{Dh:b,Dl:p}={Dh:rr(b,p,16),Dl:ir(b,p,16)},{h:f,l:d}=Gt(f,d,b,p),{Bh:h,Bl:l}={Bh:h^f,Bl:l^d},{Bh:h,Bl:l}={Bh:hs(h,l,63),Bl:ds(h,l,63)},Y[2*t]=c,Y[2*t+1]=u,Y[2*e]=l,Y[2*e+1]=h,Y[2*n]=d,Y[2*n+1]=f,Y[2*r]=p,Y[2*r+1]=b}function Y4(t,e={},n,r,i){if(Dn(n),t<0||t>n)throw new Error("outputLen bigger than keyLen");const{key:s,salt:o,personalization:a}=e;if(s!==void 0&&(s.length<1||s.length>n))throw new Error("key length must be undefined or 1.."+n);if(o!==void 0&&o.length!==r)throw new Error("salt must be undefined or "+r);if(a!==void 0&&a.length!==i)throw new Error("personalization must be undefined or "+i)}class X4 extends Qo{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,Dn(e),Dn(n),this.blockLen=e,this.outputLen=n,this.buffer=new Uint8Array(e),this.buffer32=ps(this.buffer)}update(e){sr(this),e=Zt(e),Wt(e);const{blockLen:n,buffer:r,buffer32:i}=this,s=e.length,o=e.byteOffset,a=e.buffer;for(let c=0;c<s;){this.pos===n&&(or(i),this.compress(i,0,!1),or(i),this.pos=0);const u=Math.min(n-this.pos,s-c),l=o+c;if(u===n&&!(l%4)&&c+u<s){const h=new Uint32Array(a,l,Math.floor((s-c)/4));or(h);for(let d=0;c+n<s;d+=i.length,c+=n)this.length+=n,this.compress(h,d,!1);or(h);continue}r.set(e.subarray(c,c+u),this.pos),this.pos+=u,this.length+=u,c+=u}return this}digestInto(e){sr(this),Ru(e,this);const{pos:n,buffer32:r}=this;this.finished=!0,Ft(this.buffer.subarray(n)),or(r),this.compress(r,0,!0),or(r);const i=ps(e);this.get().forEach((s,o)=>i[o]=$n(s))}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){const{buffer:n,length:r,finished:i,destroyed:s,outputLen:o,pos:a}=this;return e||(e=new this.constructor({dkLen:o})),e.set(...this.get()),e.buffer.set(n),e.destroyed=s,e.finished=i,e.length=r,e.pos=a,e.outputLen=o,e}clone(){return this._cloneInto()}}class J4 extends X4{constructor(e={}){const n=e.dkLen===void 0?64:e.dkLen;super(128,n),this.v0l=Te[0]|0,this.v0h=Te[1]|0,this.v1l=Te[2]|0,this.v1h=Te[3]|0,this.v2l=Te[4]|0,this.v2h=Te[5]|0,this.v3l=Te[6]|0,this.v3h=Te[7]|0,this.v4l=Te[8]|0,this.v4h=Te[9]|0,this.v5l=Te[10]|0,this.v5h=Te[11]|0,this.v6l=Te[12]|0,this.v6h=Te[13]|0,this.v7l=Te[14]|0,this.v7h=Te[15]|0,Y4(n,e,64,16,16);let{key:r,personalization:i,salt:s}=e,o=0;if(r!==void 0&&(r=Zt(r),o=r.length),this.v0l^=this.outputLen|o<<8|65536|1<<24,s!==void 0){s=Zt(s);const a=ps(s);this.v4l^=$n(a[0]),this.v4h^=$n(a[1]),this.v5l^=$n(a[2]),this.v5h^=$n(a[3])}if(i!==void 0){i=Zt(i);const a=ps(i);this.v6l^=$n(a[0]),this.v6h^=$n(a[1]),this.v7l^=$n(a[2]),this.v7h^=$n(a[3])}if(r!==void 0){const a=new Uint8Array(this.blockLen);a.set(r),this.update(a)}}get(){let{v0l:e,v0h:n,v1l:r,v1h:i,v2l:s,v2h:o,v3l:a,v3h:c,v4l:u,v4h:l,v5l:h,v5h:d,v6l:f,v6h:p,v7l:b,v7h:v}=this;return[e,n,r,i,s,o,a,c,u,l,h,d,f,p,b,v]}set(e,n,r,i,s,o,a,c,u,l,h,d,f,p,b,v){this.v0l=e|0,this.v0h=n|0,this.v1l=r|0,this.v1h=i|0,this.v2l=s|0,this.v2h=o|0,this.v3l=a|0,this.v3h=c|0,this.v4l=u|0,this.v4h=l|0,this.v5l=h|0,this.v5h=d|0,this.v6l=f|0,this.v6h=p|0,this.v7l=b|0,this.v7h=v|0}compress(e,n,r){this.get().forEach((c,u)=>Y[u]=c),Y.set(Te,16);let{h:i,l:s}=D0(BigInt(this.length));Y[24]=Te[8]^s,Y[25]=Te[9]^i,r&&(Y[28]=~Y[28],Y[29]=~Y[29]);let o=0;const a=Z4;for(let c=0;c<12;c++)hr(0,4,8,12,e,n+2*a[o++]),dr(0,4,8,12,e,n+2*a[o++]),hr(1,5,9,13,e,n+2*a[o++]),dr(1,5,9,13,e,n+2*a[o++]),hr(2,6,10,14,e,n+2*a[o++]),dr(2,6,10,14,e,n+2*a[o++]),hr(3,7,11,15,e,n+2*a[o++]),dr(3,7,11,15,e,n+2*a[o++]),hr(0,5,10,15,e,n+2*a[o++]),dr(0,5,10,15,e,n+2*a[o++]),hr(1,6,11,12,e,n+2*a[o++]),dr(1,6,11,12,e,n+2*a[o++]),hr(2,7,8,13,e,n+2*a[o++]),dr(2,7,8,13,e,n+2*a[o++]),hr(3,4,9,14,e,n+2*a[o++]),dr(3,4,9,14,e,n+2*a[o++]);this.v0l^=Y[0]^Y[16],this.v0h^=Y[1]^Y[17],this.v1l^=Y[2]^Y[18],this.v1h^=Y[3]^Y[19],this.v2l^=Y[4]^Y[20],this.v2h^=Y[5]^Y[21],this.v3l^=Y[6]^Y[22],this.v3h^=Y[7]^Y[23],this.v4l^=Y[8]^Y[24],this.v4h^=Y[9]^Y[25],this.v5l^=Y[10]^Y[26],this.v5h^=Y[11]^Y[27],this.v6l^=Y[12]^Y[28],this.v6h^=Y[13]^Y[29],this.v7l^=Y[14]^Y[30],this.v7h^=Y[15]^Y[31],Ft(Y)}destroy(){this.destroyed=!0,Ft(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const Q4=O4(t=>new J4(t)),e5="https://rpc.walletconnect.org/v1";function K0(t){const e=`Ethereum Signed Message:
${t.length}`,n=new TextEncoder().encode(e+t);return"0x"+Buffer.from(U4(n)).toString("hex")}async function t5(t,e,n,r,i,s){switch(n.t){case"eip191":return await n5(t,e,n.s);case"eip1271":return await r5(t,e,n.s,r,i,s);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${n.t}`)}}function n5(t,e,n){const r=s8(n);return ox({payload:K0(e),signature:r}).toLowerCase()===t.toLowerCase()}async function r5(t,e,n,r,i,s){const o=Go(r);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${r}`);try{const a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",u=n.substring(2),l=(u.length/2).toString(16).padStart(64,"0"),h=(e.startsWith("0x")?e:K0(e)).substring(2),d=a+h+c+l+u,f=await fetch(`${s||e5}/?chainId=${r}&projectId=${i}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:i5(),jsonrpc:"2.0",method:"eth_call",params:[{to:t,data:d},"latest"]})}),{result:p}=await f.json();return p?p.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function i5(){return Date.now()+Math.floor(Math.random()*1e3)}function s5(t){const e=atob(t),n=new Uint8Array(e.length);for(let o=0;o<e.length;o++)n[o]=e.charCodeAt(o);const r=n[0];if(r===0)throw new Error("No signatures found");const i=1+r*64;if(n.length<i)throw new Error("Transaction data too short for claimed signature count");if(n.length<100)throw new Error("Transaction too short");const s=Buffer.from(t,"base64").slice(1,65);return ts.encode(s)}function o5(t){const e=new Uint8Array(Buffer.from(t,"base64")),n=Array.from("TransactionData::").map(s=>s.charCodeAt(0)),r=new Uint8Array(n.length+e.length);r.set(n),r.set(e,n.length);const i=Q4(r,{dkLen:32});return ts.encode(i)}function G0(t){const e=new Uint8Array(ea(a5(t)));return ts.encode(e)}function a5(t){if(t instanceof Uint8Array)return t;if(Array.isArray(t))return new Uint8Array(t);if(typeof t=="object"&&t!=null&&t.data)return new Uint8Array(Object.values(t.data));if(typeof t=="object"&&t)return new Uint8Array(Object.values(t));throw new Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}function W0(t){const e=Buffer.from(t,"base64"),n=r6(e).txn;if(!n)throw new Error("Invalid signed transaction: missing 'txn' field");const r=Zx(n),i=Buffer.from("TX"),s=Buffer.concat([i,Buffer.from(r)]),o=W4(s);return tx.encode(o).replace(/=+$/,"")}function Fu(t){const e=[];let n=BigInt(t);for(;n>=BigInt(128);)e.push(Number(n&BigInt(127)|BigInt(128))),n>>=BigInt(7);return e.push(Number(n)),Buffer.from(e)}function c5(t){const e=Buffer.from(t.signed.bodyBytes,"base64"),n=Buffer.from(t.signed.authInfoBytes,"base64"),r=Buffer.from(t.signature.signature,"base64"),i=[];i.push(Buffer.from([10])),i.push(Fu(e.length)),i.push(e),i.push(Buffer.from([18])),i.push(Fu(n.length)),i.push(n),i.push(Buffer.from([26])),i.push(Fu(r.length)),i.push(r);const s=Buffer.concat(i),o=ea(s);return Buffer.from(o).toString("hex").toUpperCase()}function u5(t){var e,n;const r=[];try{if(typeof t=="string")return r.push(t),r;if(typeof t!="object")return r;t!=null&&t.id&&r.push(t.id);const i=(n=(e=t?.capabilities)==null?void 0:e.caip345)==null?void 0:n.transactionHashes;i&&r.push(...i)}catch(i){console.warn("getWalletSendCallsHashes failed: ",i)}return r}var l5=Object.defineProperty,f5=Object.defineProperties,h5=Object.getOwnPropertyDescriptors,Z0=Object.getOwnPropertySymbols,d5=Object.prototype.hasOwnProperty,p5=Object.prototype.propertyIsEnumerable,Y0=(t,e,n)=>e in t?l5(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,g5=(t,e)=>{for(var n in e||(e={}))d5.call(e,n)&&Y0(t,n,e[n]);if(Z0)for(var n of Z0(e))p5.call(e,n)&&Y0(t,n,e[n]);return t},y5=(t,e)=>f5(t,h5(e));const b5="did:pkh:",Lu=t=>t?.split(":"),w5=t=>{const e=t&&Lu(t);if(e)return t.includes(b5)?e[3]:e[1]},ku=t=>{const e=t&&Lu(t);if(e)return e[2]+":"+e[3]},ta=t=>{const e=t&&Lu(t);if(e)return e.pop()};async function X0(t){const{cacao:e,projectId:n}=t,{s:r,p:i}=e,s=J0(i,i.iss),o=ta(i.iss);return await t5(o,s,r,ku(i.iss),n)}const J0=(t,e)=>{const n=`${t.domain} wants you to sign in with your Ethereum account:`,r=ta(e);if(!t.aud&&!t.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let i=t.statement||void 0;const s=`URI: ${t.aud||t.uri}`,o=`Version: ${t.version}`,a=`Chain ID: ${w5(e)}`,c=`Nonce: ${t.nonce}`,u=`Issued At: ${t.iat}`,l=t.exp?`Expiration Time: ${t.exp}`:void 0,h=t.nbf?`Not Before: ${t.nbf}`:void 0,d=t.requestId?`Request ID: ${t.requestId}`:void 0,f=t.resources?`Resources:${t.resources.map(b=>`
- ${b}`).join("")}`:void 0,p=na(t.resources);if(p){const b=bs(p);i=A5(i,b)}return[n,r,"",i,"",s,o,a,c,u,l,h,d,f].filter(b=>b!=null).join(`
`)};function m5(t){return Buffer.from(JSON.stringify(t)).toString("base64")}function v5(t){return JSON.parse(Buffer.from(t,"base64").toString("utf-8"))}function kr(t){if(!t)throw new Error("No recap provided, value is undefined");if(!t.att)throw new Error("No `att` property found");const e=Object.keys(t.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(n=>{const r=t.att[n];if(Array.isArray(r))throw new Error(`Resource must be an object: ${n}`);if(typeof r!="object")throw new Error(`Resource must be an object: ${n}`);if(!Object.keys(r).length)throw new Error(`Resource object is empty: ${n}`);Object.keys(r).forEach(i=>{const s=r[i];if(!Array.isArray(s))throw new Error(`Ability limits ${i} must be an array of objects, found: ${s}`);if(!s.length)throw new Error(`Value of ${i} is empty array, must be an array with objects`);s.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${i}) must be an array of objects, found: ${o}`)})})})}function E5(t,e,n,r={}){return n?.sort((i,s)=>i.localeCompare(s)),{att:{[t]:x5(e,n,r)}}}function x5(t,e,n={}){e=e?.sort((i,s)=>i.localeCompare(s));const r=e.map(i=>({[`${t}/${i}`]:[n]}));return Object.assign({},...r)}function Q0(t){return kr(t),`urn:recap:${m5(t).replace(/=/g,"")}`}function bs(t){const e=v5(t.replace("urn:recap:",""));return kr(e),e}function _5(t,e,n){const r=E5(t,e,n);return Q0(r)}function S5(t){return t&&t.includes("urn:recap:")}function I5(t,e){const n=bs(t),r=bs(e),i=O5(n,r);return Q0(i)}function O5(t,e){kr(t),kr(e);const n=Object.keys(t.att).concat(Object.keys(e.att)).sort((i,s)=>i.localeCompare(s)),r={att:{}};return n.forEach(i=>{var s,o;Object.keys(((s=t.att)==null?void 0:s[i])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[i])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,u;r.att[i]=y5(g5({},r.att[i]),{[a]:((c=t.att[i])==null?void 0:c[a])||((u=e.att[i])==null?void 0:u[a])})})}),r}function A5(t="",e){kr(e);const n="I further authorize the stated URI to perform the following actions on my behalf: ";if(t.includes(n))return t;const r=[];let i=0;Object.keys(e.att).forEach(a=>{const c=Object.keys(e.att[a]).map(h=>({ability:h.split("/")[0],action:h.split("/")[1]}));c.sort((h,d)=>h.action.localeCompare(d.action));const u={};c.forEach(h=>{u[h.ability]||(u[h.ability]=[]),u[h.ability].push(h.action)});const l=Object.keys(u).map(h=>(i++,`(${i}) '${h}': '${u[h].join("', '")}' for '${a}'.`));r.push(l.join(", ").replace(".,","."))});const s=r.join(" "),o=`${n}${s}`;return`${t?t+" ":""}${o}`}function eg(t){var e;const n=bs(t);kr(n);const r=(e=n.att)==null?void 0:e.eip155;return r?Object.keys(r).map(i=>i.split("/")[1]):[]}function tg(t){const e=bs(t);kr(e);const n=[];return Object.values(e.att).forEach(r=>{Object.values(r).forEach(i=>{var s;(s=i?.[0])!=null&&s.chains&&n.push(i[0].chains)})}),[...new Set(n.flat())]}function na(t){if(!t)return;const e=t?.[t.length-1];return S5(e)?e:void 0}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */function ng(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function qu(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function Mu(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function vt(t,...e){if(!ng(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function rg(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function B5(t,e){vt(t);const n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function pr(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Ei(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function D5(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}const $5=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function T5(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function ju(t){if(typeof t=="string")t=T5(t);else if(ng(t))t=zu(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function P5(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function R5(t,e){if(t.length!==e.length)return!1;let n=0;for(let r=0;r<t.length;r++)n|=t[r]^e[r];return n===0}const N5=(t,e)=>{function n(r,...i){if(vt(r),!$5)throw new Error("Non little-endian hardware is not yet supported");if(t.nonceLength!==void 0){const u=i[0];if(!u)throw new Error("nonce / iv required");t.varSizeNonce?vt(u):vt(u,t.nonceLength)}const s=t.tagLength;s&&i[1]!==void 0&&vt(i[1]);const o=e(r,...i),a=(u,l)=>{if(l!==void 0){if(u!==2)throw new Error("cipher output not supported");vt(l)}};let c=!1;return{encrypt(u,l){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,vt(u),a(o.encrypt.length,l),o.encrypt(u,l)},decrypt(u,l){if(vt(u),s&&u.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return a(o.decrypt.length,l),o.decrypt(u,l)}}}return Object.assign(n,t),n};function ig(t,e,n=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(n&&!U5(e))throw new Error("invalid output, must be aligned");return e}function sg(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),c=r?4:0,u=r?0:4;t.setUint32(e+c,o,r),t.setUint32(e+u,a,r)}function C5(t,e,n){qu(n);const r=new Uint8Array(16),i=D5(r);return sg(i,0,BigInt(e),n),sg(i,8,BigInt(t),n),r}function U5(t){return t.byteOffset%4===0}function zu(t){return Uint8Array.from(t)}const og=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),F5=og("expand 16-byte k"),L5=og("expand 32-byte k"),k5=pr(F5),q5=pr(L5);function ue(t,e){return t<<e|t>>>32-e}function Vu(t){return t.byteOffset%4===0}const ra=64,M5=16,ag=2**32-1,cg=new Uint32Array;function j5(t,e,n,r,i,s,o,a){const c=i.length,u=new Uint8Array(ra),l=pr(u),h=Vu(i)&&Vu(s),d=h?pr(i):cg,f=h?pr(s):cg;for(let p=0;p<c;o++){if(t(e,n,r,l,o,a),o>=ag)throw new Error("arx: counter overflow");const b=Math.min(ra,c-p);if(h&&b===ra){const v=p/4;if(p%4!==0)throw new Error("arx: invalid block position");for(let A=0,D;A<M5;A++)D=v+A,f[D]=d[D]^l[A];p+=ra;continue}for(let v=0,A;v<b;v++)A=p+v,s[A]=i[A]^u[v];p+=b}}function z5(t,e){const{allowShortKeys:n,extendNonceFn:r,counterLength:i,counterRight:s,rounds:o}=P5({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return Mu(i),Mu(o),qu(s),qu(n),(a,c,u,l,h=0)=>{vt(a),vt(c),vt(u);const d=u.length;if(l===void 0&&(l=new Uint8Array(d)),vt(l),Mu(h),h<0||h>=ag)throw new Error("arx: counter overflow");if(l.length<d)throw new Error(`arx: output (${l.length}) is shorter than data (${d})`);const f=[];let p=a.length,b,v;if(p===32)f.push(b=zu(a)),v=q5;else if(p===16&&n)b=new Uint8Array(32),b.set(a),b.set(a,16),v=k5,f.push(b);else throw new Error(`arx: invalid 32-byte key, got length=${p}`);Vu(c)||f.push(c=zu(c));const A=pr(b);if(r){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(v,A,pr(c.subarray(0,16)),A),c=c.subarray(16)}const D=16-i;if(D!==c.length)throw new Error(`arx: nonce must be ${D} or 16 bytes`);if(D!==12){const x=new Uint8Array(12);x.set(c,s?0:12-c.length),c=x,f.push(c)}const _=pr(c);return j5(t,v,A,_,u,l,h,o),Ei(...f),l}}const Me=(t,e)=>t[e++]&255|(t[e++]&255)<<8;class V5{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=ju(e),vt(e,32);const n=Me(e,0),r=Me(e,2),i=Me(e,4),s=Me(e,6),o=Me(e,8),a=Me(e,10),c=Me(e,12),u=Me(e,14);this.r[0]=n&8191,this.r[1]=(n>>>13|r<<3)&8191,this.r[2]=(r>>>10|i<<6)&7939,this.r[3]=(i>>>7|s<<9)&8191,this.r[4]=(s>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|u<<8)&8191,this.r[9]=u>>>5&127;for(let l=0;l<8;l++)this.pad[l]=Me(e,16+2*l)}process(e,n,r=!1){const i=r?0:2048,{h:s,r:o}=this,a=o[0],c=o[1],u=o[2],l=o[3],h=o[4],d=o[5],f=o[6],p=o[7],b=o[8],v=o[9],A=Me(e,n+0),D=Me(e,n+2),_=Me(e,n+4),x=Me(e,n+6),T=Me(e,n+8),R=Me(e,n+10),F=Me(e,n+12),U=Me(e,n+14);let $=s[0]+(A&8191),z=s[1]+((A>>>13|D<<3)&8191),M=s[2]+((D>>>10|_<<6)&8191),E=s[3]+((_>>>7|x<<9)&8191),y=s[4]+((x>>>4|T<<12)&8191),m=s[5]+(T>>>1&8191),g=s[6]+((T>>>14|R<<2)&8191),w=s[7]+((R>>>11|F<<5)&8191),S=s[8]+((F>>>8|U<<8)&8191),O=s[9]+(U>>>5|i),I=0,B=I+$*a+z*(5*v)+M*(5*b)+E*(5*p)+y*(5*f);I=B>>>13,B&=8191,B+=m*(5*d)+g*(5*h)+w*(5*l)+S*(5*u)+O*(5*c),I+=B>>>13,B&=8191;let P=I+$*c+z*a+M*(5*v)+E*(5*b)+y*(5*p);I=P>>>13,P&=8191,P+=m*(5*f)+g*(5*d)+w*(5*h)+S*(5*l)+O*(5*u),I+=P>>>13,P&=8191;let L=I+$*u+z*c+M*a+E*(5*v)+y*(5*b);I=L>>>13,L&=8191,L+=m*(5*p)+g*(5*f)+w*(5*d)+S*(5*h)+O*(5*l),I+=L>>>13,L&=8191;let C=I+$*l+z*u+M*c+E*a+y*(5*v);I=C>>>13,C&=8191,C+=m*(5*b)+g*(5*p)+w*(5*f)+S*(5*d)+O*(5*h),I+=C>>>13,C&=8191;let k=I+$*h+z*l+M*u+E*c+y*a;I=k>>>13,k&=8191,k+=m*(5*v)+g*(5*b)+w*(5*p)+S*(5*f)+O*(5*d),I+=k>>>13,k&=8191;let N=I+$*d+z*h+M*l+E*u+y*c;I=N>>>13,N&=8191,N+=m*a+g*(5*v)+w*(5*b)+S*(5*p)+O*(5*f),I+=N>>>13,N&=8191;let q=I+$*f+z*d+M*h+E*l+y*u;I=q>>>13,q&=8191,q+=m*c+g*a+w*(5*v)+S*(5*b)+O*(5*p),I+=q>>>13,q&=8191;let j=I+$*p+z*f+M*d+E*h+y*l;I=j>>>13,j&=8191,j+=m*u+g*c+w*a+S*(5*v)+O*(5*b),I+=j>>>13,j&=8191;let W=I+$*b+z*p+M*f+E*d+y*h;I=W>>>13,W&=8191,W+=m*l+g*u+w*c+S*a+O*(5*v),I+=W>>>13,W&=8191;let H=I+$*v+z*b+M*p+E*f+y*d;I=H>>>13,H&=8191,H+=m*h+g*l+w*u+S*c+O*a,I+=H>>>13,H&=8191,I=(I<<2)+I|0,I=I+B|0,B=I&8191,I=I>>>13,P+=I,s[0]=B,s[1]=P,s[2]=L,s[3]=C,s[4]=k,s[5]=N,s[6]=q,s[7]=j,s[8]=W,s[9]=H}finalize(){const{h:e,pad:n}=this,r=new Uint16Array(10);let i=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=i,i=e[a]>>>13,e[a]&=8191;e[0]+=i*5,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,r[0]=e[0]+5,i=r[0]>>>13,r[0]&=8191;for(let a=1;a<10;a++)r[a]=e[a]+i,i=r[a]>>>13,r[a]&=8191;r[9]-=8192;let s=(i^1)-1;for(let a=0;a<10;a++)r[a]&=s;s=~s;for(let a=0;a<10;a++)e[a]=e[a]&s|r[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+n[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+n[a]|0)+(o>>>16)|0,e[a]=o&65535;Ei(r)}update(e){rg(this),e=ju(e),vt(e);const{buffer:n,blockLen:r}=this,i=e.length;for(let s=0;s<i;){const o=Math.min(r-this.pos,i-s);if(o===r){for(;r<=i-s;s+=r)this.process(e,s);continue}n.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===r&&(this.process(n,0,!1),this.pos=0)}return this}destroy(){Ei(this.h,this.r,this.buffer,this.pad)}digestInto(e){rg(this),B5(e,this),this.finished=!0;const{buffer:n,h:r}=this;let{pos:i}=this;if(i){for(n[i++]=1;i<16;i++)n[i]=0;this.process(n,0,!0)}this.finalize();let s=0;for(let o=0;o<8;o++)e[s++]=r[o]>>>0,e[s++]=r[o]>>>8;return e}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}}function H5(t){const e=(r,i)=>t(i).update(ju(r)).digest(),n=t(new Uint8Array(32));return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=r=>t(r),e}const K5=H5(t=>new V5(t));function G5(t,e,n,r,i,s=20){let o=t[0],a=t[1],c=t[2],u=t[3],l=e[0],h=e[1],d=e[2],f=e[3],p=e[4],b=e[5],v=e[6],A=e[7],D=i,_=n[0],x=n[1],T=n[2],R=o,F=a,U=c,$=u,z=l,M=h,E=d,y=f,m=p,g=b,w=v,S=A,O=D,I=_,B=x,P=T;for(let C=0;C<s;C+=2)R=R+z|0,O=ue(O^R,16),m=m+O|0,z=ue(z^m,12),R=R+z|0,O=ue(O^R,8),m=m+O|0,z=ue(z^m,7),F=F+M|0,I=ue(I^F,16),g=g+I|0,M=ue(M^g,12),F=F+M|0,I=ue(I^F,8),g=g+I|0,M=ue(M^g,7),U=U+E|0,B=ue(B^U,16),w=w+B|0,E=ue(E^w,12),U=U+E|0,B=ue(B^U,8),w=w+B|0,E=ue(E^w,7),$=$+y|0,P=ue(P^$,16),S=S+P|0,y=ue(y^S,12),$=$+y|0,P=ue(P^$,8),S=S+P|0,y=ue(y^S,7),R=R+M|0,P=ue(P^R,16),w=w+P|0,M=ue(M^w,12),R=R+M|0,P=ue(P^R,8),w=w+P|0,M=ue(M^w,7),F=F+E|0,O=ue(O^F,16),S=S+O|0,E=ue(E^S,12),F=F+E|0,O=ue(O^F,8),S=S+O|0,E=ue(E^S,7),U=U+y|0,I=ue(I^U,16),m=m+I|0,y=ue(y^m,12),U=U+y|0,I=ue(I^U,8),m=m+I|0,y=ue(y^m,7),$=$+z|0,B=ue(B^$,16),g=g+B|0,z=ue(z^g,12),$=$+z|0,B=ue(B^$,8),g=g+B|0,z=ue(z^g,7);let L=0;r[L++]=o+R|0,r[L++]=a+F|0,r[L++]=c+U|0,r[L++]=u+$|0,r[L++]=l+z|0,r[L++]=h+M|0,r[L++]=d+E|0,r[L++]=f+y|0,r[L++]=p+m|0,r[L++]=b+g|0,r[L++]=v+w|0,r[L++]=A+S|0,r[L++]=D+O|0,r[L++]=_+I|0,r[L++]=x+B|0,r[L++]=T+P|0}const W5=z5(G5,{counterRight:!1,counterLength:4,allowShortKeys:!1}),Z5=new Uint8Array(16),ug=(t,e)=>{t.update(e);const n=e.length%16;n&&t.update(Z5.subarray(n))},Y5=new Uint8Array(32);function lg(t,e,n,r,i){const s=t(e,n,Y5),o=K5.create(s);i&&ug(o,i),ug(o,r);const a=C5(r.length,i?i.length:0,!0);o.update(a);const c=o.digest();return Ei(s,a),c}const X5=t=>(e,n,r)=>({encrypt(i,s){const o=i.length;s=ig(o+16,s,!1),s.set(i);const a=s.subarray(0,-16);t(e,n,a,a,1);const c=lg(t,e,n,a,r);return s.set(c,o),Ei(c),s},decrypt(i,s){s=ig(i.length-16,s,!1);const o=i.subarray(0,-16),a=i.subarray(-16),c=lg(t,e,n,o,r);if(!R5(a,c))throw new Error("invalid tag");return s.set(i.subarray(0,-16)),t(e,n,s,s,1),Ei(c),s}}),fg=N5({blockSize:64,nonceLength:12,tagLength:16},X5(W5));class hg extends Qo{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,Xo(e);const r=Zt(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),Ft(s)}update(e){return sr(this),this.iHash.update(e),this}digestInto(e){sr(this),Wt(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const ia=(t,e,n)=>new hg(t,e).update(n).digest();ia.create=(t,e)=>new hg(t,e);function J5(t,e,n){return Xo(t),n===void 0&&(n=new Uint8Array(t.outputLen)),ia(t,Zt(n),Zt(e))}const Hu=Uint8Array.from([0]),dg=Uint8Array.of();function Q5(t,e,n,r=32){Xo(t),Dn(r);const i=t.outputLen;if(r>255*i)throw new Error("Length should be <= 255*HashLen");const s=Math.ceil(r/i);n===void 0&&(n=dg);const o=new Uint8Array(s*i),a=ia.create(t,e),c=a._cloneInto(),u=new Uint8Array(a.outputLen);for(let l=0;l<s;l++)Hu[0]=l+1,c.update(l===0?dg:u).update(n).update(Hu).digestInto(u),o.set(u,i*l),a._cloneInto(c);return a.destroy(),c.destroy(),Ft(u,Hu),o.slice(0,r)}const eS=(t,e,n,r,i)=>Q5(t,J5(t,e,n),r,i),sa=ea,Ku=BigInt(0),Gu=BigInt(1);function oa(t,e=""){if(typeof t!="boolean"){const n=e&&`"${e}"`;throw new Error(n+"expected boolean, got type="+typeof t)}return t}function qr(t,e,n=""){const r=Yo(t),i=t?.length,s=e!==void 0;if(!r||s&&i!==e){const o=n&&`"${n}" `,a=s?` of length ${e}`:"",c=r?`length=${i}`:`type=${typeof t}`;throw new Error(o+"expected Uint8Array"+a+", got "+c)}return t}function aa(t){const e=t.toString(16);return e.length&1?"0"+e:e}function pg(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Ku:BigInt("0x"+t)}function ca(t){return pg(vi(t))}function ua(t){return Wt(t),pg(vi(Uint8Array.from(t).reverse()))}function Wu(t,e){return Jo(t.toString(16).padStart(e*2,"0"))}function Zu(t,e){return Wu(t,e).reverse()}function Qe(t,e,n){let r;if(typeof e=="string")try{r=Jo(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(Yo(e))r=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=r.length;if(typeof n=="number"&&i!==n)throw new Error(t+" of length "+n+" expected, got "+i);return r}const Yu=t=>typeof t=="bigint"&&Ku<=t;function tS(t,e,n){return Yu(t)&&Yu(e)&&Yu(n)&&e<=t&&t<n}function Xu(t,e,n,r){if(!tS(e,n,r))throw new Error("expected valid "+t+": "+n+" <= n < "+r+", got "+e)}function gg(t){let e;for(e=0;t>Ku;t>>=Gu,e+=1);return e}const ws=t=>(Gu<<BigInt(t))-Gu;function nS(t,e,n){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");const r=d=>new Uint8Array(d),i=d=>Uint8Array.of(d);let s=r(t),o=r(t),a=0;const c=()=>{s.fill(1),o.fill(0),a=0},u=(...d)=>n(o,s,...d),l=(d=r(0))=>{o=u(i(0),d),s=u(),d.length!==0&&(o=u(i(1),d),s=u())},h=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let d=0;const f=[];for(;d<e;){s=u();const p=s.slice();f.push(p),d+=s.length}return ar(...f)};return(d,f)=>{c(),l(d);let p;for(;!(p=f(h()));)l();return c(),p}}function la(t,e,n={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function r(i,s,o){const a=t[i];if(o&&a===void 0)return;const c=typeof a;if(c!==s||a===null)throw new Error(`param "${i}" is invalid: expected ${s}, got ${c}`)}Object.entries(e).forEach(([i,s])=>r(i,s,!1)),Object.entries(n).forEach(([i,s])=>r(i,s,!0))}function yg(t){const e=new WeakMap;return(n,...r)=>{const i=e.get(n);if(i!==void 0)return i;const s=t(n,...r);return e.set(n,s),s}}const Et=BigInt(0),ct=BigInt(1),Mr=BigInt(2),bg=BigInt(3),wg=BigInt(4),mg=BigInt(5),rS=BigInt(7),vg=BigInt(8),iS=BigInt(9),Eg=BigInt(16);function Dt(t,e){const n=t%e;return n>=Et?n:e+n}function Yt(t,e,n){let r=t;for(;e-- >Et;)r*=r,r%=n;return r}function xg(t,e){if(t===Et)throw new Error("invert: expected non-zero number");if(e<=Et)throw new Error("invert: expected positive modulus, got "+e);let n=Dt(t,e),r=e,i=Et,s=ct;for(;n!==Et;){const o=r/n,a=r%n,c=i-s*o;r=n,n=a,i=s,s=c}if(r!==ct)throw new Error("invert: does not exist");return Dt(i,e)}function Ju(t,e,n){if(!t.eql(t.sqr(e),n))throw new Error("Cannot find square root")}function _g(t,e){const n=(t.ORDER+ct)/wg,r=t.pow(e,n);return Ju(t,r,e),r}function sS(t,e){const n=(t.ORDER-mg)/vg,r=t.mul(e,Mr),i=t.pow(r,n),s=t.mul(e,i),o=t.mul(t.mul(s,Mr),i),a=t.mul(s,t.sub(o,t.ONE));return Ju(t,a,e),a}function oS(t){const e=gr(t),n=Sg(t),r=n(e,e.neg(e.ONE)),i=n(e,r),s=n(e,e.neg(r)),o=(t+rS)/Eg;return(a,c)=>{let u=a.pow(c,o),l=a.mul(u,r);const h=a.mul(u,i),d=a.mul(u,s),f=a.eql(a.sqr(l),c),p=a.eql(a.sqr(h),c);u=a.cmov(u,l,f),l=a.cmov(d,h,p);const b=a.eql(a.sqr(l),c),v=a.cmov(u,l,b);return Ju(a,v,c),v}}function Sg(t){if(t<bg)throw new Error("sqrt is not defined for small field");let e=t-ct,n=0;for(;e%Mr===Et;)e/=Mr,n++;let r=Mr;const i=gr(t);for(;Og(i,r)===1;)if(r++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(n===1)return _g;let s=i.pow(r,e);const o=(e+ct)/Mr;return function(a,c){if(a.is0(c))return c;if(Og(a,c)!==1)throw new Error("Cannot find square root");let u=n,l=a.mul(a.ONE,s),h=a.pow(c,e),d=a.pow(c,o);for(;!a.eql(h,a.ONE);){if(a.is0(h))return a.ZERO;let f=1,p=a.sqr(h);for(;!a.eql(p,a.ONE);)if(f++,p=a.sqr(p),f===u)throw new Error("Cannot find square root");const b=ct<<BigInt(u-f-1),v=a.pow(l,b);u=f,l=a.sqr(v),h=a.mul(h,l),d=a.mul(d,v)}return d}}function aS(t){return t%wg===bg?_g:t%vg===mg?sS:t%Eg===iS?oS(t):Sg(t)}const cS=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function uS(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},n=cS.reduce((r,i)=>(r[i]="function",r),e);return la(t,n),t}function lS(t,e,n){if(n<Et)throw new Error("invalid exponent, negatives unsupported");if(n===Et)return t.ONE;if(n===ct)return e;let r=t.ONE,i=e;for(;n>Et;)n&ct&&(r=t.mul(r,i)),i=t.sqr(i),n>>=ct;return r}function Ig(t,e,n=!1){const r=new Array(e.length).fill(n?t.ZERO:void 0),i=e.reduce((o,a,c)=>t.is0(a)?o:(r[c]=o,t.mul(o,a)),t.ONE),s=t.inv(i);return e.reduceRight((o,a,c)=>t.is0(a)?o:(r[c]=t.mul(o,r[c]),t.mul(o,a)),s),r}function Og(t,e){const n=(t.ORDER-ct)/Mr,r=t.pow(e,n),i=t.eql(r,t.ONE),s=t.eql(r,t.ZERO),o=t.eql(r,t.neg(t.ONE));if(!i&&!s&&!o)throw new Error("invalid Legendre symbol result");return i?1:s?0:-1}function Ag(t,e){e!==void 0&&Dn(e);const n=e!==void 0?e:t.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function gr(t,e,n=!1,r={}){if(t<=Et)throw new Error("invalid field: expected ORDER > 0, got "+t);let i,s,o=!1,a;if(typeof e=="object"&&e!=null){if(r.sqrt||n)throw new Error("cannot specify opts in two arguments");const d=e;d.BITS&&(i=d.BITS),d.sqrt&&(s=d.sqrt),typeof d.isLE=="boolean"&&(n=d.isLE),typeof d.modFromBytes=="boolean"&&(o=d.modFromBytes),a=d.allowedLengths}else typeof e=="number"&&(i=e),r.sqrt&&(s=r.sqrt);const{nBitLength:c,nByteLength:u}=Ag(t,i);if(u>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let l;const h=Object.freeze({ORDER:t,isLE:n,BITS:c,BYTES:u,MASK:ws(c),ZERO:Et,ONE:ct,allowedLengths:a,create:d=>Dt(d,t),isValid:d=>{if(typeof d!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof d);return Et<=d&&d<t},is0:d=>d===Et,isValidNot0:d=>!h.is0(d)&&h.isValid(d),isOdd:d=>(d&ct)===ct,neg:d=>Dt(-d,t),eql:(d,f)=>d===f,sqr:d=>Dt(d*d,t),add:(d,f)=>Dt(d+f,t),sub:(d,f)=>Dt(d-f,t),mul:(d,f)=>Dt(d*f,t),pow:(d,f)=>lS(h,d,f),div:(d,f)=>Dt(d*xg(f,t),t),sqrN:d=>d*d,addN:(d,f)=>d+f,subN:(d,f)=>d-f,mulN:(d,f)=>d*f,inv:d=>xg(d,t),sqrt:s||(d=>(l||(l=aS(t)),l(h,d))),toBytes:d=>n?Zu(d,u):Wu(d,u),fromBytes:(d,f=!0)=>{if(a){if(!a.includes(d.length)||d.length>u)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+d.length);const b=new Uint8Array(u);b.set(d,n?0:b.length-d.length),d=b}if(d.length!==u)throw new Error("Field.fromBytes: expected "+u+" bytes, got "+d.length);let p=n?ua(d):ca(d);if(o&&(p=Dt(p,t)),!f&&!h.isValid(p))throw new Error("invalid field element: outside of range 0..ORDER");return p},invertBatch:d=>Ig(h,d),cmov:(d,f,p)=>p?f:d});return Object.freeze(h)}function Bg(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function Dg(t){const e=Bg(t);return e+Math.ceil(e/2)}function fS(t,e,n=!1){const r=t.length,i=Bg(e),s=Dg(e);if(r<16||r<s||r>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+r);const o=n?ua(t):ca(t),a=Dt(o,e-ct)+ct;return n?Zu(a,i):Wu(a,i)}const xi=BigInt(0),jr=BigInt(1);function fa(t,e){const n=e.negate();return t?n:e}function Qu(t,e){const n=Ig(t.Fp,e.map(r=>r.Z));return e.map((r,i)=>t.fromAffine(r.toAffine(n[i])))}function $g(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function el(t,e){$g(t,e);const n=Math.ceil(e/t)+1,r=2**(t-1),i=2**t,s=ws(t),o=BigInt(t);return{windows:n,windowSize:r,mask:s,maxNumber:i,shiftBy:o}}function Tg(t,e,n){const{windowSize:r,mask:i,maxNumber:s,shiftBy:o}=n;let a=Number(t&i),c=t>>o;a>r&&(a-=s,c+=jr);const u=e*r,l=u+Math.abs(a)-1,h=a===0,d=a<0,f=e%2!==0;return{nextN:c,offset:l,isZero:h,isNeg:d,isNegF:f,offsetF:u}}function hS(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((n,r)=>{if(!(n instanceof e))throw new Error("invalid point at index "+r)})}function dS(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((n,r)=>{if(!e.isValid(n))throw new Error("invalid scalar at index "+r)})}const tl=new WeakMap,Pg=new WeakMap;function nl(t){return Pg.get(t)||1}function Rg(t){if(t!==xi)throw new Error("invalid wNAF")}class pS{constructor(e,n){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=n}_unsafeLadder(e,n,r=this.ZERO){let i=e;for(;n>xi;)n&jr&&(r=r.add(i)),i=i.double(),n>>=jr;return r}precomputeWindow(e,n){const{windows:r,windowSize:i}=el(n,this.bits),s=[];let o=e,a=o;for(let c=0;c<r;c++){a=o,s.push(a);for(let u=1;u<i;u++)a=a.add(o),s.push(a);o=a.double()}return s}wNAF(e,n,r){if(!this.Fn.isValid(r))throw new Error("invalid scalar");let i=this.ZERO,s=this.BASE;const o=el(e,this.bits);for(let a=0;a<o.windows;a++){const{nextN:c,offset:u,isZero:l,isNeg:h,isNegF:d,offsetF:f}=Tg(r,a,o);r=c,l?s=s.add(fa(d,n[f])):i=i.add(fa(h,n[u]))}return Rg(r),{p:i,f:s}}wNAFUnsafe(e,n,r,i=this.ZERO){const s=el(e,this.bits);for(let o=0;o<s.windows&&r!==xi;o++){const{nextN:a,offset:c,isZero:u,isNeg:l}=Tg(r,o,s);if(r=a,!u){const h=n[c];i=i.add(l?h.negate():h)}}return Rg(r),i}getPrecomputes(e,n,r){let i=tl.get(n);return i||(i=this.precomputeWindow(n,e),e!==1&&(typeof r=="function"&&(i=r(i)),tl.set(n,i))),i}cached(e,n,r){const i=nl(e);return this.wNAF(i,this.getPrecomputes(i,e,r),n)}unsafe(e,n,r,i){const s=nl(e);return s===1?this._unsafeLadder(e,n,i):this.wNAFUnsafe(s,this.getPrecomputes(s,e,r),n,i)}createCache(e,n){$g(n,this.bits),Pg.set(e,n),tl.delete(e)}hasCache(e){return nl(e)!==1}}function gS(t,e,n,r){let i=e,s=t.ZERO,o=t.ZERO;for(;n>xi||r>xi;)n&jr&&(s=s.add(i)),r&jr&&(o=o.add(i)),i=i.double(),n>>=jr,r>>=jr;return{p1:s,p2:o}}function yS(t,e,n,r){hS(n,t),dS(r,e);const i=n.length,s=r.length;if(i!==s)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=gg(BigInt(i));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const u=ws(c),l=new Array(Number(u)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c;let d=o;for(let f=h;f>=0;f-=c){l.fill(o);for(let b=0;b<s;b++){const v=r[b],A=Number(v>>BigInt(f)&u);l[A]=l[A].add(n[b])}let p=o;for(let b=l.length-1,v=o;b>0;b--)v=v.add(l[b]),p=p.add(v);if(d=d.add(p),f!==0)for(let b=0;b<c;b++)d=d.double()}return d}function Ng(t,e,n){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return uS(e),e}else return gr(t,{isLE:n})}function bS(t,e,n={},r){if(r===void 0&&(r=t==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(const a of["p","n","h"]){const c=e[a];if(!(typeof c=="bigint"&&c>xi))throw new Error(`CURVE.${a} must be positive bigint`)}const i=Ng(e.p,n.Fp,r),s=Ng(e.n,n.Fn,r),o=["Gx","Gy","a",t==="weierstrass"?"b":"d"];for(const a of o)if(!i.isValid(e[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:i,Fn:s}}BigInt(0),BigInt(1),BigInt(2),BigInt(8),F0("HashToScalar-");const ms=BigInt(0),_i=BigInt(1),ha=BigInt(2);function wS(t){return la(t,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze(bi({},t))}function mS(t){const e=wS(t),{P:n,type:r,adjustScalarBytes:i,powPminus2:s,randomBytes:o}=e,a=r==="x25519";if(!a&&r!=="x448")throw new Error("invalid type");const c=o||Lr,u=a?255:448,l=a?32:56,h=BigInt(a?9:5),d=BigInt(a?121665:39081),f=a?ha**BigInt(254):ha**BigInt(447),p=a?BigInt(8)*ha**BigInt(251)-_i:BigInt(4)*ha**BigInt(445)-_i,b=f+p+_i,v=E=>Dt(E,n),A=D(h);function D(E){return Zu(v(E),l)}function _(E){const y=Qe("u coordinate",E,l);return a&&(y[31]&=127),v(ua(y))}function x(E){return ua(i(Qe("scalar",E,l)))}function T(E,y){const m=U(_(y),x(E));if(m===ms)throw new Error("invalid private or public key received");return D(m)}function R(E){return T(E,A)}function F(E,y,m){const g=v(E*(y-m));return y=v(y-g),m=v(m+g),{x_2:y,x_3:m}}function U(E,y){Xu("u",E,ms,n),Xu("scalar",y,f,b);const m=y,g=E;let w=_i,S=ms,O=E,I=_i,B=ms;for(let L=BigInt(u-1);L>=ms;L--){const C=m>>L&_i;B^=C,{x_2:w,x_3:O}=F(B,w,O),{x_2:S,x_3:I}=F(B,S,I),B=C;const k=w+S,N=v(k*k),q=w-S,j=v(q*q),W=N-j,H=O+I,Z=O-I,Q=v(Z*k),ee=v(H*q),se=Q+ee,he=Q-ee;O=v(se*se),I=v(g*v(he*he)),w=v(N*j),S=v(W*(N+v(d*W)))}({x_2:w,x_3:O}=F(B,w,O)),{x_2:S,x_3:I}=F(B,S,I);const P=s(S);return v(w*P)}const $={secretKey:l,publicKey:l,seed:l},z=(E=c(l))=>(Wt(E,$.seed),E);function M(E){const y=z(E);return{secretKey:y,publicKey:R(y)}}return{keygen:M,getSharedSecret:(E,y)=>T(E,y),getPublicKey:E=>R(E),scalarMult:T,scalarMultBase:R,utils:{randomSecretKey:z,randomPrivateKey:z},GuBytes:A.slice(),lengths:$}}const vS=BigInt(1),Cg=BigInt(2),ES=BigInt(3),xS=BigInt(5),_S=BigInt(8),Ug=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),SS={p:Ug,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:_S,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function IS(t){const e=BigInt(10),n=BigInt(20),r=BigInt(40),i=BigInt(80),s=Ug,o=t*t%s*t%s,a=Yt(o,Cg,s)*o%s,c=Yt(a,vS,s)*t%s,u=Yt(c,xS,s)*c%s,l=Yt(u,e,s)*u%s,h=Yt(l,n,s)*l%s,d=Yt(h,r,s)*h%s,f=Yt(d,i,s)*d%s,p=Yt(f,i,s)*d%s,b=Yt(p,e,s)*u%s;return{pow_p_5_8:Yt(b,Cg,s)*t%s,b2:o}}function OS(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const AS=gr(SS.p,{isLE:!0}),rl=(()=>{const t=AS.ORDER;return mS({P:t,type:"x25519",powPminus2:e=>{const{pow_p_5_8:n,b2:r}=IS(e);return Dt(Yt(n,ES,t)*r,t)},adjustScalarBytes:OS})})(),Fg=(t,e)=>(t+(t>=0?e:-e)/Lg)/e;function BS(t,e,n){const[[r,i],[s,o]]=e,a=Fg(o*t,n),c=Fg(-i*t,n);let u=t-a*r-c*s,l=-a*i-c*o;const h=u<Rn,d=l<Rn;h&&(u=-u),d&&(l=-l);const f=ws(Math.ceil(gg(n)/2))+Si;if(u<Rn||u>=f||l<Rn||l>=f)throw new Error("splitScalar (endomorphism): failed, k="+t);return{k1neg:h,k1:u,k2neg:d,k2:l}}function il(t){if(!["compact","recovered","der"].includes(t))throw new Error('Signature format must be "compact", "recovered", or "der"');return t}function sl(t,e){const n={};for(let r of Object.keys(e))n[r]=t[r]===void 0?e[r]:t[r];return oa(n.lowS,"lowS"),oa(n.prehash,"prehash"),n.format!==void 0&&il(n.format),n}class DS extends Error{constructor(e=""){super(e)}}const Pn={Err:DS,_tlv:{encode:(t,e)=>{const{Err:n}=Pn;if(t<0||t>256)throw new n("tlv.encode: wrong tag");if(e.length&1)throw new n("tlv.encode: unpadded data");const r=e.length/2,i=aa(r);if(i.length/2&128)throw new n("tlv.encode: long form length too big");const s=r>127?aa(i.length/2|128):"";return aa(t)+s+i+e},decode(t,e){const{Err:n}=Pn;let r=0;if(t<0||t>256)throw new n("tlv.encode: wrong tag");if(e.length<2||e[r++]!==t)throw new n("tlv.decode: wrong tlv");const i=e[r++],s=!!(i&128);let o=0;if(!s)o=i;else{const c=i&127;if(!c)throw new n("tlv.decode(long): indefinite length not supported");if(c>4)throw new n("tlv.decode(long): byte length is too big");const u=e.subarray(r,r+c);if(u.length!==c)throw new n("tlv.decode: length bytes not complete");if(u[0]===0)throw new n("tlv.decode(long): zero leftmost byte");for(const l of u)o=o<<8|l;if(r+=c,o<128)throw new n("tlv.decode(long): not minimal encoding")}const a=e.subarray(r,r+o);if(a.length!==o)throw new n("tlv.decode: wrong value length");return{v:a,l:e.subarray(r+o)}}},_int:{encode(t){const{Err:e}=Pn;if(t<Rn)throw new e("integer: negative integers are not allowed");let n=aa(t);if(Number.parseInt(n[0],16)&8&&(n="00"+n),n.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return n},decode(t){const{Err:e}=Pn;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return ca(t)}},toSig(t){const{Err:e,_int:n,_tlv:r}=Pn,i=Qe("signature",t),{v:s,l:o}=r.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=r.decode(2,s),{v:u,l}=r.decode(2,c);if(l.length)throw new e("invalid signature: left bytes after parsing");return{r:n.decode(a),s:n.decode(u)}},hexFromSig(t){const{_tlv:e,_int:n}=Pn,r=e.encode(2,n.encode(t.r)),i=e.encode(2,n.encode(t.s)),s=r+i;return e.encode(48,s)}},Rn=BigInt(0),Si=BigInt(1),Lg=BigInt(2),da=BigInt(3),$S=BigInt(4);function Ii(t,e){const{BYTES:n}=t;let r;if(typeof e=="bigint")r=e;else{let i=Qe("private key",e);try{r=t.fromBytes(i)}catch{throw new Error(`invalid private key: expected ui8a of size ${n}, got ${typeof e}`)}}if(!t.isValidNot0(r))throw new Error("invalid private key: out of range [1..N-1]");return r}function TS(t,e={}){const n=bS("weierstrass",t,e),{Fp:r,Fn:i}=n;let s=n.CURVE;const{h:o,n:a}=s;la(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:c}=e;if(c&&(!r.is0(s.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const u=qg(r,i);function l(){if(!r.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function h(E,y,m){const{x:g,y:w}=y.toAffine(),S=r.toBytes(g);if(oa(m,"isCompressed"),m){l();const O=!r.isOdd(w);return ar(kg(O),S)}else return ar(Uint8Array.of(4),S,r.toBytes(w))}function d(E){qr(E,void 0,"Point");const{publicKey:y,publicKeyUncompressed:m}=u,g=E.length,w=E[0],S=E.subarray(1);if(g===y&&(w===2||w===3)){const O=r.fromBytes(S);if(!r.isValid(O))throw new Error("bad point: is not on curve, wrong x");const I=b(O);let B;try{B=r.sqrt(I)}catch(L){const C=L instanceof Error?": "+L.message:"";throw new Error("bad point: is not on curve, sqrt error"+C)}l();const P=r.isOdd(B);return(w&1)===1!==P&&(B=r.neg(B)),{x:O,y:B}}else if(g===m&&w===4){const O=r.BYTES,I=r.fromBytes(S.subarray(0,O)),B=r.fromBytes(S.subarray(O,O*2));if(!v(I,B))throw new Error("bad point: is not on curve");return{x:I,y:B}}else throw new Error(`bad point: got length ${g}, expected compressed=${y} or uncompressed=${m}`)}const f=e.toBytes||h,p=e.fromBytes||d;function b(E){const y=r.sqr(E),m=r.mul(y,E);return r.add(r.add(m,r.mul(E,s.a)),s.b)}function v(E,y){const m=r.sqr(y),g=b(E);return r.eql(m,g)}if(!v(s.Gx,s.Gy))throw new Error("bad curve params: generator point");const A=r.mul(r.pow(s.a,da),$S),D=r.mul(r.sqr(s.b),BigInt(27));if(r.is0(r.add(A,D)))throw new Error("bad curve params: a or b");function _(E,y,m=!1){if(!r.isValid(y)||m&&r.is0(y))throw new Error(`bad point coordinate ${E}`);return y}function x(E){if(!(E instanceof $))throw new Error("ProjectivePoint expected")}function T(E){if(!c||!c.basises)throw new Error("no endo");return BS(E,c.basises,i.ORDER)}const R=yg((E,y)=>{const{X:m,Y:g,Z:w}=E;if(r.eql(w,r.ONE))return{x:m,y:g};const S=E.is0();y==null&&(y=S?r.ONE:r.inv(w));const O=r.mul(m,y),I=r.mul(g,y),B=r.mul(w,y);if(S)return{x:r.ZERO,y:r.ZERO};if(!r.eql(B,r.ONE))throw new Error("invZ was invalid");return{x:O,y:I}}),F=yg(E=>{if(E.is0()){if(e.allowInfinityPoint&&!r.is0(E.Y))return;throw new Error("bad point: ZERO")}const{x:y,y:m}=E.toAffine();if(!r.isValid(y)||!r.isValid(m))throw new Error("bad point: x or y not field elements");if(!v(y,m))throw new Error("bad point: equation left != right");if(!E.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function U(E,y,m,g,w){return m=new $(r.mul(m.X,E),m.Y,m.Z),y=fa(g,y),m=fa(w,m),y.add(m)}class ${constructor(y,m,g){this.X=_("x",y),this.Y=_("y",m,!0),this.Z=_("z",g),Object.freeze(this)}static CURVE(){return s}static fromAffine(y){const{x:m,y:g}=y||{};if(!y||!r.isValid(m)||!r.isValid(g))throw new Error("invalid affine point");if(y instanceof $)throw new Error("projective point not allowed");return r.is0(m)&&r.is0(g)?$.ZERO:new $(m,g,r.ONE)}static fromBytes(y){const m=$.fromAffine(p(qr(y,void 0,"point")));return m.assertValidity(),m}static fromHex(y){return $.fromBytes(Qe("pointHex",y))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(y=8,m=!0){return M.createCache(this,y),m||this.multiply(da),this}assertValidity(){F(this)}hasEvenY(){const{y}=this.toAffine();if(!r.isOdd)throw new Error("Field doesn't support isOdd");return!r.isOdd(y)}equals(y){x(y);const{X:m,Y:g,Z:w}=this,{X:S,Y:O,Z:I}=y,B=r.eql(r.mul(m,I),r.mul(S,w)),P=r.eql(r.mul(g,I),r.mul(O,w));return B&&P}negate(){return new $(this.X,r.neg(this.Y),this.Z)}double(){const{a:y,b:m}=s,g=r.mul(m,da),{X:w,Y:S,Z:O}=this;let I=r.ZERO,B=r.ZERO,P=r.ZERO,L=r.mul(w,w),C=r.mul(S,S),k=r.mul(O,O),N=r.mul(w,S);return N=r.add(N,N),P=r.mul(w,O),P=r.add(P,P),I=r.mul(y,P),B=r.mul(g,k),B=r.add(I,B),I=r.sub(C,B),B=r.add(C,B),B=r.mul(I,B),I=r.mul(N,I),P=r.mul(g,P),k=r.mul(y,k),N=r.sub(L,k),N=r.mul(y,N),N=r.add(N,P),P=r.add(L,L),L=r.add(P,L),L=r.add(L,k),L=r.mul(L,N),B=r.add(B,L),k=r.mul(S,O),k=r.add(k,k),L=r.mul(k,N),I=r.sub(I,L),P=r.mul(k,C),P=r.add(P,P),P=r.add(P,P),new $(I,B,P)}add(y){x(y);const{X:m,Y:g,Z:w}=this,{X:S,Y:O,Z:I}=y;let B=r.ZERO,P=r.ZERO,L=r.ZERO;const C=s.a,k=r.mul(s.b,da);let N=r.mul(m,S),q=r.mul(g,O),j=r.mul(w,I),W=r.add(m,g),H=r.add(S,O);W=r.mul(W,H),H=r.add(N,q),W=r.sub(W,H),H=r.add(m,w);let Z=r.add(S,I);return H=r.mul(H,Z),Z=r.add(N,j),H=r.sub(H,Z),Z=r.add(g,w),B=r.add(O,I),Z=r.mul(Z,B),B=r.add(q,j),Z=r.sub(Z,B),L=r.mul(C,H),B=r.mul(k,j),L=r.add(B,L),B=r.sub(q,L),L=r.add(q,L),P=r.mul(B,L),q=r.add(N,N),q=r.add(q,N),j=r.mul(C,j),H=r.mul(k,H),q=r.add(q,j),j=r.sub(N,j),j=r.mul(C,j),H=r.add(H,j),N=r.mul(q,H),P=r.add(P,N),N=r.mul(Z,H),B=r.mul(W,B),B=r.sub(B,N),N=r.mul(W,q),L=r.mul(Z,L),L=r.add(L,N),new $(B,P,L)}subtract(y){return this.add(y.negate())}is0(){return this.equals($.ZERO)}multiply(y){const{endo:m}=e;if(!i.isValidNot0(y))throw new Error("invalid scalar: out of range");let g,w;const S=O=>M.cached(this,O,I=>Qu($,I));if(m){const{k1neg:O,k1:I,k2neg:B,k2:P}=T(y),{p:L,f:C}=S(I),{p:k,f:N}=S(P);w=C.add(N),g=U(m.beta,L,k,O,B)}else{const{p:O,f:I}=S(y);g=O,w=I}return Qu($,[g,w])[0]}multiplyUnsafe(y){const{endo:m}=e,g=this;if(!i.isValid(y))throw new Error("invalid scalar: out of range");if(y===Rn||g.is0())return $.ZERO;if(y===Si)return g;if(M.hasCache(this))return this.multiply(y);if(m){const{k1neg:w,k1:S,k2neg:O,k2:I}=T(y),{p1:B,p2:P}=gS($,g,S,I);return U(m.beta,B,P,w,O)}else return M.unsafe(g,y)}multiplyAndAddUnsafe(y,m,g){const w=this.multiplyUnsafe(m).add(y.multiplyUnsafe(g));return w.is0()?void 0:w}toAffine(y){return R(this,y)}isTorsionFree(){const{isTorsionFree:y}=e;return o===Si?!0:y?y($,this):M.unsafe(this,a).is0()}clearCofactor(){const{clearCofactor:y}=e;return o===Si?this:y?y($,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes(y=!0){return oa(y,"isCompressed"),this.assertValidity(),f($,this,y)}toHex(y=!0){return vi(this.toBytes(y))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(y=!0){return this.toBytes(y)}_setWindowSize(y){this.precompute(y)}static normalizeZ(y){return Qu($,y)}static msm(y,m){return yS($,i,y,m)}static fromPrivateKey(y){return $.BASE.multiply(Ii(i,y))}}$.BASE=new $(s.Gx,s.Gy,r.ONE),$.ZERO=new $(r.ZERO,r.ONE,r.ZERO),$.Fp=r,$.Fn=i;const z=i.BITS,M=new pS($,e.endo?Math.ceil(z/2):z);return $.BASE.precompute(8),$}function kg(t){return Uint8Array.of(t?2:3)}function qg(t,e){return{secretKey:e.BYTES,publicKey:1+t.BYTES,publicKeyUncompressed:1+2*t.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function PS(t,e={}){const{Fn:n}=t,r=e.randomBytes||Lr,i=Object.assign(qg(t.Fp,n),{seed:Dg(n.ORDER)});function s(d){try{return!!Ii(n,d)}catch{return!1}}function o(d,f){const{publicKey:p,publicKeyUncompressed:b}=i;try{const v=d.length;return f===!0&&v!==p||f===!1&&v!==b?!1:!!t.fromBytes(d)}catch{return!1}}function a(d=r(i.seed)){return fS(qr(d,i.seed,"seed"),n.ORDER)}function c(d,f=!0){return t.BASE.multiply(Ii(n,d)).toBytes(f)}function u(d){const f=a(d);return{secretKey:f,publicKey:c(f)}}function l(d){if(typeof d=="bigint")return!1;if(d instanceof t)return!0;const{secretKey:f,publicKey:p,publicKeyUncompressed:b}=i;if(n.allowedLengths||f===p)return;const v=Qe("key",d).length;return v===p||v===b}function h(d,f,p=!0){if(l(d)===!0)throw new Error("first arg must be private key");if(l(f)===!1)throw new Error("second arg must be public key");const b=Ii(n,d);return t.fromHex(f).multiply(b).toBytes(p)}return Object.freeze({getPublicKey:c,getSharedSecret:h,keygen:u,Point:t,utils:{isValidSecretKey:s,isValidPublicKey:o,randomSecretKey:a,isValidPrivateKey:s,randomPrivateKey:a,normPrivateKeyToScalar:d=>Ii(n,d),precompute(d=8,f=t.BASE){return f.precompute(d,!1)}},lengths:i})}function RS(t,e,n={}){Xo(e),la(n,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const r=n.randomBytes||Lr,i=n.hmac||((m,...g)=>ia(e,m,ar(...g))),{Fp:s,Fn:o}=t,{ORDER:a,BITS:c}=o,{keygen:u,getPublicKey:l,getSharedSecret:h,utils:d,lengths:f}=PS(t,n),p={prehash:!1,lowS:typeof n.lowS=="boolean"?n.lowS:!1,format:void 0,extraEntropy:!1},b="compact";function v(m){const g=a>>Si;return m>g}function A(m,g){if(!o.isValidNot0(g))throw new Error(`invalid signature ${m}: out of range 1..Point.Fn.ORDER`);return g}function D(m,g){il(g);const w=f.signature,S=g==="compact"?w:g==="recovered"?w+1:void 0;return qr(m,S,`${g} signature`)}class _{constructor(g,w,S){this.r=A("r",g),this.s=A("s",w),S!=null&&(this.recovery=S),Object.freeze(this)}static fromBytes(g,w=b){D(g,w);let S;if(w==="der"){const{r:P,s:L}=Pn.toSig(qr(g));return new _(P,L)}w==="recovered"&&(S=g[0],w="compact",g=g.subarray(1));const O=o.BYTES,I=g.subarray(0,O),B=g.subarray(O,O*2);return new _(o.fromBytes(I),o.fromBytes(B),S)}static fromHex(g,w){return this.fromBytes(Jo(g),w)}addRecoveryBit(g){return new _(this.r,this.s,g)}recoverPublicKey(g){const w=s.ORDER,{r:S,s:O,recovery:I}=this;if(I==null||![0,1,2,3].includes(I))throw new Error("recovery id invalid");if(a*Lg<w&&I>1)throw new Error("recovery id is ambiguous for h>1 curve");const B=I===2||I===3?S+a:S;if(!s.isValid(B))throw new Error("recovery id 2 or 3 invalid");const P=s.toBytes(B),L=t.fromBytes(ar(kg((I&1)===0),P)),C=o.inv(B),k=T(Qe("msgHash",g)),N=o.create(-k*C),q=o.create(O*C),j=t.BASE.multiplyUnsafe(N).add(L.multiplyUnsafe(q));if(j.is0())throw new Error("point at infinify");return j.assertValidity(),j}hasHighS(){return v(this.s)}toBytes(g=b){if(il(g),g==="der")return Jo(Pn.hexFromSig(this));const w=o.toBytes(this.r),S=o.toBytes(this.s);if(g==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return ar(Uint8Array.of(this.recovery),w,S)}return ar(w,S)}toHex(g){return vi(this.toBytes(g))}assertValidity(){}static fromCompact(g){return _.fromBytes(Qe("sig",g),"compact")}static fromDER(g){return _.fromBytes(Qe("sig",g),"der")}normalizeS(){return this.hasHighS()?new _(this.r,o.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return vi(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return vi(this.toBytes("compact"))}}const x=n.bits2int||function(m){if(m.length>8192)throw new Error("input is too large");const g=ca(m),w=m.length*8-c;return w>0?g>>BigInt(w):g},T=n.bits2int_modN||function(m){return o.create(x(m))},R=ws(c);function F(m){return Xu("num < 2^"+c,m,Rn,R),o.toBytes(m)}function U(m,g){return qr(m,void 0,"message"),g?qr(e(m),void 0,"prehashed message"):m}function $(m,g,w){if(["recovered","canonical"].some(q=>q in w))throw new Error("sign() legacy options not supported");const{lowS:S,prehash:O,extraEntropy:I}=sl(w,p);m=U(m,O);const B=T(m),P=Ii(o,g),L=[F(P),F(B)];if(I!=null&&I!==!1){const q=I===!0?r(f.secretKey):I;L.push(Qe("extraEntropy",q))}const C=ar(...L),k=B;function N(q){const j=x(q);if(!o.isValidNot0(j))return;const W=o.inv(j),H=t.BASE.multiply(j).toAffine(),Z=o.create(H.x);if(Z===Rn)return;const Q=o.create(W*o.create(k+Z*P));if(Q===Rn)return;let ee=(H.x===Z?0:2)|Number(H.y&Si),se=Q;return S&&v(Q)&&(se=o.neg(Q),ee^=1),new _(Z,se,ee)}return{seed:C,k2sig:N}}function z(m,g,w={}){m=Qe("message",m);const{seed:S,k2sig:O}=$(m,g,w);return nS(e.outputLen,o.BYTES,i)(S,O)}function M(m){let g;const w=typeof m=="string"||Yo(m),S=!w&&m!==null&&typeof m=="object"&&typeof m.r=="bigint"&&typeof m.s=="bigint";if(!w&&!S)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(S)g=new _(m.r,m.s);else if(w){try{g=_.fromBytes(Qe("sig",m),"der")}catch(O){if(!(O instanceof Pn.Err))throw O}if(!g)try{g=_.fromBytes(Qe("sig",m),"compact")}catch{return!1}}return g||!1}function E(m,g,w,S={}){const{lowS:O,prehash:I,format:B}=sl(S,p);if(w=Qe("publicKey",w),g=U(Qe("message",g),I),"strict"in S)throw new Error("options.strict was renamed to lowS");const P=B===void 0?M(m):_.fromBytes(Qe("sig",m),B);if(P===!1)return!1;try{const L=t.fromBytes(w);if(O&&P.hasHighS())return!1;const{r:C,s:k}=P,N=T(g),q=o.inv(k),j=o.create(N*q),W=o.create(C*q),H=t.BASE.multiplyUnsafe(j).add(L.multiplyUnsafe(W));return H.is0()?!1:o.create(H.x)===C}catch{return!1}}function y(m,g,w={}){const{prehash:S}=sl(w,p);return g=U(g,S),_.fromBytes(m,"recovered").recoverPublicKey(g).toBytes()}return Object.freeze({keygen:u,getPublicKey:l,getSharedSecret:h,utils:d,lengths:f,Point:t,sign:z,verify:E,recoverPublicKey:y,Signature:_,hash:e})}function NS(t){const e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},n=t.Fp;let r=t.allowedPrivateKeyLengths?Array.from(new Set(t.allowedPrivateKeyLengths.map(o=>Math.ceil(o/2)))):void 0;const i=gr(e.n,{BITS:t.nBitLength,allowedLengths:r,modFromBytes:t.wrapPrivateKey}),s={Fp:n,Fn:i,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:s}}function CS(t){const{CURVE:e,curveOpts:n}=NS(t),r={hmac:t.hmac,randomBytes:t.randomBytes,lowS:t.lowS,bits2int:t.bits2int,bits2int_modN:t.bits2int_modN};return{CURVE:e,curveOpts:n,hash:t.hash,ecdsaOpts:r}}function US(t,e){const n=e.Point;return Object.assign({},e,{ProjectivePoint:n,CURVE:Object.assign({},t,Ag(n.Fn.ORDER,n.Fn.BITS))})}function FS(t){const{CURVE:e,curveOpts:n,hash:r,ecdsaOpts:i}=CS(t),s=TS(e,n),o=RS(s,r,i);return US(t,o)}function ol(t,e){const n=r=>FS(ls(bi({},t),{hash:r}));return ls(bi({},n(e)),{create:n})}const Mg={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},jg={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},zg={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},LS=gr(Mg.p),kS=gr(jg.p),qS=gr(zg.p),MS=ol(ls(bi({},Mg),{Fp:LS,lowS:!1}),ea);ol(ls(bi({},jg),{Fp:kS,lowS:!1}),G4),ol(ls(bi({},zg),{Fp:qS,lowS:!1,allowedPrivateKeyLengths:[130,131,132]}),K4);const jS=MS,Vg="base10",ut="base16",xt="base64pad",yr="base64url",vs="utf8",Hg=0,Nn=1,Es=2,zS=0,Kg=1,xs=12,al=32;function VS(){const t=rl.utils.randomPrivateKey(),e=rl.getPublicKey(t);return{privateKey:mt(t,ut),publicKey:mt(e,ut)}}function cl(){const t=Lr(al);return mt(t,ut)}function HS(t,e){const n=rl.getSharedSecret(Ut(t,ut),Ut(e,ut)),r=eS(sa,n,void 0,void 0,al);return mt(r,ut)}function pa(t){const e=sa(Ut(t,ut));return mt(e,ut)}function Lt(t){const e=sa(Ut(t,vs));return mt(e,ut)}function Gg(t){return Ut(`${t}`,Vg)}function zr(t){return Number(mt(t,Vg))}function Wg(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function Zg(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),n=(4-e.length%4)%4;return e+"=".repeat(n)}function KS(t){const e=Gg(typeof t.type<"u"?t.type:Hg);if(zr(e)===Nn&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const n=typeof t.senderPublicKey<"u"?Ut(t.senderPublicKey,ut):void 0,r=typeof t.iv<"u"?Ut(t.iv,ut):Lr(xs),i=Ut(t.symKey,ut),s=fg(i,r).encrypt(Ut(t.message,vs)),o=Yg({type:e,sealed:s,iv:r,senderPublicKey:n});return t.encoding===yr?Wg(o):o}function GS(t){const e=Ut(t.symKey,ut),{sealed:n,iv:r}=_s({encoded:t.encoded,encoding:t.encoding}),i=fg(e,r).decrypt(n);if(i===null)throw new Error("Failed to decrypt");return mt(i,vs)}function WS(t,e){const n=Gg(Es),r=Lr(xs),i=Ut(t,vs),s=Yg({type:n,sealed:i,iv:r});return e===yr?Wg(s):s}function ZS(t,e){const{sealed:n}=_s({encoded:t,encoding:e});return mt(n,vs)}function Yg(t){if(zr(t.type)===Es)return mt(ss([t.type,t.sealed]),xt);if(zr(t.type)===Nn){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return mt(ss([t.type,t.senderPublicKey,t.iv,t.sealed]),xt)}return mt(ss([t.type,t.iv,t.sealed]),xt)}function _s(t){const e=(t.encoding||xt)===yr?Zg(t.encoded):t.encoded,n=Ut(e,xt),r=n.slice(zS,Kg),i=Kg;if(zr(r)===Nn){const c=i+al,u=c+xs,l=n.slice(i,c),h=n.slice(c,u),d=n.slice(u);return{type:r,sealed:d,iv:h,senderPublicKey:l}}if(zr(r)===Es){const c=n.slice(i),u=Lr(xs);return{type:r,sealed:c,iv:u}}const s=i+xs,o=n.slice(i,s),a=n.slice(s);return{type:r,sealed:a,iv:o}}function YS(t,e){const n=_s({encoded:t,encoding:e?.encoding});return Xg({type:zr(n.type),senderPublicKey:typeof n.senderPublicKey<"u"?mt(n.senderPublicKey,ut):void 0,receiverPublicKey:e?.receiverPublicKey})}function Xg(t){const e=t?.type||Hg;if(e===Nn){if(typeof t?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof t?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t?.senderPublicKey,receiverPublicKey:t?.receiverPublicKey}}function Jg(t){return t.type===Nn&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}function Qg(t){return t.type===Es}function XS(t){const e=Buffer.from(t.x,"base64"),n=Buffer.from(t.y,"base64");return ss([new Uint8Array([4]),e,n])}function JS(t,e){const[n,r,i]=t.split("."),s=Buffer.from(Zg(i),"base64");if(s.length!==64)throw new Error("Invalid signature length");const o=s.slice(0,32),a=s.slice(32,64),c=`${n}.${r}`,u=sa(c),l=XS(e);if(!jS.verify(ss([o,a]),u,l))throw new Error("Invalid signature");return uc(t).payload}const QS="irn";function ga(t){return t?.relay||{protocol:QS}}function Oi(t){const e=__[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var eI=Object.defineProperty,tI=Object.defineProperties,nI=Object.getOwnPropertyDescriptors,e1=Object.getOwnPropertySymbols,rI=Object.prototype.hasOwnProperty,iI=Object.prototype.propertyIsEnumerable,t1=(t,e,n)=>e in t?eI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,ul=(t,e)=>{for(var n in e||(e={}))rI.call(e,n)&&t1(t,n,e[n]);if(e1)for(var n of e1(e))iI.call(e,n)&&t1(t,n,e[n]);return t},sI=(t,e)=>tI(t,nI(e));function oI(t,e="-"){const n={},r="relay"+e;return Object.keys(t).forEach(i=>{if(i.startsWith(r)){const s=i.replace(r,""),o=t[i];n[s]=o}}),n}function n1(t){if(!t.includes("wc:")){const u=A0(t);u!=null&&u.includes("wc:")&&(t=u)}t=t.includes("wc://")?t.replace("wc://",""):t,t=t.includes("wc:")?t.replace("wc:",""):t;const e=t.indexOf(":"),n=t.indexOf("?")!==-1?t.indexOf("?"):void 0,r=t.substring(0,e),i=t.substring(e+1,n).split("@"),s=typeof n<"u"?t.substring(n):"",o=new URLSearchParams(s),a=Object.fromEntries(o.entries()),c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:r,topic:aI(i[0]),version:parseInt(i[1],10),symKey:a.symKey,relay:oI(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function aI(t){return t.startsWith("//")?t.substring(2):t}function cI(t,e="-"){const n="relay",r={};return Object.keys(t).forEach(i=>{const s=i,o=n+e+s;t[s]&&(r[o]=t[s])}),r}function r1(t){const e=new URLSearchParams,n=ul(ul(sI(ul({},cI(t.relay)),{symKey:t.symKey}),t.expiryTimestamp&&{expiryTimestamp:t.expiryTimestamp.toString()}),t.methods&&{methods:t.methods.join(",")});return Object.entries(n).sort(([r],[i])=>r.localeCompare(i)).forEach(([r,i])=>{i!==void 0&&e.append(r,String(i))}),`${t.protocol}:${t.topic}@${t.version}?${e}`}function ya(t,e,n){return`${t}?wc_ev=${n}&topic=${e}`}var uI=Object.defineProperty,lI=Object.defineProperties,fI=Object.getOwnPropertyDescriptors,i1=Object.getOwnPropertySymbols,hI=Object.prototype.hasOwnProperty,dI=Object.prototype.propertyIsEnumerable,s1=(t,e,n)=>e in t?uI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,pI=(t,e)=>{for(var n in e||(e={}))hI.call(e,n)&&s1(t,n,e[n]);if(i1)for(var n of i1(e))dI.call(e,n)&&s1(t,n,e[n]);return t},gI=(t,e)=>lI(t,fI(e));function Ai(t){const e=[];return t.forEach(n=>{const[r,i]=n.split(":");e.push(`${r}:${i}`)}),e}function yI(t){const e=[];return Object.values(t).forEach(n=>{e.push(...Ai(n.accounts))}),e}function bI(t,e){const n=[];return Object.values(t).forEach(r=>{Ai(r.accounts).includes(e)&&n.push(...r.methods)}),n}function wI(t,e){const n=[];return Object.values(t).forEach(r=>{Ai(r.accounts).includes(e)&&n.push(...r.events)}),n}function o1(t){return t.includes(":")}function mI(t){return o1(t)?t.split(":")[0]:t}function a1(t){var e,n,r;const i={};if(!Ss(t))return i;for(const[s,o]of Object.entries(t)){const a=o1(s)?[s]:o.chains,c=o.methods||[],u=o.events||[],l=mI(s);i[l]=gI(pI({},i[l]),{chains:Fr(a,(e=i[l])==null?void 0:e.chains),methods:Fr(c,(n=i[l])==null?void 0:n.methods),events:Fr(u,(r=i[l])==null?void 0:r.events)})}return i}function vI(t){const e={};return t?.forEach(n=>{var r;const[i,s]=n.split(":");e[i]||(e[i]={accounts:[],chains:[],events:[],methods:[]}),e[i].accounts.push(n),(r=e[i].chains)==null||r.push(`${i}:${s}`)}),e}function c1(t,e){e=e.map(r=>r.replace("did:pkh:",""));const n=vI(e);for(const[r,i]of Object.entries(n))i.methods?i.methods=Fr(i.methods,t):i.methods=t,i.events=["chainChanged","accountsChanged"];return n}function EI(t,e){var n,r,i,s,o,a;const c=a1(t),u=a1(e),l={},h=Object.keys(c).concat(Object.keys(u));for(const d of h)l[d]={chains:Fr((n=c[d])==null?void 0:n.chains,(r=u[d])==null?void 0:r.chains),methods:Fr((i=c[d])==null?void 0:i.methods,(s=u[d])==null?void 0:s.methods),events:Fr((o=c[d])==null?void 0:o.events,(a=u[d])==null?void 0:a.events)};return l}const xI={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},_I={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function G(t,e){const{message:n,code:r}=_I[t];return{message:e?`${n} ${e}`:n,code:r}}function xe(t,e){const{message:n,code:r}=xI[t];return{message:e?`${n} ${e}`:n,code:r}}function Bi(t,e){return Array.isArray(t)?typeof e<"u"&&t.length?t.every(e):!0:!1}function Ss(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function Pe(t){return typeof t>"u"}function Oe(t,e){return e&&Pe(t)?!0:typeof t=="string"&&!!t.trim().length}function ll(t,e){return e&&Pe(t)?!0:typeof t=="number"&&!isNaN(t)}function SI(t,e){const{requiredNamespaces:n}=e,r=Object.keys(t.namespaces),i=Object.keys(n);let s=!0;return Cr(i,r)?(r.forEach(o=>{const{accounts:a,methods:c,events:u}=t.namespaces[o],l=Ai(a),h=n[o];(!Cr(y0(o,h),l)||!Cr(h.methods,c)||!Cr(h.events,u))&&(s=!1)}),s):!1}function ba(t){return Oe(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function II(t){if(Oe(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const n=e[0]+":"+e[1];return!!e[2]&&ba(n)}}return!1}function OI(t){function e(n){try{return typeof new URL(n)<"u"}catch{return!1}}try{if(Oe(t,!1)){if(e(t))return!0;const n=A0(t);return e(n)}}catch{}return!1}function AI(t){var e;return(e=t?.proposer)==null?void 0:e.publicKey}function BI(t){return t?.topic}function DI(t,e){let n=null;return Oe(t?.publicKey,!1)||(n=G("MISSING_OR_INVALID",`${e} controller public key should be a string`)),n}function u1(t){let e=!0;return Bi(t)?t.length&&(e=t.every(n=>Oe(n,!1))):e=!1,e}function $I(t,e,n){let r=null;return Bi(e)&&e.length?e.forEach(i=>{r||ba(i)||(r=xe("UNSUPPORTED_CHAINS",`${n}, chain ${i} should be a string and conform to "namespace:chainId" format`))}):ba(t)||(r=xe("UNSUPPORTED_CHAINS",`${n}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),r}function TI(t,e,n){let r=null;return Object.entries(t).forEach(([i,s])=>{if(r)return;const o=$I(i,y0(i,s),`${e} ${n}`);o&&(r=o)}),r}function PI(t,e){let n=null;return Bi(t)?t.forEach(r=>{n||II(r)||(n=xe("UNSUPPORTED_ACCOUNTS",`${e}, account ${r} should be a string and conform to "namespace:chainId:address" format`))}):n=xe("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),n}function RI(t,e){let n=null;return Object.values(t).forEach(r=>{if(n)return;const i=PI(r?.accounts,`${e} namespace`);i&&(n=i)}),n}function NI(t,e){let n=null;return u1(t?.methods)?u1(t?.events)||(n=xe("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):n=xe("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),n}function l1(t,e){let n=null;return Object.values(t).forEach(r=>{if(n)return;const i=NI(r,`${e}, namespace`);i&&(n=i)}),n}function CI(t,e,n){let r=null;if(t&&Ss(t)){const i=l1(t,e);i&&(r=i);const s=TI(t,e,n);s&&(r=s)}else r=G("MISSING_OR_INVALID",`${e}, ${n} should be an object with data`);return r}function fl(t,e){let n=null;if(t&&Ss(t)){const r=l1(t,e);r&&(n=r);const i=RI(t,e);i&&(n=i)}else n=G("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return n}function f1(t){return Oe(t.protocol,!0)}function UI(t,e){let n=!1;return e&&!t?n=!0:t&&Bi(t)&&t.length&&t.forEach(r=>{n=f1(r)}),n}function FI(t){return typeof t=="number"}function _t(t){return typeof t<"u"&&typeof t!==null}function LI(t){return!(!t||typeof t!="object"||!t.code||!ll(t.code,!1)||!t.message||!Oe(t.message,!1))}function kI(t){return!(Pe(t)||!Oe(t.method,!1))}function qI(t){return!(Pe(t)||Pe(t.result)&&Pe(t.error)||!ll(t.id,!1)||!Oe(t.jsonrpc,!1))}function MI(t){return!(Pe(t)||!Oe(t.name,!1))}function h1(t,e){return!(!ba(e)||!yI(t).includes(e))}function jI(t,e,n){return Oe(n,!1)?bI(t,e).includes(n):!1}function zI(t,e,n){return Oe(n,!1)?wI(t,e).includes(n):!1}function d1(t,e,n){let r=null;const i=VI(t),s=HI(e),o=Object.keys(i),a=Object.keys(s),c=p1(Object.keys(t)),u=p1(Object.keys(e)),l=c.filter(h=>!u.includes(h));return l.length&&(r=G("NON_CONFORMING_NAMESPACES",`${n} namespaces keys don't satisfy requiredNamespaces.
      Required: ${l.toString()}
      Received: ${Object.keys(e).toString()}`)),Cr(o,a)||(r=G("NON_CONFORMING_NAMESPACES",`${n} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(h=>{if(!h.includes(":")||r)return;const d=Ai(e[h].accounts);d.includes(h)||(r=G("NON_CONFORMING_NAMESPACES",`${n} namespaces accounts don't satisfy namespace accounts for ${h}
        Required: ${h}
        Approved: ${d.toString()}`))}),o.forEach(h=>{r||(Cr(i[h].methods,s[h].methods)?Cr(i[h].events,s[h].events)||(r=G("NON_CONFORMING_NAMESPACES",`${n} namespaces events don't satisfy namespace events for ${h}`)):r=G("NON_CONFORMING_NAMESPACES",`${n} namespaces methods don't satisfy namespace methods for ${h}`))}),r}function VI(t){const e={};return Object.keys(t).forEach(n=>{var r;n.includes(":")?e[n]=t[n]:(r=t[n].chains)==null||r.forEach(i=>{e[i]={methods:t[n].methods,events:t[n].events}})}),e}function p1(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function HI(t){const e={};return Object.keys(t).forEach(n=>{if(n.includes(":"))e[n]=t[n];else{const r=Ai(t[n].accounts);r?.forEach(i=>{e[i]={accounts:t[n].accounts.filter(s=>s.includes(`${i}:`)),methods:t[n].methods,events:t[n].events}})}}),e}function KI(t,e){return ll(t,!1)&&t<=e.max&&t>=e.min}function g1(){const t=fs();return new Promise(e=>{switch(t){case Bt.browser:e(GI());break;case Bt.reactNative:e(WI());break;case Bt.node:e(ZI());break;default:e(!0)}})}function GI(){return wi()&&navigator?.onLine}async function WI(){if(tr()&&typeof global<"u"&&global!=null&&global.NetInfo){const t=await(global==null?void 0:global.NetInfo.fetch());return t?.isConnected}return!0}function ZI(){return!0}function YI(t){switch(fs()){case Bt.browser:XI(t);break;case Bt.reactNative:JI(t);break}}function XI(t){!tr()&&wi()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function JI(t){tr()&&typeof global<"u"&&global!=null&&global.NetInfo&&global?.NetInfo.addEventListener(e=>t(e?.isConnected))}function QI(){var t;return wi()&&Ar()?((t=Ar())==null?void 0:t.visibilityState)==="visible":!0}const hl={};class Is{static get(e){return hl[e]}static set(e,n){hl[e]=n}static delete(e){delete hl[e]}}function e9(t){const e=ts.decode(t);if(e.length<33)throw new Error("Too short to contain a public key");return e.slice(1,33)}function t9({publicKey:t,signature:e,payload:n}){var r;const i=dl(n.method),s=128|parseInt(((r=n.version)==null?void 0:r.toString())||"4"),o=i9(n.address),a=n.era==="00"?new Uint8Array([0]):dl(n.era);if(a.length!==1&&a.length!==2)throw new Error("Invalid era length");const c=parseInt(n.nonce,16),u=new Uint8Array([c&255,c>>8&255]),l=BigInt(`0x${r9(n.tip)}`),h=o9(l),d=new Uint8Array([0,...t,o,...e,...a,...u,...h,...i]),f=s9(d.length+1);return new Uint8Array([...f,s,...d])}function n9(t){const e=dl(t),n=C_.blake2b(e,void 0,32);return"0x"+Buffer.from(n).toString("hex")}function dl(t){return new Uint8Array(t.replace(/^0x/,"").match(/.{1,2}/g).map(e=>parseInt(e,16)))}function r9(t){return t.startsWith("0x")?t.slice(2):t}function i9(t){const e=ts.decode(t)[0];return e===42?0:e===60?2:1}function s9(t){if(t<64)return new Uint8Array([t<<2]);if(t<16384){const e=t<<2|1;return new Uint8Array([e&255,e>>8&255])}else if(t<1<<30){const e=t<<2|2;return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}else throw new Error("Compact encoding > 2^30 not supported")}function o9(t){if(t<BigInt(1)<<BigInt(6))return new Uint8Array([Number(t<<BigInt(2))]);if(t<BigInt(1)<<BigInt(14)){const e=t<<BigInt(2)|BigInt(1);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255))])}else if(t<BigInt(1)<<BigInt(30)){const e=t<<BigInt(2)|BigInt(2);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255)),Number(e>>BigInt(16)&BigInt(255)),Number(e>>BigInt(24)&BigInt(255))])}else throw new Error("BigInt compact encoding not supported > 2^30")}function a9(t){const e=Uint8Array.from(Buffer.from(t.signature,"hex")),n=e9(t.transaction.address),r=t9({publicKey:n,signature:e,payload:t.transaction}),i=Buffer.from(r).toString("hex");return n9(i)}const c9="PARSE_ERROR",u9="INVALID_REQUEST",l9="METHOD_NOT_FOUND",f9="INVALID_PARAMS",y1="INTERNAL_ERROR",pl="SERVER_ERROR",h9=[-32700,-32600,-32601,-32602,-32603],Os={[c9]:{code:-32700,message:"Parse error"},[u9]:{code:-32600,message:"Invalid Request"},[l9]:{code:-32601,message:"Method not found"},[f9]:{code:-32602,message:"Invalid params"},[y1]:{code:-32603,message:"Internal error"},[pl]:{code:-32e3,message:"Server error"}},b1=pl;function d9(t){return h9.includes(t)}function w1(t){return Object.keys(Os).includes(t)?Os[t]:Os[b1]}function p9(t){const e=Object.values(Os).find(n=>n.code===t);return e||Os[b1]}function g9(t,e,n){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${n} RPC url at ${e}`):t}var m1={};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var gl=function(t,e){return gl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)r.hasOwnProperty(i)&&(n[i]=r[i])},gl(t,e)};function y9(t,e){gl(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var yl=function(){return yl=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},yl.apply(this,arguments)};function b9(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}function w9(t,e,n,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,n):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,n,s):o(e,n))||s);return i>3&&s&&Object.defineProperty(e,n,s),s}function m9(t,e){return function(n,r){e(n,r,t)}}function v9(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function E9(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(l){try{u(r.next(l))}catch(h){o(h)}}function c(l){try{u(r.throw(l))}catch(h){o(h)}}function u(l){l.done?s(l.value):i(l.value).then(a,c)}u((r=r.apply(t,e||[])).next())})}function x9(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(l){return c([u,l])}}function c(u){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,i=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){n.label=u[1];break}if(u[0]===6&&n.label<s[1]){n.label=s[1],s=u;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(u);break}s[2]&&n.ops.pop(),n.trys.pop();continue}u=e.call(t,n)}catch(l){u=[6,l],i=0}finally{r=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function _9(t,e,n,r){r===void 0&&(r=n),t[r]=e[n]}function S9(t,e){for(var n in t)n!=="default"&&!e.hasOwnProperty(n)&&(e[n]=t[n])}function bl(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function v1(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}function I9(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(v1(arguments[e]));return t}function O9(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)r[i]=s[o];return r}function As(t){return this instanceof As?(this.v=t,this):new As(t)}function A9(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(d){r[d]&&(i[d]=function(f){return new Promise(function(p,b){s.push([d,f,p,b])>1||a(d,f)})})}function a(d,f){try{c(r[d](f))}catch(p){h(s[0][3],p)}}function c(d){d.value instanceof As?Promise.resolve(d.value.v).then(u,l):h(s[0][2],d)}function u(d){a("next",d)}function l(d){a("throw",d)}function h(d,f){d(f),s.shift(),s.length&&a(s[0][0],s[0][1])}}function B9(t){var e,n;return e={},r("next"),r("throw",function(i){throw i}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(i,s){e[i]=t[i]?function(o){return(n=!n)?{value:As(t[i](o)),done:i==="return"}:s?s(o):o}:s}}function D9(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof bl=="function"?bl(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(u){s({value:u,done:a})},o)}}function $9(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function T9(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function P9(t){return t&&t.__esModule?t:{default:t}}function R9(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function N9(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,n),n}var C9=Object.freeze({__proto__:null,__extends:y9,get __assign(){return yl},__rest:b9,__decorate:w9,__param:m9,__metadata:v9,__awaiter:E9,__generator:x9,__createBinding:_9,__exportStar:S9,__values:bl,__read:v1,__spread:I9,__spreadArrays:O9,__await:As,__asyncGenerator:A9,__asyncDelegator:B9,__asyncValues:D9,__makeTemplateObject:$9,__importStar:T9,__importDefault:P9,__classPrivateFieldGet:R9,__classPrivateFieldSet:N9}),U9=jl(C9),Cn={},E1;function F9(){if(E1)return Cn;E1=1,Object.defineProperty(Cn,"__esModule",{value:!0}),Cn.isBrowserCryptoAvailable=Cn.getSubtleCrypto=Cn.getBrowerCrypto=void 0;function t(){return Qt?.crypto||Qt?.msCrypto||{}}Cn.getBrowerCrypto=t;function e(){const r=t();return r.subtle||r.webkitSubtle}Cn.getSubtleCrypto=e;function n(){return!!t()&&!!e()}return Cn.isBrowserCryptoAvailable=n,Cn}var Un={},x1;function L9(){if(x1)return Un;x1=1,Object.defineProperty(Un,"__esModule",{value:!0}),Un.isBrowser=Un.isNode=Un.isReactNative=void 0;function t(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}Un.isReactNative=t;function e(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}Un.isNode=e;function n(){return!t()&&!e()}return Un.isBrowser=n,Un}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=U9;e.__exportStar(F9(),t),e.__exportStar(L9(),t)})(m1);function an(t=3){const e=Date.now()*Math.pow(10,t),n=Math.floor(Math.random()*Math.pow(10,t));return e+n}function br(t=6){return BigInt(an(t))}function Fn(t,e,n){return{id:n||an(),jsonrpc:"2.0",method:t,params:e}}function wa(t,e){return{id:t,jsonrpc:"2.0",result:e}}function wl(t,e,n){return{id:t,jsonrpc:"2.0",error:k9(e,n)}}function k9(t,e){return typeof t>"u"?w1(y1):(typeof t=="string"&&(t=Object.assign(Object.assign({},w1(pl)),{message:t})),typeof e<"u"&&(t.data=e),d9(t.code)&&(t=p9(t.code)),t)}class q9{}class M9 extends q9{constructor(){super()}}class j9 extends M9{constructor(e){super()}}const z9="^wss?:";function V9(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function H9(t,e){const n=V9(t);return typeof n>"u"?!1:new RegExp(e).test(n)}function _1(t){return H9(t,z9)}function K9(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function S1(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function ml(t){return S1(t)&&"method"in t}function ma(t){return S1(t)&&(cn(t)||kt(t))}function cn(t){return"result"in t}function kt(t){return"error"in t}class G9 extends j9{constructor(e){super(e),this.events=new ft.exports.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,n){this.events.on(e,n)}once(e,n){this.events.once(e,n)}off(e,n){this.events.off(e,n)}removeListener(e,n){this.events.removeListener(e,n)}async request(e,n){return this.requestStrict(Fn(e.method,e.params||[],e.id||br().toString()),n)}async requestStrict(e,n){return new Promise(async(r,i)=>{if(!this.connection.connected)try{await this.open()}catch(s){i(s)}this.events.on(`${e.id}`,s=>{kt(s)?i(s.error):r(s.result)});try{await this.connection.send(e,n)}catch(s){i(s)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),ma(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const W9=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),Z9=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",I1=t=>t.split("?")[0],O1=10,Y9=W9();class X9{constructor(e){if(this.url=e,this.events=new ft.exports.EventEmitter,this.registering=!1,!_1(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,n){this.events.on(e,n)}once(e,n){this.events.once(e,n)}off(e,n){this.events.off(e,n)}removeListener(e,n){this.events.removeListener(e,n)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,n)=>{if(typeof this.socket>"u"){n(new Error("Connection already closed"));return}this.socket.onclose=r=>{this.onClose(r),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Sr(e))}catch(n){this.onError(e.id,n)}}register(e=this.url){if(!_1(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const n=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=n||this.events.listenerCount("open")>=n)&&this.events.setMaxListeners(n+1),new Promise((r,i)=>{this.events.once("register_error",s=>{this.resetMaxListeners(),i(s)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return i(new Error("WebSocket connection is missing or invalid"));r(this.socket)})})}return this.url=e,this.registering=!0,new Promise((n,r)=>{const i=m1.isReactNative()?void 0:{rejectUnauthorized:!K9(e)},s=new Y9(e,[],i);Z9()?s.onerror=o=>{const a=o;r(this.emitError(a.error))}:s.on("error",o=>{r(this.emitError(o))}),s.onopen=()=>{this.onOpen(s),n(s)}})}onOpen(e){e.onmessage=n=>this.onPayload(n),e.onclose=n=>this.onClose(n),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const n=typeof e.data=="string"?Yr(e.data):e.data;this.events.emit("payload",n)}onError(e,n){const r=this.parseError(n),i=r.message||r.toString(),s=wl(e,i);this.events.emit("payload",s)}parseError(e,n=this.url){return g9(e,I1(n),"WS")}resetMaxListeners(){this.events.getMaxListeners()>O1&&this.events.setMaxListeners(O1)}emitError(e){const n=this.parseError(new Error(e?.message||`WebSocket connection failed for host: ${I1(this.url)}`));return this.events.emit("register_error",n),n}}var J9=Object.defineProperty,A1=Object.getOwnPropertySymbols,Q9=Object.prototype.hasOwnProperty,e7=Object.prototype.propertyIsEnumerable,B1=(t,e,n)=>e in t?J9(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,lt=(t,e)=>{for(var n in e||(e={}))Q9.call(e,n)&&B1(t,n,e[n]);if(A1)for(var n of A1(e))e7.call(e,n)&&B1(t,n,e[n]);return t};const D1="wc",$1=2,va="core",un=`${D1}@2:${va}:`,t7={name:va,logger:"error"},n7={database:":memory:"},r7="crypto",T1="client_ed25519_seed",i7=K.ONE_DAY,s7="keychain",o7="0.3",a7="messages",c7="0.3",u7=K.SIX_HOURS,l7="publisher",P1="irn",f7="error",R1="wss://relay.walletconnect.org",h7="relayer",Ie={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},d7="_subscription",qt={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},p7=.1,vl="2.21.10",ve={link_mode:"link_mode",relay:"relay"},Ea={inbound:"inbound",outbound:"outbound"},g7="0.3",y7="WALLETCONNECT_CLIENT_ID",N1="WALLETCONNECT_LINK_MODE_APPS",$t={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},b7="subscription",w7="0.3",m7="pairing",v7="0.3",Bs={wc_pairingDelete:{req:{ttl:K.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:K.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:K.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:K.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:K.ONE_DAY,prompt:!1,tag:0},res:{ttl:K.ONE_DAY,prompt:!1,tag:0}}},Vr={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Xt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},E7="history",x7="0.3",_7="expirer",Mt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},S7="0.3",I7="verify-api",O7="https://verify.walletconnect.com",C1="https://verify.walletconnect.org",Ds=C1,A7=`${Ds}/v3`,B7=[O7,C1],D7="echo",$7="https://echo.walletconnect.com",ln={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},Ln={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},wr={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success"},$s={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found"},Hr={authenticated_session_approve_started:"authenticated_session_approve_started",authenticated_session_not_expired:"authenticated_session_not_expired",chains_caip2_compliant:"chains_caip2_compliant",chains_evm_compliant:"chains_evm_compliant",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve",authenticated_session_approve_publish_success:"authenticated_session_approve_publish_success"},Ts={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",missing_session_authenticate_request:"missing_session_authenticate_request",session_authenticate_request_expired:"session_authenticate_request_expired",chains_caip2_compliant_failure:"chains_caip2_compliant_failure",chains_evm_compliant_failure:"chains_evm_compliant_failure",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},T7=.1,P7="event-client",R7=86400,N7="https://pulse.walletconnect.org/batch";function C7(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),o=s.charCodeAt(0);if(n[o]!==255)throw new TypeError(s+" is ambiguous");n[o]=i}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var b=0,v=0,A=0,D=p.length;A!==D&&p[A]===0;)A++,b++;for(var _=(D-A)*l+1>>>0,x=new Uint8Array(_);A!==D;){for(var T=p[A],R=0,F=_-1;(T!==0||R<v)&&F!==-1;F--,R++)T+=256*x[F]>>>0,x[F]=T%a>>>0,T=T/a>>>0;if(T!==0)throw new Error("Non-zero carry");v=R,A++}for(var U=_-v;U!==_&&x[U]===0;)U++;for(var $=c.repeat(b);U<_;++U)$+=t.charAt(x[U]);return $}function d(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var b=0;if(p[b]!==" "){for(var v=0,A=0;p[b]===c;)v++,b++;for(var D=(p.length-b)*u+1>>>0,_=new Uint8Array(D);p[b];){var x=n[p.charCodeAt(b)];if(x===255)return;for(var T=0,R=D-1;(x!==0||T<A)&&R!==-1;R--,T++)x+=a*_[R]>>>0,_[R]=x%256>>>0,x=x/256>>>0;if(x!==0)throw new Error("Non-zero carry");A=T,b++}if(p[b]!==" "){for(var F=D-A;F!==D&&_[F]===0;)F++;for(var U=new Uint8Array(v+(D-F)),$=v;F!==D;)U[$++]=_[F++];return U}}}function f(p){var b=d(p);if(b)return b;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:d,decode:f}}var U7=C7,F7=U7;const U1=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},L7=t=>new TextEncoder().encode(t),k7=t=>new TextDecoder().decode(t);class q7{constructor(e,n,r){this.name=e,this.prefix=n,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class M7{constructor(e,n,r){if(this.name=e,this.prefix=n,n.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=n.codePointAt(0),this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return F1(this,e)}}class j7{constructor(e){this.decoders=e}or(e){return F1(this,e)}decode(e){const n=e[0],r=this.decoders[n];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const F1=(t,e)=>new j7(lt(lt({},t.decoders||{[t.prefix]:t}),e.decoders||{[e.prefix]:e}));class z7{constructor(e,n,r,i){this.name=e,this.prefix=n,this.baseEncode=r,this.baseDecode=i,this.encoder=new q7(e,n,r),this.decoder=new M7(e,n,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const xa=({name:t,prefix:e,encode:n,decode:r})=>new z7(t,e,n,r),Ps=({prefix:t,name:e,alphabet:n})=>{const{encode:r,decode:i}=F7(n,e);return xa({prefix:t,name:e,encode:r,decode:s=>U1(i(s))})},V7=(t,e,n,r)=>{const i={};for(let l=0;l<e.length;++l)i[e[l]]=l;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*n/8|0);let a=0,c=0,u=0;for(let l=0;l<s;++l){const h=i[t[l]];if(h===void 0)throw new SyntaxError(`Non-${r} character`);c=c<<n|h,a+=n,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=n||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},H7=(t,e,n)=>{const r=e[e.length-1]==="=",i=(1<<n)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>n;)o-=n,s+=e[i&a>>o];if(o&&(s+=e[i&a<<n-o]),r)for(;s.length*n&7;)s+="=";return s},je=({name:t,prefix:e,bitsPerChar:n,alphabet:r})=>xa({prefix:e,name:t,encode(i){return H7(i,r,n)},decode(i){return V7(i,r,n,t)}}),K7=xa({prefix:"\0",name:"identity",encode:t=>k7(t),decode:t=>L7(t)});var G7=Object.freeze({__proto__:null,identity:K7});const W7=je({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Z7=Object.freeze({__proto__:null,base2:W7});const Y7=je({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var X7=Object.freeze({__proto__:null,base8:Y7});const J7=Ps({prefix:"9",name:"base10",alphabet:"0123456789"});var Q7=Object.freeze({__proto__:null,base10:J7});const eO=je({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),tO=je({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var nO=Object.freeze({__proto__:null,base16:eO,base16upper:tO});const rO=je({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),iO=je({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),sO=je({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),oO=je({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),aO=je({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),cO=je({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),uO=je({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),lO=je({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),fO=je({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var hO=Object.freeze({__proto__:null,base32:rO,base32upper:iO,base32pad:sO,base32padupper:oO,base32hex:aO,base32hexupper:cO,base32hexpad:uO,base32hexpadupper:lO,base32z:fO});const dO=Ps({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),pO=Ps({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var gO=Object.freeze({__proto__:null,base36:dO,base36upper:pO});const yO=Ps({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),bO=Ps({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var wO=Object.freeze({__proto__:null,base58btc:yO,base58flickr:bO});const mO=je({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),vO=je({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),EO=je({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),xO=je({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var _O=Object.freeze({__proto__:null,base64:mO,base64pad:vO,base64url:EO,base64urlpad:xO});const L1=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),SO=L1.reduce((t,e,n)=>(t[n]=e,t),[]),IO=L1.reduce((t,e,n)=>(t[e.codePointAt(0)]=n,t),[]);function OO(t){return t.reduce((e,n)=>(e+=SO[n],e),"")}function AO(t){const e=[];for(const n of t){const r=IO[n.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${n}`);e.push(r)}return new Uint8Array(e)}const BO=xa({prefix:"\u{1F680}",name:"base256emoji",encode:OO,decode:AO});var DO=Object.freeze({__proto__:null,base256emoji:BO}),$O=q1,k1=128,TO=127,PO=~TO,RO=Math.pow(2,31);function q1(t,e,n){e=e||[],n=n||0;for(var r=n;t>=RO;)e[n++]=t&255|k1,t/=128;for(;t&PO;)e[n++]=t&255|k1,t>>>=7;return e[n]=t|0,q1.bytes=n-r+1,e}var NO=El,CO=128,M1=127;function El(t,r){var n=0,r=r||0,i=0,s=r,o,a=t.length;do{if(s>=a)throw El.bytes=0,new RangeError("Could not decode varint");o=t[s++],n+=i<28?(o&M1)<<i:(o&M1)*Math.pow(2,i),i+=7}while(o>=CO);return El.bytes=s-r,n}var UO=Math.pow(2,7),FO=Math.pow(2,14),LO=Math.pow(2,21),kO=Math.pow(2,28),qO=Math.pow(2,35),MO=Math.pow(2,42),jO=Math.pow(2,49),zO=Math.pow(2,56),VO=Math.pow(2,63),HO=function(t){return t<UO?1:t<FO?2:t<LO?3:t<kO?4:t<qO?5:t<MO?6:t<jO?7:t<zO?8:t<VO?9:10},KO={encode:$O,decode:NO,encodingLength:HO},j1=KO;const z1=(t,e,n=0)=>(j1.encode(t,e,n),e),V1=t=>j1.encodingLength(t),xl=(t,e)=>{const n=e.byteLength,r=V1(t),i=r+V1(n),s=new Uint8Array(i+n);return z1(t,s,0),z1(n,s,r),s.set(e,i),new GO(t,n,e,s)};class GO{constructor(e,n,r,i){this.code=e,this.size=n,this.digest=r,this.bytes=i}}const H1=({name:t,code:e,encode:n})=>new WO(t,e,n);class WO{constructor(e,n,r){this.name=e,this.code=n,this.encode=r}digest(e){if(e instanceof Uint8Array){const n=this.encode(e);return n instanceof Uint8Array?xl(this.code,n):n.then(r=>xl(this.code,r))}else throw Error("Unknown type, must be binary type")}}const K1=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),ZO=H1({name:"sha2-256",code:18,encode:K1("SHA-256")}),YO=H1({name:"sha2-512",code:19,encode:K1("SHA-512")});var XO=Object.freeze({__proto__:null,sha256:ZO,sha512:YO});const G1=0,JO="identity",W1=U1;var QO=Object.freeze({__proto__:null,identity:{code:G1,name:JO,encode:W1,digest:t=>xl(G1,W1(t))}});new TextEncoder,new TextDecoder;const Z1=lt(lt(lt(lt(lt(lt(lt(lt(lt(lt({},G7),Z7),X7),Q7),nO),hO),gO),wO),_O),DO);lt(lt({},XO),QO);function Y1(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function eA(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Y1(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function X1(t,e,n,r){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:n},decoder:{decode:r}}}const J1=X1("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),_l=X1("ascii","a",t=>{let e="a";for(let n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return e},t=>{t=t.substring(1);const e=eA(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}),tA=lt({utf8:J1,"utf-8":J1,hex:Z1.base16,latin1:_l,ascii:_l,binary:_l},Z1);function nA(t,e="utf8"){const n=tA[e];if(!n)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Y1(globalThis.Buffer.from(t,"utf-8")):n.decoder.decode(`${n.prefix}${t}`)}var rA=Object.defineProperty,iA=(t,e,n)=>e in t?rA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,fn=(t,e,n)=>iA(t,typeof e!="symbol"?e+"":e,n);class sA{constructor(e,n){this.core=e,this.logger=n,fn(this,"keychain",new Map),fn(this,"name",s7),fn(this,"version",o7),fn(this,"initialized",!1),fn(this,"storagePrefix",un),fn(this,"init",async()=>{if(!this.initialized){const r=await this.getKeyChain();typeof r<"u"&&(this.keychain=r),this.initialized=!0}}),fn(this,"has",r=>(this.isInitialized(),this.keychain.has(r))),fn(this,"set",async(r,i)=>{this.isInitialized(),this.keychain.set(r,i),await this.persist()}),fn(this,"get",r=>{this.isInitialized();const i=this.keychain.get(r);if(typeof i>"u"){const{message:s}=G("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(s)}return i}),fn(this,"del",async r=>{this.isInitialized(),this.keychain.delete(r),await this.persist()}),this.core=e,this.logger=nt(n,this.name)}get context(){return dt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,Bu(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Du(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}}var oA=Object.defineProperty,aA=(t,e,n)=>e in t?oA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,ze=(t,e,n)=>aA(t,typeof e!="symbol"?e+"":e,n);class cA{constructor(e,n,r){this.core=e,this.logger=n,ze(this,"name",r7),ze(this,"keychain"),ze(this,"randomSessionIdentifier",cl()),ze(this,"initialized",!1),ze(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),ze(this,"hasKeys",i=>(this.isInitialized(),this.keychain.has(i))),ze(this,"getClientId",async()=>{this.isInitialized();const i=await this.getClientSeed(),s=mh(i);return wh(s.publicKey)}),ze(this,"generateKeyPair",()=>{this.isInitialized();const i=VS();return this.setPrivateKey(i.publicKey,i.privateKey)}),ze(this,"signJWT",async i=>{this.isInitialized();const s=await this.getClientSeed(),o=mh(s),a=this.randomSessionIdentifier;return await Nv(a,i,i7,o)}),ze(this,"generateSharedKey",(i,s,o)=>{this.isInitialized();const a=this.getPrivateKey(i),c=HS(a,s);return this.setSymKey(c,o)}),ze(this,"setSymKey",async(i,s)=>{this.isInitialized();const o=s||pa(i);return await this.keychain.set(o,i),o}),ze(this,"deleteKeyPair",async i=>{this.isInitialized(),await this.keychain.del(i)}),ze(this,"deleteSymKey",async i=>{this.isInitialized(),await this.keychain.del(i)}),ze(this,"encode",async(i,s,o)=>{this.isInitialized();const a=Xg(o),c=Sr(s);if(Qg(a))return WS(c,o?.encoding);if(Jg(a)){const d=a.senderPublicKey,f=a.receiverPublicKey;i=await this.generateSharedKey(d,f)}const u=this.getSymKey(i),{type:l,senderPublicKey:h}=a;return KS({type:l,symKey:u,message:c,senderPublicKey:h,encoding:o?.encoding})}),ze(this,"decode",async(i,s,o)=>{this.isInitialized();const a=YS(s,o);if(Qg(a)){const c=ZS(s,o?.encoding);return Yr(c)}if(Jg(a)){const c=a.receiverPublicKey,u=a.senderPublicKey;i=await this.generateSharedKey(c,u)}try{const c=this.getSymKey(i),u=GS({symKey:c,encoded:s,encoding:o?.encoding});return Yr(u)}catch(c){this.logger.error(`Failed to decode message from topic: '${i}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),ze(this,"getPayloadType",(i,s=xt)=>{const o=_s({encoded:i,encoding:s});return zr(o.type)}),ze(this,"getPayloadSenderPublicKey",(i,s=xt)=>{const o=_s({encoded:i,encoding:s});return o.senderPublicKey?mt(o.senderPublicKey,ut):void 0}),this.core=e,this.logger=nt(n,this.name),this.keychain=r||new sA(this.core,this.logger)}get context(){return dt(this.logger)}async setPrivateKey(e,n){return await this.keychain.set(e,n),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(T1)}catch{e=cl(),await this.keychain.set(T1,e)}return nA(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}}var uA=Object.defineProperty,lA=Object.defineProperties,fA=Object.getOwnPropertyDescriptors,Q1=Object.getOwnPropertySymbols,hA=Object.prototype.hasOwnProperty,dA=Object.prototype.propertyIsEnumerable,Sl=(t,e,n)=>e in t?uA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,pA=(t,e)=>{for(var n in e||(e={}))hA.call(e,n)&&Sl(t,n,e[n]);if(Q1)for(var n of Q1(e))dA.call(e,n)&&Sl(t,n,e[n]);return t},gA=(t,e)=>lA(t,fA(e)),Tt=(t,e,n)=>Sl(t,typeof e!="symbol"?e+"":e,n);class yA extends Rw{constructor(e,n){super(e,n),this.logger=e,this.core=n,Tt(this,"messages",new Map),Tt(this,"messagesWithoutClientAck",new Map),Tt(this,"name",a7),Tt(this,"version",c7),Tt(this,"initialized",!1),Tt(this,"storagePrefix",un),Tt(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const r=await this.getRelayerMessages();typeof r<"u"&&(this.messages=r);const i=await this.getRelayerMessagesWithoutClientAck();typeof i<"u"&&(this.messagesWithoutClientAck=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(r){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(r)}finally{this.initialized=!0}}}),Tt(this,"set",async(r,i,s)=>{this.isInitialized();const o=Lt(i);let a=this.messages.get(r);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=i,this.messages.set(r,a),s===Ea.inbound){const c=this.messagesWithoutClientAck.get(r)||{};this.messagesWithoutClientAck.set(r,gA(pA({},c),{[o]:i}))}return await this.persist(),o}),Tt(this,"get",r=>{this.isInitialized();let i=this.messages.get(r);return typeof i>"u"&&(i={}),i}),Tt(this,"getWithoutAck",r=>{this.isInitialized();const i={};for(const s of r){const o=this.messagesWithoutClientAck.get(s)||{};i[s]=Object.values(o)}return i}),Tt(this,"has",(r,i)=>{this.isInitialized();const s=this.get(r),o=Lt(i);return typeof s[o]<"u"}),Tt(this,"ack",async(r,i)=>{this.isInitialized();const s=this.messagesWithoutClientAck.get(r);if(typeof s>"u")return;const o=Lt(i);delete s[o],Object.keys(s).length===0?this.messagesWithoutClientAck.delete(r):this.messagesWithoutClientAck.set(r,s),await this.persist()}),Tt(this,"del",async r=>{this.isInitialized(),this.messages.delete(r),this.messagesWithoutClientAck.delete(r),await this.persist()}),this.logger=nt(e,this.name),this.core=n}get context(){return dt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,Bu(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,Bu(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Du(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?Du(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}}var bA=Object.defineProperty,wA=Object.defineProperties,mA=Object.getOwnPropertyDescriptors,ey=Object.getOwnPropertySymbols,vA=Object.prototype.hasOwnProperty,EA=Object.prototype.propertyIsEnumerable,Il=(t,e,n)=>e in t?bA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Di=(t,e)=>{for(var n in e||(e={}))vA.call(e,n)&&Il(t,n,e[n]);if(ey)for(var n of ey(e))EA.call(e,n)&&Il(t,n,e[n]);return t},ty=(t,e)=>wA(t,mA(e)),jt=(t,e,n)=>Il(t,typeof e!="symbol"?e+"":e,n);class xA extends Nw{constructor(e,n){super(e,n),this.relayer=e,this.logger=n,jt(this,"events",new ft.exports.EventEmitter),jt(this,"name",l7),jt(this,"queue",new Map),jt(this,"publishTimeout",K.toMiliseconds(K.ONE_MINUTE)),jt(this,"initialPublishTimeout",K.toMiliseconds(K.ONE_SECOND*15)),jt(this,"needsTransportRestart",!1),jt(this,"publish",async(r,i,s)=>{var o,a,c,u,l;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:r,message:i,opts:s}});const h=s?.ttl||u7,d=s?.prompt||!1,f=s?.tag||0,p=s?.id||br().toString(),b=Oi(ga().protocol),v={id:p,method:s?.publishMethod||b.publish,params:Di({topic:r,message:i,ttl:h,prompt:d,tag:f,attestation:s?.attestation},s?.tvf)},A=`Failed to publish payload, please try again. id:${p} tag:${f}`;try{Pe((o=v.params)==null?void 0:o.prompt)&&((a=v.params)==null||delete a.prompt),Pe((c=v.params)==null?void 0:c.tag)&&((u=v.params)==null||delete u.tag);const D=new Promise(async _=>{const x=({id:R})=>{var F;((F=v.id)==null?void 0:F.toString())===R.toString()&&(this.removeRequestFromQueue(R),this.relayer.events.removeListener(Ie.publish,x),_())};this.relayer.events.on(Ie.publish,x);const T=sn(new Promise((R,F)=>{this.rpcPublish(v,s).then(R).catch(U=>{this.logger.warn(U,U?.message),F(U)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${p} tag:${f}`);try{await T,this.events.removeListener(Ie.publish,x)}catch(R){this.queue.set(p,{request:v,opts:s,attempt:1}),this.logger.warn(R,R?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:p,topic:r,message:i,opts:s}}),await sn(D,this.publishTimeout,A)}catch(D){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(D),(l=s?.internal)!=null&&l.throwOnFailedPublish)throw D}finally{this.queue.delete(p)}}),jt(this,"publishCustom",async r=>{var i,s,o,a,c;this.logger.debug("Publishing custom payload"),this.logger.trace({type:"method",method:"publishCustom",params:r});const{payload:u,opts:l={}}=r,{attestation:h,tvf:d,publishMethod:f,prompt:p,tag:b,ttl:v=K.FIVE_MINUTES}=l,A=l.id||br().toString(),D=Oi(ga().protocol),_=f||D.publish,x={id:A,method:_,params:Di(ty(Di({},u),{ttl:v,prompt:p,tag:b,attestation:h}),d)},T=`Failed to publish custom payload, please try again. id:${A} tag:${b}`;try{Pe((i=x.params)==null?void 0:i.prompt)&&((s=x.params)==null||delete s.prompt),Pe((o=x.params)==null?void 0:o.tag)&&((a=x.params)==null||delete a.tag);const R=new Promise(async F=>{const U=({id:z})=>{var M;((M=x.id)==null?void 0:M.toString())===z.toString()&&(this.removeRequestFromQueue(z),this.relayer.events.removeListener(Ie.publish,U),F())};this.relayer.events.on(Ie.publish,U);const $=sn(new Promise((z,M)=>{this.rpcPublish(x,l).then(z).catch(E=>{this.logger.warn(E,E?.message),M(E)})}),this.initialPublishTimeout,`Failed initial custom payload publish, retrying.... method:${_} id:${A} tag:${b}`);try{await $,this.events.removeListener(Ie.publish,U)}catch(z){this.queue.set(A,{request:x,opts:l,attempt:1}),this.logger.warn(z,z?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:A,payload:u,opts:l}}),await sn(R,this.publishTimeout,T)}catch(R){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(R),(c=l?.internal)!=null&&c.throwOnFailedPublish)throw R}finally{this.queue.delete(A)}}),jt(this,"on",(r,i)=>{this.events.on(r,i)}),jt(this,"once",(r,i)=>{this.events.once(r,i)}),jt(this,"off",(r,i)=>{this.events.off(r,i)}),jt(this,"removeListener",(r,i)=>{this.events.removeListener(r,i)}),this.relayer=e,this.logger=nt(n,this.name),this.registerEventListeners()}get context(){return dt(this.logger)}async rpcPublish(e,n){this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:e});const r=await this.relayer.request(e);return this.relayer.events.emit(Ie.publish,Di(Di({},e),n)),this.logger.debug("Successfully Published Payload"),r}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,n)=>{var r;const i=e.attempt+1;this.queue.set(n,ty(Di({},e),{attempt:i})),this.logger.warn({},`Publisher: queue->publishing: ${e.request.id}, tag: ${(r=e.request.params)==null?void 0:r.tag}, attempt: ${i}`),await this.rpcPublish(e.request,e.opts),this.logger.warn({},`Publisher: queue->published: ${e.request.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(xr.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Ie.connection_stalled);return}this.checkQueue()}),this.relayer.on(Ie.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}var _A=Object.defineProperty,SA=(t,e,n)=>e in t?_A(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,$i=(t,e,n)=>SA(t,typeof e!="symbol"?e+"":e,n);class IA{constructor(){$i(this,"map",new Map),$i(this,"set",(e,n)=>{const r=this.get(e);this.exists(e,n)||this.map.set(e,[...r,n])}),$i(this,"get",e=>this.map.get(e)||[]),$i(this,"exists",(e,n)=>this.get(e).includes(n)),$i(this,"delete",(e,n)=>{if(typeof n>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const r=this.get(e);if(!this.exists(e,n))return;const i=r.filter(s=>s!==n);if(!i.length){this.map.delete(e);return}this.map.set(e,i)}),$i(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var OA=Object.defineProperty,AA=Object.defineProperties,BA=Object.getOwnPropertyDescriptors,ny=Object.getOwnPropertySymbols,DA=Object.prototype.hasOwnProperty,$A=Object.prototype.propertyIsEnumerable,Ol=(t,e,n)=>e in t?OA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Rs=(t,e)=>{for(var n in e||(e={}))DA.call(e,n)&&Ol(t,n,e[n]);if(ny)for(var n of ny(e))$A.call(e,n)&&Ol(t,n,e[n]);return t},Al=(t,e)=>AA(t,BA(e)),be=(t,e,n)=>Ol(t,typeof e!="symbol"?e+"":e,n);class TA extends Fw{constructor(e,n){super(e,n),this.relayer=e,this.logger=n,be(this,"subscriptions",new Map),be(this,"topicMap",new IA),be(this,"events",new ft.exports.EventEmitter),be(this,"name",b7),be(this,"version",w7),be(this,"pending",new Map),be(this,"cached",[]),be(this,"initialized",!1),be(this,"storagePrefix",un),be(this,"subscribeTimeout",K.toMiliseconds(K.ONE_MINUTE)),be(this,"initialSubscribeTimeout",K.toMiliseconds(K.ONE_SECOND*15)),be(this,"clientId"),be(this,"batchSubscribeTopicsLimit",500),be(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),be(this,"subscribe",async(r,i)=>{var s;this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:r,opts:i}});try{const o=ga(i),a={topic:r,relay:o,transportType:i?.transportType};(s=i?.internal)!=null&&s.skipSubscribe||this.pending.set(r,a);const c=await this.rpcSubscribe(r,o,i);return typeof c=="string"&&(this.onSubscribe(c,a),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:r,opts:i}})),c}catch(o){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(o),o}}),be(this,"unsubscribe",async(r,i)=>{this.isInitialized(),typeof i?.id<"u"?await this.unsubscribeById(r,i.id,i):await this.unsubscribeByTopic(r,i)}),be(this,"isSubscribed",r=>new Promise(i=>{i(this.topicMap.topics.includes(r))})),be(this,"isKnownTopic",r=>new Promise(i=>{i(this.topicMap.topics.includes(r)||this.pending.has(r)||this.cached.some(s=>s.topic===r))})),be(this,"on",(r,i)=>{this.events.on(r,i)}),be(this,"once",(r,i)=>{this.events.once(r,i)}),be(this,"off",(r,i)=>{this.events.off(r,i)}),be(this,"removeListener",(r,i)=>{this.events.removeListener(r,i)}),be(this,"start",async()=>{await this.onConnect()}),be(this,"stop",async()=>{await this.onDisconnect()}),be(this,"restart",async()=>{await this.restore(),await this.onRestart()}),be(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const r=[];this.pending.forEach(i=>{r.push(i)}),await this.batchSubscribe(r)}),be(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(xr.pulse,async()=>{await this.checkPending()}),this.events.on($t.created,async r=>{const i=$t.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),await this.persist()}),this.events.on($t.deleted,async r=>{const i=$t.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),await this.persist()})}),this.relayer=e,this.logger=nt(n,this.name),this.clientId=""}get context(){return dt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,n){let r=!1;try{r=this.getSubscription(e).topic===n}catch{}return r}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,n){const r=this.topicMap.get(e);await Promise.all(r.map(async i=>await this.unsubscribeById(e,i,n)))}async unsubscribeById(e,n,r){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:n,opts:r}});try{const i=ga(r);await this.restartToComplete({topic:e,id:n,relay:i}),await this.rpcUnsubscribe(e,n,i);const s=xe("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,n,s),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:n,opts:r}})}catch(i){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(i),i}}async rpcSubscribe(e,n,r){var i,s;const o=await this.getSubscriptionId(e);if((i=r?.internal)!=null&&i.skipSubscribe)return o;(!r||r?.transportType===ve.relay)&&await this.restartToComplete({topic:e,id:e,relay:n});const a={method:Oi(n.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a});const c=(s=r?.internal)==null?void 0:s.throwOnFailedPublish;try{if(r?.transportType===ve.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(a).catch(h=>this.logger.warn(h))},K.toMiliseconds(K.ONE_SECOND)),o;const u=new Promise(async h=>{const d=f=>{f.topic===e&&(this.events.removeListener($t.created,d),h(f.id))};this.events.on($t.created,d);try{const f=await sn(new Promise((p,b)=>{this.relayer.request(a).catch(v=>{this.logger.warn(v,v?.message),b(v)}).then(p)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener($t.created,d),h(f)}catch{}}),l=await sn(u,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!l&&c)throw new Error(`Subscribing to ${e} failed, please try again`);return l?o:null}catch(u){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Ie.connection_stalled),c)throw u}return null}async rpcBatchSubscribe(e){if(!e.length)return;const n=e[0].relay,r={method:Oi(n.protocol).batchSubscribe,params:{topics:e.map(i=>i.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});try{await await sn(new Promise(i=>{this.relayer.request(r).catch(s=>this.logger.warn(s)).then(i)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(Ie.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;const n=e[0].relay,r={method:Oi(n.protocol).batchFetchMessages,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});let i;try{i=await await sn(new Promise((s,o)=>{this.relayer.request(r).catch(a=>{this.logger.warn(a),o(a)}).then(s)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(Ie.connection_stalled)}return i}rpcUnsubscribe(e,n,r){const i={method:Oi(r.protocol).unsubscribe,params:{topic:e,id:n}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i}),this.relayer.request(i)}onSubscribe(e,n){this.setSubscription(e,Al(Rs({},n),{id:e})),this.pending.delete(n.topic)}onBatchSubscribe(e){e.length&&e.forEach(n=>{this.setSubscription(n.id,Rs({},n)),this.pending.delete(n.topic)})}async onUnsubscribe(e,n,r){this.events.removeAllListeners(n),this.hasSubscription(n,e)&&this.deleteSubscription(n,r),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,n){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:n}),this.addSubscription(e,n)}addSubscription(e,n){this.subscriptions.set(e,Rs({},n)),this.topicMap.set(n.topic,e),this.events.emit($t.created,n)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const n=this.subscriptions.get(e);if(!n){const{message:r}=G("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(r)}return n}deleteSubscription(e,n){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:n});const r=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(r.topic,e),this.events.emit($t.deleted,Al(Rs({},r),{reason:n}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit($t.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],n=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<n;r++){const i=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(i)}}this.events.emit($t.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size&&!e.every(n=>{var r;return n.topic===((r=this.subscriptions.get(n.id))==null?void 0:r.topic)})){const{message:n}=G("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(n),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(n)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async n=>Al(Rs({},n),{id:await this.getSubscriptionId(n.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const n=await this.rpcBatchFetchMessages(e);n&&n.messages&&(await h4(K.toMiliseconds(K.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(n.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return Lt(e+await this.getClientId())}}var PA=Object.defineProperty,ry=Object.getOwnPropertySymbols,RA=Object.prototype.hasOwnProperty,NA=Object.prototype.propertyIsEnumerable,Bl=(t,e,n)=>e in t?PA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,iy=(t,e)=>{for(var n in e||(e={}))RA.call(e,n)&&Bl(t,n,e[n]);if(ry)for(var n of ry(e))NA.call(e,n)&&Bl(t,n,e[n]);return t},le=(t,e,n)=>Bl(t,typeof e!="symbol"?e+"":e,n);class CA extends Cw{constructor(e){super(e),le(this,"protocol","wc"),le(this,"version",2),le(this,"core"),le(this,"logger"),le(this,"events",new ft.exports.EventEmitter),le(this,"provider"),le(this,"messages"),le(this,"subscriber"),le(this,"publisher"),le(this,"name",h7),le(this,"transportExplicitlyClosed",!1),le(this,"initialized",!1),le(this,"connectionAttemptInProgress",!1),le(this,"relayUrl"),le(this,"projectId"),le(this,"packageName"),le(this,"bundleId"),le(this,"hasExperiencedNetworkDisruption",!1),le(this,"pingTimeout"),le(this,"heartBeatTimeout",K.toMiliseconds(K.THIRTY_SECONDS+K.FIVE_SECONDS)),le(this,"reconnectTimeout"),le(this,"connectPromise"),le(this,"reconnectInProgress",!1),le(this,"requestsInFlight",[]),le(this,"connectTimeout",K.toMiliseconds(K.ONE_SECOND*15)),le(this,"request",async n=>{var r,i;this.logger.debug("Publishing Request Payload");const s=n.id||br().toString();await this.toEstablishConnection();try{this.logger.trace({id:s,method:n.method,topic:(r=n.params)==null?void 0:r.topic},"relayer.request - publishing...");const o=`${s}:${((i=n.params)==null?void 0:i.tag)||""}`;this.requestsInFlight.push(o);const a=await this.provider.request(n);return this.requestsInFlight=this.requestsInFlight.filter(c=>c!==o),a}catch(o){throw this.logger.debug(`Failed to Publish Request: ${s}`),o}}),le(this,"resetPingTimeout",()=>{Wo()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var n,r,i,s;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(s=(i=(r=(n=this.provider)==null?void 0:n.connection)==null?void 0:r.socket)==null?void 0:i.terminate)==null||s.call(i)}catch(o){this.logger.warn(o,o?.message)}},this.heartBeatTimeout))}),le(this,"onPayloadHandler",n=>{this.onProviderPayload(n),this.resetPingTimeout()}),le(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected \u{1F6DC}"),this.startPingTimeout(),this.events.emit(Ie.connect)}),le(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected \u{1F6D1}"),this.requestsInFlight=[],this.onProviderDisconnect()}),le(this,"onProviderErrorHandler",n=>{this.logger.fatal(`Fatal socket error: ${n.message}`),this.events.emit(Ie.error,n),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),le(this,"registerProviderListeners",()=>{this.provider.on(qt.payload,this.onPayloadHandler),this.provider.on(qt.connect,this.onConnectHandler),this.provider.on(qt.disconnect,this.onDisconnectHandler),this.provider.on(qt.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?nt(e.logger,this.name):hn(ja({level:e.logger||f7})),this.messages=new yA(this.logger,e.core),this.subscriber=new TA(this,this.logger),this.publisher=new xA(this,this.logger),this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||R1,Y_()?this.packageName=v0():X_()&&(this.bundleId=v0()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(e=>this.logger.warn(e,e?.message))}get context(){return dt(this.logger)}get connected(){var e,n,r;return((r=(n=(e=this.provider)==null?void 0:e.connection)==null?void 0:n.socket)==null?void 0:r.readyState)===1||!1}get connecting(){var e,n,r;return((r=(n=(e=this.provider)==null?void 0:e.connection)==null?void 0:n.socket)==null?void 0:r.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,n,r){this.isInitialized(),await this.publisher.publish(e,n,r),await this.recordMessageEvent({topic:e,message:n,publishedAt:Date.now(),transportType:ve.relay},Ea.outbound)}async publishCustom(e){this.isInitialized(),await this.publisher.publishCustom(e)}async subscribe(e,n){var r,i,s;this.isInitialized(),(!(n!=null&&n.transportType)||n?.transportType==="relay")&&await this.toEstablishConnection();const o=typeof((r=n?.internal)==null?void 0:r.throwOnFailedPublish)>"u"?!0:(i=n?.internal)==null?void 0:i.throwOnFailedPublish;let a=((s=this.subscriber.topicMap.get(e))==null?void 0:s[0])||"",c;const u=l=>{l.topic===e&&(this.subscriber.off($t.created,u),c())};return await Promise.all([new Promise(l=>{c=l,this.subscriber.on($t.created,u)}),new Promise(async(l,h)=>{a=await this.subscriber.subscribe(e,iy({internal:{throwOnFailedPublish:o}},n)).catch(d=>{o&&h(d)})||a,l()})]),a}async unsubscribe(e,n){this.isInitialized(),await this.subscriber.unsubscribe(e,n)}on(e,n){this.events.on(e,n)}once(e,n){this.events.once(e,n)}off(e,n){this.events.off(e,n)}removeListener(e,n){this.events.removeListener(e,n)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await sn(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.info("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(n,r)=>{await this.connect(e).then(n).catch(r).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await g1())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if(e?.length===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const n=e.sort((r,i)=>r.publishedAt-i.publishedAt);this.logger.debug(`Batch of ${n.length} message events sorted`);for(const r of n)try{await this.onMessageEvent(r)}catch(i){this.logger.warn(i,"Error while processing batch message event: "+i?.message)}this.logger.trace(`Batch of ${n.length} message events processed`)}async onLinkMessageEvent(e,n){const{topic:r}=e;if(!n.sessionExists){const i=$e(K.FIVE_MINUTES),s={topic:r,expiry:i,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(r,s)}this.events.emit(Ie.message,e),await this.recordMessageEvent(e,Ea.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let n=1;for(;n<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${n}...`),await this.createProvider(),await new Promise(async(r,i)=>{const s=()=>{i(new Error("Connection interrupted while trying to connect"))};this.provider.once(qt.disconnect,s),await sn(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{i(o)}).finally(()=>{this.provider.off(qt.disconnect,s),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const c=()=>{i(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(qt.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(qt.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,r()})}catch(r){await this.subscriber.stop();const i=r;this.logger.warn({},i.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${n}`);break}await new Promise(r=>setTimeout(r,K.toMiliseconds(n*1))),n++}}startPingTimeout(){var e,n,r,i,s;if(Wo())try{(n=(e=this.provider)==null?void 0:e.connection)!=null&&n.socket&&((s=(i=(r=this.provider)==null?void 0:r.connection)==null?void 0:i.socket)==null||s.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o?.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new G9(new X9(n4({sdkVersion:vl,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,n){const{topic:r,message:i}=e;await this.messages.set(r,i,n)}async shouldIgnoreMessageEvent(e){const{topic:n,message:r}=e;if(!r||r.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${r}`),!0;if(!await this.subscriber.isKnownTopic(n))return this.logger.warn(`Ignoring message for unknown topic ${n}`),!0;const i=this.messages.has(n,r);return i&&this.logger.warn(`Ignoring duplicate message: ${r}`),i}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),ml(e)){if(!e.method.endsWith(d7))return;const n=e.params,{topic:r,message:i,publishedAt:s,attestation:o}=n.data,a={topic:r,message:i,publishedAt:s,transportType:ve.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(iy({type:"event",event:n.id},a)),this.events.emit(n.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else ma(e)&&this.events.emit(Ie.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,Ea.inbound),this.events.emit(Ie.message,e))}async acknowledgePayload(e){const n=wa(e.id,!0);await this.provider.connection.send(n)}unregisterProviderListeners(){this.provider.off(qt.payload,this.onPayloadHandler),this.provider.off(qt.connect,this.onConnectHandler),this.provider.off(qt.disconnect,this.onDisconnectHandler),this.provider.off(qt.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await g1();YI(async n=>{e!==n&&(e=n,n?await this.transportOpen().catch(r=>this.logger.error(r,r?.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(xr.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&QI())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(n){this.logger.warn(n,n?.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(Ie.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},K.toMiliseconds(p7)))))}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}}function UA(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}function sy(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function oy(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const FA="[object RegExp]",LA="[object String]",kA="[object Number]",qA="[object Boolean]",ay="[object Arguments]",MA="[object Symbol]",jA="[object Date]",zA="[object Map]",VA="[object Set]",HA="[object Array]",KA="[object Function]",GA="[object ArrayBuffer]",Dl="[object Object]",WA="[object Error]",ZA="[object DataView]",YA="[object Uint8Array]",XA="[object Uint8ClampedArray]",JA="[object Uint16Array]",QA="[object Uint32Array]",eB="[object BigUint64Array]",tB="[object Int8Array]",nB="[object Int16Array]",rB="[object Int32Array]",iB="[object BigInt64Array]",sB="[object Float32Array]",oB="[object Float64Array]";function aB(){}function cy(t){if(!t||typeof t!="object")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(t)==="[object Object]":!1}function cB(t,e,n){return Ns(t,e,void 0,void 0,void 0,void 0,n)}function Ns(t,e,n,r,i,s,o){const a=o(t,e,n,r,i,s);if(a!==void 0)return a;if(typeof t==typeof e)switch(typeof t){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return t===e;case"number":return t===e||Object.is(t,e);case"function":return t===e;case"object":return Cs(t,e,s,o)}return Cs(t,e,s,o)}function Cs(t,e,n,r){if(Object.is(t,e))return!0;let i=oy(t),s=oy(e);if(i===ay&&(i=Dl),s===ay&&(s=Dl),i!==s)return!1;switch(i){case LA:return t.toString()===e.toString();case kA:{const c=t.valueOf(),u=e.valueOf();return UA(c,u)}case qA:case jA:case MA:return Object.is(t.valueOf(),e.valueOf());case FA:return t.source===e.source&&t.flags===e.flags;case KA:return t===e}n=n??new Map;const o=n.get(t),a=n.get(e);if(o!=null&&a!=null)return o===e;n.set(t,e),n.set(e,t);try{switch(i){case zA:{if(t.size!==e.size)return!1;for(const[c,u]of t.entries())if(!e.has(c)||!Ns(u,e.get(c),c,t,e,n,r))return!1;return!0}case VA:{if(t.size!==e.size)return!1;const c=Array.from(t.values()),u=Array.from(e.values());for(let l=0;l<c.length;l++){const h=c[l],d=u.findIndex(f=>Ns(h,f,void 0,t,e,n,r));if(d===-1)return!1;u.splice(d,1)}return!0}case HA:case YA:case XA:case JA:case QA:case eB:case tB:case nB:case rB:case iB:case sB:case oB:{if(typeof Buffer<"u"&&Buffer.isBuffer(t)!==Buffer.isBuffer(e)||t.length!==e.length)return!1;for(let c=0;c<t.length;c++)if(!Ns(t[c],e[c],c,t,e,n,r))return!1;return!0}case GA:return t.byteLength!==e.byteLength?!1:Cs(new Uint8Array(t),new Uint8Array(e),n,r);case ZA:return t.byteLength!==e.byteLength||t.byteOffset!==e.byteOffset?!1:Cs(new Uint8Array(t),new Uint8Array(e),n,r);case WA:return t.name===e.name&&t.message===e.message;case Dl:{if(!(Cs(t.constructor,e.constructor,n,r)||cy(t)&&cy(e)))return!1;const c=[...Object.keys(t),...sy(t)],u=[...Object.keys(e),...sy(e)];if(c.length!==u.length)return!1;for(let l=0;l<c.length;l++){const h=c[l],d=t[h];if(!Object.hasOwn(e,h))return!1;const f=e[h];if(!Ns(d,f,h,t,e,n,r))return!1}return!0}default:return!1}}finally{n.delete(t),n.delete(e)}}function uB(t,e){return cB(t,e,aB)}var lB=Object.defineProperty,uy=Object.getOwnPropertySymbols,fB=Object.prototype.hasOwnProperty,hB=Object.prototype.propertyIsEnumerable,$l=(t,e,n)=>e in t?lB(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,ly=(t,e)=>{for(var n in e||(e={}))fB.call(e,n)&&$l(t,n,e[n]);if(uy)for(var n of uy(e))hB.call(e,n)&&$l(t,n,e[n]);return t},St=(t,e,n)=>$l(t,typeof e!="symbol"?e+"":e,n);class Kr extends Uw{constructor(e,n,r,i=un,s=void 0){super(e,n,r,i),this.core=e,this.logger=n,this.name=r,St(this,"map",new Map),St(this,"version",g7),St(this,"cached",[]),St(this,"initialized",!1),St(this,"getKey"),St(this,"storagePrefix",un),St(this,"recentlyDeleted",[]),St(this,"recentlyDeletedLimit",200),St(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!Pe(o)?this.map.set(this.getKey(o),o):AI(o)?this.map.set(o.id,o):BI(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),St(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),St(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),St(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>uB(a[c],o[c]))):this.values)),St(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const c=ly(ly({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),St(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=nt(n,this.name),this.storagePrefix=i,this.getKey=s}get context(){return dt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const n=this.map.get(e);if(!n){if(this.recentlyDeleted.includes(e)){const{message:i}=G("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}const{message:r}=G("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(r),new Error(r)}return n}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:n}=G("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(n),new Error(n)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}}var dB=Object.defineProperty,pB=(t,e,n)=>e in t?dB(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,oe=(t,e,n)=>pB(t,typeof e!="symbol"?e+"":e,n);class gB{constructor(e,n){this.core=e,this.logger=n,oe(this,"name",m7),oe(this,"version",v7),oe(this,"events",new ft.exports),oe(this,"pairings"),oe(this,"initialized",!1),oe(this,"storagePrefix",un),oe(this,"ignoredPayloadTypes",[Nn]),oe(this,"registeredMethods",[]),oe(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),oe(this,"register",({methods:r})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...r])]}),oe(this,"create",async r=>{this.isInitialized();const i=cl(),s=await this.core.crypto.setSymKey(i),o=$e(K.FIVE_MINUTES),a={protocol:P1},c={topic:s,expiry:o,relay:a,active:!1,methods:r?.methods},u=r1({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:i,relay:a,expiryTimestamp:o,methods:r?.methods});return this.events.emit(Vr.create,c),this.core.expirer.set(s,o),await this.pairings.set(s,c),await this.core.relayer.subscribe(s,{transportType:r?.transportType,internal:r?.internal}),{topic:s,uri:u}}),oe(this,"pair",async r=>{this.isInitialized();const i=this.core.eventClient.createEvent({properties:{topic:r?.uri,trace:[ln.pairing_started]}});this.isValidPair(r,i);const{topic:s,symKey:o,relay:a,expiryTimestamp:c,methods:u}=n1(r.uri);i.props.properties.topic=s,i.addTrace(ln.pairing_uri_validation_success),i.addTrace(ln.pairing_uri_not_expired);let l;if(this.pairings.keys.includes(s)){if(l=this.pairings.get(s),i.addTrace(ln.existing_pairing),l.active)throw i.setError(Ln.active_pairing_already_exists),new Error(`Pairing already exists: ${s}. Please try again with a new connection URI.`);i.addTrace(ln.pairing_not_expired)}const h=c||$e(K.FIVE_MINUTES),d={topic:s,relay:a,expiry:h,active:!1,methods:u};this.core.expirer.set(s,h),await this.pairings.set(s,d),i.addTrace(ln.store_new_pairing),r.activatePairing&&await this.activate({topic:s}),this.events.emit(Vr.create,d),i.addTrace(ln.emit_inactive_pairing),this.core.crypto.keychain.has(s)||await this.core.crypto.setSymKey(o,s),i.addTrace(ln.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{i.setError(Ln.no_internet_connection)}try{await this.core.relayer.subscribe(s,{relay:a})}catch(f){throw i.setError(Ln.subscribe_pairing_topic_failure),f}return i.addTrace(ln.subscribe_pairing_topic_success),d}),oe(this,"activate",async({topic:r})=>{this.isInitialized();const i=$e(K.FIVE_MINUTES);this.core.expirer.set(r,i),await this.pairings.update(r,{active:!0,expiry:i})}),oe(this,"ping",async r=>{this.isInitialized(),await this.isValidPing(r),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:i}=r;if(this.pairings.keys.includes(i)){const s=await this.sendRequest(i,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=Ur();this.events.once(fe("pairing_ping",s),({error:u})=>{u?c(u):a()}),await o()}}),oe(this,"updateExpiry",async({topic:r,expiry:i})=>{this.isInitialized(),await this.pairings.update(r,{expiry:i})}),oe(this,"updateMetadata",async({topic:r,metadata:i})=>{this.isInitialized(),await this.pairings.update(r,{peerMetadata:i})}),oe(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),oe(this,"disconnect",async r=>{this.isInitialized(),await this.isValidDisconnect(r);const{topic:i}=r;this.pairings.keys.includes(i)&&(await this.sendRequest(i,"wc_pairingDelete",xe("USER_DISCONNECTED")),await this.deletePairing(i))}),oe(this,"formatUriFromPairing",r=>{this.isInitialized();const{topic:i,relay:s,expiry:o,methods:a}=r,c=this.core.crypto.keychain.get(i);return r1({protocol:this.core.protocol,version:this.core.version,topic:i,symKey:c,relay:s,expiryTimestamp:o,methods:a})}),oe(this,"sendRequest",async(r,i,s)=>{const o=Fn(i,s),a=await this.core.crypto.encode(r,o),c=Bs[i].req;return this.core.history.set(r,o),this.core.relayer.publish(r,a,c),o.id}),oe(this,"sendResult",async(r,i,s)=>{const o=wa(r,s),a=await this.core.crypto.encode(i,o),c=(await this.core.history.get(i,r)).request.method,u=Bs[c].res;await this.core.relayer.publish(i,a,u),await this.core.history.resolve(o)}),oe(this,"sendError",async(r,i,s)=>{const o=wl(r,s),a=await this.core.crypto.encode(i,o),c=(await this.core.history.get(i,r)).request.method,u=Bs[c]?Bs[c].res:Bs.unregistered_method.res;await this.core.relayer.publish(i,a,u),await this.core.history.resolve(o)}),oe(this,"deletePairing",async(r,i)=>{await this.core.relayer.unsubscribe(r),await Promise.all([this.pairings.delete(r,xe("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(r),i?Promise.resolve():this.core.expirer.del(r)])}),oe(this,"cleanup",async()=>{const r=this.pairings.getAll().filter(i=>nr(i.expiry));await Promise.all(r.map(i=>this.deletePairing(i.topic)))}),oe(this,"onRelayEventRequest",async r=>{const{topic:i,payload:s}=r;switch(s.method){case"wc_pairingPing":return await this.onPairingPingRequest(i,s);case"wc_pairingDelete":return await this.onPairingDeleteRequest(i,s);default:return await this.onUnknownRpcMethodRequest(i,s)}}),oe(this,"onRelayEventResponse",async r=>{const{topic:i,payload:s}=r,o=(await this.core.history.get(i,s.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(i,s);default:return this.onUnknownRpcMethodResponse(o)}}),oe(this,"onPairingPingRequest",async(r,i)=>{const{id:s}=i;try{this.isValidPing({topic:r}),await this.sendResult(s,r,!0),this.events.emit(Vr.ping,{id:s,topic:r})}catch(o){await this.sendError(s,r,o),this.logger.error(o)}}),oe(this,"onPairingPingResponse",(r,i)=>{const{id:s}=i;setTimeout(()=>{cn(i)?this.events.emit(fe("pairing_ping",s),{}):kt(i)&&this.events.emit(fe("pairing_ping",s),{error:i.error})},500)}),oe(this,"onPairingDeleteRequest",async(r,i)=>{const{id:s}=i;try{this.isValidDisconnect({topic:r}),await this.deletePairing(r),this.events.emit(Vr.delete,{id:s,topic:r})}catch(o){await this.sendError(s,r,o),this.logger.error(o)}}),oe(this,"onUnknownRpcMethodRequest",async(r,i)=>{const{id:s,method:o}=i;try{if(this.registeredMethods.includes(o))return;const a=xe("WC_METHOD_UNSUPPORTED",o);await this.sendError(s,r,a),this.logger.error(a)}catch(a){await this.sendError(s,r,a),this.logger.error(a)}}),oe(this,"onUnknownRpcMethodResponse",r=>{this.registeredMethods.includes(r)||this.logger.error(xe("WC_METHOD_UNSUPPORTED",r))}),oe(this,"isValidPair",(r,i)=>{var s;if(!_t(r)){const{message:a}=G("MISSING_OR_INVALID",`pair() params: ${r}`);throw i.setError(Ln.malformed_pairing_uri),new Error(a)}if(!OI(r.uri)){const{message:a}=G("MISSING_OR_INVALID",`pair() uri: ${r.uri}`);throw i.setError(Ln.malformed_pairing_uri),new Error(a)}const o=n1(r?.uri);if(!((s=o?.relay)!=null&&s.protocol)){const{message:a}=G("MISSING_OR_INVALID","pair() uri#relay-protocol");throw i.setError(Ln.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){const{message:a}=G("MISSING_OR_INVALID","pair() uri#symKey");throw i.setError(Ln.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&K.toMiliseconds(o?.expiryTimestamp)<Date.now()){i.setError(Ln.pairing_expired);const{message:a}=G("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),oe(this,"isValidPing",async r=>{if(!_t(r)){const{message:s}=G("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(s)}const{topic:i}=r;await this.isValidPairingTopic(i)}),oe(this,"isValidDisconnect",async r=>{if(!_t(r)){const{message:s}=G("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(s)}const{topic:i}=r;await this.isValidPairingTopic(i)}),oe(this,"isValidPairingTopic",async r=>{if(!Oe(r,!1)){const{message:i}=G("MISSING_OR_INVALID",`pairing topic should be a string: ${r}`);throw new Error(i)}if(!this.pairings.keys.includes(r)){const{message:i}=G("NO_MATCHING_KEY",`pairing topic doesn't exist: ${r}`);throw new Error(i)}if(nr(this.pairings.get(r).expiry)){await this.deletePairing(r);const{message:i}=G("EXPIRED",`pairing topic: ${r}`);throw new Error(i)}}),this.core=e,this.logger=nt(n,this.name),this.pairings=new Kr(this.core,this.logger,this.name,this.storagePrefix)}get context(){return dt(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(Ie.message,async e=>{const{topic:n,message:r,transportType:i}=e;if(this.pairings.keys.includes(n)&&i!==ve.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(r)))try{const s=await this.core.crypto.decode(n,r);ml(s)?(this.core.history.set(n,s),await this.onRelayEventRequest({topic:n,payload:s})):ma(s)&&(await this.core.history.resolve(s),await this.onRelayEventResponse({topic:n,payload:s}),this.core.history.delete(n,s.id)),await this.core.relayer.messages.ack(n,r)}catch(s){this.logger.error(s)}})}registerExpirerEvents(){this.core.expirer.on(Mt.expired,async e=>{const{topic:n}=S0(e.target);n&&this.pairings.keys.includes(n)&&(await this.deletePairing(n,!0),this.events.emit(Vr.expire,{topic:n}))})}}var yB=Object.defineProperty,bB=(t,e,n)=>e in t?yB(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Ve=(t,e,n)=>bB(t,typeof e!="symbol"?e+"":e,n);class wB extends Pw{constructor(e,n){super(e,n),this.core=e,this.logger=n,Ve(this,"records",new Map),Ve(this,"events",new ft.exports.EventEmitter),Ve(this,"name",E7),Ve(this,"version",x7),Ve(this,"cached",[]),Ve(this,"initialized",!1),Ve(this,"storagePrefix",un),Ve(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(r=>this.records.set(r.id,r)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Ve(this,"set",(r,i,s)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:r,request:i,chainId:s}),this.records.has(i.id))return;const o={id:i.id,topic:r,request:{method:i.method,params:i.params||null},chainId:s,expiry:$e(K.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(Xt.created,o)}),Ve(this,"resolve",async r=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:r}),!this.records.has(r.id))return;const i=await this.getRecord(r.id);typeof i.response>"u"&&(i.response=kt(r)?{error:r.error}:{result:r.result},this.records.set(i.id,i),this.persist(),this.events.emit(Xt.updated,i))}),Ve(this,"get",async(r,i)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:r,id:i}),await this.getRecord(i))),Ve(this,"delete",(r,i)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:i}),this.values.forEach(s=>{if(s.topic===r){if(typeof i<"u"&&s.id!==i)return;this.records.delete(s.id),this.events.emit(Xt.deleted,s)}}),this.persist()}),Ve(this,"exists",async(r,i)=>(this.isInitialized(),this.records.has(i)?(await this.getRecord(i)).topic===r:!1)),Ve(this,"on",(r,i)=>{this.events.on(r,i)}),Ve(this,"once",(r,i)=>{this.events.once(r,i)}),Ve(this,"off",(r,i)=>{this.events.off(r,i)}),Ve(this,"removeListener",(r,i)=>{this.events.removeListener(r,i)}),this.logger=nt(n,this.name)}get context(){return dt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(n=>{if(typeof n.response<"u")return;const r={topic:n.topic,request:Fn(n.request.method,n.request.params,n.id),chainId:n.chainId};return e.push(r)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const n=this.records.get(e);if(!n){const{message:r}=G("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(r)}return n}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Xt.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:n}=G("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(n),new Error(n)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(Xt.created,e=>{const n=Xt.created;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,record:e})}),this.events.on(Xt.updated,e=>{const n=Xt.updated;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,record:e})}),this.events.on(Xt.deleted,e=>{const n=Xt.deleted;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,record:e})}),this.core.heartbeat.on(xr.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(n=>{K.toMiliseconds(n.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${n.id}`),this.records.delete(n.id),this.events.emit(Xt.deleted,n,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}}var mB=Object.defineProperty,vB=(t,e,n)=>e in t?mB(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,et=(t,e,n)=>vB(t,typeof e!="symbol"?e+"":e,n);class EB extends Lw{constructor(e,n){super(e,n),this.core=e,this.logger=n,et(this,"expirations",new Map),et(this,"events",new ft.exports.EventEmitter),et(this,"name",_7),et(this,"version",S7),et(this,"cached",[]),et(this,"initialized",!1),et(this,"storagePrefix",un),et(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(r=>this.expirations.set(r.target,r)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),et(this,"has",r=>{try{const i=this.formatTarget(r);return typeof this.getExpiration(i)<"u"}catch{return!1}}),et(this,"set",(r,i)=>{this.isInitialized();const s=this.formatTarget(r),o={target:s,expiry:i};this.expirations.set(s,o),this.checkExpiry(s,o),this.events.emit(Mt.created,{target:s,expiration:o})}),et(this,"get",r=>{this.isInitialized();const i=this.formatTarget(r);return this.getExpiration(i)}),et(this,"del",r=>{if(this.isInitialized(),this.has(r)){const i=this.formatTarget(r),s=this.getExpiration(i);this.expirations.delete(i),this.events.emit(Mt.deleted,{target:i,expiration:s})}}),et(this,"on",(r,i)=>{this.events.on(r,i)}),et(this,"once",(r,i)=>{this.events.once(r,i)}),et(this,"off",(r,i)=>{this.events.off(r,i)}),et(this,"removeListener",(r,i)=>{this.events.removeListener(r,i)}),this.logger=nt(n,this.name)}get context(){return dt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return r4(e);if(typeof e=="number")return i4(e);const{message:n}=G("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(n)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Mt.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:n}=G("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(n),new Error(n)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const n=this.expirations.get(e);if(!n){const{message:r}=G("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(r),new Error(r)}return n}checkExpiry(e,n){const{expiry:r}=n;K.toMiliseconds(r)-Date.now()<=0&&this.expire(e,n)}expire(e,n){this.expirations.delete(e),this.events.emit(Mt.expired,{target:e,expiration:n})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,n)=>this.checkExpiry(n,e))}registerEventListeners(){this.core.heartbeat.on(xr.pulse,()=>this.checkExpirations()),this.events.on(Mt.created,e=>{const n=Mt.created;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:e}),this.persist()}),this.events.on(Mt.expired,e=>{const n=Mt.expired;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:e}),this.persist()}),this.events.on(Mt.deleted,e=>{const n=Mt.deleted;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}}var xB=Object.defineProperty,_B=(t,e,n)=>e in t?xB(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Ae=(t,e,n)=>_B(t,typeof e!="symbol"?e+"":e,n);class SB extends kw{constructor(e,n,r){super(e,n,r),this.core=e,this.logger=n,this.store=r,Ae(this,"name",I7),Ae(this,"abortController"),Ae(this,"isDevEnv"),Ae(this,"verifyUrlV3",A7),Ae(this,"storagePrefix",un),Ae(this,"version",$1),Ae(this,"publicKey"),Ae(this,"fetchPromise"),Ae(this,"init",async()=>{var i;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&K.toMiliseconds((i=this.publicKey)==null?void 0:i.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),Ae(this,"register",async i=>{if(!wi()||this.isDevEnv)return;const s=window.location.origin,{id:o,decryptedId:a}=i,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${s}&id=${o}&decryptedId=${a}`;try{const u=Ar(),l=this.startAbortTimer(K.ONE_SECOND*5),h=await new Promise((d,f)=>{const p=()=>{window.removeEventListener("message",v),u.body.removeChild(b),f("attestation aborted")};this.abortController.signal.addEventListener("abort",p);const b=u.createElement("iframe");b.src=c,b.style.display="none",b.addEventListener("error",p,{signal:this.abortController.signal});const v=A=>{if(A.data&&typeof A.data=="string")try{const D=JSON.parse(A.data);if(D.type==="verify_attestation"){if(uc(D.attestation).payload.id!==o)return;clearInterval(l),u.body.removeChild(b),this.abortController.signal.removeEventListener("abort",p),window.removeEventListener("message",v),d(D.attestation===null?"":D.attestation)}}catch(D){this.logger.warn(D)}};u.body.appendChild(b),window.addEventListener("message",v,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",h),h}catch(u){this.logger.warn(u)}return""}),Ae(this,"resolve",async i=>{if(this.isDevEnv)return"";const{attestationId:s,hash:o,encryptedId:a}=i;if(s===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(s){if(uc(s).payload.id!==a)return;const u=await this.isValidJwtAttestation(s);if(u){if(!u.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return u}}if(!o)return;const c=this.getVerifyUrl(i?.verifyUrl);return this.fetchAttestation(o,c)}),Ae(this,"fetchAttestation",async(i,s)=>{this.logger.debug(`resolving attestation: ${i} from url: ${s}`);const o=this.startAbortTimer(K.ONE_SECOND*5),a=await fetch(`${s}/attestation/${i}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),Ae(this,"getVerifyUrl",i=>{let s=i||Ds;return B7.includes(s)||(this.logger.info(`verify url: ${s}, not included in trusted list, assigning default: ${Ds}`),s=Ds),s}),Ae(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const i=this.startAbortTimer(K.FIVE_SECONDS),s=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(i),await s.json()}catch(i){this.logger.warn(i)}}),Ae(this,"persistPublicKey",async i=>{this.logger.debug("persisting public key to local storage",i),await this.store.setItem(this.storeKey,i),this.publicKey=i}),Ae(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),Ae(this,"isValidJwtAttestation",async i=>{const s=await this.getPublicKey();try{if(s)return this.validateAttestation(i,s)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(i,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),Ae(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),Ae(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async s=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),s(o))});const i=await this.fetchPromise;return this.fetchPromise=void 0,i}),Ae(this,"validateAttestation",(i,s)=>{const o=JS(i,s.publicKey),a={hasExpired:K.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=nt(n,this.name),this.abortController=new AbortController,this.isDevEnv=$u(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return dt(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),K.toMiliseconds(e))}}var IB=Object.defineProperty,OB=(t,e,n)=>e in t?IB(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,fy=(t,e,n)=>OB(t,typeof e!="symbol"?e+"":e,n);class AB extends qw{constructor(e,n){super(e,n),this.projectId=e,this.logger=n,fy(this,"context",D7),fy(this,"registerDeviceToken",async r=>{const{clientId:i,token:s,notificationType:o,enableEncrypted:a=!1}=r,c=`${$7}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:i,type:o,token:s,always_raw:a})})}),this.logger=nt(n,this.context)}}var BB=Object.defineProperty,hy=Object.getOwnPropertySymbols,DB=Object.prototype.hasOwnProperty,$B=Object.prototype.propertyIsEnumerable,Tl=(t,e,n)=>e in t?BB(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Us=(t,e)=>{for(var n in e||(e={}))DB.call(e,n)&&Tl(t,n,e[n]);if(hy)for(var n of hy(e))$B.call(e,n)&&Tl(t,n,e[n]);return t},Ue=(t,e,n)=>Tl(t,typeof e!="symbol"?e+"":e,n);class TB extends Mw{constructor(e,n,r=!0){super(e,n,r),this.core=e,this.logger=n,Ue(this,"context",P7),Ue(this,"storagePrefix",un),Ue(this,"storageVersion",T7),Ue(this,"events",new Map),Ue(this,"shouldPersist",!1),Ue(this,"init",async()=>{if(!$u())try{const i={eventId:O0(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:x0(this.core.relayer.protocol,this.core.relayer.version,vl)}}};await this.sendEvent([i])}catch(i){this.logger.warn(i)}}),Ue(this,"createEvent",i=>{const{event:s="ERROR",type:o="",properties:{topic:a,trace:c}}=i,u=O0(),l=this.core.projectId||"",h=Date.now(),d=Us({eventId:u,timestamp:h,props:{event:s,type:o,properties:{topic:a,trace:c}},bundleId:l,domain:this.getAppDomain()},this.setMethods(u));return this.telemetryEnabled&&(this.events.set(u,d),this.shouldPersist=!0),d}),Ue(this,"getEvent",i=>{const{eventId:s,topic:o}=i;if(s)return this.events.get(s);const a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return Us(Us({},a),this.setMethods(a.eventId))}),Ue(this,"deleteEvent",i=>{const{eventId:s}=i;this.events.delete(s),this.shouldPersist=!0}),Ue(this,"setEventListeners",()=>{this.core.heartbeat.on(xr.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(i=>{K.fromMiliseconds(Date.now())-K.fromMiliseconds(i.timestamp)>R7&&(this.events.delete(i.eventId),this.shouldPersist=!0)})})}),Ue(this,"setMethods",i=>({addTrace:s=>this.addTrace(i,s),setError:s=>this.setError(i,s)})),Ue(this,"addTrace",(i,s)=>{const o=this.events.get(i);o&&(o.props.properties.trace.push(s),this.events.set(i,o),this.shouldPersist=!0)}),Ue(this,"setError",(i,s)=>{const o=this.events.get(i);o&&(o.props.type=s,o.timestamp=Date.now(),this.events.set(i,o),this.shouldPersist=!0)}),Ue(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),Ue(this,"restore",async()=>{try{const i=await this.core.storage.getItem(this.storageKey)||[];if(!i.length)return;i.forEach(s=>{this.events.set(s.eventId,Us(Us({},s),this.setMethods(s.eventId)))})}catch(i){this.logger.warn(i)}}),Ue(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const i=[];for(const[s,o]of this.events)o.props.type&&i.push(o);if(i.length!==0)try{if((await this.sendEvent(i)).ok)for(const s of i)this.events.delete(s.eventId),this.shouldPersist=!0}catch(s){this.logger.warn(s)}}),Ue(this,"sendEvent",async i=>{const s=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${N7}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${vl}${s}`,{method:"POST",body:JSON.stringify(i)})}),Ue(this,"getAppDomain",()=>E0().url),this.logger=nt(n,this.context),this.telemetryEnabled=r,r?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var PB=Object.defineProperty,dy=Object.getOwnPropertySymbols,RB=Object.prototype.hasOwnProperty,NB=Object.prototype.propertyIsEnumerable,Pl=(t,e,n)=>e in t?PB(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,py=(t,e)=>{for(var n in e||(e={}))RB.call(e,n)&&Pl(t,n,e[n]);if(dy)for(var n of dy(e))NB.call(e,n)&&Pl(t,n,e[n]);return t},me=(t,e,n)=>Pl(t,typeof e!="symbol"?e+"":e,n);class Rl extends Bw{constructor(e){var n;super(e),me(this,"protocol",D1),me(this,"version",$1),me(this,"name",va),me(this,"relayUrl"),me(this,"projectId"),me(this,"customStoragePrefix"),me(this,"events",new ft.exports.EventEmitter),me(this,"logger"),me(this,"heartbeat"),me(this,"relayer"),me(this,"crypto"),me(this,"storage"),me(this,"history"),me(this,"expirer"),me(this,"pairing"),me(this,"verify"),me(this,"echoClient"),me(this,"linkModeSupportedApps"),me(this,"eventClient"),me(this,"initialized",!1),me(this,"logChunkController"),me(this,"on",(a,c)=>this.events.on(a,c)),me(this,"once",(a,c)=>this.events.once(a,c)),me(this,"off",(a,c)=>this.events.off(a,c)),me(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),me(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:u})=>{if(!a||!c)return;const l={topic:a,message:c,publishedAt:Date.now(),transportType:ve.link_mode};this.relayer.onLinkMessageEvent(l,{sessionExists:u})});const r=this.getGlobalCore(e?.customStoragePrefix);if(r)try{return this.customStoragePrefix=r.customStoragePrefix,this.logger=r.logger,this.heartbeat=r.heartbeat,this.crypto=r.crypto,this.history=r.history,this.expirer=r.expirer,this.storage=r.storage,this.relayer=r.relayer,this.pairing=r.pairing,this.verify=r.verify,this.echoClient=r.echoClient,this.linkModeSupportedApps=r.linkModeSupportedApps,this.eventClient=r.eventClient,this.initialized=r.initialized,this.logChunkController=r.logChunkController,r}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||R1,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const i=ja({level:typeof e?.logger=="string"&&e.logger?e.logger:t7.logger,name:va}),{logger:s,chunkLoggerController:o}=Iw({opts:i,maxSizeInBytes:e?.maxLogBlobSizeInBytes,loggerOverride:e?.logger});this.logChunkController=o,(n=this.logChunkController)!=null&&n.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=nt(s,this.name),this.heartbeat=new Ca,this.crypto=new cA(this,this.logger,e?.keychain),this.history=new wB(this,this.logger),this.expirer=new EB(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new Xb(py(py({},n7),e?.storageOptions)),this.relayer=new CA({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new gB(this,this.logger),this.verify=new SB(this,this.logger,this.storage),this.echoClient=new AB(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new TB(this,this.logger,e?.telemetryEnabled),this.setGlobalCore(this)}static async init(e){const n=new Rl(e);await n.initialize();const r=await n.crypto.getClientId();return await n.storage.setItem(y7,r),n}get context(){return dt(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(N1,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(N1)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const n=`_walletConnectCore_${e}`,r=`${n}_count`;return globalThis[r]=(globalThis[r]||0)+1,globalThis[r]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[r]} times.`),globalThis[n]}catch(n){console.warn("Failed to get global WalletConnect core",n);return}}setGlobalCore(e){var n;try{if(this.isGlobalCoreDisabled())return;const r=`_walletConnectCore_${((n=e.opts)==null?void 0:n.customStoragePrefix)||""}`;globalThis[r]=e}catch(r){console.warn("Failed to set global WalletConnect core",r)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&process.env.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}}const CB=Rl,Nl="wc",Cl=2,Ul="client",_a=`${Nl}@${Cl}:${Ul}:`,Sa={name:Ul,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.org"},UB={session_proposal:"session_proposal",session_update:"session_update",session_extend:"session_extend",session_ping:"session_ping",session_delete:"session_delete",session_expire:"session_expire",session_request:"session_request",session_request_sent:"session_request_sent",session_event:"session_event",proposal_expire:"proposal_expire",session_authenticate:"session_authenticate",session_request_expire:"session_request_expire",session_connect:"session_connect"},FB={database:":memory:"},Fl="WALLETCONNECT_DEEPLINK_CHOICE",LB={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},kB="history",qB="0.3",gy="proposal",MB=K.THIRTY_DAYS,Ll="Proposal expired",yy="session",Gr=K.SEVEN_DAYS,by="engine",Fe={wc_sessionPropose:{req:{ttl:K.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:K.ONE_DAY,prompt:!1,tag:1104},res:{ttl:K.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:K.ONE_DAY,prompt:!1,tag:1106},res:{ttl:K.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:K.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:K.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:K.ONE_DAY,prompt:!1,tag:1112},res:{ttl:K.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:K.ONE_DAY,prompt:!1,tag:1114},res:{ttl:K.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:K.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:K.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1119}}},Ia={min:K.FIVE_MINUTES,max:K.SEVEN_DAYS},Jt={idle:"IDLE",active:"ACTIVE"},wy={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},my="request",vy=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],Ey="wc",jB=1.5,xy="auth",_y="authKeys",Sy="pairingTopics",Iy="requests",Fs=`${Ey}@${1.5}:${xy}:`,Ls=`${Fs}:PUB_KEY`;var zB=Object.defineProperty,VB=Object.defineProperties,HB=Object.getOwnPropertyDescriptors,Oy=Object.getOwnPropertySymbols,KB=Object.prototype.hasOwnProperty,GB=Object.prototype.propertyIsEnumerable,kl=(t,e,n)=>e in t?zB(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,de=(t,e)=>{for(var n in e||(e={}))KB.call(e,n)&&kl(t,n,e[n]);if(Oy)for(var n of Oy(e))GB.call(e,n)&&kl(t,n,e[n]);return t},tt=(t,e)=>VB(t,HB(e)),V=(t,e,n)=>kl(t,typeof e!="symbol"?e+"":e,n);class WB extends Hw{constructor(e){super(e),V(this,"name",by),V(this,"events",new ft.exports),V(this,"initialized",!1),V(this,"requestQueue",{state:Jt.idle,queue:[]}),V(this,"sessionRequestQueue",{state:Jt.idle,queue:[]}),V(this,"emittedSessionRequests",new d4({limit:500})),V(this,"requestQueueDelay",K.ONE_SECOND),V(this,"expectedPairingMethodMap",new Map),V(this,"recentlyDeletedMap",new Map),V(this,"recentlyDeletedLimit",200),V(this,"relayMessageCache",[]),V(this,"pendingSessions",new Map),V(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(Fe)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},K.toMiliseconds(this.requestQueueDelay)))}),V(this,"connect",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();const r=tt(de({},n),{requiredNamespaces:n.requiredNamespaces||{},optionalNamespaces:n.optionalNamespaces||{}});await this.isValidConnect(r),r.optionalNamespaces=EI(r.requiredNamespaces,r.optionalNamespaces),r.requiredNamespaces={};const{pairingTopic:i,requiredNamespaces:s,optionalNamespaces:o,sessionProperties:a,scopedProperties:c,relays:u}=r;let l=i,h,d=!1;try{if(l){const R=this.client.core.pairing.pairings.get(l);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),d=R.active}}catch(R){throw this.client.logger.error(`connect() -> pairing.get(${l}) failed`),R}if(!l||!d){const{topic:R,uri:F}=await this.client.core.pairing.create({internal:{skipSubscribe:!0}});l=R,h=F}if(!l){const{message:R}=G("NO_MATCHING_KEY",`connect() pairing topic: ${l}`);throw new Error(R)}const f=await this.client.core.crypto.generateKeyPair(),p=Fe.wc_sessionPropose.req.ttl||K.FIVE_MINUTES,b=$e(p),v=tt(de(de({requiredNamespaces:s,optionalNamespaces:o,relays:u??[{protocol:P1}],proposer:{publicKey:f,metadata:this.client.metadata},expiryTimestamp:b,pairingTopic:l},a&&{sessionProperties:a}),c&&{scopedProperties:c}),{id:an()}),A=fe("session_connect",v.id),{reject:D,resolve:_,done:x}=Ur(p,Ll),T=({id:R})=>{R===v.id&&(this.client.events.off("proposal_expire",T),this.pendingSessions.delete(v.id),this.events.emit(A,{error:{message:Ll,code:0}}))};return this.client.events.on("proposal_expire",T),this.events.once(A,({error:R,session:F})=>{this.client.events.off("proposal_expire",T),R?D(R):F&&_(F)}),await this.sendProposeSession({proposal:v,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:v.id}}}),await this.setProposal(v.id,v),{uri:h,approval:x}}),V(this,"pair",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(n)}catch(r){throw this.client.logger.error("pair() failed"),r}}),V(this,"approve",async n=>{var r,i,s;const o=this.client.core.eventClient.createEvent({properties:{topic:(r=n?.id)==null?void 0:r.toString(),trace:[wr.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch($){throw o.setError($s.no_internet_connection),$}try{await this.isValidProposalId(n?.id)}catch($){throw this.client.logger.error(`approve() -> proposal.get(${n?.id}) failed`),o.setError($s.proposal_not_found),$}try{await this.isValidApprove(n)}catch($){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError($s.session_approve_namespace_validation_failure),$}const{id:a,relayProtocol:c,namespaces:u,sessionProperties:l,scopedProperties:h,sessionConfig:d}=n,f=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});const{pairingTopic:p,proposer:b,requiredNamespaces:v,optionalNamespaces:A}=f;let D=(i=this.client.core.eventClient)==null?void 0:i.getEvent({topic:p});D||(D=(s=this.client.core.eventClient)==null?void 0:s.createEvent({type:wr.session_approve_started,properties:{topic:p,trace:[wr.session_approve_started,wr.session_namespaces_validation_success]}}));const _=await this.client.core.crypto.generateKeyPair(),x=b.publicKey,T=await this.client.core.crypto.generateSharedKey(_,x),R=de(de(de({relay:{protocol:c??"irn"},namespaces:u,controller:{publicKey:_,metadata:this.client.metadata},expiry:$e(Gr)},l&&{sessionProperties:l}),h&&{scopedProperties:h}),d&&{sessionConfig:d}),F=ve.relay;D.addTrace(wr.subscribing_session_topic);try{await this.client.core.relayer.subscribe(T,{transportType:F,internal:{skipSubscribe:!0}})}catch($){throw D.setError($s.subscribe_session_topic_failure),$}D.addTrace(wr.subscribe_session_topic_success);const U=tt(de({},R),{topic:T,requiredNamespaces:v,optionalNamespaces:A,pairingTopic:p,acknowledged:!1,self:R.controller,peer:{publicKey:b.publicKey,metadata:b.metadata},controller:_,transportType:ve.relay});await this.client.session.set(T,U),D.addTrace(wr.store_session);try{await this.sendApproveSession({sessionTopic:T,proposal:f,pairingProposalResponse:{relay:{protocol:c??"irn"},responderPublicKey:_},sessionSettleRequest:R,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:a}}}),D.addTrace(wr.session_approve_publish_success)}catch($){throw this.client.logger.error($),this.client.session.delete(T,xe("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(T),$}return this.client.core.eventClient.deleteEvent({eventId:D.eventId}),await this.client.core.pairing.updateMetadata({topic:p,metadata:b.metadata}),await this.deleteProposal(a),await this.client.core.pairing.activate({topic:p}),await this.setExpiry(T,$e(Gr)),{topic:T,acknowledged:()=>Promise.resolve(this.client.session.get(T))}}),V(this,"reject",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(n)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}const{id:r,reason:i}=n;let s;try{s=this.client.proposal.get(r).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${r}) failed`),o}s&&await this.sendError({id:r,topic:s,error:i,rpcOpts:Fe.wc_sessionPropose.reject}),await this.deleteProposal(r)}),V(this,"update",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(n)}catch(h){throw this.client.logger.error("update() -> isValidUpdate() failed"),h}const{topic:r,namespaces:i}=n,{done:s,resolve:o,reject:a}=Ur(),c=an(),u=br().toString(),l=this.client.session.get(r).namespaces;return this.events.once(fe("session_update",c),({error:h})=>{h?a(h):o()}),await this.client.session.update(r,{namespaces:i}),await this.sendRequest({topic:r,method:"wc_sessionUpdate",params:{namespaces:i},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:u}).catch(h=>{this.client.logger.error(h),this.client.session.update(r,{namespaces:l}),a(h)}),{acknowledged:s}}),V(this,"extend",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(n)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}const{topic:r}=n,i=an(),{done:s,resolve:o,reject:a}=Ur();return this.events.once(fe("session_extend",i),({error:c})=>{c?a(c):o()}),await this.setExpiry(r,$e(Gr)),this.sendRequest({topic:r,method:"wc_sessionExtend",params:{},clientRpcId:i,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:s}}),V(this,"request",async n=>{this.isInitialized();try{await this.isValidRequest(n)}catch(v){throw this.client.logger.error("request() -> isValidRequest() failed"),v}const{chainId:r,request:i,topic:s,expiry:o=Fe.wc_sessionRequest.req.ttl}=n,a=this.client.session.get(s);a?.transportType===ve.relay&&await this.confirmOnlineStateOrThrow();const c=an(),u=br().toString(),{done:l,resolve:h,reject:d}=Ur(o,"Request expired. Please try again.");this.events.once(fe("session_request",c),({error:v,result:A})=>{v?d(v):h(A)});const f="wc_sessionRequest",p=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(p)return await this.sendRequest({clientRpcId:c,relayRpcId:u,topic:s,method:f,params:{request:tt(de({},i),{expiryTimestamp:$e(o)}),chainId:r},expiry:o,throwOnFailedPublish:!0,appLink:p}).catch(v=>d(v)),this.client.events.emit("session_request_sent",{topic:s,request:i,chainId:r,id:c}),await l();const b={request:tt(de({},i),{expiryTimestamp:$e(o)}),chainId:r};return await Promise.all([new Promise(async v=>{await this.sendRequest({clientRpcId:c,relayRpcId:u,topic:s,method:f,params:b,expiry:o,throwOnFailedPublish:!0,tvf:this.getTVFParams(c,b)}).catch(A=>d(A)),this.client.events.emit("session_request_sent",{topic:s,request:i,chainId:r,id:c}),v()}),new Promise(async v=>{var A;if(!((A=a.sessionConfig)!=null&&A.disableDeepLink)){const D=await c4(this.client.core.storage,Fl);await s4({id:c,topic:s,wcDeepLink:D})}v()}),l()]).then(v=>v[2])}),V(this,"respond",async n=>{this.isInitialized(),await this.isValidRespond(n);const{topic:r,response:i}=n,{id:s}=i,o=this.client.session.get(r);o.transportType===ve.relay&&await this.confirmOnlineStateOrThrow();const a=this.getAppLinkIfEnabled(o.peer.metadata,o.transportType);cn(i)?await this.sendResult({id:s,topic:r,result:i.result,throwOnFailedPublish:!0,appLink:a}):kt(i)&&await this.sendError({id:s,topic:r,error:i.error,appLink:a}),this.cleanupAfterResponse(n)}),V(this,"ping",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(n)}catch(i){throw this.client.logger.error("ping() -> isValidPing() failed"),i}const{topic:r}=n;if(this.client.session.keys.includes(r)){const i=an(),s=br().toString(),{done:o,resolve:a,reject:c}=Ur();this.events.once(fe("session_ping",i),({error:u})=>{u?c(u):a()}),await Promise.all([this.sendRequest({topic:r,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:i,relayRpcId:s}),o()])}else this.client.core.pairing.pairings.keys.includes(r)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:r}))}),V(this,"emit",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(n);const{topic:r,event:i,chainId:s}=n,o=br().toString(),a=an();await this.sendRequest({topic:r,method:"wc_sessionEvent",params:{event:i,chainId:s},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})}),V(this,"disconnect",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(n);const{topic:r}=n;if(this.client.session.keys.includes(r))await this.sendRequest({topic:r,method:"wc_sessionDelete",params:xe("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:r,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(r))await this.client.core.pairing.disconnect({topic:r});else{const{message:i}=G("MISMATCHED_TOPIC",`Session or pairing topic not found: ${r}`);throw new Error(i)}}),V(this,"find",n=>(this.isInitialized(),this.client.session.getAll().filter(r=>SI(r,n)))),V(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),V(this,"authenticate",async(n,r)=>{var i;this.isInitialized(),this.isValidAuthenticate(n);const s=r&&this.client.core.linkModeSupportedApps.includes(r)&&((i=this.client.metadata.redirect)==null?void 0:i.linkMode),o=s?ve.link_mode:ve.relay;o===ve.relay&&await this.confirmOnlineStateOrThrow();const{chains:a,statement:c="",uri:u,domain:l,nonce:h,type:d,exp:f,nbf:p,methods:b=[],expiry:v}=n,A=[...n.resources||[]],{topic:D,uri:_}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:D,uri:_}});const x=await this.client.core.crypto.generateKeyPair(),T=pa(x);if(await Promise.all([this.client.auth.authKeys.set(Ls,{responseTopic:T,publicKey:x}),this.client.auth.pairingTopics.set(T,{topic:T,pairingTopic:D})]),await this.client.core.relayer.subscribe(T,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${D}`),b.length>0){const{namespace:I}=Go(a[0]);let B=_5(I,"request",b);na(A)&&(B=I5(B,A.pop())),A.push(B)}const R=v&&v>Fe.wc_sessionAuthenticate.req.ttl?v:Fe.wc_sessionAuthenticate.req.ttl,F={authPayload:{type:d??"caip122",chains:a,statement:c,aud:u,domain:l,version:"1",nonce:h,iat:new Date().toISOString(),exp:f,nbf:p,resources:A},requester:{publicKey:x,metadata:this.client.metadata},expiryTimestamp:$e(R)},U={eip155:{chains:a,methods:[...new Set(["personal_sign",...b])],events:["chainChanged","accountsChanged"]}},$={requiredNamespaces:{},optionalNamespaces:U,relays:[{protocol:"irn"}],pairingTopic:D,proposer:{publicKey:x,metadata:this.client.metadata},expiryTimestamp:$e(Fe.wc_sessionPropose.req.ttl),id:an()},{done:z,resolve:M,reject:E}=Ur(R,"Request expired"),y=an(),m=fe("session_connect",$.id),g=fe("session_request",y),w=async({error:I,session:B})=>{this.events.off(g,S),I?E(I):B&&M({session:B})},S=async I=>{var B,P,L;if(await this.deletePendingAuthRequest(y,{message:"fulfilled",code:0}),I.error){const H=xe("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return I.error.code===H.code?void 0:(this.events.off(m,w),E(I.error.message))}await this.deleteProposal($.id),this.events.off(m,w);const{cacaos:C,responder:k}=I.result,N=[],q=[];for(const H of C){await X0({cacao:H,projectId:this.client.core.projectId})||(this.client.logger.error(H,"Signature verification failed"),E(xe("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:Z}=H,Q=na(Z.resources),ee=[ku(Z.iss)],se=ta(Z.iss);if(Q){const he=eg(Q),Ee=tg(Q);N.push(...he),ee.push(...Ee)}for(const he of ee)q.push(`${he}:${se}`)}const j=await this.client.core.crypto.generateSharedKey(x,k.publicKey);let W;N.length>0&&(W={topic:j,acknowledged:!0,self:{publicKey:x,metadata:this.client.metadata},peer:k,controller:k.publicKey,expiry:$e(Gr),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:D,namespaces:c1([...new Set(N)],[...new Set(q)]),transportType:o},await this.client.core.relayer.subscribe(j,{transportType:o}),await this.client.session.set(j,W),D&&await this.client.core.pairing.updateMetadata({topic:D,metadata:k.metadata}),W=this.client.session.get(j)),(B=this.client.metadata.redirect)!=null&&B.linkMode&&(P=k.metadata.redirect)!=null&&P.linkMode&&(L=k.metadata.redirect)!=null&&L.universal&&r&&(this.client.core.addLinkModeSupportedApp(k.metadata.redirect.universal),this.client.session.update(j,{transportType:ve.link_mode})),M({auths:C,session:W})};this.events.once(m,w),this.events.once(g,S);let O;try{if(s){const I=Fn("wc_sessionAuthenticate",F,y);this.client.core.history.set(D,I);const B=await this.client.core.crypto.encode("",I,{type:Es,encoding:yr});O=ya(r,D,B)}else await Promise.all([this.sendRequest({topic:D,method:"wc_sessionAuthenticate",params:F,expiry:n.expiry,throwOnFailedPublish:!0,clientRpcId:y}),this.sendRequest({topic:D,method:"wc_sessionPropose",params:$,expiry:Fe.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:$.id})])}catch(I){throw this.events.off(m,w),this.events.off(g,S),I}return await this.setProposal($.id,$),await this.setAuthRequest(y,{request:tt(de({},F),{verifyContext:{}}),pairingTopic:D,transportType:o}),{uri:O??_,response:z}}),V(this,"approveSessionAuthenticate",async n=>{const{id:r,auths:i}=n,s=this.client.core.eventClient.createEvent({properties:{topic:r.toString(),trace:[Hr.authenticated_session_approve_started]}});try{this.isInitialized()}catch(v){throw s.setError(Ts.no_internet_connection),v}const o=this.getPendingAuthRequest(r);if(!o)throw s.setError(Ts.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${r}`);const a=o.transportType||ve.relay;a===ve.relay&&await this.confirmOnlineStateOrThrow();const c=o.requester.publicKey,u=await this.client.core.crypto.generateKeyPair(),l=pa(c),h={type:Nn,receiverPublicKey:c,senderPublicKey:u},d=[],f=[];for(const v of i){if(!await X0({cacao:v,projectId:this.client.core.projectId})){s.setError(Ts.invalid_cacao);const T=xe("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:r,topic:l,error:T,encodeOpts:h}),new Error(T.message)}s.addTrace(Hr.cacaos_verified);const{p:A}=v,D=na(A.resources),_=[ku(A.iss)],x=ta(A.iss);if(D){const T=eg(D),R=tg(D);d.push(...T),_.push(...R)}for(const T of _)f.push(`${T}:${x}`)}const p=await this.client.core.crypto.generateSharedKey(u,c);s.addTrace(Hr.create_authenticated_session_topic);let b;if(d?.length>0){b={topic:p,acknowledged:!0,self:{publicKey:u,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:$e(Gr),authentication:i,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:c1([...new Set(d)],[...new Set(f)]),transportType:a},s.addTrace(Hr.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(p,{transportType:a})}catch(v){throw s.setError(Ts.subscribe_authenticated_session_topic_failure),v}s.addTrace(Hr.subscribe_authenticated_session_topic_success),await this.client.session.set(p,b),s.addTrace(Hr.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}s.addTrace(Hr.publishing_authenticated_session_approve);try{await this.sendResult({topic:l,id:r,result:{cacaos:i,responder:{publicKey:u,metadata:this.client.metadata}},encodeOpts:h,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(v){throw s.setError(Ts.authenticated_session_approve_publish_failure),v}return await this.client.auth.requests.delete(r,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:s.eventId}),{session:b}}),V(this,"rejectSessionAuthenticate",async n=>{this.isInitialized();const{id:r,reason:i}=n,s=this.getPendingAuthRequest(r);if(!s)throw new Error(`Could not find pending auth request with id ${r}`);s.transportType===ve.relay&&await this.confirmOnlineStateOrThrow();const o=s.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=pa(o),u={type:Nn,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:r,topic:c,error:i,encodeOpts:u,rpcOpts:Fe.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(s.requester.metadata,s.transportType)}),await this.client.auth.requests.delete(r,{message:"rejected",code:0}),await this.deleteProposal(r)}),V(this,"formatAuthMessage",n=>{this.isInitialized();const{request:r,iss:i}=n;return J0(r,i)}),V(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{const n=this.relayMessageCache.shift();n&&await this.onRelayMessage(n)}catch(n){this.client.logger.error(n)}},50)}),V(this,"cleanupDuplicatePairings",async n=>{if(n.pairingTopic)try{const r=this.client.core.pairing.pairings.get(n.pairingTopic),i=this.client.core.pairing.pairings.getAll().filter(s=>{var o,a;return((o=s.peerMetadata)==null?void 0:o.url)&&((a=s.peerMetadata)==null?void 0:a.url)===n.peer.metadata.url&&s.topic&&s.topic!==r.topic});if(i.length===0)return;this.client.logger.info(`Cleaning up ${i.length} duplicate pairing(s)`),await Promise.all(i.map(s=>this.client.core.pairing.disconnect({topic:s.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(r){this.client.logger.error(r)}}),V(this,"deleteSession",async n=>{var r;const{topic:i,expirerHasDeleted:s=!1,emitEvent:o=!0,id:a=0}=n,{self:c}=this.client.session.get(i);await this.client.core.relayer.unsubscribe(i),await this.client.session.delete(i,xe("USER_DISCONNECTED")),this.addToRecentlyDeleted(i,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(i)&&await this.client.core.crypto.deleteSymKey(i),s||this.client.core.expirer.del(i),this.client.core.storage.removeItem(Fl).catch(u=>this.client.logger.warn(u)),this.getPendingSessionRequests().forEach(u=>{u.topic===i&&this.deletePendingSessionRequest(u.id,xe("USER_DISCONNECTED"))}),i===((r=this.sessionRequestQueue.queue[0])==null?void 0:r.topic)&&(this.sessionRequestQueue.state=Jt.idle),o&&this.client.events.emit("session_delete",{id:a,topic:i})}),V(this,"deleteProposal",async(n,r)=>{if(r)try{const i=this.client.proposal.get(n),s=this.client.core.eventClient.getEvent({topic:i.pairingTopic});s?.setError($s.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(n,xe("USER_DISCONNECTED")),r?Promise.resolve():this.client.core.expirer.del(n)]),this.addToRecentlyDeleted(n,"proposal")}),V(this,"deletePendingSessionRequest",async(n,r,i=!1)=>{await Promise.all([this.client.pendingRequest.delete(n,r),i?Promise.resolve():this.client.core.expirer.del(n)]),this.addToRecentlyDeleted(n,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(s=>s.id!==n),i&&(this.sessionRequestQueue.state=Jt.idle,this.client.events.emit("session_request_expire",{id:n}))}),V(this,"deletePendingAuthRequest",async(n,r,i=!1)=>{await Promise.all([this.client.auth.requests.delete(n,r),i?Promise.resolve():this.client.core.expirer.del(n)])}),V(this,"setExpiry",async(n,r)=>{this.client.session.keys.includes(n)&&(this.client.core.expirer.set(n,r),await this.client.session.update(n,{expiry:r}))}),V(this,"setProposal",async(n,r)=>{this.client.core.expirer.set(n,$e(Fe.wc_sessionPropose.req.ttl)),await this.client.proposal.set(n,r)}),V(this,"setAuthRequest",async(n,r)=>{const{request:i,pairingTopic:s,transportType:o=ve.relay}=r;this.client.core.expirer.set(n,i.expiryTimestamp),await this.client.auth.requests.set(n,{authPayload:i.authPayload,requester:i.requester,expiryTimestamp:i.expiryTimestamp,id:n,pairingTopic:s,verifyContext:i.verifyContext,transportType:o})}),V(this,"setPendingSessionRequest",async n=>{const{id:r,topic:i,params:s,verifyContext:o}=n,a=s.request.expiryTimestamp||$e(Fe.wc_sessionRequest.req.ttl);this.client.core.expirer.set(r,a),await this.client.pendingRequest.set(r,{id:r,topic:i,params:s,verifyContext:o})}),V(this,"sendRequest",async n=>{const{topic:r,method:i,params:s,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:u,appLink:l,tvf:h,publishOpts:d={}}=n,f=Fn(i,s,c);let p;const b=!!l;try{const D=b?yr:xt;p=await this.client.core.crypto.encode(r,f,{encoding:D})}catch(D){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${r} failed`),D}let v;if(vy.includes(i)){const D=Lt(JSON.stringify(f)),_=Lt(p);v=await this.client.core.verify.register({id:_,decryptedId:D})}const A=de(de({},Fe[i].req),d);if(A.attestation=v,o&&(A.ttl=o),a&&(A.id=a),this.client.core.history.set(r,f),b){const D=ya(l,r,p);await global.Linking.openURL(D,this.client.name)}else A.tvf=tt(de({},h),{correlationId:f.id}),u?(A.internal=tt(de({},A.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(r,p,A)):this.client.core.relayer.publish(r,p,A).catch(D=>this.client.logger.error(D));return f.id}),V(this,"sendProposeSession",async n=>{const{proposal:r,publishOpts:i}=n,s=Fn("wc_sessionPropose",r,r.id);this.client.core.history.set(r.pairingTopic,s);const o=await this.client.core.crypto.encode(r.pairingTopic,s,{encoding:xt}),a=Lt(JSON.stringify(s)),c=Lt(o),u=await this.client.core.verify.register({id:c,decryptedId:a});await this.client.core.relayer.publishCustom({payload:{pairingTopic:r.pairingTopic,sessionProposal:o},opts:tt(de({},i),{publishMethod:"wc_proposeSession",attestation:u})})}),V(this,"sendApproveSession",async n=>{const{sessionTopic:r,pairingProposalResponse:i,proposal:s,sessionSettleRequest:o,publishOpts:a}=n,c=wa(s.id,i),u=await this.client.core.crypto.encode(s.pairingTopic,c,{encoding:xt}),l=Fn("wc_sessionSettle",o,a?.id),h=await this.client.core.crypto.encode(r,l,{encoding:xt});this.client.core.history.set(r,l),await this.client.core.relayer.publishCustom({payload:{sessionTopic:r,pairingTopic:s.pairingTopic,sessionProposalResponse:u,sessionSettlementRequest:h},opts:tt(de({},a),{publishMethod:"wc_approveSession"})})}),V(this,"sendResult",async n=>{const{id:r,topic:i,result:s,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=n,u=wa(r,s);let l;const h=c&&typeof(global==null?void 0:global.Linking)<"u";try{const p=h?yr:xt;l=await this.client.core.crypto.encode(i,u,tt(de({},a||{}),{encoding:p}))}catch(p){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${i} failed`),p}let d,f;try{d=await this.client.core.history.get(i,r);const p=d.request;try{f=this.getTVFParams(r,p.params,s)}catch(b){this.client.logger.warn(`sendResult() -> getTVFParams() failed: ${b?.message}`)}}catch(p){throw this.client.logger.error(`sendResult() -> history.get(${i}, ${r}) failed`),p}if(h){const p=ya(c,i,l);await global.Linking.openURL(p,this.client.name)}else{const p=d.request.method,b=Fe[p].res;b.tvf=tt(de({},f),{correlationId:r}),o?(b.internal=tt(de({},b.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,l,b)):this.client.core.relayer.publish(i,l,b).catch(v=>this.client.logger.error(v))}await this.client.core.history.resolve(u)}),V(this,"sendError",async n=>{const{id:r,topic:i,error:s,encodeOpts:o,rpcOpts:a,appLink:c}=n,u=wl(r,s);let l;const h=c&&typeof(global==null?void 0:global.Linking)<"u";try{const f=h?yr:xt;l=await this.client.core.crypto.encode(i,u,tt(de({},o||{}),{encoding:f}))}catch(f){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${i} failed`),f}let d;try{d=await this.client.core.history.get(i,r)}catch(f){throw this.client.logger.error(`sendError() -> history.get(${i}, ${r}) failed`),f}if(h){const f=ya(c,i,l);await global.Linking.openURL(f,this.client.name)}else{const f=d.request.method,p=a||Fe[f].res;this.client.core.relayer.publish(i,l,p)}await this.client.core.history.resolve(u)}),V(this,"cleanup",async()=>{const n=[],r=[];this.client.session.getAll().forEach(i=>{let s=!1;nr(i.expiry)&&(s=!0),this.client.core.crypto.keychain.has(i.topic)||(s=!0),s&&n.push(i.topic)}),this.client.proposal.getAll().forEach(i=>{nr(i.expiryTimestamp)&&r.push(i.id)}),await Promise.all([...n.map(i=>this.deleteSession({topic:i})),...r.map(i=>this.deleteProposal(i))])}),V(this,"onProviderMessageEvent",async n=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(n):await this.onRelayMessage(n)}),V(this,"onRelayEventRequest",async n=>{this.requestQueue.queue.push(n),await this.processRequestsQueue()}),V(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===Jt.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=Jt.active;const n=this.requestQueue.queue.shift();if(n)try{await this.processRequest(n)}catch(r){this.client.logger.warn(r)}}this.requestQueue.state=Jt.idle}),V(this,"processRequest",async n=>{const{topic:r,payload:i,attestation:s,transportType:o,encryptedId:a}=n,c=i.method;if(!this.shouldIgnorePairingRequest({topic:r,requestMethod:c}))switch(c){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:r,payload:i,attestation:s,encryptedId:a});case"wc_sessionSettle":return await this.onSessionSettleRequest(r,i);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(r,i);case"wc_sessionExtend":return await this.onSessionExtendRequest(r,i);case"wc_sessionPing":return await this.onSessionPingRequest(r,i);case"wc_sessionDelete":return await this.onSessionDeleteRequest(r,i);case"wc_sessionRequest":return await this.onSessionRequest({topic:r,payload:i,attestation:s,encryptedId:a,transportType:o});case"wc_sessionEvent":return await this.onSessionEventRequest(r,i);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:r,payload:i,attestation:s,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}}),V(this,"onRelayEventResponse",async n=>{const{topic:r,payload:i,transportType:s}=n,o=(await this.client.core.history.get(r,i.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(r,i,s);case"wc_sessionSettle":return this.onSessionSettleResponse(r,i);case"wc_sessionUpdate":return this.onSessionUpdateResponse(r,i);case"wc_sessionExtend":return this.onSessionExtendResponse(r,i);case"wc_sessionPing":return this.onSessionPingResponse(r,i);case"wc_sessionRequest":return this.onSessionRequestResponse(r,i);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(r,i);default:return this.client.logger.info(`Unsupported response method ${o}`)}}),V(this,"onRelayEventUnknownPayload",n=>{const{topic:r}=n,{message:i}=G("MISSING_OR_INVALID",`Decoded payload on topic ${r} is not identifiable as a JSON-RPC request or a response.`);throw new Error(i)}),V(this,"shouldIgnorePairingRequest",n=>{const{topic:r,requestMethod:i}=n,s=this.expectedPairingMethodMap.get(r);return!s||s.includes(i)?!1:!!(s.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),V(this,"onSessionProposeRequest",async n=>{const{topic:r,payload:i,attestation:s,encryptedId:o}=n,{params:a,id:c}=i;try{const u=this.client.core.eventClient.getEvent({topic:r});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),u?.setError(Ln.proposal_listener_not_found)),this.isValidConnect(de({},i.params));const l=a.expiryTimestamp||$e(Fe.wc_sessionPropose.req.ttl),h=de({id:c,pairingTopic:r,expiryTimestamp:l,attestation:s,encryptedId:o},a);await this.setProposal(c,h);const d=await this.getVerifyContext({attestationId:s,hash:Lt(JSON.stringify(i)),encryptedId:o,metadata:h.proposer.metadata});u?.addTrace(ln.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:h,verifyContext:d})}catch(u){await this.sendError({id:c,topic:r,error:u,rpcOpts:Fe.wc_sessionPropose.autoReject}),this.client.logger.error(u)}}),V(this,"onSessionProposeResponse",async(n,r,i)=>{const{id:s}=r;if(cn(r)){const{result:o}=r;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const a=this.client.proposal.get(s);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const u=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:u});const l=await this.client.core.crypto.generateSharedKey(c,u);this.pendingSessions.set(s,{sessionTopic:l,pairingTopic:n,proposalId:s,publicKey:c});const h=await this.client.core.relayer.subscribe(l,{transportType:i});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:h}),await this.client.core.pairing.activate({topic:n})}else if(kt(r)){await this.deleteProposal(s);const o=fe("session_connect",s);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:r.error})}}),V(this,"onSessionSettleRequest",async(n,r)=>{const{id:i,params:s}=r;try{this.isValidSessionSettleRequest(s);const{relay:o,controller:a,expiry:c,namespaces:u,sessionProperties:l,scopedProperties:h,sessionConfig:d}=r.params,f=[...this.pendingSessions.values()].find(v=>v.sessionTopic===n);if(!f)return this.client.logger.error(`Pending session not found for topic ${n}`);const p=this.client.proposal.get(f.proposalId),b=tt(de(de(de({topic:n,relay:o,expiry:c,namespaces:u,acknowledged:!0,pairingTopic:f.pairingTopic,requiredNamespaces:p.requiredNamespaces,optionalNamespaces:p.optionalNamespaces,controller:a.publicKey,self:{publicKey:f.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},l&&{sessionProperties:l}),h&&{scopedProperties:h}),d&&{sessionConfig:d}),{transportType:ve.relay});await this.client.session.set(b.topic,b),await this.setExpiry(b.topic,b.expiry),await this.client.core.pairing.updateMetadata({topic:f.pairingTopic,metadata:b.peer.metadata}),this.client.events.emit("session_connect",{session:b}),this.events.emit(fe("session_connect",f.proposalId),{session:b}),this.pendingSessions.delete(f.proposalId),this.deleteProposal(f.proposalId,!1),this.cleanupDuplicatePairings(b),await this.sendResult({id:r.id,topic:n,result:!0})}catch(o){await this.sendError({id:i,topic:n,error:o}),this.client.logger.error(o)}}),V(this,"onSessionSettleResponse",async(n,r)=>{const{id:i}=r;cn(r)?(await this.client.session.update(n,{acknowledged:!0}),this.events.emit(fe("session_approve",i),{})):kt(r)&&(await this.client.session.delete(n,xe("USER_DISCONNECTED")),this.events.emit(fe("session_approve",i),{error:r.error}))}),V(this,"onSessionUpdateRequest",async(n,r)=>{const{params:i,id:s}=r;try{const o=`${n}_session_update`,a=Is.get(o);if(a&&this.isRequestOutOfSync(a,s)){this.client.logger.warn(`Discarding out of sync request - ${s}`),this.sendError({id:s,topic:n,error:xe("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(de({topic:n},i));try{Is.set(o,s),await this.client.session.update(n,{namespaces:i.namespaces}),await this.sendResult({id:s,topic:n,result:!0})}catch(c){throw Is.delete(o),c}this.client.events.emit("session_update",{id:s,topic:n,params:i})}catch(o){await this.sendError({id:s,topic:n,error:o}),this.client.logger.error(o)}}),V(this,"isRequestOutOfSync",(n,r)=>r.toString().slice(0,-3)<n.toString().slice(0,-3)),V(this,"onSessionUpdateResponse",(n,r)=>{const{id:i}=r,s=fe("session_update",i);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);cn(r)?this.events.emit(fe("session_update",i),{}):kt(r)&&this.events.emit(fe("session_update",i),{error:r.error})}),V(this,"onSessionExtendRequest",async(n,r)=>{const{id:i}=r;try{this.isValidExtend({topic:n}),await this.setExpiry(n,$e(Gr)),await this.sendResult({id:i,topic:n,result:!0}),this.client.events.emit("session_extend",{id:i,topic:n})}catch(s){await this.sendError({id:i,topic:n,error:s}),this.client.logger.error(s)}}),V(this,"onSessionExtendResponse",(n,r)=>{const{id:i}=r,s=fe("session_extend",i);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);cn(r)?this.events.emit(fe("session_extend",i),{}):kt(r)&&this.events.emit(fe("session_extend",i),{error:r.error})}),V(this,"onSessionPingRequest",async(n,r)=>{const{id:i}=r;try{this.isValidPing({topic:n}),await this.sendResult({id:i,topic:n,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:i,topic:n})}catch(s){await this.sendError({id:i,topic:n,error:s}),this.client.logger.error(s)}}),V(this,"onSessionPingResponse",(n,r)=>{const{id:i}=r,s=fe("session_ping",i);setTimeout(()=>{if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners 2176`);cn(r)?this.events.emit(fe("session_ping",i),{}):kt(r)&&this.events.emit(fe("session_ping",i),{error:r.error})},500)}),V(this,"onSessionDeleteRequest",async(n,r)=>{const{id:i}=r;try{this.isValidDisconnect({topic:n,reason:r.params}),await Promise.all([new Promise(s=>{this.client.core.relayer.once(Ie.publish,async()=>{s(await this.deleteSession({topic:n,id:i}))})}),this.sendResult({id:i,topic:n,result:!0}),this.cleanupPendingSentRequestsForTopic({topic:n,error:xe("USER_DISCONNECTED")})]).catch(s=>this.client.logger.error(s))}catch(s){this.client.logger.error(s)}}),V(this,"onSessionRequest",async n=>{var r,i,s;const{topic:o,payload:a,attestation:c,encryptedId:u,transportType:l}=n,{id:h,params:d}=a;try{await this.isValidRequest(de({topic:o},d));const f=this.client.session.get(o),p=await this.getVerifyContext({attestationId:c,hash:Lt(JSON.stringify(Fn("wc_sessionRequest",d,h))),encryptedId:u,metadata:f.peer.metadata,transportType:l}),b={id:h,topic:o,params:d,verifyContext:p};await this.setPendingSessionRequest(b),l===ve.link_mode&&(r=f.peer.metadata.redirect)!=null&&r.universal&&this.client.core.addLinkModeSupportedApp((i=f.peer.metadata.redirect)==null?void 0:i.universal),(s=this.client.signConfig)!=null&&s.disableRequestQueue?this.emitSessionRequest(b):(this.addSessionRequestToSessionRequestQueue(b),this.processSessionRequestQueue())}catch(f){await this.sendError({id:h,topic:o,error:f}),this.client.logger.error(f)}}),V(this,"onSessionRequestResponse",(n,r)=>{const{id:i}=r,s=fe("session_request",i);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);cn(r)?this.events.emit(fe("session_request",i),{result:r.result}):kt(r)&&this.events.emit(fe("session_request",i),{error:r.error})}),V(this,"onSessionEventRequest",async(n,r)=>{const{id:i,params:s}=r;try{const o=`${n}_session_event_${s.event.name}`,a=Is.get(o);if(a&&this.isRequestOutOfSync(a,i)){this.client.logger.info(`Discarding out of sync request - ${i}`);return}this.isValidEmit(de({topic:n},s)),this.client.events.emit("session_event",{id:i,topic:n,params:s}),Is.set(o,i)}catch(o){await this.sendError({id:i,topic:n,error:o}),this.client.logger.error(o)}}),V(this,"onSessionAuthenticateResponse",(n,r)=>{const{id:i}=r;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:n,payload:r}),cn(r)?this.events.emit(fe("session_request",i),{result:r.result}):kt(r)&&this.events.emit(fe("session_request",i),{error:r.error})}),V(this,"onSessionAuthenticateRequest",async n=>{var r;const{topic:i,payload:s,attestation:o,encryptedId:a,transportType:c}=n;try{const{requester:u,authPayload:l,expiryTimestamp:h}=s.params,d=await this.getVerifyContext({attestationId:o,hash:Lt(JSON.stringify(s)),encryptedId:a,metadata:u.metadata,transportType:c}),f={requester:u,pairingTopic:i,id:s.id,authPayload:l,verifyContext:d,expiryTimestamp:h};await this.setAuthRequest(s.id,{request:f,pairingTopic:i,transportType:c}),c===ve.link_mode&&(r=u.metadata.redirect)!=null&&r.universal&&this.client.core.addLinkModeSupportedApp(u.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:i,params:s.params,id:s.id,verifyContext:d})}catch(u){this.client.logger.error(u);const l=s.params.requester.publicKey,h=await this.client.core.crypto.generateKeyPair(),d=this.getAppLinkIfEnabled(s.params.requester.metadata,c),f={type:Nn,receiverPublicKey:l,senderPublicKey:h};await this.sendError({id:s.id,topic:i,error:u,encodeOpts:f,rpcOpts:Fe.wc_sessionAuthenticate.autoReject,appLink:d})}}),V(this,"addSessionRequestToSessionRequestQueue",n=>{this.sessionRequestQueue.queue.push(n)}),V(this,"cleanupAfterResponse",n=>{this.deletePendingSessionRequest(n.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=Jt.idle,this.processSessionRequestQueue()},K.toMiliseconds(this.requestQueueDelay))}),V(this,"cleanupPendingSentRequestsForTopic",({topic:n,error:r})=>{const i=this.client.core.history.pending;i.length>0&&i.filter(s=>s.topic===n&&s.request.method==="wc_sessionRequest").forEach(s=>{const o=s.request.id,a=fe("session_request",o);if(this.events.listenerCount(a)===0)throw new Error(`emitting ${a} without any listeners`);this.events.emit(fe("session_request",s.request.id),{error:r})})}),V(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===Jt.active){this.client.logger.info("session request queue is already active.");return}const n=this.sessionRequestQueue.queue[0];if(!n){this.client.logger.info("session request queue is empty.");return}try{this.emitSessionRequest(n)}catch(r){this.client.logger.error(r)}}),V(this,"emitSessionRequest",n=>{if(this.emittedSessionRequests.has(n.id)){this.client.logger.warn({id:n.id},`Skipping emitting \`session_request\` event for duplicate request. id: ${n.id}`);return}this.sessionRequestQueue.state=Jt.active,this.emittedSessionRequests.add(n.id),this.client.events.emit("session_request",n)}),V(this,"onPairingCreated",n=>{if(n.methods&&this.expectedPairingMethodMap.set(n.topic,n.methods),n.active)return;const r=this.client.proposal.getAll().find(i=>i.pairingTopic===n.topic);r&&this.onSessionProposeRequest({topic:n.topic,payload:Fn("wc_sessionPropose",tt(de({},r),{requiredNamespaces:r.requiredNamespaces,optionalNamespaces:r.optionalNamespaces,relays:r.relays,proposer:r.proposer,sessionProperties:r.sessionProperties,scopedProperties:r.scopedProperties}),r.id),attestation:r.attestation,encryptedId:r.encryptedId})}),V(this,"isValidConnect",async n=>{if(!_t(n)){const{message:u}=G("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(n)}`);throw new Error(u)}const{pairingTopic:r,requiredNamespaces:i,optionalNamespaces:s,sessionProperties:o,scopedProperties:a,relays:c}=n;if(Pe(r)||await this.isValidPairingTopic(r),!UI(c,!0)){const{message:u}=G("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(u)}if(!Pe(i)&&Ss(i)!==0){const u="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(u):this.client.logger.warn(u),this.validateNamespaces(i,"requiredNamespaces")}if(!Pe(s)&&Ss(s)!==0&&this.validateNamespaces(s,"optionalNamespaces"),Pe(o)||this.validateSessionProps(o,"sessionProperties"),!Pe(a)){this.validateSessionProps(a,"scopedProperties");const u=Object.keys(i||{}).concat(Object.keys(s||{}));if(!Object.keys(a).every(l=>u.includes(l.split(":")[0])))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(u)}`)}}),V(this,"validateNamespaces",(n,r)=>{const i=CI(n,"connect()",r);if(i)throw new Error(i.message)}),V(this,"isValidApprove",async n=>{if(!_t(n))throw new Error(G("MISSING_OR_INVALID",`approve() params: ${n}`).message);const{id:r,namespaces:i,relayProtocol:s,sessionProperties:o,scopedProperties:a}=n;this.checkRecentlyDeleted(r),await this.isValidProposalId(r);const c=this.client.proposal.get(r),u=fl(i,"approve()");if(u)throw new Error(u.message);const l=d1(c.requiredNamespaces,i,"approve()");if(l)throw new Error(l.message);if(!Oe(s,!0)){const{message:h}=G("MISSING_OR_INVALID",`approve() relayProtocol: ${s}`);throw new Error(h)}if(Pe(o)||this.validateSessionProps(o,"sessionProperties"),!Pe(a)){this.validateSessionProps(a,"scopedProperties");const h=new Set(Object.keys(i));if(!Object.keys(a).every(d=>h.has(d.split(":")[0])))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(h).join(", ")}`)}}),V(this,"isValidReject",async n=>{if(!_t(n)){const{message:s}=G("MISSING_OR_INVALID",`reject() params: ${n}`);throw new Error(s)}const{id:r,reason:i}=n;if(this.checkRecentlyDeleted(r),await this.isValidProposalId(r),!LI(i)){const{message:s}=G("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(i)}`);throw new Error(s)}}),V(this,"isValidSessionSettleRequest",n=>{if(!_t(n)){const{message:u}=G("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${n}`);throw new Error(u)}const{relay:r,controller:i,namespaces:s,expiry:o}=n;if(!f1(r)){const{message:u}=G("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(u)}const a=DI(i,"onSessionSettleRequest()");if(a)throw new Error(a.message);const c=fl(s,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(nr(o)){const{message:u}=G("EXPIRED","onSessionSettleRequest()");throw new Error(u)}}),V(this,"isValidUpdate",async n=>{if(!_t(n)){const{message:c}=G("MISSING_OR_INVALID",`update() params: ${n}`);throw new Error(c)}const{topic:r,namespaces:i}=n;this.checkRecentlyDeleted(r),await this.isValidSessionTopic(r);const s=this.client.session.get(r),o=fl(i,"update()");if(o)throw new Error(o.message);const a=d1(s.requiredNamespaces,i,"update()");if(a)throw new Error(a.message)}),V(this,"isValidExtend",async n=>{if(!_t(n)){const{message:i}=G("MISSING_OR_INVALID",`extend() params: ${n}`);throw new Error(i)}const{topic:r}=n;this.checkRecentlyDeleted(r),await this.isValidSessionTopic(r)}),V(this,"isValidRequest",async n=>{if(!_t(n)){const{message:c}=G("MISSING_OR_INVALID",`request() params: ${n}`);throw new Error(c)}const{topic:r,request:i,chainId:s,expiry:o}=n;this.checkRecentlyDeleted(r),await this.isValidSessionTopic(r);const{namespaces:a}=this.client.session.get(r);if(!h1(a,s)){const{message:c}=G("MISSING_OR_INVALID",`request() chainId: ${s}`);throw new Error(c)}if(!kI(i)){const{message:c}=G("MISSING_OR_INVALID",`request() ${JSON.stringify(i)}`);throw new Error(c)}if(!jI(a,s,i.method)){const{message:c}=G("MISSING_OR_INVALID",`request() method: ${i.method}`);throw new Error(c)}if(o&&!KI(o,Ia)){const{message:c}=G("MISSING_OR_INVALID",`request() expiry: ${o}. Expiry must be a number (in seconds) between ${Ia.min} and ${Ia.max}`);throw new Error(c)}}),V(this,"isValidRespond",async n=>{var r;if(!_t(n)){const{message:o}=G("MISSING_OR_INVALID",`respond() params: ${n}`);throw new Error(o)}const{topic:i,response:s}=n;try{await this.isValidSessionTopic(i)}catch(o){throw(r=n?.response)!=null&&r.id&&this.cleanupAfterResponse(n),o}if(!qI(s)){const{message:o}=G("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(s)}`);throw new Error(o)}}),V(this,"isValidPing",async n=>{if(!_t(n)){const{message:i}=G("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(i)}const{topic:r}=n;await this.isValidSessionOrPairingTopic(r)}),V(this,"isValidEmit",async n=>{if(!_t(n)){const{message:a}=G("MISSING_OR_INVALID",`emit() params: ${n}`);throw new Error(a)}const{topic:r,event:i,chainId:s}=n;await this.isValidSessionTopic(r);const{namespaces:o}=this.client.session.get(r);if(!h1(o,s)){const{message:a}=G("MISSING_OR_INVALID",`emit() chainId: ${s}`);throw new Error(a)}if(!MI(i)){const{message:a}=G("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(i)}`);throw new Error(a)}if(!zI(o,s,i.name)){const{message:a}=G("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(i)}`);throw new Error(a)}}),V(this,"isValidDisconnect",async n=>{if(!_t(n)){const{message:i}=G("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(i)}const{topic:r}=n;await this.isValidSessionOrPairingTopic(r)}),V(this,"isValidAuthenticate",n=>{const{chains:r,uri:i,domain:s,nonce:o}=n;if(!Array.isArray(r)||r.length===0)throw new Error("chains is required and must be a non-empty array");if(!Oe(i,!1))throw new Error("uri is required parameter");if(!Oe(s,!1))throw new Error("domain is required parameter");if(!Oe(o,!1))throw new Error("nonce is required parameter");if([...new Set(r.map(c=>Go(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:a}=Go(r[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),V(this,"getVerifyContext",async n=>{const{attestationId:r,hash:i,encryptedId:s,metadata:o,transportType:a}=n,c={verified:{verifyUrl:o.verifyUrl||Ds,validation:"UNKNOWN",origin:o.url||""}};try{if(a===ve.link_mode){const l=this.getAppLinkIfEnabled(o,a);return c.verified.validation=l&&new URL(l).origin===new URL(o.url).origin?"VALID":"INVALID",c}const u=await this.client.core.verify.resolve({attestationId:r,hash:i,encryptedId:s,verifyUrl:o.verifyUrl});u&&(c.verified.origin=u.origin,c.verified.isScam=u.isScam,c.verified.validation=u.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(u){this.client.logger.warn(u)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c}),V(this,"validateSessionProps",(n,r)=>{Object.values(n).forEach((i,s)=>{if(i==null){const{message:o}=G("MISSING_OR_INVALID",`${r} must contain an existing value for each key. Received: ${i} for key ${Object.keys(n)[s]}`);throw new Error(o)}})}),V(this,"getPendingAuthRequest",n=>{const r=this.client.auth.requests.get(n);return typeof r=="object"?r:void 0}),V(this,"addToRecentlyDeleted",(n,r)=>{if(this.recentlyDeletedMap.set(n,r),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let i=0;const s=this.recentlyDeletedLimit/2;for(const o of this.recentlyDeletedMap.keys()){if(i++>=s)break;this.recentlyDeletedMap.delete(o)}}}),V(this,"checkRecentlyDeleted",n=>{const r=this.recentlyDeletedMap.get(n);if(r){const{message:i}=G("MISSING_OR_INVALID",`Record was recently deleted - ${r}: ${n}`);throw new Error(i)}}),V(this,"isLinkModeEnabled",(n,r)=>{var i,s,o,a,c,u,l,h,d;return!n||r!==ve.link_mode?!1:((s=(i=this.client.metadata)==null?void 0:i.redirect)==null?void 0:s.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((u=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:u.universal)!==""&&((l=n?.redirect)==null?void 0:l.universal)!==void 0&&((h=n?.redirect)==null?void 0:h.universal)!==""&&((d=n?.redirect)==null?void 0:d.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(n.redirect.universal)&&typeof(global==null?void 0:global.Linking)<"u"}),V(this,"getAppLinkIfEnabled",(n,r)=>{var i;return this.isLinkModeEnabled(n,r)?(i=n?.redirect)==null?void 0:i.universal:void 0}),V(this,"handleLinkModeMessage",({url:n})=>{if(!n||!n.includes("wc_ev")||!n.includes("topic"))return;const r=I0(n,"topic")||"",i=decodeURIComponent(I0(n,"wc_ev")||""),s=this.client.session.keys.includes(r);s&&this.client.session.update(r,{transportType:ve.link_mode}),this.client.core.dispatchEnvelope({topic:r,message:i,sessionExists:s})}),V(this,"registerLinkModeListeners",async()=>{var n;if($u()||tr()&&(n=this.client.metadata.redirect)!=null&&n.linkMode){const r=global==null?void 0:global.Linking;if(typeof r<"u"){r.addEventListener("url",this.handleLinkModeMessage,this.client.name);const i=await r.getInitialURL();i&&setTimeout(()=>{this.handleLinkModeMessage({url:i})},50)}}}),V(this,"getTVFParams",(n,r,i)=>{var s,o,a;if(!((s=r.request)!=null&&s.method))return{};const c={correlationId:n,rpcMethods:[r.request.method],chainId:r.chainId};try{const u=this.extractTxHashesFromResult(r.request,i);c.txHashes=u,c.contractAddresses=this.isValidContractData(r.request.params)?[(a=(o=r.request.params)==null?void 0:o[0])==null?void 0:a.to]:[]}catch(u){this.client.logger.warn("Error getting TVF params",u)}return c}),V(this,"isValidContractData",n=>{var r;if(!n)return!1;try{const i=n?.data||((r=n?.[0])==null?void 0:r.data);if(!i.startsWith("0x"))return!1;const s=i.slice(2);return/^[0-9a-fA-F]*$/.test(s)?s.length%2===0:!1}catch{}return!1}),V(this,"extractTxHashesFromResult",(n,r)=>{var i;try{if(!r)return[];const s=n.method,o=wy[s];if(s==="sui_signTransaction")return[o5(r.transactionBytes)];if(s==="near_signTransaction")return[G0(r)];if(s==="near_signTransactions")return r.map(c=>G0(c));if(s==="xrpl_signTransactionFor"||s==="xrpl_signTransaction")return[(i=r.tx_json)==null?void 0:i.hash];if(s==="polkadot_signTransaction")return[a9({transaction:n.params.transactionPayload,signature:r.signature})];if(s==="algo_signTxn")return Bi(r)?r.map(c=>W0(c)):[W0(r)];if(s==="cosmos_signDirect")return[c5(r)];if(s==="wallet_sendCalls")return u5(r);if(typeof r=="string")return[r];const a=r[o.key];if(Bi(a))return s==="solana_signAllTransactions"?a.map(c=>s5(c)):a;if(typeof a=="string")return[a]}catch(s){this.client.logger.warn("Error extracting tx hashes from result",s)}return[]})}async processPendingMessageEvents(){try{const e=this.client.session.keys,n=this.client.core.relayer.messages.getWithoutAck(e);for(const[r,i]of Object.entries(n))for(const s of i)try{await this.onProviderMessageEvent({topic:r,message:s,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${r}, message: ${s}`)}}catch(e){this.client.logger.warn("processPendingMessageEvents failed",e)}}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Ie.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){const{topic:n,message:r,attestation:i,transportType:s}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(Ls)?this.client.auth.authKeys.get(Ls):{responseTopic:void 0,publicKey:void 0};try{const a=await this.client.core.crypto.decode(n,r,{receiverPublicKey:o,encoding:s===ve.link_mode?yr:xt});ml(a)?(this.client.core.history.set(n,a),await this.onRelayEventRequest({topic:n,payload:a,attestation:i,transportType:s,encryptedId:Lt(r)})):ma(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:n,payload:a,transportType:s}),this.client.core.history.delete(n,a.id)):await this.onRelayEventUnknownPayload({topic:n,payload:a,transportType:s}),await this.client.core.relayer.messages.ack(n,r)}catch(a){this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(Mt.expired,async e=>{const{topic:n,id:r}=S0(e.target);if(r&&this.client.pendingRequest.keys.includes(r))return await this.deletePendingSessionRequest(r,G("EXPIRED"),!0);if(r&&this.client.auth.requests.keys.includes(r))return await this.deletePendingAuthRequest(r,G("EXPIRED"),!0);n?this.client.session.keys.includes(n)&&(await this.deleteSession({topic:n,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:n})):r&&(await this.deleteProposal(r,!0),this.client.events.emit("proposal_expire",{id:r}))})}registerPairingEvents(){this.client.core.pairing.events.on(Vr.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(Vr.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!Oe(e,!1)){const{message:n}=G("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(n)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:n}=G("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(n)}if(nr(this.client.core.pairing.pairings.get(e).expiry)){const{message:n}=G("EXPIRED",`pairing topic: ${e}`);throw new Error(n)}}async isValidSessionTopic(e){if(!Oe(e,!1)){const{message:n}=G("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(n)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:n}=G("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(n)}if(nr(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:n}=G("EXPIRED",`session topic: ${e}`);throw new Error(n)}if(!this.client.core.crypto.keychain.has(e)){const{message:n}=G("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(n)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(Oe(e,!1)){const{message:n}=G("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(n)}else{const{message:n}=G("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(n)}}async isValidProposalId(e){if(!FI(e)){const{message:n}=G("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(n)}if(!this.client.proposal.keys.includes(e)){const{message:n}=G("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(n)}if(nr(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:n}=G("EXPIRED",`proposal id: ${e}`);throw new Error(n)}}}class ZB extends Kr{constructor(e,n){super(e,n,gy,_a),this.core=e,this.logger=n}}class Ay extends Kr{constructor(e,n){super(e,n,yy,_a),this.core=e,this.logger=n}}class YB extends Kr{constructor(e,n){super(e,n,my,_a,r=>r.id),this.core=e,this.logger=n}}class XB extends Kr{constructor(e,n){super(e,n,_y,Fs,()=>Ls),this.core=e,this.logger=n}}class JB extends Kr{constructor(e,n){super(e,n,Sy,Fs),this.core=e,this.logger=n}}class QB extends Kr{constructor(e,n){super(e,n,Iy,Fs,r=>r.id),this.core=e,this.logger=n}}var eD=Object.defineProperty,tD=(t,e,n)=>e in t?eD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,ql=(t,e,n)=>tD(t,typeof e!="symbol"?e+"":e,n);class nD{constructor(e,n){this.core=e,this.logger=n,ql(this,"authKeys"),ql(this,"pairingTopics"),ql(this,"requests"),this.authKeys=new XB(this.core,this.logger),this.pairingTopics=new JB(this.core,this.logger),this.requests=new QB(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var rD=Object.defineProperty,iD=(t,e,n)=>e in t?rD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,ae=(t,e,n)=>iD(t,typeof e!="symbol"?e+"":e,n);class Oa extends Vw{constructor(e){super(e),ae(this,"protocol",Nl),ae(this,"version",Cl),ae(this,"name",Sa.name),ae(this,"metadata"),ae(this,"core"),ae(this,"logger"),ae(this,"events",new ft.exports.EventEmitter),ae(this,"engine"),ae(this,"session"),ae(this,"proposal"),ae(this,"pendingRequest"),ae(this,"auth"),ae(this,"signConfig"),ae(this,"on",(r,i)=>this.events.on(r,i)),ae(this,"once",(r,i)=>this.events.once(r,i)),ae(this,"off",(r,i)=>this.events.off(r,i)),ae(this,"removeListener",(r,i)=>this.events.removeListener(r,i)),ae(this,"removeAllListeners",r=>this.events.removeAllListeners(r)),ae(this,"connect",async r=>{try{return await this.engine.connect(r)}catch(i){throw this.logger.error(i.message),i}}),ae(this,"pair",async r=>{try{return await this.engine.pair(r)}catch(i){throw this.logger.error(i.message),i}}),ae(this,"approve",async r=>{try{return await this.engine.approve(r)}catch(i){throw this.logger.error(i.message),i}}),ae(this,"reject",async r=>{try{return await this.engine.reject(r)}catch(i){throw this.logger.error(i.message),i}}),ae(this,"update",async r=>{try{return await this.engine.update(r)}catch(i){throw this.logger.error(i.message),i}}),ae(this,"extend",async r=>{try{return await this.engine.extend(r)}catch(i){throw this.logger.error(i.message),i}}),ae(this,"request",async r=>{try{return await this.engine.request(r)}catch(i){throw this.logger.error(i.message),i}}),ae(this,"respond",async r=>{try{return await this.engine.respond(r)}catch(i){throw this.logger.error(i.message),i}}),ae(this,"ping",async r=>{try{return await this.engine.ping(r)}catch(i){throw this.logger.error(i.message),i}}),ae(this,"emit",async r=>{try{return await this.engine.emit(r)}catch(i){throw this.logger.error(i.message),i}}),ae(this,"disconnect",async r=>{try{return await this.engine.disconnect(r)}catch(i){throw this.logger.error(i.message),i}}),ae(this,"find",r=>{try{return this.engine.find(r)}catch(i){throw this.logger.error(i.message),i}}),ae(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(r){throw this.logger.error(r.message),r}}),ae(this,"authenticate",async(r,i)=>{try{return await this.engine.authenticate(r,i)}catch(s){throw this.logger.error(s.message),s}}),ae(this,"formatAuthMessage",r=>{try{return this.engine.formatAuthMessage(r)}catch(i){throw this.logger.error(i.message),i}}),ae(this,"approveSessionAuthenticate",async r=>{try{return await this.engine.approveSessionAuthenticate(r)}catch(i){throw this.logger.error(i.message),i}}),ae(this,"rejectSessionAuthenticate",async r=>{try{return await this.engine.rejectSessionAuthenticate(r)}catch(i){throw this.logger.error(i.message),i}}),this.name=e?.name||Sa.name,this.metadata=Q_(e?.metadata),this.signConfig=e?.signConfig;const n=typeof e?.logger<"u"&&typeof e?.logger!="string"?e.logger:hn(ja({level:e?.logger||Sa.logger}));this.core=e?.core||new CB(e),this.logger=nt(n,this.name),this.session=new Ay(this.core,this.logger),this.proposal=new ZB(this.core,this.logger),this.pendingRequest=new YB(this.core,this.logger),this.engine=new WB(this),this.auth=new nD(this.core,this.logger)}static async init(e){const n=new Oa(e);return await n.initialize(),n}get context(){return dt(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}}const sD=Ay,oD=Oa;re.AUTH_CONTEXT=xy,re.AUTH_KEYS_CONTEXT=_y,re.AUTH_PAIRING_TOPIC_CONTEXT=Sy,re.AUTH_PROTOCOL=Ey,re.AUTH_PUBLIC_KEY_NAME=Ls,re.AUTH_REQUEST_CONTEXT=Iy,re.AUTH_STORAGE_PREFIX=Fs,re.AUTH_VERSION=jB,re.ENGINE_CONTEXT=by,re.ENGINE_QUEUE_STATES=Jt,re.ENGINE_RPC_OPTS=Fe,re.HISTORY_CONTEXT=kB,re.HISTORY_EVENTS=LB,re.HISTORY_STORAGE_VERSION=qB,re.METHODS_TO_VERIFY=vy,re.PROPOSAL_CONTEXT=gy,re.PROPOSAL_EXPIRY=MB,re.PROPOSAL_EXPIRY_MESSAGE=Ll,re.REQUEST_CONTEXT=my,re.SESSION_CONTEXT=yy,re.SESSION_EXPIRY=Gr,re.SESSION_REQUEST_EXPIRY_BOUNDARIES=Ia,re.SIGN_CLIENT_CONTEXT=Ul,re.SIGN_CLIENT_DEFAULT=Sa,re.SIGN_CLIENT_EVENTS=UB,re.SIGN_CLIENT_PROTOCOL=Nl,re.SIGN_CLIENT_STORAGE_OPTIONS=FB,re.SIGN_CLIENT_STORAGE_PREFIX=_a,re.SIGN_CLIENT_VERSION=Cl,re.SessionStore=sD,re.SignClient=oD,re.TVF_METHODS=wy,re.WALLETCONNECT_DEEPLINK_CHOICE=Fl,re.default=Oa,Object.defineProperty(re,"__esModule",{value:!0})});
//# sourceMappingURL=index.umd.js.map

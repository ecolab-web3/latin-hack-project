(function(V,Tt){typeof exports=="object"&&typeof module<"u"?Tt(exports):typeof define=="function"&&define.amd?define(["exports"],Tt):(V=typeof globalThis<"u"?globalThis:V||self,Tt(V["@walletconnect/core"]={}))})(this,function(V){"use strict";var Tt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Jc(e){var t=e.default;if(typeof t=="function"){var n=function(){return t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return e[r]}})}),n}var lt={exports:{}},ir=typeof Reflect=="object"?Reflect:null,Qc=ir&&typeof ir.apply=="function"?ir.apply:function(t,n,r){return Function.prototype.apply.call(t,n,r)},Ui;ir&&typeof ir.ownKeys=="function"?Ui=ir.ownKeys:Object.getOwnPropertySymbols?Ui=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Ui=function(t){return Object.getOwnPropertyNames(t)};function up(e){console&&console.warn&&console.warn(e)}var ef=Number.isNaN||function(t){return t!==t};function ae(){ae.init.call(this)}lt.exports=ae,lt.exports.once=gp,ae.EventEmitter=ae,ae.prototype._events=void 0,ae.prototype._eventsCount=0,ae.prototype._maxListeners=void 0;var tf=10;function Fi(e){if(typeof e!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}Object.defineProperty(ae,"defaultMaxListeners",{enumerable:!0,get:function(){return tf},set:function(e){if(typeof e!="number"||e<0||ef(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");tf=e}}),ae.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},ae.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||ef(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function nf(e){return e._maxListeners===void 0?ae.defaultMaxListeners:e._maxListeners}ae.prototype.getMaxListeners=function(){return nf(this)},ae.prototype.emit=function(t){for(var n=[],r=1;r<arguments.length;r++)n.push(arguments[r]);var i=t==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var o;if(n.length>0&&(o=n[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=s[t];if(c===void 0)return!1;if(typeof c=="function")Qc(c,this,n);else for(var f=c.length,u=cf(c,f),r=0;r<f;++r)Qc(u[r],this,n);return!0};function rf(e,t,n,r){var i,s,o;if(Fi(n),s=e._events,s===void 0?(s=e._events=Object.create(null),e._eventsCount=0):(s.newListener!==void 0&&(e.emit("newListener",t,n.listener?n.listener:n),s=e._events),o=s[t]),o===void 0)o=s[t]=n,++e._eventsCount;else if(typeof o=="function"?o=s[t]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),i=nf(e),i>0&&o.length>i&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=e,a.type=t,a.count=o.length,up(a)}return e}ae.prototype.addListener=function(t,n){return rf(this,t,n,!1)},ae.prototype.on=ae.prototype.addListener,ae.prototype.prependListener=function(t,n){return rf(this,t,n,!0)};function lp(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function sf(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=lp.bind(r);return i.listener=n,r.wrapFn=i,i}ae.prototype.once=function(t,n){return Fi(n),this.on(t,sf(this,t,n)),this},ae.prototype.prependOnceListener=function(t,n){return Fi(n),this.prependListener(t,sf(this,t,n)),this},ae.prototype.removeListener=function(t,n){var r,i,s,o,a;if(Fi(n),i=this._events,i===void 0)return this;if(r=i[t],r===void 0)return this;if(r===n||r.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete i[t],i.removeListener&&this.emit("removeListener",t,r.listener||n));else if(typeof r!="function"){for(s=-1,o=r.length-1;o>=0;o--)if(r[o]===n||r[o].listener===n){a=r[o].listener,s=o;break}if(s<0)return this;s===0?r.shift():hp(r,s),r.length===1&&(i[t]=r[0]),i.removeListener!==void 0&&this.emit("removeListener",t,a||n)}return this},ae.prototype.off=ae.prototype.removeListener,ae.prototype.removeAllListeners=function(t){var n,r,i;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[t]),this;if(arguments.length===0){var s=Object.keys(r),o;for(i=0;i<s.length;++i)o=s[i],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=r[t],typeof n=="function")this.removeListener(t,n);else if(n!==void 0)for(i=n.length-1;i>=0;i--)this.removeListener(t,n[i]);return this};function of(e,t,n){var r=e._events;if(r===void 0)return[];var i=r[t];return i===void 0?[]:typeof i=="function"?n?[i.listener||i]:[i]:n?dp(i):cf(i,i.length)}ae.prototype.listeners=function(t){return of(this,t,!0)},ae.prototype.rawListeners=function(t){return of(this,t,!1)},ae.listenerCount=function(e,t){return typeof e.listenerCount=="function"?e.listenerCount(t):af.call(e,t)},ae.prototype.listenerCount=af;function af(e){var t=this._events;if(t!==void 0){var n=t[e];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}ae.prototype.eventNames=function(){return this._eventsCount>0?Ui(this._events):[]};function cf(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function hp(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function dp(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}function gp(e,t){return new Promise(function(n,r){function i(o){e.removeListener(t,s),r(o)}function s(){typeof e.removeListener=="function"&&e.removeListener("error",i),n([].slice.call(arguments))}ff(e,t,s,{once:!0}),t!=="error"&&pp(e,i,{once:!0})})}function pp(e,t,n){typeof e.on=="function"&&ff(e,"error",t,n)}function ff(e,t,n,r){if(typeof e.on=="function")r.once?e.once(t,n):e.on(t,n);else if(typeof e.addEventListener=="function")e.addEventListener(t,function i(s){r.once&&e.removeEventListener(t,i),n(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}var W={};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var co=function(e,t){return co=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)r.hasOwnProperty(i)&&(n[i]=r[i])},co(e,t)};function bp(e,t){co(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}var fo=function(){return fo=Object.assign||function(t){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},fo.apply(this,arguments)};function yp(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n}function wp(e,t,n,r){var i=arguments.length,s=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s}function mp(e,t){return function(n,r){t(n,r,e)}}function Ep(e,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(e,t)}function vp(e,t,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{f(r.next(u))}catch(d){o(d)}}function c(u){try{f(r.throw(u))}catch(d){o(d)}}function f(u){u.done?s(u.value):i(u.value).then(a,c)}f((r=r.apply(e,t||[])).next())})}function _p(e,t){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(f){return function(u){return c([f,u])}}function c(f){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(s=f[0]&2?i.return:f[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,f[1])).done)return s;switch(i=0,s&&(f=[f[0]&2,s.value]),f[0]){case 0:case 1:s=f;break;case 4:return n.label++,{value:f[1],done:!1};case 5:n.label++,i=f[1],f=[0];continue;case 7:f=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(f[0]===6||f[0]===2)){n=0;continue}if(f[0]===3&&(!s||f[1]>s[0]&&f[1]<s[3])){n.label=f[1];break}if(f[0]===6&&n.label<s[1]){n.label=s[1],s=f;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(f);break}s[2]&&n.ops.pop(),n.trys.pop();continue}f=t.call(e,n)}catch(u){f=[6,u],i=0}finally{r=s=0}if(f[0]&5)throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}}function xp(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]}function Sp(e,t){for(var n in e)n!=="default"&&!t.hasOwnProperty(n)&&(t[n]=e[n])}function uo(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function uf(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,s=[],o;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}function Ip(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(uf(arguments[t]));return e}function Op(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var r=Array(e),i=0,t=0;t<n;t++)for(var s=arguments[t],o=0,a=s.length;o<a;o++,i++)r[i]=s[o];return r}function qr(e){return this instanceof qr?(this.v=e,this):new qr(e)}function Bp(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(e,t||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(h){r[h]&&(i[h]=function(l){return new Promise(function(g,w){s.push([h,l,g,w])>1||a(h,l)})})}function a(h,l){try{c(r[h](l))}catch(g){d(s[0][3],g)}}function c(h){h.value instanceof qr?Promise.resolve(h.value.v).then(f,u):d(s[0][2],h)}function f(h){a("next",h)}function u(h){a("throw",h)}function d(h,l){h(l),s.shift(),s.length&&a(s[0][0],s[0][1])}}function Ap(e){var t,n;return t={},r("next"),r("throw",function(i){throw i}),r("return"),t[Symbol.iterator]=function(){return this},t;function r(i,s){t[i]=e[i]?function(o){return(n=!n)?{value:qr(e[i](o)),done:i==="return"}:s?s(o):o}:s}}function Dp(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],n;return t?t.call(e):(e=typeof uo=="function"?uo(e):e[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=e[s]&&function(o){return new Promise(function(a,c){o=e[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(f){s({value:f,done:a})},o)}}function Tp(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}function Rp(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function Np(e){return e&&e.__esModule?e:{default:e}}function Cp(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)}function Pp(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n}var $p=Object.freeze({__proto__:null,__extends:bp,get __assign(){return fo},__rest:yp,__decorate:wp,__param:mp,__metadata:Ep,__awaiter:vp,__generator:_p,__createBinding:xp,__exportStar:Sp,__values:uo,__read:uf,__spread:Ip,__spreadArrays:Op,__await:qr,__asyncGenerator:Bp,__asyncDelegator:Ap,__asyncValues:Dp,__makeTemplateObject:Tp,__importStar:Rp,__importDefault:Np,__classPrivateFieldGet:Cp,__classPrivateFieldSet:Pp}),ji=Jc($p),lo={},Hr={},lf;function Lp(){if(lf)return Hr;lf=1,Object.defineProperty(Hr,"__esModule",{value:!0}),Hr.delay=void 0;function e(t){return new Promise(n=>{setTimeout(()=>{n(!0)},t)})}return Hr.delay=e,Hr}var $n={},ho={},Ln={},hf;function Up(){return hf||(hf=1,Object.defineProperty(Ln,"__esModule",{value:!0}),Ln.ONE_THOUSAND=Ln.ONE_HUNDRED=void 0,Ln.ONE_HUNDRED=100,Ln.ONE_THOUSAND=1e3),Ln}var go={},df;function Fp(){return df||(df=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ONE_YEAR=e.FOUR_WEEKS=e.THREE_WEEKS=e.TWO_WEEKS=e.ONE_WEEK=e.THIRTY_DAYS=e.SEVEN_DAYS=e.FIVE_DAYS=e.THREE_DAYS=e.ONE_DAY=e.TWENTY_FOUR_HOURS=e.TWELVE_HOURS=e.SIX_HOURS=e.THREE_HOURS=e.ONE_HOUR=e.SIXTY_MINUTES=e.THIRTY_MINUTES=e.TEN_MINUTES=e.FIVE_MINUTES=e.ONE_MINUTE=e.SIXTY_SECONDS=e.THIRTY_SECONDS=e.TEN_SECONDS=e.FIVE_SECONDS=e.ONE_SECOND=void 0,e.ONE_SECOND=1,e.FIVE_SECONDS=5,e.TEN_SECONDS=10,e.THIRTY_SECONDS=30,e.SIXTY_SECONDS=60,e.ONE_MINUTE=e.SIXTY_SECONDS,e.FIVE_MINUTES=e.ONE_MINUTE*5,e.TEN_MINUTES=e.ONE_MINUTE*10,e.THIRTY_MINUTES=e.ONE_MINUTE*30,e.SIXTY_MINUTES=e.ONE_MINUTE*60,e.ONE_HOUR=e.SIXTY_MINUTES,e.THREE_HOURS=e.ONE_HOUR*3,e.SIX_HOURS=e.ONE_HOUR*6,e.TWELVE_HOURS=e.ONE_HOUR*12,e.TWENTY_FOUR_HOURS=e.ONE_HOUR*24,e.ONE_DAY=e.TWENTY_FOUR_HOURS,e.THREE_DAYS=e.ONE_DAY*3,e.FIVE_DAYS=e.ONE_DAY*5,e.SEVEN_DAYS=e.ONE_DAY*7,e.THIRTY_DAYS=e.ONE_DAY*30,e.ONE_WEEK=e.SEVEN_DAYS,e.TWO_WEEKS=e.ONE_WEEK*2,e.THREE_WEEKS=e.ONE_WEEK*3,e.FOUR_WEEKS=e.ONE_WEEK*4,e.ONE_YEAR=e.ONE_DAY*365}(go)),go}var gf;function pf(){return gf||(gf=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=ji;t.__exportStar(Up(),e),t.__exportStar(Fp(),e)}(ho)),ho}var bf;function jp(){if(bf)return $n;bf=1,Object.defineProperty($n,"__esModule",{value:!0}),$n.fromMiliseconds=$n.toMiliseconds=void 0;const e=pf();function t(r){return r*e.ONE_THOUSAND}$n.toMiliseconds=t;function n(r){return Math.floor(r/e.ONE_THOUSAND)}return $n.fromMiliseconds=n,$n}var yf;function kp(){return yf||(yf=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=ji;t.__exportStar(Lp(),e),t.__exportStar(jp(),e)}(lo)),lo}var sr={},wf;function Mp(){if(wf)return sr;wf=1,Object.defineProperty(sr,"__esModule",{value:!0}),sr.Watch=void 0;class e{constructor(){this.timestamps=new Map}start(n){if(this.timestamps.has(n))throw new Error(`Watch already started for label: ${n}`);this.timestamps.set(n,{started:Date.now()})}stop(n){const r=this.get(n);if(typeof r.elapsed<"u")throw new Error(`Watch already stopped for label: ${n}`);const i=Date.now()-r.started;this.timestamps.set(n,{started:r.started,elapsed:i})}get(n){const r=this.timestamps.get(n);if(typeof r>"u")throw new Error(`No timestamp found for label: ${n}`);return r}elapsed(n){const r=this.get(n);return r.elapsed||Date.now()-r.started}}return sr.Watch=e,sr.default=e,sr}var po={},Vr={},mf;function zp(){if(mf)return Vr;mf=1,Object.defineProperty(Vr,"__esModule",{value:!0}),Vr.IWatch=void 0;class e{}return Vr.IWatch=e,Vr}var Ef;function qp(){return Ef||(Ef=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),ji.__exportStar(zp(),e)}(po)),po}(function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=ji;t.__exportStar(kp(),e),t.__exportStar(Mp(),e),t.__exportStar(qp(),e),t.__exportStar(pf(),e)})(W);class Un{}class Hp extends Un{constructor(t){super()}}const vf=W.FIVE_SECONDS,Fn={pulse:"heartbeat_pulse"};class bo extends Hp{constructor(t){super(t),this.events=new lt.exports.EventEmitter,this.interval=vf,this.interval=t?.interval||vf}static async init(t){const n=new bo(t);return await n.init(),n}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(t,n){this.events.on(t,n)}once(t,n){this.events.once(t,n)}off(t,n){this.events.off(t,n)}removeListener(t,n){this.events.removeListener(t,n)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),W.toMiliseconds(this.interval))}pulse(){this.events.emit(Fn.pulse)}}const Vp=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,Kp=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,Gp=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function Zp(e,t){if(e==="__proto__"||e==="constructor"&&t&&typeof t=="object"&&"prototype"in t){Yp(e);return}return t}function Yp(e){console.warn(`[destr] Dropping "${e}" key to prevent prototype pollution.`)}function ki(e,t={}){if(typeof e!="string")return e;if(e[0]==='"'&&e[e.length-1]==='"'&&e.indexOf("\\")===-1)return e.slice(1,-1);const n=e.trim();if(n.length<=9)switch(n.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!Gp.test(e)){if(t.strict)throw new SyntaxError("[destr] Invalid JSON");return e}try{if(Vp.test(e)||Kp.test(e)){if(t.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(e,Zp)}return JSON.parse(e)}catch(r){if(t.strict)throw r;return e}}function Wp(e){return!e||typeof e.then!="function"?Promise.resolve(e):e}function ve(e,...t){try{return Wp(e(...t))}catch(n){return Promise.reject(n)}}function Xp(e){const t=typeof e;return e===null||t!=="object"&&t!=="function"}function Jp(e){const t=Object.getPrototypeOf(e);return!t||t.isPrototypeOf(Object)}function Mi(e){if(Xp(e))return String(e);if(Jp(e)||Array.isArray(e))return JSON.stringify(e);if(typeof e.toJSON=="function")return Mi(e.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const yo="base64:";function Qp(e){return typeof e=="string"?e:yo+n1(e)}function e1(e){return typeof e!="string"||!e.startsWith(yo)?e:t1(e.slice(yo.length))}function t1(e){return globalThis.Buffer?Buffer.from(e,"base64"):Uint8Array.from(globalThis.atob(e),t=>t.codePointAt(0))}function n1(e){return globalThis.Buffer?Buffer.from(e).toString("base64"):globalThis.btoa(String.fromCodePoint(...e))}function Ke(e){return e&&e.split("?")[0]?.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,"")||""}function r1(...e){return Ke(e.join(":"))}function zi(e){return e=Ke(e),e?e+":":""}function i1(e,t){if(t===void 0)return!0;let n=0,r=e.indexOf(":");for(;r>-1;)n++,r=e.indexOf(":",r+1);return n<=t}function s1(e,t){return t?e.startsWith(t)&&e[e.length-1]!=="$":e[e.length-1]!=="$"}function yx(e){return e}const o1="memory",a1=()=>{const e=new Map;return{name:o1,getInstance:()=>e,hasItem(t){return e.has(t)},getItem(t){return e.get(t)??null},getItemRaw(t){return e.get(t)??null},setItem(t,n){e.set(t,n)},setItemRaw(t,n){e.set(t,n)},removeItem(t){e.delete(t)},getKeys(){return[...e.keys()]},clear(){e.clear()},dispose(){e.clear()}}};function c1(e={}){const t={mounts:{"":e.driver||a1()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},n=f=>{for(const u of t.mountpoints)if(f.startsWith(u))return{base:u,relativeKey:f.slice(u.length),driver:t.mounts[u]};return{base:"",relativeKey:f,driver:t.mounts[""]}},r=(f,u)=>t.mountpoints.filter(d=>d.startsWith(f)||u&&f.startsWith(d)).map(d=>({relativeBase:f.length>d.length?f.slice(d.length):void 0,mountpoint:d,driver:t.mounts[d]})),i=(f,u)=>{if(t.watching){u=Ke(u);for(const d of t.watchListeners)d(f,u)}},s=async()=>{if(!t.watching){t.watching=!0;for(const f in t.mounts)t.unwatch[f]=await _f(t.mounts[f],i,f)}},o=async()=>{if(t.watching){for(const f in t.unwatch)await t.unwatch[f]();t.unwatch={},t.watching=!1}},a=(f,u,d)=>{const h=new Map,l=g=>{let w=h.get(g.base);return w||(w={driver:g.driver,base:g.base,items:[]},h.set(g.base,w)),w};for(const g of f){const w=typeof g=="string",v=Ke(w?g:g.key),A=w?void 0:g.value,C=w||!g.options?u:{...u,...g.options},x=n(v);l(x).items.push({key:v,value:A,relativeKey:x.relativeKey,options:C})}return Promise.all([...h.values()].map(g=>d(g))).then(g=>g.flat())},c={hasItem(f,u={}){f=Ke(f);const{relativeKey:d,driver:h}=n(f);return ve(h.hasItem,d,u)},getItem(f,u={}){f=Ke(f);const{relativeKey:d,driver:h}=n(f);return ve(h.getItem,d,u).then(l=>ki(l))},getItems(f,u={}){return a(f,u,d=>d.driver.getItems?ve(d.driver.getItems,d.items.map(h=>({key:h.relativeKey,options:h.options})),u).then(h=>h.map(l=>({key:r1(d.base,l.key),value:ki(l.value)}))):Promise.all(d.items.map(h=>ve(d.driver.getItem,h.relativeKey,h.options).then(l=>({key:h.key,value:ki(l)})))))},getItemRaw(f,u={}){f=Ke(f);const{relativeKey:d,driver:h}=n(f);return h.getItemRaw?ve(h.getItemRaw,d,u):ve(h.getItem,d,u).then(l=>e1(l))},async setItem(f,u,d={}){if(u===void 0)return c.removeItem(f);f=Ke(f);const{relativeKey:h,driver:l}=n(f);l.setItem&&(await ve(l.setItem,h,Mi(u),d),l.watch||i("update",f))},async setItems(f,u){await a(f,u,async d=>{if(d.driver.setItems)return ve(d.driver.setItems,d.items.map(h=>({key:h.relativeKey,value:Mi(h.value),options:h.options})),u);d.driver.setItem&&await Promise.all(d.items.map(h=>ve(d.driver.setItem,h.relativeKey,Mi(h.value),h.options)))})},async setItemRaw(f,u,d={}){if(u===void 0)return c.removeItem(f,d);f=Ke(f);const{relativeKey:h,driver:l}=n(f);if(l.setItemRaw)await ve(l.setItemRaw,h,u,d);else if(l.setItem)await ve(l.setItem,h,Qp(u),d);else return;l.watch||i("update",f)},async removeItem(f,u={}){typeof u=="boolean"&&(u={removeMeta:u}),f=Ke(f);const{relativeKey:d,driver:h}=n(f);h.removeItem&&(await ve(h.removeItem,d,u),(u.removeMeta||u.removeMata)&&await ve(h.removeItem,d+"$",u),h.watch||i("remove",f))},async getMeta(f,u={}){typeof u=="boolean"&&(u={nativeOnly:u}),f=Ke(f);const{relativeKey:d,driver:h}=n(f),l=Object.create(null);if(h.getMeta&&Object.assign(l,await ve(h.getMeta,d,u)),!u.nativeOnly){const g=await ve(h.getItem,d+"$",u).then(w=>ki(w));g&&typeof g=="object"&&(typeof g.atime=="string"&&(g.atime=new Date(g.atime)),typeof g.mtime=="string"&&(g.mtime=new Date(g.mtime)),Object.assign(l,g))}return l},setMeta(f,u,d={}){return this.setItem(f+"$",u,d)},removeMeta(f,u={}){return this.removeItem(f+"$",u)},async getKeys(f,u={}){f=zi(f);const d=r(f,!0);let h=[];const l=[];let g=!0;for(const v of d){v.driver.flags?.maxDepth||(g=!1);const A=await ve(v.driver.getKeys,v.relativeBase,u);for(const C of A){const x=v.mountpoint+Ke(C);h.some(_=>x.startsWith(_))||l.push(x)}h=[v.mountpoint,...h.filter(C=>!C.startsWith(v.mountpoint))]}const w=u.maxDepth!==void 0&&!g;return l.filter(v=>(!w||i1(v,u.maxDepth))&&s1(v,f))},async clear(f,u={}){f=zi(f),await Promise.all(r(f,!1).map(async d=>{if(d.driver.clear)return ve(d.driver.clear,d.relativeBase,u);if(d.driver.removeItem){const h=await d.driver.getKeys(d.relativeBase||"",u);return Promise.all(h.map(l=>d.driver.removeItem(l,u)))}}))},async dispose(){await Promise.all(Object.values(t.mounts).map(f=>xf(f)))},async watch(f){return await s(),t.watchListeners.push(f),async()=>{t.watchListeners=t.watchListeners.filter(u=>u!==f),t.watchListeners.length===0&&await o()}},async unwatch(){t.watchListeners=[],await o()},mount(f,u){if(f=zi(f),f&&t.mounts[f])throw new Error(`already mounted at ${f}`);return f&&(t.mountpoints.push(f),t.mountpoints.sort((d,h)=>h.length-d.length)),t.mounts[f]=u,t.watching&&Promise.resolve(_f(u,i,f)).then(d=>{t.unwatch[f]=d}).catch(console.error),c},async unmount(f,u=!0){f=zi(f),!(!f||!t.mounts[f])&&(t.watching&&f in t.unwatch&&(t.unwatch[f]?.(),delete t.unwatch[f]),u&&await xf(t.mounts[f]),t.mountpoints=t.mountpoints.filter(d=>d!==f),delete t.mounts[f])},getMount(f=""){f=Ke(f)+":";const u=n(f);return{driver:u.driver,base:u.base}},getMounts(f="",u={}){return f=Ke(f),r(f,u.parents).map(h=>({driver:h.driver,base:h.mountpoint}))},keys:(f,u={})=>c.getKeys(f,u),get:(f,u={})=>c.getItem(f,u),set:(f,u,d={})=>c.setItem(f,u,d),has:(f,u={})=>c.hasItem(f,u),del:(f,u={})=>c.removeItem(f,u),remove:(f,u={})=>c.removeItem(f,u)};return c}function _f(e,t,n){return e.watch?e.watch((r,i)=>t(r,n+i)):()=>{}}async function xf(e){typeof e.dispose=="function"&&await ve(e.dispose)}function jn(e){return new Promise((t,n)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>n(e.error)})}function Sf(e,t){const n=indexedDB.open(e);n.onupgradeneeded=()=>n.result.createObjectStore(t);const r=jn(n);return(i,s)=>r.then(o=>s(o.transaction(t,i).objectStore(t)))}let wo;function Kr(){return wo||(wo=Sf("keyval-store","keyval")),wo}function If(e,t=Kr()){return t("readonly",n=>jn(n.get(e)))}function f1(e,t,n=Kr()){return n("readwrite",r=>(r.put(t,e),jn(r.transaction)))}function u1(e,t=Kr()){return t("readwrite",n=>(n.delete(e),jn(n.transaction)))}function l1(e=Kr()){return e("readwrite",t=>(t.clear(),jn(t.transaction)))}function h1(e,t){return e.openCursor().onsuccess=function(){this.result&&(t(this.result),this.result.continue())},jn(e.transaction)}function d1(e=Kr()){return e("readonly",t=>{if(t.getAllKeys)return jn(t.getAllKeys());const n=[];return h1(t,r=>n.push(r.key)).then(()=>n)})}const g1=e=>JSON.stringify(e,(t,n)=>typeof n=="bigint"?n.toString()+"n":n),p1=e=>{const t=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,n=e.replace(t,'$1"$2n"$3');return JSON.parse(n,(r,i)=>typeof i=="string"&&i.match(/^\d+n$/)?BigInt(i.substring(0,i.length-1)):i)};function or(e){if(typeof e!="string")throw new Error(`Cannot safe json parse value of type ${typeof e}`);try{return p1(e)}catch{return e}}function kn(e){return typeof e=="string"?e:g1(e)||""}const b1="idb-keyval";var y1=(e={})=>{const t=e.base&&e.base.length>0?`${e.base}:`:"",n=i=>t+i;let r;return e.dbName&&e.storeName&&(r=Sf(e.dbName,e.storeName)),{name:b1,options:e,async hasItem(i){return!(typeof await If(n(i),r)>"u")},async getItem(i){return await If(n(i),r)??null},setItem(i,s){return f1(n(i),s,r)},removeItem(i){return u1(n(i),r)},getKeys(){return d1(r)},clear(){return l1(r)}}};const w1="WALLET_CONNECT_V2_INDEXED_DB",m1="keyvaluestorage";class E1{constructor(){this.indexedDb=c1({driver:y1({dbName:w1,storeName:m1})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(t=>[t.key,t.value])}async getItem(t){const n=await this.indexedDb.getItem(t);if(n!==null)return n}async setItem(t,n){await this.indexedDb.setItem(t,kn(n))}async removeItem(t){await this.indexedDb.removeItem(t)}}var mo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},qi={exports:{}};(function(){let e;function t(){}e=t,e.prototype.getItem=function(n){return this.hasOwnProperty(n)?String(this[n]):null},e.prototype.setItem=function(n,r){this[n]=String(r)},e.prototype.removeItem=function(n){delete this[n]},e.prototype.clear=function(){const n=this;Object.keys(n).forEach(function(r){n[r]=void 0,delete n[r]})},e.prototype.key=function(n){return n=n||0,Object.keys(this)[n]},e.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof mo<"u"&&mo.localStorage?qi.exports=mo.localStorage:typeof window<"u"&&window.localStorage?qi.exports=window.localStorage:qi.exports=new t})();function v1(e){var t;return[e[0],or((t=e[1])!=null?t:"")]}class _1{constructor(){this.localStorage=qi.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(v1)}async getItem(t){const n=this.localStorage.getItem(t);if(n!==null)return or(n)}async setItem(t,n){this.localStorage.setItem(t,kn(n))}async removeItem(t){this.localStorage.removeItem(t)}}const x1="wc_storage_version",Of=1,S1=async(e,t,n)=>{const r=x1,i=await t.getItem(r);if(i&&i>=Of){n(t);return}const s=await e.getKeys();if(!s.length){n(t);return}const o=[];for(;s.length;){const a=s.shift();if(!a)continue;const c=a.toLowerCase();if(c.includes("wc@")||c.includes("walletconnect")||c.includes("wc_")||c.includes("wallet_connect")){const f=await e.getItem(a);await t.setItem(a,f),o.push(a)}}await t.setItem(r,Of),n(t),I1(e,o)},I1=async(e,t)=>{t.length&&t.forEach(async n=>{await e.removeItem(n)})};class O1{constructor(){this.initialized=!1,this.setInitialized=n=>{this.storage=n,this.initialized=!0};const t=new _1;this.storage=t;try{const n=new E1;S1(t,n,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(t){return await this.initialize(),this.storage.getItem(t)}async setItem(t,n){return await this.initialize(),this.storage.setItem(t,n)}async removeItem(t){return await this.initialize(),this.storage.removeItem(t)}async initialize(){this.initialized||await new Promise(t=>{const n=setInterval(()=>{this.initialized&&(clearInterval(n),t())},20)})}}function B1(e){try{return JSON.stringify(e)}catch{return'"[Circular]"'}}var A1=D1;function D1(e,t,n){var r=n&&n.stringify||B1,i=1;if(typeof e=="object"&&e!==null){var s=t.length+i;if(s===1)return e;var o=new Array(s);o[0]=r(e);for(var a=1;a<s;a++)o[a]=r(t[a]);return o.join(" ")}if(typeof e!="string")return e;var c=t.length;if(c===0)return e;for(var f="",u=1-i,d=-1,h=e&&e.length||0,l=0;l<h;){if(e.charCodeAt(l)===37&&l+1<h){switch(d=d>-1?d:0,e.charCodeAt(l+1)){case 100:case 102:if(u>=c||t[u]==null)break;d<l&&(f+=e.slice(d,l)),f+=Number(t[u]),d=l+2,l++;break;case 105:if(u>=c||t[u]==null)break;d<l&&(f+=e.slice(d,l)),f+=Math.floor(Number(t[u])),d=l+2,l++;break;case 79:case 111:case 106:if(u>=c||t[u]===void 0)break;d<l&&(f+=e.slice(d,l));var g=typeof t[u];if(g==="string"){f+="'"+t[u]+"'",d=l+2,l++;break}if(g==="function"){f+=t[u].name||"<anonymous>",d=l+2,l++;break}f+=r(t[u]),d=l+2,l++;break;case 115:if(u>=c)break;d<l&&(f+=e.slice(d,l)),f+=String(t[u]),d=l+2,l++;break;case 37:d<l&&(f+=e.slice(d,l)),f+="%",d=l+2,l++,u--;break}++u}++l}return d===-1?e:(d<h&&(f+=e.slice(d)),f)}const Bf=A1;var fn=Rt;const Gr=j1().console||{},T1={mapHttpRequest:Vi,mapHttpResponse:Vi,wrapRequestSerializer:vo,wrapResponseSerializer:vo,wrapErrorSerializer:vo,req:Vi,res:Vi,err:$1};function R1(e,t){return Array.isArray(e)?e.filter(function(r){return r!=="!stdSerializers.err"}):e===!0?Object.keys(t):!1}function Rt(e){e=e||{},e.browser=e.browser||{};const t=e.browser.transmit;if(t&&typeof t.send!="function")throw Error("pino: transmit option must have a send function");const n=e.browser.write||Gr;e.browser.write&&(e.browser.asObject=!0);const r=e.serializers||{},i=R1(e.browser.serialize,r);let s=e.browser.serialize;Array.isArray(e.browser.serialize)&&e.browser.serialize.indexOf("!stdSerializers.err")>-1&&(s=!1);const o=["error","fatal","warn","info","debug","trace"];typeof n=="function"&&(n.error=n.fatal=n.warn=n.info=n.debug=n.trace=n),e.enabled===!1&&(e.level="silent");const a=e.level||"info",c=Object.create(n);c.log||(c.log=Zr),Object.defineProperty(c,"levelVal",{get:u}),Object.defineProperty(c,"level",{get:d,set:h});const f={transmit:t,serialize:i,asObject:e.browser.asObject,levels:o,timestamp:L1(e)};c.levels=Rt.levels,c.level=a,c.setMaxListeners=c.getMaxListeners=c.emit=c.addListener=c.on=c.prependListener=c.once=c.prependOnceListener=c.removeListener=c.removeAllListeners=c.listeners=c.listenerCount=c.eventNames=c.write=c.flush=Zr,c.serializers=r,c._serialize=i,c._stdErrSerialize=s,c.child=l,t&&(c._logEvent=Eo());function u(){return this.level==="silent"?1/0:this.levels.values[this.level]}function d(){return this._level}function h(g){if(g!=="silent"&&!this.levels.values[g])throw Error("unknown level "+g);this._level=g,ar(f,c,"error","log"),ar(f,c,"fatal","error"),ar(f,c,"warn","error"),ar(f,c,"info","log"),ar(f,c,"debug","log"),ar(f,c,"trace","log")}function l(g,w){if(!g)throw new Error("missing bindings for child Pino");w=w||{},i&&g.serializers&&(w.serializers=g.serializers);const v=w.serializers;if(i&&v){var A=Object.assign({},r,v),C=e.browser.serialize===!0?Object.keys(A):i;delete g.serializers,Hi([g],C,A,this._stdErrSerialize)}function x(_){this._childLevel=(_._childLevel|0)+1,this.error=cr(_,g,"error"),this.fatal=cr(_,g,"fatal"),this.warn=cr(_,g,"warn"),this.info=cr(_,g,"info"),this.debug=cr(_,g,"debug"),this.trace=cr(_,g,"trace"),A&&(this.serializers=A,this._serialize=C),t&&(this._logEvent=Eo([].concat(_._logEvent.bindings,g)))}return x.prototype=this,new x(this)}return c}Rt.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},Rt.stdSerializers=T1,Rt.stdTimeFunctions=Object.assign({},{nullTime:Af,epochTime:Df,unixTime:U1,isoTime:F1});function ar(e,t,n,r){const i=Object.getPrototypeOf(t);t[n]=t.levelVal>t.levels.values[n]?Zr:i[n]?i[n]:Gr[n]||Gr[r]||Zr,N1(e,t,n)}function N1(e,t,n){!e.transmit&&t[n]===Zr||(t[n]=function(r){return function(){const s=e.timestamp(),o=new Array(arguments.length),a=Object.getPrototypeOf&&Object.getPrototypeOf(this)===Gr?Gr:this;for(var c=0;c<o.length;c++)o[c]=arguments[c];if(e.serialize&&!e.asObject&&Hi(o,this._serialize,this.serializers,this._stdErrSerialize),e.asObject?r.call(a,C1(this,n,o,s)):r.apply(a,o),e.transmit){const f=e.transmit.level||t.level,u=Rt.levels.values[f],d=Rt.levels.values[n];if(d<u)return;P1(this,{ts:s,methodLevel:n,methodValue:d,transmitLevel:f,transmitValue:Rt.levels.values[e.transmit.level||t.level],send:e.transmit.send,val:t.levelVal},o)}}}(t[n]))}function C1(e,t,n,r){e._serialize&&Hi(n,e._serialize,e.serializers,e._stdErrSerialize);const i=n.slice();let s=i[0];const o={};r&&(o.time=r),o.level=Rt.levels.values[t];let a=(e._childLevel|0)+1;if(a<1&&(a=1),s!==null&&typeof s=="object"){for(;a--&&typeof i[0]=="object";)Object.assign(o,i.shift());s=i.length?Bf(i.shift(),i):void 0}else typeof s=="string"&&(s=Bf(i.shift(),i));return s!==void 0&&(o.msg=s),o}function Hi(e,t,n,r){for(const i in e)if(r&&e[i]instanceof Error)e[i]=Rt.stdSerializers.err(e[i]);else if(typeof e[i]=="object"&&!Array.isArray(e[i]))for(const s in e[i])t&&t.indexOf(s)>-1&&s in n&&(e[i][s]=n[s](e[i][s]))}function cr(e,t,n){return function(){const r=new Array(1+arguments.length);r[0]=t;for(var i=1;i<r.length;i++)r[i]=arguments[i-1];return e[n].apply(this,r)}}function P1(e,t,n){const r=t.send,i=t.ts,s=t.methodLevel,o=t.methodValue,a=t.val,c=e._logEvent.bindings;Hi(n,e._serialize||Object.keys(e.serializers),e.serializers,e._stdErrSerialize===void 0?!0:e._stdErrSerialize),e._logEvent.ts=i,e._logEvent.messages=n.filter(function(f){return c.indexOf(f)===-1}),e._logEvent.level.label=s,e._logEvent.level.value=o,r(s,e._logEvent,a),e._logEvent=Eo(c)}function Eo(e){return{ts:0,messages:[],bindings:e||[],level:{label:"",value:0}}}function $1(e){const t={type:e.constructor.name,msg:e.message,stack:e.stack};for(const n in e)t[n]===void 0&&(t[n]=e[n]);return t}function L1(e){return typeof e.timestamp=="function"?e.timestamp:e.timestamp===!1?Af:Df}function Vi(){return{}}function vo(e){return e}function Zr(){}function Af(){return!1}function Df(){return Date.now()}function U1(){return Math.round(Date.now()/1e3)}function F1(){return new Date(Date.now()).toISOString()}function j1(){function e(t){return typeof t<"u"&&t}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return e(self)||e(window)||e(this)||{}}}const k1={level:"info"},Yr="custom_context",_o=1e3*1024;class M1{constructor(t){this.nodeValue=t,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}}class Tf{constructor(t){this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=t,this.sizeInBytes=0}append(t){const n=new M1(t);if(n.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${t} with size ${n.size}`);for(;this.size+n.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=n),this.tail=n):(this.head=n,this.tail=n),this.lengthInNodes++,this.sizeInBytes+=n.size}shift(){if(!this.head)return;const t=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=t.size}toArray(){const t=[];let n=this.head;for(;n!==null;)t.push(n.value),n=n.next;return t}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let t=this.head;return{next:()=>{if(!t)return{done:!0,value:null};const n=t.value;return t=t.next,{done:!1,value:n}}}}}class Rf{constructor(t,n=_o){this.level=t??"error",this.levelValue=fn.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=n,this.logs=new Tf(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(t,n){n===fn.levels.values.error?console.error(t):n===fn.levels.values.warn?console.warn(t):n===fn.levels.values.debug?console.debug(t):n===fn.levels.values.trace?console.trace(t):console.log(t)}appendToLogs(t){this.logs.append(kn({timestamp:new Date().toISOString(),log:t}));const n=typeof t=="string"?JSON.parse(t).level:t.level;n>=this.levelValue&&this.forwardToConsole(t,n)}getLogs(){return this.logs}clearLogs(){this.logs=new Tf(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(t){const n=this.getLogArray();return n.push(kn({extraMetadata:t})),new Blob(n,{type:"application/json"})}}class z1{constructor(t,n=_o){this.baseChunkLogger=new Rf(t,n)}write(t){this.baseChunkLogger.appendToLogs(t)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(t){return this.baseChunkLogger.logsToBlob(t)}downloadLogsBlobInBrowser(t){const n=URL.createObjectURL(this.logsToBlob(t)),r=document.createElement("a");r.href=n,r.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n)}}class q1{constructor(t,n=_o){this.baseChunkLogger=new Rf(t,n)}write(t){this.baseChunkLogger.appendToLogs(t)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(t){return this.baseChunkLogger.logsToBlob(t)}}var H1=Object.defineProperty,V1=Object.defineProperties,K1=Object.getOwnPropertyDescriptors,Nf=Object.getOwnPropertySymbols,G1=Object.prototype.hasOwnProperty,Z1=Object.prototype.propertyIsEnumerable,Cf=(e,t,n)=>t in e?H1(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ki=(e,t)=>{for(var n in t||(t={}))G1.call(t,n)&&Cf(e,n,t[n]);if(Nf)for(var n of Nf(t))Z1.call(t,n)&&Cf(e,n,t[n]);return e},Gi=(e,t)=>V1(e,K1(t));function Pf(e){return Gi(Ki({},e),{level:e?.level||k1.level})}function Y1(e,t=Yr){return e[t]||""}function W1(e,t,n=Yr){return e[n]=t,e}function it(e,t=Yr){let n="";return typeof e.bindings>"u"?n=Y1(e,t):n=e.bindings().context||"",n}function X1(e,t,n=Yr){const r=it(e,n);return r.trim()?`${r}/${t}`:t}function Ge(e,t,n=Yr){const r=X1(e,t,n),i=e.child({context:r});return W1(i,r,n)}function J1(e){var t,n;const r=new z1((t=e.opts)==null?void 0:t.level,e.maxSizeInBytes);return{logger:fn(Gi(Ki({},e.opts),{level:"trace",browser:Gi(Ki({},(n=e.opts)==null?void 0:n.browser),{write:i=>r.write(i)})})),chunkLoggerController:r}}function Q1(e){var t;const n=new q1((t=e.opts)==null?void 0:t.level,e.maxSizeInBytes);return{logger:fn(Gi(Ki({},e.opts),{level:"trace"})),chunkLoggerController:n}}function eb(e){return typeof e.loggerOverride<"u"&&typeof e.loggerOverride!="string"?{logger:e.loggerOverride,chunkLoggerController:null}:typeof window<"u"?J1(e):Q1(e)}var tb=Object.defineProperty,nb=(e,t,n)=>t in e?tb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,$f=(e,t,n)=>nb(e,typeof t!="symbol"?t+"":t,n);class rb extends Un{constructor(t){super(),this.opts=t,$f(this,"protocol","wc"),$f(this,"version",2)}}var ib=Object.defineProperty,sb=(e,t,n)=>t in e?ib(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,ob=(e,t,n)=>sb(e,typeof t!="symbol"?t+"":t,n);class ab extends Un{constructor(t,n){super(),this.core=t,this.logger=n,ob(this,"records",new Map)}}class cb{constructor(t,n){this.logger=t,this.core=n}}class fb extends Un{constructor(t,n){super(),this.relayer=t,this.logger=n}}class ub extends Un{constructor(t){super()}}class lb{constructor(t,n,r,i){this.core=t,this.logger=n,this.name=r}}class hb extends Un{constructor(t,n){super(),this.relayer=t,this.logger=n}}class db extends Un{constructor(t,n){super(),this.core=t,this.logger=n}}class gb{constructor(t,n,r){this.core=t,this.logger=n,this.store=r}}class pb{constructor(t,n){this.projectId=t,this.logger=n}}class bb{constructor(t,n,r){this.core=t,this.logger=n,this.telemetryEnabled=r}}const xo="wc",So=2,Wr="core",Et=`${xo}@2:${Wr}:`,Lf={name:Wr,logger:"error"},Uf={database:":memory:"},Ff="crypto",Io="client_ed25519_seed",jf=W.ONE_DAY,kf="keychain",Mf="0.3",zf="messages",qf="0.3",Hf=W.SIX_HOURS,Vf="publisher",Kf="irn",Gf="error",Oo="wss://relay.walletconnect.org",Zf="relayer",be={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},Yf="_subscription",st={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},Wf=.1,yb={database:":memory:"},Zi="2.21.10",wb=1e4,Mn={link_mode:"link_mode",relay:"relay"},Xr={inbound:"inbound",outbound:"outbound"},Xf="0.3",Jf="WALLETCONNECT_CLIENT_ID",Bo="WALLETCONNECT_LINK_MODE_APPS",Ze={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},mb=W.THIRTY_DAYS,Qf="subscription",eu="0.3",Eb=W.FIVE_SECONDS*1e3,tu="pairing",nu="0.3",vb=W.THIRTY_DAYS,fr={wc_pairingDelete:{req:{ttl:W.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:W.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:W.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:W.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:W.ONE_DAY,prompt:!1,tag:0},res:{ttl:W.ONE_DAY,prompt:!1,tag:0}}},ur={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},ht={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},ru="history",iu="0.3",su="expirer",dt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},ou="0.3",_b=W.ONE_DAY,au="verify-api",xb="https://verify.walletconnect.com",cu="https://verify.walletconnect.org",Jr=cu,fu=`${Jr}/v3`,uu=[xb,cu],lu="echo",hu="https://echo.walletconnect.com",Sb="event-client",Nt={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},jt={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},Ib={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success"},Ob={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found"},Bb={authenticated_session_approve_started:"authenticated_session_approve_started",authenticated_session_not_expired:"authenticated_session_not_expired",chains_caip2_compliant:"chains_caip2_compliant",chains_evm_compliant:"chains_evm_compliant",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve",authenticated_session_approve_publish_success:"authenticated_session_approve_publish_success"},Ab={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",missing_session_authenticate_request:"missing_session_authenticate_request",session_authenticate_request_expired:"session_authenticate_request_expired",chains_caip2_compliant_failure:"chains_caip2_compliant_failure",chains_evm_compliant_failure:"chains_evm_compliant_failure",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},du=.1,gu="event-client",pu=86400,bu="https://pulse.walletconnect.org/batch";function Db(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function yu(e,...t){if(!Db(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function wu(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Tb(e,t){yu(e);const n=t.outputLen;if(e.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}const lr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Ao=e=>new DataView(e.buffer,e.byteOffset,e.byteLength);function Rb(e){if(typeof e!="string")throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array(new TextEncoder().encode(e))}function mu(e){return typeof e=="string"&&(e=Rb(e)),yu(e),e}class Nb{clone(){return this._cloneInto()}}function Cb(e){const t=r=>e().update(mu(r)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function Eu(e=32){if(lr&&typeof lr.getRandomValues=="function")return lr.getRandomValues(new Uint8Array(e));if(lr&&typeof lr.randomBytes=="function")return lr.randomBytes(e);throw new Error("crypto.getRandomValues must be defined")}function Pb(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),c=r?4:0,f=r?0:4;e.setUint32(t+c,o,r),e.setUint32(t+f,a,r)}class $b extends Nb{constructor(t,n,r,i){super(),this.blockLen=t,this.outputLen=n,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=Ao(this.buffer)}update(t){wu(this);const{view:n,buffer:r,blockLen:i}=this;t=mu(t);const s=t.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=Ao(t);for(;i<=s-o;o+=i)this.process(c,o);continue}r.set(t.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){wu(this),Tb(t,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let d=o;d<i;d++)n[d]=0;Pb(r,i-8,BigInt(this.length*8),s),this.process(r,0);const a=Ao(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const f=c/4,u=this.get();if(f>u.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<f;d++)a.setUint32(4*d,u[d],s)}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const r=t.slice(0,n);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return t.length=i,t.pos=a,t.finished=s,t.destroyed=o,i%n&&t.buffer.set(r),t}}const Yi=BigInt(2**32-1),Do=BigInt(32);function vu(e,t=!1){return t?{h:Number(e&Yi),l:Number(e>>Do&Yi)}:{h:Number(e>>Do&Yi)|0,l:Number(e&Yi)|0}}function Lb(e,t=!1){let n=new Uint32Array(e.length),r=new Uint32Array(e.length);for(let i=0;i<e.length;i++){const{h:s,l:o}=vu(e[i],t);[n[i],r[i]]=[s,o]}return[n,r]}const Ub=(e,t)=>BigInt(e>>>0)<<Do|BigInt(t>>>0),Fb=(e,t,n)=>e>>>n,jb=(e,t,n)=>e<<32-n|t>>>n,kb=(e,t,n)=>e>>>n|t<<32-n,Mb=(e,t,n)=>e<<32-n|t>>>n,zb=(e,t,n)=>e<<64-n|t>>>n-32,qb=(e,t,n)=>e>>>n-32|t<<64-n,Hb=(e,t)=>t,Vb=(e,t)=>e,Kb=(e,t,n)=>e<<n|t>>>32-n,Gb=(e,t,n)=>t<<n|e>>>32-n,Zb=(e,t,n)=>t<<n-32|e>>>64-n,Yb=(e,t,n)=>e<<n-32|t>>>64-n;function Wb(e,t,n,r){const i=(t>>>0)+(r>>>0);return{h:e+n+(i/2**32|0)|0,l:i|0}}const Xb=(e,t,n)=>(e>>>0)+(t>>>0)+(n>>>0),Jb=(e,t,n,r)=>t+n+r+(e/2**32|0)|0,Qb=(e,t,n,r)=>(e>>>0)+(t>>>0)+(n>>>0)+(r>>>0),ey=(e,t,n,r,i)=>t+n+r+i+(e/2**32|0)|0,ty=(e,t,n,r,i)=>(e>>>0)+(t>>>0)+(n>>>0)+(r>>>0)+(i>>>0),ny=(e,t,n,r,i,s)=>t+n+r+i+s+(e/2**32|0)|0,Q={fromBig:vu,split:Lb,toBig:Ub,shrSH:Fb,shrSL:jb,rotrSH:kb,rotrSL:Mb,rotrBH:zb,rotrBL:qb,rotr32H:Hb,rotr32L:Vb,rotlSH:Kb,rotlSL:Gb,rotlBH:Zb,rotlBL:Yb,add:Wb,add3L:Xb,add3H:Jb,add4L:Qb,add4H:ey,add5H:ny,add5L:ty},[ry,iy]=Q.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))),un=new Uint32Array(80),ln=new Uint32Array(80);class sy extends $b{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:t,Al:n,Bh:r,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:f,El:u,Fh:d,Fl:h,Gh:l,Gl:g,Hh:w,Hl:v}=this;return[t,n,r,i,s,o,a,c,f,u,d,h,l,g,w,v]}set(t,n,r,i,s,o,a,c,f,u,d,h,l,g,w,v){this.Ah=t|0,this.Al=n|0,this.Bh=r|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=f|0,this.El=u|0,this.Fh=d|0,this.Fl=h|0,this.Gh=l|0,this.Gl=g|0,this.Hh=w|0,this.Hl=v|0}process(t,n){for(let x=0;x<16;x++,n+=4)un[x]=t.getUint32(n),ln[x]=t.getUint32(n+=4);for(let x=16;x<80;x++){const _=un[x-15]|0,R=ln[x-15]|0,L=Q.rotrSH(_,R,1)^Q.rotrSH(_,R,8)^Q.shrSH(_,R,7),j=Q.rotrSL(_,R,1)^Q.rotrSL(_,R,8)^Q.shrSL(_,R,7),U=un[x-2]|0,D=ln[x-2]|0,q=Q.rotrSH(U,D,19)^Q.rotrBH(U,D,61)^Q.shrSH(U,D,6),M=Q.rotrSL(U,D,19)^Q.rotrBL(U,D,61)^Q.shrSL(U,D,6),E=Q.add4L(j,M,ln[x-7],ln[x-16]),b=Q.add4H(E,L,q,un[x-7],un[x-16]);un[x]=b|0,ln[x]=E|0}let{Ah:r,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:f,Dl:u,Eh:d,El:h,Fh:l,Fl:g,Gh:w,Gl:v,Hh:A,Hl:C}=this;for(let x=0;x<80;x++){const _=Q.rotrSH(d,h,14)^Q.rotrSH(d,h,18)^Q.rotrBH(d,h,41),R=Q.rotrSL(d,h,14)^Q.rotrSL(d,h,18)^Q.rotrBL(d,h,41),L=d&l^~d&w,j=h&g^~h&v,U=Q.add5L(C,R,j,iy[x],ln[x]),D=Q.add5H(U,A,_,L,ry[x],un[x]),q=U|0,M=Q.rotrSH(r,i,28)^Q.rotrBH(r,i,34)^Q.rotrBH(r,i,39),E=Q.rotrSL(r,i,28)^Q.rotrBL(r,i,34)^Q.rotrBL(r,i,39),b=r&s^r&a^s&a,m=i&o^i&c^o&c;A=w|0,C=v|0,w=l|0,v=g|0,l=d|0,g=h|0,{h:d,l:h}=Q.add(f|0,u|0,D|0,q|0),f=a|0,u=c|0,a=s|0,c=o|0,s=r|0,o=i|0;const p=Q.add3L(q,E,m);r=Q.add3H(p,D,M,b),i=p|0}({h:r,l:i}=Q.add(this.Ah|0,this.Al|0,r|0,i|0)),{h:s,l:o}=Q.add(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=Q.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:f,l:u}=Q.add(this.Dh|0,this.Dl|0,f|0,u|0),{h:d,l:h}=Q.add(this.Eh|0,this.El|0,d|0,h|0),{h:l,l:g}=Q.add(this.Fh|0,this.Fl|0,l|0,g|0),{h:w,l:v}=Q.add(this.Gh|0,this.Gl|0,w|0,v|0),{h:A,l:C}=Q.add(this.Hh|0,this.Hl|0,A|0,C|0),this.set(r,i,s,o,a,c,f,u,d,h,l,g,w,v,A,C)}roundClean(){un.fill(0),ln.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const oy=Cb(()=>new sy);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const To=BigInt(0),_u=BigInt(1),ay=BigInt(2);function Ro(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function No(e){if(!Ro(e))throw new Error("Uint8Array expected")}function Co(e,t){if(typeof t!="boolean")throw new Error(e+" boolean expected, got "+t)}const cy=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Po(e){No(e);let t="";for(let n=0;n<e.length;n++)t+=cy[e[n]];return t}function xu(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return e===""?To:BigInt("0x"+e)}const kt={_0:48,_9:57,A:65,F:70,a:97,f:102};function Su(e){if(e>=kt._0&&e<=kt._9)return e-kt._0;if(e>=kt.A&&e<=kt.F)return e-(kt.A-10);if(e>=kt.a&&e<=kt.f)return e-(kt.a-10)}function Iu(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const t=e.length,n=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const r=new Uint8Array(n);for(let i=0,s=0;i<n;i++,s+=2){const o=Su(e.charCodeAt(s)),a=Su(e.charCodeAt(s+1));if(o===void 0||a===void 0){const c=e[s]+e[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}r[i]=o*16+a}return r}function fy(e){return xu(Po(e))}function Wi(e){return No(e),xu(Po(Uint8Array.from(e).reverse()))}function Ou(e,t){return Iu(e.toString(16).padStart(t*2,"0"))}function $o(e,t){return Ou(e,t).reverse()}function Mt(e,t,n){let r;if(typeof t=="string")try{r=Iu(t)}catch(s){throw new Error(e+" must be hex string or Uint8Array, cause: "+s)}else if(Ro(t))r=Uint8Array.from(t);else throw new Error(e+" must be hex string or Uint8Array");const i=r.length;if(typeof n=="number"&&i!==n)throw new Error(e+" of length "+n+" expected, got "+i);return r}function Bu(...e){let t=0;for(let r=0;r<e.length;r++){const i=e[r];No(i),t+=i.length}const n=new Uint8Array(t);for(let r=0,i=0;r<e.length;r++){const s=e[r];n.set(s,i),i+=s.length}return n}const Lo=e=>typeof e=="bigint"&&To<=e;function uy(e,t,n){return Lo(e)&&Lo(t)&&Lo(n)&&t<=e&&e<n}function Qr(e,t,n,r){if(!uy(t,n,r))throw new Error("expected valid "+e+": "+n+" <= n < "+r+", got "+t)}function ly(e){let t;for(t=0;e>To;e>>=_u,t+=1);return t}const hy=e=>(ay<<BigInt(e-1))-_u,dy={bigint:e=>typeof e=="bigint",function:e=>typeof e=="function",boolean:e=>typeof e=="boolean",string:e=>typeof e=="string",stringOrUint8Array:e=>typeof e=="string"||Ro(e),isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>typeof e=="function"&&Number.isSafeInteger(e.outputLen)};function Uo(e,t,n={}){const r=(i,s,o)=>{const a=dy[s];if(typeof a!="function")throw new Error("invalid validator function");const c=e[i];if(!(o&&c===void 0)&&!a(c,e))throw new Error("param "+String(i)+" is invalid. Expected "+s+", got "+c)};for(const[i,s]of Object.entries(t))r(i,s,!1);for(const[i,s]of Object.entries(n))r(i,s,!0);return e}function Au(e){const t=new WeakMap;return(n,...r)=>{const i=t.get(n);if(i!==void 0)return i;const s=e(n,...r);return t.set(n,s),s}}const _e=BigInt(0),ge=BigInt(1),zn=BigInt(2),gy=BigInt(3),Fo=BigInt(4),Du=BigInt(5),Tu=BigInt(8);function we(e,t){const n=e%t;return n>=_e?n:t+n}function py(e,t,n){if(t<_e)throw new Error("invalid exponent, negatives unsupported");if(n<=_e)throw new Error("invalid modulus");if(n===ge)return _e;let r=ge;for(;t>_e;)t&ge&&(r=r*e%n),e=e*e%n,t>>=ge;return r}function Ct(e,t,n){let r=e;for(;t-- >_e;)r*=r,r%=n;return r}function Ru(e,t){if(e===_e)throw new Error("invert: expected non-zero number");if(t<=_e)throw new Error("invert: expected positive modulus, got "+t);let n=we(e,t),r=t,i=_e,s=ge;for(;n!==_e;){const o=r/n,a=r%n,c=i-s*o;r=n,n=a,i=s,s=c}if(r!==ge)throw new Error("invert: does not exist");return we(i,t)}function by(e){const t=(e-ge)/zn;let n,r,i;for(n=e-ge,r=0;n%zn===_e;n/=zn,r++);for(i=zn;i<e&&py(i,t,e)!==e-ge;i++)if(i>1e3)throw new Error("Cannot find square root: likely non-prime P");if(r===1){const o=(e+ge)/Fo;return function(a,c){const f=a.pow(c,o);if(!a.eql(a.sqr(f),c))throw new Error("Cannot find square root");return f}}const s=(n+ge)/zn;return function(o,a){if(o.pow(a,t)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=r,f=o.pow(o.mul(o.ONE,i),n),u=o.pow(a,s),d=o.pow(a,n);for(;!o.eql(d,o.ONE);){if(o.eql(d,o.ZERO))return o.ZERO;let h=1;for(let g=o.sqr(d);h<c&&!o.eql(g,o.ONE);h++)g=o.sqr(g);const l=o.pow(f,ge<<BigInt(c-h-1));f=o.sqr(l),u=o.mul(u,l),d=o.mul(d,f),c=h}return u}}function yy(e){if(e%Fo===gy){const t=(e+ge)/Fo;return function(n,r){const i=n.pow(r,t);if(!n.eql(n.sqr(i),r))throw new Error("Cannot find square root");return i}}if(e%Tu===Du){const t=(e-Du)/Tu;return function(n,r){const i=n.mul(r,zn),s=n.pow(i,t),o=n.mul(r,s),a=n.mul(n.mul(o,zn),s),c=n.mul(o,n.sub(a,n.ONE));if(!n.eql(n.sqr(c),r))throw new Error("Cannot find square root");return c}}return by(e)}const wy=(e,t)=>(we(e,t)&ge)===ge,my=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Ey(e){const t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=my.reduce((r,i)=>(r[i]="function",r),t);return Uo(e,n)}function vy(e,t,n){if(n<_e)throw new Error("invalid exponent, negatives unsupported");if(n===_e)return e.ONE;if(n===ge)return t;let r=e.ONE,i=t;for(;n>_e;)n&ge&&(r=e.mul(r,i)),i=e.sqr(i),n>>=ge;return r}function _y(e,t){const n=new Array(t.length),r=t.reduce((s,o,a)=>e.is0(o)?s:(n[a]=s,e.mul(s,o)),e.ONE),i=e.inv(r);return t.reduceRight((s,o,a)=>e.is0(o)?s:(n[a]=e.mul(s,n[a]),e.mul(s,o)),i),n}function Nu(e,t){const n=t!==void 0?t:e.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function Cu(e,t,n=!1,r={}){if(e<=_e)throw new Error("invalid field: expected ORDER > 0, got "+e);const{nBitLength:i,nByteLength:s}=Nu(e,t);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:e,isLE:n,BITS:i,BYTES:s,MASK:hy(i),ZERO:_e,ONE:ge,create:c=>we(c,e),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return _e<=c&&c<e},is0:c=>c===_e,isOdd:c=>(c&ge)===ge,neg:c=>we(-c,e),eql:(c,f)=>c===f,sqr:c=>we(c*c,e),add:(c,f)=>we(c+f,e),sub:(c,f)=>we(c-f,e),mul:(c,f)=>we(c*f,e),pow:(c,f)=>vy(a,c,f),div:(c,f)=>we(c*Ru(f,e),e),sqrN:c=>c*c,addN:(c,f)=>c+f,subN:(c,f)=>c-f,mulN:(c,f)=>c*f,inv:c=>Ru(c,e),sqrt:r.sqrt||(c=>(o||(o=yy(e)),o(a,c))),invertBatch:c=>_y(a,c),cmov:(c,f,u)=>u?f:c,toBytes:c=>n?$o(c,s):Ou(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return n?Wi(c):fy(c)}});return Object.freeze(a)}const Pu=BigInt(0),Xi=BigInt(1);function jo(e,t){const n=t.negate();return e?n:t}function $u(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function ko(e,t){$u(e,t);const n=Math.ceil(t/e)+1,r=2**(e-1);return{windows:n,windowSize:r}}function xy(e,t){if(!Array.isArray(e))throw new Error("array expected");e.forEach((n,r)=>{if(!(n instanceof t))throw new Error("invalid point at index "+r)})}function Sy(e,t){if(!Array.isArray(e))throw new Error("array of scalars expected");e.forEach((n,r)=>{if(!t.isValid(n))throw new Error("invalid scalar at index "+r)})}const Mo=new WeakMap,Lu=new WeakMap;function zo(e){return Lu.get(e)||1}function Iy(e,t){return{constTimeNegate:jo,hasPrecomputes(n){return zo(n)!==1},unsafeLadder(n,r,i=e.ZERO){let s=n;for(;r>Pu;)r&Xi&&(i=i.add(s)),s=s.double(),r>>=Xi;return i},precomputeWindow(n,r){const{windows:i,windowSize:s}=ko(r,t),o=[];let a=n,c=a;for(let f=0;f<i;f++){c=a,o.push(c);for(let u=1;u<s;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(n,r,i){const{windows:s,windowSize:o}=ko(n,t);let a=e.ZERO,c=e.BASE;const f=BigInt(2**n-1),u=2**n,d=BigInt(n);for(let h=0;h<s;h++){const l=h*o;let g=Number(i&f);i>>=d,g>o&&(g-=u,i+=Xi);const w=l,v=l+Math.abs(g)-1,A=h%2!==0,C=g<0;g===0?c=c.add(jo(A,r[w])):a=a.add(jo(C,r[v]))}return{p:a,f:c}},wNAFUnsafe(n,r,i,s=e.ZERO){const{windows:o,windowSize:a}=ko(n,t),c=BigInt(2**n-1),f=2**n,u=BigInt(n);for(let d=0;d<o;d++){const h=d*a;if(i===Pu)break;let l=Number(i&c);if(i>>=u,l>a&&(l-=f,i+=Xi),l===0)continue;let g=r[h+Math.abs(l)-1];l<0&&(g=g.negate()),s=s.add(g)}return s},getPrecomputes(n,r,i){let s=Mo.get(r);return s||(s=this.precomputeWindow(r,n),n!==1&&Mo.set(r,i(s))),s},wNAFCached(n,r,i){const s=zo(n);return this.wNAF(s,this.getPrecomputes(s,n,i),r)},wNAFCachedUnsafe(n,r,i,s){const o=zo(n);return o===1?this.unsafeLadder(n,r,s):this.wNAFUnsafe(o,this.getPrecomputes(o,n,i),r,s)},setWindowSize(n,r){$u(r,t),Lu.set(n,r),Mo.delete(n)}}}function Oy(e,t,n,r){if(xy(n,e),Sy(r,t),n.length!==r.length)throw new Error("arrays of points and scalars must have equal length");const i=e.ZERO,s=ly(BigInt(n.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=(1<<o)-1,c=new Array(a+1).fill(i),f=Math.floor((t.BITS-1)/o)*o;let u=i;for(let d=f;d>=0;d-=o){c.fill(i);for(let l=0;l<r.length;l++){const g=r[l],w=Number(g>>BigInt(d)&BigInt(a));c[w]=c[w].add(n[l])}let h=i;for(let l=c.length-1,g=i;l>0;l--)g=g.add(c[l]),h=h.add(g);if(u=u.add(h),d!==0)for(let l=0;l<o;l++)u=u.double()}return u}function By(e){return Ey(e.Fp),Uo(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Nu(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}const vt=BigInt(0),Ye=BigInt(1),Ji=BigInt(2),Ay=BigInt(8),Dy={zip215:!0};function Ty(e){const t=By(e);return Uo(e,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...t})}function Ry(e){const t=Ty(e),{Fp:n,n:r,prehash:i,hash:s,randomBytes:o,nByteLength:a,h:c}=t,f=Ji<<BigInt(a*8)-Ye,u=n.create,d=Cu(t.n,t.nBitLength),h=t.uvRatio||((p,y)=>{try{return{isValid:!0,value:n.sqrt(p*n.inv(y))}}catch{return{isValid:!1,value:vt}}}),l=t.adjustScalarBytes||(p=>p),g=t.domain||((p,y,S)=>{if(Co("phflag",S),y.length||S)throw new Error("Contexts/pre-hash are not supported");return p});function w(p,y){Qr("coordinate "+p,y,vt,f)}function v(p){if(!(p instanceof x))throw new Error("ExtendedPoint expected")}const A=Au((p,y)=>{const{ex:S,ey:I,ez:O}=p,B=p.is0();y==null&&(y=B?Ay:n.inv(O));const T=u(S*y),$=u(I*y),P=u(O*y);if(B)return{x:vt,y:Ye};if(P!==Ye)throw new Error("invZ was invalid");return{x:T,y:$}}),C=Au(p=>{const{a:y,d:S}=t;if(p.is0())throw new Error("bad point: ZERO");const{ex:I,ey:O,ez:B,et:T}=p,$=u(I*I),P=u(O*O),F=u(B*B),N=u(F*F),k=u($*y),z=u(F*u(k+P)),G=u(N+u(S*u($*P)));if(z!==G)throw new Error("bad point: equation left != right (1)");const H=u(I*O),K=u(B*T);if(H!==K)throw new Error("bad point: equation left != right (2)");return!0});class x{constructor(y,S,I,O){this.ex=y,this.ey=S,this.ez=I,this.et=O,w("x",y),w("y",S),w("z",I),w("t",O),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(y){if(y instanceof x)throw new Error("extended point not allowed");const{x:S,y:I}=y||{};return w("x",S),w("y",I),new x(S,I,Ye,u(S*I))}static normalizeZ(y){const S=n.invertBatch(y.map(I=>I.ez));return y.map((I,O)=>I.toAffine(S[O])).map(x.fromAffine)}static msm(y,S){return Oy(x,d,y,S)}_setWindowSize(y){L.setWindowSize(this,y)}assertValidity(){C(this)}equals(y){v(y);const{ex:S,ey:I,ez:O}=this,{ex:B,ey:T,ez:$}=y,P=u(S*$),F=u(B*O),N=u(I*$),k=u(T*O);return P===F&&N===k}is0(){return this.equals(x.ZERO)}negate(){return new x(u(-this.ex),this.ey,this.ez,u(-this.et))}double(){const{a:y}=t,{ex:S,ey:I,ez:O}=this,B=u(S*S),T=u(I*I),$=u(Ji*u(O*O)),P=u(y*B),F=S+I,N=u(u(F*F)-B-T),k=P+T,z=k-$,G=P-T,H=u(N*z),K=u(k*G),J=u(N*G),ee=u(z*k);return new x(H,K,ee,J)}add(y){v(y);const{a:S,d:I}=t,{ex:O,ey:B,ez:T,et:$}=this,{ex:P,ey:F,ez:N,et:k}=y;if(S===BigInt(-1)){const rp=u((B-O)*(F+P)),ip=u((B+O)*(F-P)),Xc=u(ip-rp);if(Xc===vt)return this.double();const sp=u(T*Ji*k),op=u($*Ji*N),ap=op+sp,cp=ip+rp,fp=op-sp,dx=u(ap*Xc),gx=u(cp*fp),px=u(ap*fp),bx=u(Xc*cp);return new x(dx,gx,bx,px)}const z=u(O*P),G=u(B*F),H=u($*I*k),K=u(T*N),J=u((O+B)*(P+F)-z-G),ee=K-H,re=K+H,he=u(G-S*z),de=u(J*ee),cn=u(re*he),ao=u(J*he),hx=u(ee*re);return new x(de,cn,hx,ao)}subtract(y){return this.add(y.negate())}wNAF(y){return L.wNAFCached(this,y,x.normalizeZ)}multiply(y){const S=y;Qr("scalar",S,Ye,r);const{p:I,f:O}=this.wNAF(S);return x.normalizeZ([I,O])[0]}multiplyUnsafe(y,S=x.ZERO){const I=y;return Qr("scalar",I,vt,r),I===vt?R:this.is0()||I===Ye?this:L.wNAFCachedUnsafe(this,I,x.normalizeZ,S)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return L.unsafeLadder(this,r).is0()}toAffine(y){return A(this,y)}clearCofactor(){const{h:y}=t;return y===Ye?this:this.multiplyUnsafe(y)}static fromHex(y,S=!1){const{d:I,a:O}=t,B=n.BYTES;y=Mt("pointHex",y,B),Co("zip215",S);const T=y.slice(),$=y[B-1];T[B-1]=$&-129;const P=Wi(T),F=S?f:n.ORDER;Qr("pointHex.y",P,vt,F);const N=u(P*P),k=u(N-Ye),z=u(I*N-O);let{isValid:G,value:H}=h(k,z);if(!G)throw new Error("Point.fromHex: invalid y coordinate");const K=(H&Ye)===Ye,J=($&128)!==0;if(!S&&H===vt&&J)throw new Error("Point.fromHex: x=0 and x_0=1");return J!==K&&(H=u(-H)),x.fromAffine({x:H,y:P})}static fromPrivateKey(y){return D(y).point}toRawBytes(){const{x:y,y:S}=this.toAffine(),I=$o(S,n.BYTES);return I[I.length-1]|=y&Ye?128:0,I}toHex(){return Po(this.toRawBytes())}}x.BASE=new x(t.Gx,t.Gy,Ye,u(t.Gx*t.Gy)),x.ZERO=new x(vt,Ye,Ye,vt);const{BASE:_,ZERO:R}=x,L=Iy(x,a*8);function j(p){return we(p,r)}function U(p){return j(Wi(p))}function D(p){const y=n.BYTES;p=Mt("private key",p,y);const S=Mt("hashed private key",s(p),2*y),I=l(S.slice(0,y)),O=S.slice(y,2*y),B=U(I),T=_.multiply(B),$=T.toRawBytes();return{head:I,prefix:O,scalar:B,point:T,pointBytes:$}}function q(p){return D(p).pointBytes}function M(p=new Uint8Array,...y){const S=Bu(...y);return U(s(g(S,Mt("context",p),!!i)))}function E(p,y,S={}){p=Mt("message",p),i&&(p=i(p));const{prefix:I,scalar:O,pointBytes:B}=D(y),T=M(S.context,I,p),$=_.multiply(T).toRawBytes(),P=M(S.context,$,B,p),F=j(T+P*O);Qr("signature.s",F,vt,r);const N=Bu($,$o(F,n.BYTES));return Mt("result",N,n.BYTES*2)}const b=Dy;function m(p,y,S,I=b){const{context:O,zip215:B}=I,T=n.BYTES;p=Mt("signature",p,2*T),y=Mt("message",y),S=Mt("publicKey",S,T),B!==void 0&&Co("zip215",B),i&&(y=i(y));const $=Wi(p.slice(T,2*T));let P,F,N;try{P=x.fromHex(S,B),F=x.fromHex(p.slice(0,T),B),N=_.multiplyUnsafe($)}catch{return!1}if(!B&&P.isSmallOrder())return!1;const k=M(O,F.toRawBytes(),P.toRawBytes(),y);return F.add(P.multiplyUnsafe(k)).subtract(N).clearCofactor().equals(x.ZERO)}return _._setWindowSize(8),{CURVE:t,getPublicKey:q,sign:E,verify:m,ExtendedPoint:x,utils:{getExtendedPublicKey:D,randomPrivateKey:()=>o(n.BYTES),precompute(p=8,y=x.BASE){return y._setWindowSize(p),y.multiply(BigInt(3)),y}}}}BigInt(0),BigInt(1);const qo=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Uu=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const Ny=BigInt(1),Fu=BigInt(2);BigInt(3);const Cy=BigInt(5),Py=BigInt(8);function $y(e){const t=BigInt(10),n=BigInt(20),r=BigInt(40),i=BigInt(80),s=qo,o=e*e%s*e%s,a=Ct(o,Fu,s)*o%s,c=Ct(a,Ny,s)*e%s,f=Ct(c,Cy,s)*c%s,u=Ct(f,t,s)*f%s,d=Ct(u,n,s)*u%s,h=Ct(d,r,s)*d%s,l=Ct(h,i,s)*h%s,g=Ct(l,i,s)*h%s,w=Ct(g,t,s)*f%s;return{pow_p_5_8:Ct(w,Fu,s)*e%s,b2:o}}function Ly(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}function Uy(e,t){const n=qo,r=we(t*t*t,n),i=we(r*r*t,n),s=$y(e*i).pow_p_5_8;let o=we(e*r*s,n);const a=we(t*o*o,n),c=o,f=we(o*Uu,n),u=a===e,d=a===we(-e,n),h=a===we(-e*Uu,n);return u&&(o=c),(d||h)&&(o=f),wy(o,n)&&(o=we(-o,n)),{isValid:u||d,value:o}}const Fy=Cu(qo,void 0,!0),jy={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:Fy,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:Py,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:oy,randomBytes:Eu,adjustScalarBytes:Ly,uvRatio:Uy},ju=Ry(jy),ky="EdDSA",My="JWT",Qi=".",es="base64url",ku="utf8",Mu="utf8",zy=":",qy="did",Hy="key",zu="base58btc",Vy="z",Ky="K36",Gy=32;function Ho(e){return globalThis.Buffer!=null?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function qu(e=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Ho(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}function Hu(e,t){t||(t=e.reduce((i,s)=>i+s.length,0));const n=qu(t);let r=0;for(const i of e)n.set(i,r),r+=i.length;return Ho(n)}function Zy(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(n[o]!==255)throw new TypeError(s+" is ambiguous");n[o]=i}var a=e.length,c=e.charAt(0),f=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function d(g){if(g instanceof Uint8Array||(ArrayBuffer.isView(g)?g=new Uint8Array(g.buffer,g.byteOffset,g.byteLength):Array.isArray(g)&&(g=Uint8Array.from(g))),!(g instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(g.length===0)return"";for(var w=0,v=0,A=0,C=g.length;A!==C&&g[A]===0;)A++,w++;for(var x=(C-A)*u+1>>>0,_=new Uint8Array(x);A!==C;){for(var R=g[A],L=0,j=x-1;(R!==0||L<v)&&j!==-1;j--,L++)R+=256*_[j]>>>0,_[j]=R%a>>>0,R=R/a>>>0;if(R!==0)throw new Error("Non-zero carry");v=L,A++}for(var U=x-v;U!==x&&_[U]===0;)U++;for(var D=c.repeat(w);U<x;++U)D+=e.charAt(_[U]);return D}function h(g){if(typeof g!="string")throw new TypeError("Expected String");if(g.length===0)return new Uint8Array;var w=0;if(g[w]!==" "){for(var v=0,A=0;g[w]===c;)v++,w++;for(var C=(g.length-w)*f+1>>>0,x=new Uint8Array(C);g[w];){var _=n[g.charCodeAt(w)];if(_===255)return;for(var R=0,L=C-1;(_!==0||R<A)&&L!==-1;L--,R++)_+=a*x[L]>>>0,x[L]=_%256>>>0,_=_/256>>>0;if(_!==0)throw new Error("Non-zero carry");A=R,w++}if(g[w]!==" "){for(var j=C-A;j!==C&&x[j]===0;)j++;for(var U=new Uint8Array(v+(C-j)),D=v;j!==C;)U[D++]=x[j++];return U}}}function l(g){var w=h(g);if(w)return w;throw new Error(`Non-${t} character`)}return{encode:d,decodeUnsafe:h,decode:l}}var Yy=Zy,Wy=Yy;const Vu=e=>{if(e instanceof Uint8Array&&e.constructor.name==="Uint8Array")return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")},Xy=e=>new TextEncoder().encode(e),Jy=e=>new TextDecoder().decode(e);class Qy{constructor(t,n,r){this.name=t,this.prefix=n,this.baseEncode=r}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class ew{constructor(t,n,r){if(this.name=t,this.prefix=n,n.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=n.codePointAt(0),this.baseDecode=r}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return Ku(this,t)}}class tw{constructor(t){this.decoders=t}or(t){return Ku(this,t)}decode(t){const n=t[0],r=this.decoders[n];if(r)return r.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Ku=(e,t)=>new tw({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class nw{constructor(t,n,r,i){this.name=t,this.prefix=n,this.baseEncode=r,this.baseDecode=i,this.encoder=new Qy(t,n,r),this.decoder=new ew(t,n,i)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}const ts=({name:e,prefix:t,encode:n,decode:r})=>new nw(e,t,n,r),ei=({prefix:e,name:t,alphabet:n})=>{const{encode:r,decode:i}=Wy(n,t);return ts({prefix:e,name:t,encode:r,decode:s=>Vu(i(s))})},rw=(e,t,n,r)=>{const i={};for(let u=0;u<t.length;++u)i[t[u]]=u;let s=e.length;for(;e[s-1]==="=";)--s;const o=new Uint8Array(s*n/8|0);let a=0,c=0,f=0;for(let u=0;u<s;++u){const d=i[e[u]];if(d===void 0)throw new SyntaxError(`Non-${r} character`);c=c<<n|d,a+=n,a>=8&&(a-=8,o[f++]=255&c>>a)}if(a>=n||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},iw=(e,t,n)=>{const r=t[t.length-1]==="=",i=(1<<n)-1;let s="",o=0,a=0;for(let c=0;c<e.length;++c)for(a=a<<8|e[c],o+=8;o>n;)o-=n,s+=t[i&a>>o];if(o&&(s+=t[i&a<<n-o]),r)for(;s.length*n&7;)s+="=";return s},Ie=({name:e,prefix:t,bitsPerChar:n,alphabet:r})=>ts({prefix:t,name:e,encode(i){return iw(i,r,n)},decode(i){return rw(i,r,n,e)}}),sw=ts({prefix:"\0",name:"identity",encode:e=>Jy(e),decode:e=>Xy(e)});var ow=Object.freeze({__proto__:null,identity:sw});const aw=Ie({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var cw=Object.freeze({__proto__:null,base2:aw});const fw=Ie({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var uw=Object.freeze({__proto__:null,base8:fw});const lw=ei({prefix:"9",name:"base10",alphabet:"0123456789"});var hw=Object.freeze({__proto__:null,base10:lw});const dw=Ie({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),gw=Ie({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var pw=Object.freeze({__proto__:null,base16:dw,base16upper:gw});const bw=Ie({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),yw=Ie({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),ww=Ie({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),mw=Ie({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Ew=Ie({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),vw=Ie({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),_w=Ie({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),xw=Ie({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Sw=Ie({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Iw=Object.freeze({__proto__:null,base32:bw,base32upper:yw,base32pad:ww,base32padupper:mw,base32hex:Ew,base32hexupper:vw,base32hexpad:_w,base32hexpadupper:xw,base32z:Sw});const Ow=ei({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Bw=ei({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Aw=Object.freeze({__proto__:null,base36:Ow,base36upper:Bw});const Dw=ei({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Tw=ei({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Rw=Object.freeze({__proto__:null,base58btc:Dw,base58flickr:Tw});const Nw=Ie({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Cw=Ie({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Pw=Ie({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),$w=Ie({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Lw=Object.freeze({__proto__:null,base64:Nw,base64pad:Cw,base64url:Pw,base64urlpad:$w});const Gu=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),Uw=Gu.reduce((e,t,n)=>(e[n]=t,e),[]),Fw=Gu.reduce((e,t,n)=>(e[t.codePointAt(0)]=n,e),[]);function jw(e){return e.reduce((t,n)=>(t+=Uw[n],t),"")}function kw(e){const t=[];for(const n of e){const r=Fw[n.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${n}`);t.push(r)}return new Uint8Array(t)}const Mw=ts({prefix:"\u{1F680}",name:"base256emoji",encode:jw,decode:kw});var zw=Object.freeze({__proto__:null,base256emoji:Mw}),qw=Yu,Zu=128,Hw=127,Vw=~Hw,Kw=Math.pow(2,31);function Yu(e,t,n){t=t||[],n=n||0;for(var r=n;e>=Kw;)t[n++]=e&255|Zu,e/=128;for(;e&Vw;)t[n++]=e&255|Zu,e>>>=7;return t[n]=e|0,Yu.bytes=n-r+1,t}var Gw=Vo,Zw=128,Wu=127;function Vo(e,r){var n=0,r=r||0,i=0,s=r,o,a=e.length;do{if(s>=a)throw Vo.bytes=0,new RangeError("Could not decode varint");o=e[s++],n+=i<28?(o&Wu)<<i:(o&Wu)*Math.pow(2,i),i+=7}while(o>=Zw);return Vo.bytes=s-r,n}var Yw=Math.pow(2,7),Ww=Math.pow(2,14),Xw=Math.pow(2,21),Jw=Math.pow(2,28),Qw=Math.pow(2,35),em=Math.pow(2,42),tm=Math.pow(2,49),nm=Math.pow(2,56),rm=Math.pow(2,63),im=function(e){return e<Yw?1:e<Ww?2:e<Xw?3:e<Jw?4:e<Qw?5:e<em?6:e<tm?7:e<nm?8:e<rm?9:10},sm={encode:qw,decode:Gw,encodingLength:im},Xu=sm;const Ju=(e,t,n=0)=>(Xu.encode(e,t,n),t),Qu=e=>Xu.encodingLength(e),Ko=(e,t)=>{const n=t.byteLength,r=Qu(e),i=r+Qu(n),s=new Uint8Array(i+n);return Ju(e,s,0),Ju(n,s,r),s.set(t,i),new om(e,n,t,s)};class om{constructor(t,n,r,i){this.code=t,this.size=n,this.digest=r,this.bytes=i}}const el=({name:e,code:t,encode:n})=>new am(e,t,n);class am{constructor(t,n,r){this.name=t,this.code=n,this.encode=r}digest(t){if(t instanceof Uint8Array){const n=this.encode(t);return n instanceof Uint8Array?Ko(this.code,n):n.then(r=>Ko(this.code,r))}else throw Error("Unknown type, must be binary type")}}const tl=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),cm=el({name:"sha2-256",code:18,encode:tl("SHA-256")}),fm=el({name:"sha2-512",code:19,encode:tl("SHA-512")});var um=Object.freeze({__proto__:null,sha256:cm,sha512:fm});const nl=0,lm="identity",rl=Vu;var hm=Object.freeze({__proto__:null,identity:{code:nl,name:lm,encode:rl,digest:e=>Ko(nl,rl(e))}});new TextEncoder,new TextDecoder;const il={...ow,...cw,...uw,...hw,...pw,...Iw,...Aw,...Rw,...Lw,...zw};({...um,...hm});function sl(e,t,n,r){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:n},decoder:{decode:r}}}const ol=sl("utf8","u",e=>"u"+new TextDecoder("utf8").decode(e),e=>new TextEncoder().encode(e.substring(1))),Go=sl("ascii","a",e=>{let t="a";for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t},e=>{e=e.substring(1);const t=qu(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}),al={utf8:ol,"utf-8":ol,hex:il.base16,latin1:Go,ascii:Go,binary:Go,...il};function ns(e,t="utf8"){const n=al[t];if(!n)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8"):n.encoder.encode(e).substring(1)}function hr(e,t="utf8"){const n=al[t];if(!n)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Ho(globalThis.Buffer.from(e,"utf-8")):n.decoder.decode(`${n.prefix}${e}`)}function cl(e){return or(ns(hr(e,es),ku))}function rs(e){return ns(hr(kn(e),ku),es)}function fl(e){const t=hr(Ky,zu),n=Vy+ns(Hu([t,e]),zu);return[qy,Hy,n].join(zy)}function dm(e){return ns(e,es)}function gm(e){return hr(e,es)}function pm(e){return hr([rs(e.header),rs(e.payload)].join(Qi),Mu)}function bm(e){return[rs(e.header),rs(e.payload),dm(e.signature)].join(Qi)}function Zo(e){const t=e.split(Qi),n=cl(t[0]),r=cl(t[1]),i=gm(t[2]),s=hr(t.slice(0,2).join(Qi),Mu);return{header:n,payload:r,signature:i,data:s}}function ul(e=Eu(Gy)){const t=ju.getPublicKey(e);return{secretKey:Hu([e,t]),publicKey:t}}async function ym(e,t,n,r,i=W.fromMiliseconds(Date.now())){const s={alg:ky,typ:My},o=fl(r.publicKey),a=i+n,c={iss:o,sub:e,aud:t,iat:i,exp:a},f=pm({header:s,payload:c}),u=ju.sign(f,r.secretKey.slice(0,32));return bm({header:s,payload:c,signature:u})}function wm(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(n[o]!==255)throw new TypeError(s+" is ambiguous");n[o]=i}var a=e.length,c=e.charAt(0),f=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function d(g){if(g instanceof Uint8Array||(ArrayBuffer.isView(g)?g=new Uint8Array(g.buffer,g.byteOffset,g.byteLength):Array.isArray(g)&&(g=Uint8Array.from(g))),!(g instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(g.length===0)return"";for(var w=0,v=0,A=0,C=g.length;A!==C&&g[A]===0;)A++,w++;for(var x=(C-A)*u+1>>>0,_=new Uint8Array(x);A!==C;){for(var R=g[A],L=0,j=x-1;(R!==0||L<v)&&j!==-1;j--,L++)R+=256*_[j]>>>0,_[j]=R%a>>>0,R=R/a>>>0;if(R!==0)throw new Error("Non-zero carry");v=L,A++}for(var U=x-v;U!==x&&_[U]===0;)U++;for(var D=c.repeat(w);U<x;++U)D+=e.charAt(_[U]);return D}function h(g){if(typeof g!="string")throw new TypeError("Expected String");if(g.length===0)return new Uint8Array;var w=0;if(g[w]!==" "){for(var v=0,A=0;g[w]===c;)v++,w++;for(var C=(g.length-w)*f+1>>>0,x=new Uint8Array(C);g[w];){var _=n[g.charCodeAt(w)];if(_===255)return;for(var R=0,L=C-1;(_!==0||R<A)&&L!==-1;L--,R++)_+=a*x[L]>>>0,x[L]=_%256>>>0,_=_/256>>>0;if(_!==0)throw new Error("Non-zero carry");A=R,w++}if(g[w]!==" "){for(var j=C-A;j!==C&&x[j]===0;)j++;for(var U=new Uint8Array(v+(C-j)),D=v;j!==C;)U[D++]=x[j++];return U}}}function l(g){var w=h(g);if(w)return w;throw new Error(`Non-${t} character`)}return{encode:d,decodeUnsafe:h,decode:l}}var mm=wm,Em=mm;const ll=e=>{if(e instanceof Uint8Array&&e.constructor.name==="Uint8Array")return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")},vm=e=>new TextEncoder().encode(e),_m=e=>new TextDecoder().decode(e);class xm{constructor(t,n,r){this.name=t,this.prefix=n,this.baseEncode=r}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class Sm{constructor(t,n,r){if(this.name=t,this.prefix=n,n.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=n.codePointAt(0),this.baseDecode=r}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return hl(this,t)}}class Im{constructor(t){this.decoders=t}or(t){return hl(this,t)}decode(t){const n=t[0],r=this.decoders[n];if(r)return r.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const hl=(e,t)=>new Im({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class Om{constructor(t,n,r,i){this.name=t,this.prefix=n,this.baseEncode=r,this.baseDecode=i,this.encoder=new xm(t,n,r),this.decoder=new Sm(t,n,i)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}const is=({name:e,prefix:t,encode:n,decode:r})=>new Om(e,t,n,r),ti=({prefix:e,name:t,alphabet:n})=>{const{encode:r,decode:i}=Em(n,t);return is({prefix:e,name:t,encode:r,decode:s=>ll(i(s))})},Bm=(e,t,n,r)=>{const i={};for(let u=0;u<t.length;++u)i[t[u]]=u;let s=e.length;for(;e[s-1]==="=";)--s;const o=new Uint8Array(s*n/8|0);let a=0,c=0,f=0;for(let u=0;u<s;++u){const d=i[e[u]];if(d===void 0)throw new SyntaxError(`Non-${r} character`);c=c<<n|d,a+=n,a>=8&&(a-=8,o[f++]=255&c>>a)}if(a>=n||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Am=(e,t,n)=>{const r=t[t.length-1]==="=",i=(1<<n)-1;let s="",o=0,a=0;for(let c=0;c<e.length;++c)for(a=a<<8|e[c],o+=8;o>n;)o-=n,s+=t[i&a>>o];if(o&&(s+=t[i&a<<n-o]),r)for(;s.length*n&7;)s+="=";return s},Oe=({name:e,prefix:t,bitsPerChar:n,alphabet:r})=>is({prefix:t,name:e,encode(i){return Am(i,r,n)},decode(i){return Bm(i,r,n,e)}}),Dm=is({prefix:"\0",name:"identity",encode:e=>_m(e),decode:e=>vm(e)});var Tm=Object.freeze({__proto__:null,identity:Dm});const Rm=Oe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Nm=Object.freeze({__proto__:null,base2:Rm});const Cm=Oe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Pm=Object.freeze({__proto__:null,base8:Cm});const $m=ti({prefix:"9",name:"base10",alphabet:"0123456789"});var Lm=Object.freeze({__proto__:null,base10:$m});const Um=Oe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Fm=Oe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var jm=Object.freeze({__proto__:null,base16:Um,base16upper:Fm});const km=Oe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Mm=Oe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),zm=Oe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),qm=Oe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Hm=Oe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Vm=Oe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Km=Oe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Gm=Oe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Zm=Oe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Ym=Object.freeze({__proto__:null,base32:km,base32upper:Mm,base32pad:zm,base32padupper:qm,base32hex:Hm,base32hexupper:Vm,base32hexpad:Km,base32hexpadupper:Gm,base32z:Zm});const Wm=ti({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Xm=ti({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Jm=Object.freeze({__proto__:null,base36:Wm,base36upper:Xm});const Qm=ti({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),e2=ti({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var t2=Object.freeze({__proto__:null,base58btc:Qm,base58flickr:e2});const n2=Oe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),r2=Oe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),i2=Oe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),s2=Oe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var o2=Object.freeze({__proto__:null,base64:n2,base64pad:r2,base64url:i2,base64urlpad:s2});const dl=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),a2=dl.reduce((e,t,n)=>(e[n]=t,e),[]),c2=dl.reduce((e,t,n)=>(e[t.codePointAt(0)]=n,e),[]);function f2(e){return e.reduce((t,n)=>(t+=a2[n],t),"")}function u2(e){const t=[];for(const n of e){const r=c2[n.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${n}`);t.push(r)}return new Uint8Array(t)}const l2=is({prefix:"\u{1F680}",name:"base256emoji",encode:f2,decode:u2});var h2=Object.freeze({__proto__:null,base256emoji:l2}),d2=pl,gl=128,g2=127,p2=~g2,b2=Math.pow(2,31);function pl(e,t,n){t=t||[],n=n||0;for(var r=n;e>=b2;)t[n++]=e&255|gl,e/=128;for(;e&p2;)t[n++]=e&255|gl,e>>>=7;return t[n]=e|0,pl.bytes=n-r+1,t}var y2=Yo,w2=128,bl=127;function Yo(e,r){var n=0,r=r||0,i=0,s=r,o,a=e.length;do{if(s>=a)throw Yo.bytes=0,new RangeError("Could not decode varint");o=e[s++],n+=i<28?(o&bl)<<i:(o&bl)*Math.pow(2,i),i+=7}while(o>=w2);return Yo.bytes=s-r,n}var m2=Math.pow(2,7),E2=Math.pow(2,14),v2=Math.pow(2,21),_2=Math.pow(2,28),x2=Math.pow(2,35),S2=Math.pow(2,42),I2=Math.pow(2,49),O2=Math.pow(2,56),B2=Math.pow(2,63),A2=function(e){return e<m2?1:e<E2?2:e<v2?3:e<_2?4:e<x2?5:e<S2?6:e<I2?7:e<O2?8:e<B2?9:10},D2={encode:d2,decode:y2,encodingLength:A2},yl=D2;const wl=(e,t,n=0)=>(yl.encode(e,t,n),t),ml=e=>yl.encodingLength(e),Wo=(e,t)=>{const n=t.byteLength,r=ml(e),i=r+ml(n),s=new Uint8Array(i+n);return wl(e,s,0),wl(n,s,r),s.set(t,i),new T2(e,n,t,s)};class T2{constructor(t,n,r,i){this.code=t,this.size=n,this.digest=r,this.bytes=i}}const El=({name:e,code:t,encode:n})=>new R2(e,t,n);class R2{constructor(t,n,r){this.name=t,this.code=n,this.encode=r}digest(t){if(t instanceof Uint8Array){const n=this.encode(t);return n instanceof Uint8Array?Wo(this.code,n):n.then(r=>Wo(this.code,r))}else throw Error("Unknown type, must be binary type")}}const vl=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),N2=El({name:"sha2-256",code:18,encode:vl("SHA-256")}),C2=El({name:"sha2-512",code:19,encode:vl("SHA-512")});var P2=Object.freeze({__proto__:null,sha256:N2,sha512:C2});const _l=0,$2="identity",xl=ll;var L2=Object.freeze({__proto__:null,identity:{code:_l,name:$2,encode:xl,digest:e=>Wo(_l,xl(e))}});new TextEncoder,new TextDecoder;const Sl={...Tm,...Nm,...Pm,...Lm,...jm,...Ym,...Jm,...t2,...o2,...h2};({...P2,...L2});function Xo(e){return globalThis.Buffer!=null?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function Il(e=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Xo(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}function Ol(e,t,n,r){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:n},decoder:{decode:r}}}const Bl=Ol("utf8","u",e=>"u"+new TextDecoder("utf8").decode(e),e=>new TextEncoder().encode(e.substring(1))),Jo=Ol("ascii","a",e=>{let t="a";for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t},e=>{e=e.substring(1);const t=Il(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}),Al={utf8:Bl,"utf-8":Bl,hex:Sl.base16,latin1:Jo,ascii:Jo,binary:Jo,...Sl};function ot(e,t="utf8"){const n=Al[t];if(!n)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Xo(globalThis.Buffer.from(e,"utf-8")):n.decoder.decode(`${n.prefix}${e}`)}var Dl=function(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,s;r<i;r++)(s||!(r in t))&&(s||(s=Array.prototype.slice.call(t,0,r)),s[r]=t[r]);return e.concat(s||Array.prototype.slice.call(t))},U2=function(){function e(t,n,r){this.name=t,this.version=n,this.os=r,this.type="browser"}return e}(),F2=function(){function e(t){this.version=t,this.type="node",this.name="node",this.os=process.platform}return e}(),j2=function(){function e(t,n,r,i){this.name=t,this.version=n,this.os=r,this.bot=i,this.type="bot-device"}return e}(),k2=function(){function e(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return e}(),M2=function(){function e(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return e}(),z2=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,q2=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,Tl=3,H2=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",z2]],Rl=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function V2(e){return e?Nl(e):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new M2:typeof navigator<"u"?Nl(navigator.userAgent):Z2()}function K2(e){return e!==""&&H2.reduce(function(t,n){var r=n[0],i=n[1];if(t)return t;var s=i.exec(e);return!!s&&[r,s]},!1)}function Nl(e){var t=K2(e);if(!t)return null;var n=t[0],r=t[1];if(n==="searchbot")return new k2;var i=r[1]&&r[1].split(".").join("_").split("_").slice(0,3);i?i.length<Tl&&(i=Dl(Dl([],i,!0),Y2(Tl-i.length),!0)):i=[];var s=i.join("."),o=G2(e),a=q2.exec(e);return a&&a[1]?new j2(n,s,o,a[1]):new U2(n,s,o)}function G2(e){for(var t=0,n=Rl.length;t<n;t++){var r=Rl[t],i=r[0],s=r[1],o=s.exec(e);if(o)return i}return null}function Z2(){var e=typeof process<"u"&&process.version;return e?new F2(process.version.slice(1)):null}function Y2(e){for(var t=[],n=0;n<e;n++)t.push("0");return t}var ue={};Object.defineProperty(ue,"__esModule",{value:!0}),ue.getLocalStorage=ue.getLocalStorageOrThrow=ue.getCrypto=ue.getCryptoOrThrow=Cl=ue.getLocation=ue.getLocationOrThrow=Qo=ue.getNavigator=ue.getNavigatorOrThrow=gr=ue.getDocument=ue.getDocumentOrThrow=ue.getFromWindowOrThrow=ue.getFromWindow=void 0;function qn(e){let t;return typeof window<"u"&&typeof window[e]<"u"&&(t=window[e]),t}ue.getFromWindow=qn;function dr(e){const t=qn(e);if(!t)throw new Error(`${e} is not defined in Window`);return t}ue.getFromWindowOrThrow=dr;function W2(){return dr("document")}ue.getDocumentOrThrow=W2;function X2(){return qn("document")}var gr=ue.getDocument=X2;function J2(){return dr("navigator")}ue.getNavigatorOrThrow=J2;function Q2(){return qn("navigator")}var Qo=ue.getNavigator=Q2;function eE(){return dr("location")}ue.getLocationOrThrow=eE;function tE(){return qn("location")}var Cl=ue.getLocation=tE;function nE(){return dr("crypto")}ue.getCryptoOrThrow=nE;function rE(){return qn("crypto")}ue.getCrypto=rE;function iE(){return dr("localStorage")}ue.getLocalStorageOrThrow=iE;function sE(){return qn("localStorage")}ue.getLocalStorage=sE;var ea={};Object.defineProperty(ea,"__esModule",{value:!0});var Pl=ea.getWindowMetadata=void 0;const $l=ue;function oE(){let e,t;try{e=$l.getDocumentOrThrow(),t=$l.getLocationOrThrow()}catch{return null}function n(){const d=e.getElementsByTagName("link"),h=[];for(let l=0;l<d.length;l++){const g=d[l],w=g.getAttribute("rel");if(w&&w.toLowerCase().indexOf("icon")>-1){const v=g.getAttribute("href");if(v)if(v.toLowerCase().indexOf("https:")===-1&&v.toLowerCase().indexOf("http:")===-1&&v.indexOf("//")!==0){let A=t.protocol+"//"+t.host;if(v.indexOf("/")===0)A+=v;else{const C=t.pathname.split("/");C.pop();const x=C.join("/");A+=x+"/"+v}h.push(A)}else if(v.indexOf("//")===0){const A=t.protocol+v;h.push(A)}else h.push(v)}}return h}function r(...d){const h=e.getElementsByTagName("meta");for(let l=0;l<h.length;l++){const g=h[l],w=["itemprop","property","name"].map(v=>g.getAttribute(v)).filter(v=>v?d.includes(v):!1);if(w.length&&w){const v=g.getAttribute("content");if(v)return v}}return""}function i(){let d=r("name","og:site_name","og:title","twitter:title");return d||(d=e.title),d}function s(){return r("description","og:description","twitter:description","keywords")}const o=i(),a=s(),c=t.origin,f=n();return{description:a,url:c,icons:f,name:o}}Pl=ea.getWindowMetadata=oE;const aE="0.1.1";function cE(){return aE}class Fe extends Error{constructor(t,n={}){const r=(()=>{if(n.cause instanceof Fe){if(n.cause.details)return n.cause.details;if(n.cause.shortMessage)return n.cause.shortMessage}return n.cause&&"details"in n.cause&&typeof n.cause.details=="string"?n.cause.details:n.cause?.message?n.cause.message:n.details})(),i=n.cause instanceof Fe&&n.cause.docsPath||n.docsPath,o=`https://oxlib.sh${i??""}`,a=[t||"An error occurred.",...n.metaMessages?["",...n.metaMessages]:[],...r||i?["",r?`Details: ${r}`:void 0,i?`See: ${o}`:void 0]:[]].filter(c=>typeof c=="string").join(`
`);super(a,n.cause?{cause:n.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:`ox@${cE()}`}),this.cause=n.cause,this.details=r,this.docs=o,this.docsPath=i,this.shortMessage=t}walk(t){return Ll(this,t)}}function Ll(e,t){return t?.(e)?e:e&&typeof e=="object"&&"cause"in e&&e.cause?Ll(e.cause,t):t?null:e}const pr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function ss(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function br(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function zt(e,...t){if(!ss(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function Ul(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");br(e.outputLen),br(e.blockLen)}function yr(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Fl(e,t){zt(e);const n=t.outputLen;if(e.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function fE(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function hn(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function ta(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function Pt(e,t){return e<<32-t|e>>>t}const uE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function lE(e){return e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255}function hE(e){for(let t=0;t<e.length;t++)e[t]=lE(e[t]);return e}const jl=uE?e=>e:hE,kl=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",dE=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function wr(e){if(zt(e),kl)return e.toHex();let t="";for(let n=0;n<e.length;n++)t+=dE[e[n]];return t}const qt={_0:48,_9:57,A:65,F:70,a:97,f:102};function Ml(e){if(e>=qt._0&&e<=qt._9)return e-qt._0;if(e>=qt.A&&e<=qt.F)return e-(qt.A-10);if(e>=qt.a&&e<=qt.f)return e-(qt.a-10)}function os(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);if(kl)return Uint8Array.fromHex(e);const t=e.length,n=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const r=new Uint8Array(n);for(let i=0,s=0;i<n;i++,s+=2){const o=Ml(e.charCodeAt(s)),a=Ml(e.charCodeAt(s+1));if(o===void 0||a===void 0){const c=e[s]+e[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}r[i]=o*16+a}return r}function na(e){if(typeof e!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}function as(e){return typeof e=="string"&&(e=na(e)),zt(e),e}function Ht(...e){let t=0;for(let r=0;r<e.length;r++){const i=e[r];zt(i),t+=i.length}const n=new Uint8Array(t);for(let r=0,i=0;r<e.length;r++){const s=e[r];n.set(s,i),i+=s.length}return n}class ra{}function cs(e){const t=r=>e().update(as(r)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function fs(e=32){if(pr&&typeof pr.getRandomValues=="function")return pr.getRandomValues(new Uint8Array(e));if(pr&&typeof pr.randomBytes=="function")return Uint8Array.from(pr.randomBytes(e));throw new Error("crypto.getRandomValues must be defined")}function gE(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),c=r?4:0,f=r?0:4;e.setUint32(t+c,o,r),e.setUint32(t+f,a,r)}function pE(e,t,n){return e&t^~e&n}function bE(e,t,n){return e&t^e&n^t&n}class zl extends ra{constructor(t,n,r,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=t,this.outputLen=n,this.padOffset=r,this.isLE=i,this.buffer=new Uint8Array(t),this.view=ta(this.buffer)}update(t){yr(this),t=as(t),zt(t);const{view:n,buffer:r,blockLen:i}=this,s=t.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=ta(t);for(;i<=s-o;o+=i)this.process(c,o);continue}r.set(t.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){yr(this),Fl(t,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,hn(this.buffer.subarray(o)),this.padOffset>i-o&&(this.process(r,0),o=0);for(let d=o;d<i;d++)n[d]=0;gE(r,i-8,BigInt(this.length*8),s),this.process(r,0);const a=ta(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const f=c/4,u=this.get();if(f>u.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<f;d++)a.setUint32(4*d,u[d],s)}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const r=t.slice(0,n);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return t.destroyed=o,t.finished=s,t.length=i,t.pos=a,i%n&&t.buffer.set(r),t}clone(){return this._cloneInto()}}const Vt=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Te=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),Re=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),us=BigInt(2**32-1),ql=BigInt(32);function yE(e,t=!1){return t?{h:Number(e&us),l:Number(e>>ql&us)}:{h:Number(e>>ql&us)|0,l:Number(e&us)|0}}function Hl(e,t=!1){const n=e.length;let r=new Uint32Array(n),i=new Uint32Array(n);for(let s=0;s<n;s++){const{h:o,l:a}=yE(e[s],t);[r[s],i[s]]=[o,a]}return[r,i]}const Vl=(e,t,n)=>e>>>n,Kl=(e,t,n)=>e<<32-n|t>>>n,mr=(e,t,n)=>e>>>n|t<<32-n,Er=(e,t,n)=>e<<32-n|t>>>n,ls=(e,t,n)=>e<<64-n|t>>>n-32,hs=(e,t,n)=>e>>>n-32|t<<64-n,wE=(e,t,n)=>e<<n|t>>>32-n,mE=(e,t,n)=>t<<n|e>>>32-n,EE=(e,t,n)=>t<<n-32|e>>>64-n,vE=(e,t,n)=>e<<n-32|t>>>64-n;function Kt(e,t,n,r){const i=(t>>>0)+(r>>>0);return{h:e+n+(i/2**32|0)|0,l:i|0}}const _E=(e,t,n)=>(e>>>0)+(t>>>0)+(n>>>0),xE=(e,t,n,r)=>t+n+r+(e/2**32|0)|0,SE=(e,t,n,r)=>(e>>>0)+(t>>>0)+(n>>>0)+(r>>>0),IE=(e,t,n,r,i)=>t+n+r+i+(e/2**32|0)|0,OE=(e,t,n,r,i)=>(e>>>0)+(t>>>0)+(n>>>0)+(r>>>0)+(i>>>0),BE=(e,t,n,r,i,s)=>t+n+r+i+s+(e/2**32|0)|0,AE=BigInt(0),ni=BigInt(1),DE=BigInt(2),TE=BigInt(7),RE=BigInt(256),NE=BigInt(113),Gl=[],Zl=[],Yl=[];for(let e=0,t=ni,n=1,r=0;e<24;e++){[n,r]=[r,(2*n+3*r)%5],Gl.push(2*(5*r+n)),Zl.push((e+1)*(e+2)/2%64);let i=AE;for(let s=0;s<7;s++)t=(t<<ni^(t>>TE)*NE)%RE,t&DE&&(i^=ni<<(ni<<BigInt(s))-ni);Yl.push(i)}const Wl=Hl(Yl,!0),CE=Wl[0],PE=Wl[1],Xl=(e,t,n)=>n>32?EE(e,t,n):wE(e,t,n),Jl=(e,t,n)=>n>32?vE(e,t,n):mE(e,t,n);function $E(e,t=24){const n=new Uint32Array(10);for(let r=24-t;r<24;r++){for(let o=0;o<10;o++)n[o]=e[o]^e[o+10]^e[o+20]^e[o+30]^e[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,f=n[c],u=n[c+1],d=Xl(f,u,1)^n[a],h=Jl(f,u,1)^n[a+1];for(let l=0;l<50;l+=10)e[o+l]^=d,e[o+l+1]^=h}let i=e[2],s=e[3];for(let o=0;o<24;o++){const a=Zl[o],c=Xl(i,s,a),f=Jl(i,s,a),u=Gl[o];i=e[u],s=e[u+1],e[u]=c,e[u+1]=f}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)n[a]=e[o+a];for(let a=0;a<10;a++)e[o+a]^=~n[(a+2)%10]&n[(a+4)%10]}e[0]^=CE[r],e[1]^=PE[r]}hn(n)}class ia extends ra{constructor(t,n,r,i=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=t,this.suffix=n,this.outputLen=r,this.enableXOF=i,this.rounds=s,br(r),!(0<t&&t<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=fE(this.state)}clone(){return this._cloneInto()}keccak(){jl(this.state32),$E(this.state32,this.rounds),jl(this.state32),this.posOut=0,this.pos=0}update(t){yr(this),t=as(t),zt(t);const{blockLen:n,state:r}=this,i=t.length;for(let s=0;s<i;){const o=Math.min(n-this.pos,i-s);for(let a=0;a<o;a++)r[this.pos++]^=t[s++];this.pos===n&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:t,suffix:n,pos:r,blockLen:i}=this;t[r]^=n,(n&128)!==0&&r===i-1&&this.keccak(),t[i-1]^=128,this.keccak()}writeInto(t){yr(this,!1),zt(t),this.finish();const n=this.state,{blockLen:r}=this;for(let i=0,s=t.length;i<s;){this.posOut>=r&&this.keccak();const o=Math.min(r-this.posOut,s-i);t.set(n.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return t}xofInto(t){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(t)}xof(t){return br(t),this.xofInto(new Uint8Array(t))}digestInto(t){if(Fl(t,this),this.finished)throw new Error("digest() was already called");return this.writeInto(t),this.destroy(),t}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,hn(this.state)}_cloneInto(t){const{blockLen:n,suffix:r,outputLen:i,rounds:s,enableXOF:o}=this;return t||(t=new ia(n,r,i,o,s)),t.state32.set(this.state32),t.pos=this.pos,t.posOut=this.posOut,t.finished=this.finished,t.rounds=s,t.suffix=r,t.outputLen=i,t.enableXOF=o,t.destroyed=this.destroyed,t}}const LE=(e,t,n)=>cs(()=>new ia(t,e,n)),UE=LE(1,136,256/8),FE=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),dn=new Uint32Array(64);class jE extends zl{constructor(t=32){super(64,t,8,!1),this.A=Vt[0]|0,this.B=Vt[1]|0,this.C=Vt[2]|0,this.D=Vt[3]|0,this.E=Vt[4]|0,this.F=Vt[5]|0,this.G=Vt[6]|0,this.H=Vt[7]|0}get(){const{A:t,B:n,C:r,D:i,E:s,F:o,G:a,H:c}=this;return[t,n,r,i,s,o,a,c]}set(t,n,r,i,s,o,a,c){this.A=t|0,this.B=n|0,this.C=r|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(t,n){for(let d=0;d<16;d++,n+=4)dn[d]=t.getUint32(n,!1);for(let d=16;d<64;d++){const h=dn[d-15],l=dn[d-2],g=Pt(h,7)^Pt(h,18)^h>>>3,w=Pt(l,17)^Pt(l,19)^l>>>10;dn[d]=w+dn[d-7]+g+dn[d-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:c,G:f,H:u}=this;for(let d=0;d<64;d++){const h=Pt(a,6)^Pt(a,11)^Pt(a,25),l=u+h+pE(a,c,f)+FE[d]+dn[d]|0,w=(Pt(r,2)^Pt(r,13)^Pt(r,22))+bE(r,i,s)|0;u=f,f=c,c=a,a=o+l|0,o=s,s=i,i=r,r=l+w|0}r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,f=f+this.G|0,u=u+this.H|0,this.set(r,i,s,o,a,c,f,u)}roundClean(){hn(dn)}destroy(){this.set(0,0,0,0,0,0,0,0),hn(this.buffer)}}const Ql=Hl(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))),kE=Ql[0],ME=Ql[1],gn=new Uint32Array(80),pn=new Uint32Array(80);class eh extends zl{constructor(t=64){super(128,t,16,!1),this.Ah=Re[0]|0,this.Al=Re[1]|0,this.Bh=Re[2]|0,this.Bl=Re[3]|0,this.Ch=Re[4]|0,this.Cl=Re[5]|0,this.Dh=Re[6]|0,this.Dl=Re[7]|0,this.Eh=Re[8]|0,this.El=Re[9]|0,this.Fh=Re[10]|0,this.Fl=Re[11]|0,this.Gh=Re[12]|0,this.Gl=Re[13]|0,this.Hh=Re[14]|0,this.Hl=Re[15]|0}get(){const{Ah:t,Al:n,Bh:r,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:f,El:u,Fh:d,Fl:h,Gh:l,Gl:g,Hh:w,Hl:v}=this;return[t,n,r,i,s,o,a,c,f,u,d,h,l,g,w,v]}set(t,n,r,i,s,o,a,c,f,u,d,h,l,g,w,v){this.Ah=t|0,this.Al=n|0,this.Bh=r|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=f|0,this.El=u|0,this.Fh=d|0,this.Fl=h|0,this.Gh=l|0,this.Gl=g|0,this.Hh=w|0,this.Hl=v|0}process(t,n){for(let x=0;x<16;x++,n+=4)gn[x]=t.getUint32(n),pn[x]=t.getUint32(n+=4);for(let x=16;x<80;x++){const _=gn[x-15]|0,R=pn[x-15]|0,L=mr(_,R,1)^mr(_,R,8)^Vl(_,R,7),j=Er(_,R,1)^Er(_,R,8)^Kl(_,R,7),U=gn[x-2]|0,D=pn[x-2]|0,q=mr(U,D,19)^ls(U,D,61)^Vl(U,D,6),M=Er(U,D,19)^hs(U,D,61)^Kl(U,D,6),E=SE(j,M,pn[x-7],pn[x-16]),b=IE(E,L,q,gn[x-7],gn[x-16]);gn[x]=b|0,pn[x]=E|0}let{Ah:r,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:f,Dl:u,Eh:d,El:h,Fh:l,Fl:g,Gh:w,Gl:v,Hh:A,Hl:C}=this;for(let x=0;x<80;x++){const _=mr(d,h,14)^mr(d,h,18)^ls(d,h,41),R=Er(d,h,14)^Er(d,h,18)^hs(d,h,41),L=d&l^~d&w,j=h&g^~h&v,U=OE(C,R,j,ME[x],pn[x]),D=BE(U,A,_,L,kE[x],gn[x]),q=U|0,M=mr(r,i,28)^ls(r,i,34)^ls(r,i,39),E=Er(r,i,28)^hs(r,i,34)^hs(r,i,39),b=r&s^r&a^s&a,m=i&o^i&c^o&c;A=w|0,C=v|0,w=l|0,v=g|0,l=d|0,g=h|0,{h:d,l:h}=Kt(f|0,u|0,D|0,q|0),f=a|0,u=c|0,a=s|0,c=o|0,s=r|0,o=i|0;const p=_E(q,E,m);r=xE(p,D,M,b),i=p|0}({h:r,l:i}=Kt(this.Ah|0,this.Al|0,r|0,i|0)),{h:s,l:o}=Kt(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=Kt(this.Ch|0,this.Cl|0,a|0,c|0),{h:f,l:u}=Kt(this.Dh|0,this.Dl|0,f|0,u|0),{h:d,l:h}=Kt(this.Eh|0,this.El|0,d|0,h|0),{h:l,l:g}=Kt(this.Fh|0,this.Fl|0,l|0,g|0),{h:w,l:v}=Kt(this.Gh|0,this.Gl|0,w|0,v|0),{h:A,l:C}=Kt(this.Hh|0,this.Hl|0,A|0,C|0),this.set(r,i,s,o,a,c,f,u,d,h,l,g,w,v,A,C)}roundClean(){hn(gn,pn)}destroy(){hn(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class zE extends eh{constructor(){super(48),this.Ah=Te[0]|0,this.Al=Te[1]|0,this.Bh=Te[2]|0,this.Bl=Te[3]|0,this.Ch=Te[4]|0,this.Cl=Te[5]|0,this.Dh=Te[6]|0,this.Dl=Te[7]|0,this.Eh=Te[8]|0,this.El=Te[9]|0,this.Fh=Te[10]|0,this.Fl=Te[11]|0,this.Gh=Te[12]|0,this.Gl=Te[13]|0,this.Hh=Te[14]|0,this.Hl=Te[15]|0}}const vr=cs(()=>new jE),qE=cs(()=>new eh),HE=cs(()=>new zE);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const sa=BigInt(0),ds=BigInt(1);function ri(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function bn(e){if(!ri(e))throw new Error("Uint8Array expected")}function ii(e,t){if(typeof t!="boolean")throw new Error(e+" boolean expected, got "+t)}function gs(e){const t=e.toString(16);return t.length&1?"0"+t:t}function th(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return e===""?sa:BigInt("0x"+e)}const nh=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",VE=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Hn(e){if(bn(e),nh)return e.toHex();let t="";for(let n=0;n<e.length;n++)t+=VE[e[n]];return t}const Gt={_0:48,_9:57,A:65,F:70,a:97,f:102};function rh(e){if(e>=Gt._0&&e<=Gt._9)return e-Gt._0;if(e>=Gt.A&&e<=Gt.F)return e-(Gt.A-10);if(e>=Gt.a&&e<=Gt.f)return e-(Gt.a-10)}function ps(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);if(nh)return Uint8Array.fromHex(e);const t=e.length,n=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const r=new Uint8Array(n);for(let i=0,s=0;i<n;i++,s+=2){const o=rh(e.charCodeAt(s)),a=rh(e.charCodeAt(s+1));if(o===void 0||a===void 0){const c=e[s]+e[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}r[i]=o*16+a}return r}function je(e){return th(Hn(e))}function ih(e){return bn(e),th(Hn(Uint8Array.from(e).reverse()))}function me(e,t){return ps(e.toString(16).padStart(t*2,"0"))}function sh(e,t){return me(e,t).reverse()}function Ne(e,t,n){let r;if(typeof t=="string")try{r=ps(t)}catch(s){throw new Error(e+" must be hex string or Uint8Array, cause: "+s)}else if(ri(t))r=Uint8Array.from(t);else throw new Error(e+" must be hex string or Uint8Array");const i=r.length;if(typeof n=="number"&&i!==n)throw new Error(e+" of length "+n+" expected, got "+i);return r}function pe(...e){let t=0;for(let r=0;r<e.length;r++){const i=e[r];bn(i),t+=i.length}const n=new Uint8Array(t);for(let r=0,i=0;r<e.length;r++){const s=e[r];n.set(s,i),i+=s.length}return n}function oa(e){if(typeof e!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}const aa=e=>typeof e=="bigint"&&sa<=e;function ca(e,t,n){return aa(e)&&aa(t)&&aa(n)&&t<=e&&e<n}function _r(e,t,n,r){if(!ca(t,n,r))throw new Error("expected valid "+e+": "+n+" <= n < "+r+", got "+t)}function si(e){let t;for(t=0;e>sa;e>>=ds,t+=1);return t}function KE(e,t){return e>>BigInt(t)&ds}const Vn=e=>(ds<<BigInt(e))-ds,fa=e=>new Uint8Array(e),oh=e=>Uint8Array.from(e);function GE(e,t,n){if(typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=fa(e),i=fa(e),s=0;const o=()=>{r.fill(1),i.fill(0),s=0},a=(...d)=>n(i,r,...d),c=(d=fa(0))=>{i=a(oh([0]),d),r=a(),d.length!==0&&(i=a(oh([1]),d),r=a())},f=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let d=0;const h=[];for(;d<t;){r=a();const l=r.slice();h.push(l),d+=r.length}return pe(...h)};return(d,h)=>{o(),c(d);let l;for(;!(l=h(f()));)c();return o(),l}}const ZE={bigint:e=>typeof e=="bigint",function:e=>typeof e=="function",boolean:e=>typeof e=="boolean",string:e=>typeof e=="string",stringOrUint8Array:e=>typeof e=="string"||ri(e),isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>typeof e=="function"&&Number.isSafeInteger(e.outputLen)};function oi(e,t,n={}){const r=(i,s,o)=>{const a=ZE[s];if(typeof a!="function")throw new Error("invalid validator function");const c=e[i];if(!(o&&c===void 0)&&!a(c,e))throw new Error("param "+String(i)+" is invalid. Expected "+s+", got "+c)};for(const[i,s]of Object.entries(t))r(i,s,!1);for(const[i,s]of Object.entries(n))r(i,s,!0);return e}const ah=()=>{throw new Error("not implemented")};function ua(e){const t=new WeakMap;return(n,...r)=>{const i=t.get(n);if(i!==void 0)return i;const s=e(n,...r);return t.set(n,s),s}}function YE(e,t){if(hh(e)>t)throw new lv({givenSize:hh(e),maxSize:t})}const Zt={zero:48,nine:57,A:65,F:70,a:97,f:102};function ch(e){if(e>=Zt.zero&&e<=Zt.nine)return e-Zt.zero;if(e>=Zt.A&&e<=Zt.F)return e-(Zt.A-10);if(e>=Zt.a&&e<=Zt.f)return e-(Zt.a-10)}function WE(e,t={}){const{dir:n,size:r=32}=t;if(r===0)return e;if(e.length>r)throw new hv({size:e.length,targetSize:r,type:"Bytes"});const i=new Uint8Array(r);for(let s=0;s<r;s++){const o=n==="right";i[o?s:r-s-1]=e[o?s:e.length-s-1]}return i}function la(e,t){if(da(e)>t)throw new rv({givenSize:da(e),maxSize:t})}function fh(e,t={}){const{dir:n,size:r=32}=t;if(r===0)return e;const i=e.replace("0x","");if(i.length>r*2)throw new iv({size:Math.ceil(i.length/2),targetSize:r,type:"Hex"});return`0x${i[n==="right"?"padEnd":"padStart"](r*2,"0")}`}const XE=new TextEncoder,JE=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function uh(...e){return`0x${e.reduce((t,n)=>t+n.replace("0x",""),"")}`}function QE(e,t={}){const n=`0x${Number(e)}`;return typeof t.size=="number"?(la(n,t.size),bs(n,t.size)):n}function lh(e,t={}){let n="";for(let i=0;i<e.length;i++)n+=JE[e[i]];const r=`0x${n}`;return typeof t.size=="number"?(la(r,t.size),ha(r,t.size)):r}function ev(e,t={}){const{signed:n,size:r}=t,i=BigInt(e);let s;r?n?s=(1n<<BigInt(r)*8n-1n)-1n:s=2n**(BigInt(r)*8n)-1n:typeof e=="number"&&(s=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof s=="bigint"&&n?-s-1n:0;if(s&&i>s||i<o){const f=typeof e=="bigint"?"n":"";throw new nv({max:s?`${s}${f}`:void 0,min:`${o}${f}`,signed:n,size:r,value:`${e}${f}`})}const c=`0x${(n&&i<0?(1n<<BigInt(r*8))+BigInt(i):i).toString(16)}`;return r?bs(c,r):c}function tv(e,t={}){return lh(XE.encode(e),t)}function bs(e,t){return fh(e,{dir:"left",size:t})}function ha(e,t){return fh(e,{dir:"right",size:t})}function da(e){return Math.ceil((e.length-2)/2)}class nv extends Fe{constructor({max:t,min:n,signed:r,size:i,value:s}){super(`Number \`${s}\` is not in safe${i?` ${i*8}-bit`:""}${r?" signed":" unsigned"} integer range ${t?`(\`${n}\` to \`${t}\`)`:`(above \`${n}\`)`}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.IntegerOutOfRangeError"})}}class rv extends Fe{constructor({givenSize:t,maxSize:n}){super(`Size cannot exceed \`${n}\` bytes. Given size: \`${t}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeOverflowError"})}}class iv extends Fe{constructor({size:t,targetSize:n,type:r}){super(`${r.charAt(0).toUpperCase()}${r.slice(1).toLowerCase()} size (\`${t}\`) exceeds padding size (\`${n}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeExceedsPaddingSizeError"})}}const sv=new TextEncoder;function ov(e){return e instanceof Uint8Array?e:typeof e=="string"?cv(e):av(e)}function av(e){return e instanceof Uint8Array?e:new Uint8Array(e)}function cv(e,t={}){const{size:n}=t;let r=e;n&&(la(e,n),r=ha(e,n));let i=r.slice(2);i.length%2&&(i=`0${i}`);const s=i.length/2,o=new Uint8Array(s);for(let a=0,c=0;a<s;a++){const f=ch(i.charCodeAt(c++)),u=ch(i.charCodeAt(c++));if(f===void 0||u===void 0)throw new Fe(`Invalid byte sequence ("${i[c-2]}${i[c-1]}" in "${i}").`);o[a]=f*16+u}return o}function fv(e,t={}){const{size:n}=t,r=sv.encode(e);return typeof n=="number"?(YE(r,n),uv(r,n)):r}function uv(e,t){return WE(e,{dir:"right",size:t})}function hh(e){return e.length}class lv extends Fe{constructor({givenSize:t,maxSize:n}){super(`Size cannot exceed \`${n}\` bytes. Given size: \`${t}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeOverflowError"})}}class hv extends Fe{constructor({size:t,targetSize:n,type:r}){super(`${r.charAt(0).toUpperCase()}${r.slice(1).toLowerCase()} size (\`${t}\`) exceeds padding size (\`${n}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeExceedsPaddingSizeError"})}}function dv(e,t={}){const{as:n=typeof e=="string"?"Hex":"Bytes"}=t,r=UE(ov(e));return n==="Bytes"?r:lh(r)}class gv extends Map{constructor(t){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=t}get(t){const n=super.get(t);return super.has(t)&&n!==void 0&&(this.delete(t),super.set(t,n)),n}set(t,n){if(super.set(t,n),this.maxSize&&this.size>this.maxSize){const r=this.keys().next().value;r&&this.delete(r)}return this}}const ga={checksum:new gv(8192)}.checksum,pv=/^0x[a-fA-F0-9]{40}$/;function dh(e,t={}){const{strict:n=!0}=t;if(!pv.test(e))throw new gh({address:e,cause:new yv});if(n){if(e.toLowerCase()===e)return;if(bv(e)!==e)throw new gh({address:e,cause:new wv})}}function bv(e){if(ga.has(e))return ga.get(e);dh(e,{strict:!1});const t=e.substring(2).toLowerCase(),n=dv(fv(t),{as:"Bytes"}),r=t.split("");for(let s=0;s<40;s+=2)n[s>>1]>>4>=8&&r[s]&&(r[s]=r[s].toUpperCase()),(n[s>>1]&15)>=8&&r[s+1]&&(r[s+1]=r[s+1].toUpperCase());const i=`0x${r.join("")}`;return ga.set(e,i),i}class gh extends Fe{constructor({address:t,cause:n}){super(`Address "${t}" is invalid.`,{cause:n}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidAddressError"})}}class yv extends Fe{constructor(){super("Address is not a 20 byte (40 hexadecimal character) value."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidInputError"})}}class wv extends Fe{constructor(){super("Address does not match its checksum counterpart."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidChecksumError"})}}const mv=/^(.*)\[([0-9]*)\]$/,Ev=/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/,vv=/^(u?int)(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/;function pa(e,t){if(e.length!==t.length)throw new xv({expectedLength:e.length,givenLength:t.length});const n=[];for(let r=0;r<e.length;r++){const i=e[r],s=t[r];n.push(pa.encode(i,s))}return uh(...n)}(function(e){function t(n,r,i=!1){if(n==="address"){const c=r;return dh(c),bs(c.toLowerCase(),i?32:0)}if(n==="string")return tv(r);if(n==="bytes")return r;if(n==="bool")return bs(QE(r),i?32:1);const s=n.match(vv);if(s){const[c,f,u="256"]=s,d=Number.parseInt(u,10)/8;return ev(r,{size:i?32:d,signed:f==="int"})}const o=n.match(Ev);if(o){const[c,f]=o;if(Number.parseInt(f,10)!==(r.length-2)/2)throw new _v({expectedSize:Number.parseInt(f,10),value:r});return ha(r,i?32:0)}const a=n.match(mv);if(a&&Array.isArray(r)){const[c,f]=a,u=[];for(let d=0;d<r.length;d++)u.push(t(f,r[d],!0));return u.length===0?"0x":uh(...u)}throw new Sv(n)}e.encode=t})(pa||(pa={}));class _v extends Fe{constructor({expectedSize:t,value:n}){super(`Size of bytes "${n}" (bytes${da(n)}) does not match expected size (bytes${t}).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.BytesSizeMismatchError"})}}class xv extends Fe{constructor({expectedLength:t,givenLength:n}){super(["ABI encoding parameters/values length mismatch.",`Expected length (parameters): ${t}`,`Given length (values): ${n}`].join(`
`)),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.LengthMismatchError"})}}class Sv extends Fe{constructor(t){super(`Type \`${t}\` is not a valid ABI Type.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.InvalidTypeError"})}}class ph extends ra{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,Ul(t);const r=as(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?t.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=t.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),hn(s)}update(t){return yr(this),this.iHash.update(t),this}digestInto(t){yr(this),zt(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return t=t,t.finished=i,t.destroyed=s,t.blockLen=o,t.outputLen=a,t.oHash=n._cloneInto(t.oHash),t.iHash=r._cloneInto(t.iHash),t}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const ba=(e,t,n)=>new ph(e,t).update(n).digest();ba.create=(e,t)=>new ph(e,t);const We=BigInt(0),ke=BigInt(1),Kn=BigInt(2),Iv=BigInt(3),bh=BigInt(4),yh=BigInt(5),wh=BigInt(8);function Me(e,t){const n=e%t;return n>=We?n:t+n}function gt(e,t,n){let r=e;for(;t-- >We;)r*=r,r%=n;return r}function ya(e,t){if(e===We)throw new Error("invert: expected non-zero number");if(t<=We)throw new Error("invert: expected positive modulus, got "+t);let n=Me(e,t),r=t,i=We,s=ke;for(;n!==We;){const a=r/n,c=r%n,f=i-s*a;r=n,n=c,i=s,s=f}if(r!==ke)throw new Error("invert: does not exist");return Me(i,t)}function mh(e,t){const n=(e.ORDER+ke)/bh,r=e.pow(t,n);if(!e.eql(e.sqr(r),t))throw new Error("Cannot find square root");return r}function Ov(e,t){const n=(e.ORDER-yh)/wh,r=e.mul(t,Kn),i=e.pow(r,n),s=e.mul(t,i),o=e.mul(e.mul(s,Kn),i),a=e.mul(s,e.sub(o,e.ONE));if(!e.eql(e.sqr(a),t))throw new Error("Cannot find square root");return a}function Bv(e){if(e<BigInt(3))throw new Error("sqrt is not defined for small field");let t=e-ke,n=0;for(;t%Kn===We;)t/=Kn,n++;let r=Kn;const i=yn(e);for(;ws(i,r)===1;)if(r++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(n===1)return mh;let s=i.pow(r,t);const o=(t+ke)/Kn;return function(c,f){if(c.is0(f))return f;if(ws(c,f)!==1)throw new Error("Cannot find square root");let u=n,d=c.mul(c.ONE,s),h=c.pow(f,t),l=c.pow(f,o);for(;!c.eql(h,c.ONE);){if(c.is0(h))return c.ZERO;let g=1,w=c.sqr(h);for(;!c.eql(w,c.ONE);)if(g++,w=c.sqr(w),g===u)throw new Error("Cannot find square root");const v=ke<<BigInt(u-g-1),A=c.pow(d,v);u=g,d=c.sqr(A),h=c.mul(h,d),l=c.mul(l,A)}return l}}function Av(e){return e%bh===Iv?mh:e%wh===yh?Ov:Bv(e)}const Dv=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Eh(e){const t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=Dv.reduce((r,i)=>(r[i]="function",r),t);return oi(e,n)}function ys(e,t,n){if(n<We)throw new Error("invalid exponent, negatives unsupported");if(n===We)return e.ONE;if(n===ke)return t;let r=e.ONE,i=t;for(;n>We;)n&ke&&(r=e.mul(r,i)),i=e.sqr(i),n>>=ke;return r}function Gn(e,t,n=!1){const r=new Array(t.length).fill(n?e.ZERO:void 0),i=t.reduce((o,a,c)=>e.is0(a)?o:(r[c]=o,e.mul(o,a)),e.ONE),s=e.inv(i);return t.reduceRight((o,a,c)=>e.is0(a)?o:(r[c]=e.mul(o,r[c]),e.mul(o,a)),s),r}function ws(e,t){const n=(e.ORDER-ke)/Kn,r=e.pow(t,n),i=e.eql(r,e.ONE),s=e.eql(r,e.ZERO),o=e.eql(r,e.neg(e.ONE));if(!i&&!s&&!o)throw new Error("invalid Legendre symbol result");return i?1:s?0:-1}function vh(e,t){t!==void 0&&br(t);const n=t!==void 0?t:e.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function yn(e,t,n=!1,r={}){if(e<=We)throw new Error("invalid field: expected ORDER > 0, got "+e);const{nBitLength:i,nByteLength:s}=vh(e,t);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:e,isLE:n,BITS:i,BYTES:s,MASK:Vn(i),ZERO:We,ONE:ke,create:c=>Me(c,e),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return We<=c&&c<e},is0:c=>c===We,isOdd:c=>(c&ke)===ke,neg:c=>Me(-c,e),eql:(c,f)=>c===f,sqr:c=>Me(c*c,e),add:(c,f)=>Me(c+f,e),sub:(c,f)=>Me(c-f,e),mul:(c,f)=>Me(c*f,e),pow:(c,f)=>ys(a,c,f),div:(c,f)=>Me(c*ya(f,e),e),sqrN:c=>c*c,addN:(c,f)=>c+f,subN:(c,f)=>c-f,mulN:(c,f)=>c*f,inv:c=>ya(c,e),sqrt:r.sqrt||(c=>(o||(o=Av(e)),o(a,c))),toBytes:c=>n?sh(c,s):me(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return n?ih(c):je(c)},invertBatch:c=>Gn(a,c),cmov:(c,f,u)=>u?f:c});return Object.freeze(a)}function _h(e){if(typeof e!="bigint")throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function wa(e){const t=_h(e);return t+Math.ceil(t/2)}function xh(e,t,n=!1){const r=e.length,i=_h(t),s=wa(t);if(r<16||r<s||r>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+r);const o=n?ih(e):je(e),a=Me(o,t-ke)+ke;return n?sh(a,i):me(a,i)}const Sh=BigInt(0),ma=BigInt(1);function Ea(e,t){const n=t.negate();return e?n:t}function Ih(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function va(e,t){Ih(e,t);const n=Math.ceil(t/e)+1,r=2**(e-1),i=2**e,s=Vn(e),o=BigInt(e);return{windows:n,windowSize:r,mask:s,maxNumber:i,shiftBy:o}}function Oh(e,t,n){const{windowSize:r,mask:i,maxNumber:s,shiftBy:o}=n;let a=Number(e&i),c=e>>o;a>r&&(a-=s,c+=ma);const f=t*r,u=f+Math.abs(a)-1,d=a===0,h=a<0,l=t%2!==0;return{nextN:c,offset:u,isZero:d,isNeg:h,isNegF:l,offsetF:f}}function Tv(e,t){if(!Array.isArray(e))throw new Error("array expected");e.forEach((n,r)=>{if(!(n instanceof t))throw new Error("invalid point at index "+r)})}function Rv(e,t){if(!Array.isArray(e))throw new Error("array of scalars expected");e.forEach((n,r)=>{if(!t.isValid(n))throw new Error("invalid scalar at index "+r)})}const _a=new WeakMap,Bh=new WeakMap;function xa(e){return Bh.get(e)||1}function Nv(e,t){return{constTimeNegate:Ea,hasPrecomputes(n){return xa(n)!==1},unsafeLadder(n,r,i=e.ZERO){let s=n;for(;r>Sh;)r&ma&&(i=i.add(s)),s=s.double(),r>>=ma;return i},precomputeWindow(n,r){const{windows:i,windowSize:s}=va(r,t),o=[];let a=n,c=a;for(let f=0;f<i;f++){c=a,o.push(c);for(let u=1;u<s;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(n,r,i){let s=e.ZERO,o=e.BASE;const a=va(n,t);for(let c=0;c<a.windows;c++){const{nextN:f,offset:u,isZero:d,isNeg:h,isNegF:l,offsetF:g}=Oh(i,c,a);i=f,d?o=o.add(Ea(l,r[g])):s=s.add(Ea(h,r[u]))}return{p:s,f:o}},wNAFUnsafe(n,r,i,s=e.ZERO){const o=va(n,t);for(let a=0;a<o.windows&&i!==Sh;a++){const{nextN:c,offset:f,isZero:u,isNeg:d}=Oh(i,a,o);if(i=c,!u){const h=r[f];s=s.add(d?h.negate():h)}}return s},getPrecomputes(n,r,i){let s=_a.get(r);return s||(s=this.precomputeWindow(r,n),n!==1&&_a.set(r,i(s))),s},wNAFCached(n,r,i){const s=xa(n);return this.wNAF(s,this.getPrecomputes(s,n,i),r)},wNAFCachedUnsafe(n,r,i,s){const o=xa(n);return o===1?this.unsafeLadder(n,r,s):this.wNAFUnsafe(o,this.getPrecomputes(o,n,i),r,s)},setWindowSize(n,r){Ih(r,t),Bh.set(n,r),_a.delete(n)}}}function Cv(e,t,n,r){Tv(n,e),Rv(r,t);const i=n.length,s=r.length;if(i!==s)throw new Error("arrays of points and scalars must have equal length");const o=e.ZERO,a=si(BigInt(i));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const f=Vn(c),u=new Array(Number(f)+1).fill(o),d=Math.floor((t.BITS-1)/c)*c;let h=o;for(let l=d;l>=0;l-=c){u.fill(o);for(let w=0;w<s;w++){const v=r[w],A=Number(v>>BigInt(l)&f);u[A]=u[A].add(n[w])}let g=o;for(let w=u.length-1,v=o;w>0;w--)v=v.add(u[w]),g=g.add(v);if(h=h.add(g),l!==0)for(let w=0;w<c;w++)h=h.double()}return h}function Ah(e){return Eh(e.Fp),oi(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...vh(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}function Dh(e){e.lowS!==void 0&&ii("lowS",e.lowS),e.prehash!==void 0&&ii("prehash",e.prehash)}function Pv(e){const t=Ah(e);oi(t,{a:"field",b:"field"},{allowInfinityPoint:"boolean",allowedPrivateKeyLengths:"array",clearCofactor:"function",fromBytes:"function",isTorsionFree:"function",toBytes:"function",wrapPrivateKey:"boolean"});const{endo:n,Fp:r,a:i}=t;if(n){if(!r.eql(i,r.ZERO))throw new Error("invalid endo: CURVE.a must be 0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function')}return Object.freeze({...t})}class $v extends Error{constructor(t=""){super(t)}}const Yt={Err:$v,_tlv:{encode:(e,t)=>{const{Err:n}=Yt;if(e<0||e>256)throw new n("tlv.encode: wrong tag");if(t.length&1)throw new n("tlv.encode: unpadded data");const r=t.length/2,i=gs(r);if(i.length/2&128)throw new n("tlv.encode: long form length too big");const s=r>127?gs(i.length/2|128):"";return gs(e)+s+i+t},decode(e,t){const{Err:n}=Yt;let r=0;if(e<0||e>256)throw new n("tlv.encode: wrong tag");if(t.length<2||t[r++]!==e)throw new n("tlv.decode: wrong tlv");const i=t[r++],s=!!(i&128);let o=0;if(!s)o=i;else{const c=i&127;if(!c)throw new n("tlv.decode(long): indefinite length not supported");if(c>4)throw new n("tlv.decode(long): byte length is too big");const f=t.subarray(r,r+c);if(f.length!==c)throw new n("tlv.decode: length bytes not complete");if(f[0]===0)throw new n("tlv.decode(long): zero leftmost byte");for(const u of f)o=o<<8|u;if(r+=c,o<128)throw new n("tlv.decode(long): not minimal encoding")}const a=t.subarray(r,r+o);if(a.length!==o)throw new n("tlv.decode: wrong value length");return{v:a,l:t.subarray(r+o)}}},_int:{encode(e){const{Err:t}=Yt;if(e<_t)throw new t("integer: negative integers are not allowed");let n=gs(e);if(Number.parseInt(n[0],16)&8&&(n="00"+n),n.length&1)throw new t("unexpected DER parsing assertion: unpadded hex");return n},decode(e){const{Err:t}=Yt;if(e[0]&128)throw new t("invalid signature integer: negative");if(e[0]===0&&!(e[1]&128))throw new t("invalid signature integer: unnecessary leading zero");return je(e)}},toSig(e){const{Err:t,_int:n,_tlv:r}=Yt,i=Ne("signature",e),{v:s,l:o}=r.decode(48,i);if(o.length)throw new t("invalid signature: left bytes after parsing");const{v:a,l:c}=r.decode(2,s),{v:f,l:u}=r.decode(2,c);if(u.length)throw new t("invalid signature: left bytes after parsing");return{r:n.decode(a),s:n.decode(f)}},hexFromSig(e){const{_tlv:t,_int:n}=Yt,r=t.encode(2,n.encode(e.r)),i=t.encode(2,n.encode(e.s)),s=r+i;return t.encode(48,s)}};function Sa(e,t){return Hn(me(e,t))}const _t=BigInt(0),ce=BigInt(1),wn=BigInt(2),ai=BigInt(3),Ia=BigInt(4);function Oa(e){const t=Pv(e),{Fp:n}=t,r=yn(t.n,t.nBitLength),i=t.toBytes||((x,_,R)=>{const L=_.toAffine();return pe(Uint8Array.from([4]),n.toBytes(L.x),n.toBytes(L.y))}),s=t.fromBytes||(x=>{const _=x.subarray(1),R=n.fromBytes(_.subarray(0,n.BYTES)),L=n.fromBytes(_.subarray(n.BYTES,2*n.BYTES));return{x:R,y:L}});function o(x){const{a:_,b:R}=t,L=n.sqr(x),j=n.mul(L,x);return n.add(n.add(j,n.mul(x,_)),R)}function a(x,_){const R=n.sqr(_),L=o(x);return n.eql(R,L)}if(!a(t.Gx,t.Gy))throw new Error("bad curve params: generator point");const c=n.mul(n.pow(t.a,ai),Ia),f=n.mul(n.sqr(t.b),BigInt(27));if(n.is0(n.add(c,f)))throw new Error("bad curve params: a or b");function u(x){return ca(x,ce,t.n)}function d(x){const{allowedPrivateKeyLengths:_,nByteLength:R,wrapPrivateKey:L,n:j}=t;if(_&&typeof x!="bigint"){if(ri(x)&&(x=Hn(x)),typeof x!="string"||!_.includes(x.length))throw new Error("invalid private key");x=x.padStart(R*2,"0")}let U;try{U=typeof x=="bigint"?x:je(Ne("private key",x,R))}catch{throw new Error("invalid private key, expected hex or "+R+" bytes, got "+typeof x)}return L&&(U=Me(U,j)),_r("private key",U,ce,j),U}function h(x){if(!(x instanceof w))throw new Error("ProjectivePoint expected")}const l=ua((x,_)=>{const{px:R,py:L,pz:j}=x;if(n.eql(j,n.ONE))return{x:R,y:L};const U=x.is0();_==null&&(_=U?n.ONE:n.inv(j));const D=n.mul(R,_),q=n.mul(L,_),M=n.mul(j,_);if(U)return{x:n.ZERO,y:n.ZERO};if(!n.eql(M,n.ONE))throw new Error("invZ was invalid");return{x:D,y:q}}),g=ua(x=>{if(x.is0()){if(t.allowInfinityPoint&&!n.is0(x.py))return;throw new Error("bad point: ZERO")}const{x:_,y:R}=x.toAffine();if(!n.isValid(_)||!n.isValid(R))throw new Error("bad point: x or y not FE");if(!a(_,R))throw new Error("bad point: equation left != right");if(!x.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class w{constructor(_,R,L){if(_==null||!n.isValid(_))throw new Error("x required");if(R==null||!n.isValid(R)||n.is0(R))throw new Error("y required");if(L==null||!n.isValid(L))throw new Error("z required");this.px=_,this.py=R,this.pz=L,Object.freeze(this)}static fromAffine(_){const{x:R,y:L}=_||{};if(!_||!n.isValid(R)||!n.isValid(L))throw new Error("invalid affine point");if(_ instanceof w)throw new Error("projective point not allowed");const j=U=>n.eql(U,n.ZERO);return j(R)&&j(L)?w.ZERO:new w(R,L,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(_){const R=Gn(n,_.map(L=>L.pz));return _.map((L,j)=>L.toAffine(R[j])).map(w.fromAffine)}static fromHex(_){const R=w.fromAffine(s(Ne("pointHex",_)));return R.assertValidity(),R}static fromPrivateKey(_){return w.BASE.multiply(d(_))}static msm(_,R){return Cv(w,r,_,R)}_setWindowSize(_){C.setWindowSize(this,_)}assertValidity(){g(this)}hasEvenY(){const{y:_}=this.toAffine();if(n.isOdd)return!n.isOdd(_);throw new Error("Field doesn't support isOdd")}equals(_){h(_);const{px:R,py:L,pz:j}=this,{px:U,py:D,pz:q}=_,M=n.eql(n.mul(R,q),n.mul(U,j)),E=n.eql(n.mul(L,q),n.mul(D,j));return M&&E}negate(){return new w(this.px,n.neg(this.py),this.pz)}double(){const{a:_,b:R}=t,L=n.mul(R,ai),{px:j,py:U,pz:D}=this;let q=n.ZERO,M=n.ZERO,E=n.ZERO,b=n.mul(j,j),m=n.mul(U,U),p=n.mul(D,D),y=n.mul(j,U);return y=n.add(y,y),E=n.mul(j,D),E=n.add(E,E),q=n.mul(_,E),M=n.mul(L,p),M=n.add(q,M),q=n.sub(m,M),M=n.add(m,M),M=n.mul(q,M),q=n.mul(y,q),E=n.mul(L,E),p=n.mul(_,p),y=n.sub(b,p),y=n.mul(_,y),y=n.add(y,E),E=n.add(b,b),b=n.add(E,b),b=n.add(b,p),b=n.mul(b,y),M=n.add(M,b),p=n.mul(U,D),p=n.add(p,p),b=n.mul(p,y),q=n.sub(q,b),E=n.mul(p,m),E=n.add(E,E),E=n.add(E,E),new w(q,M,E)}add(_){h(_);const{px:R,py:L,pz:j}=this,{px:U,py:D,pz:q}=_;let M=n.ZERO,E=n.ZERO,b=n.ZERO;const m=t.a,p=n.mul(t.b,ai);let y=n.mul(R,U),S=n.mul(L,D),I=n.mul(j,q),O=n.add(R,L),B=n.add(U,D);O=n.mul(O,B),B=n.add(y,S),O=n.sub(O,B),B=n.add(R,j);let T=n.add(U,q);return B=n.mul(B,T),T=n.add(y,I),B=n.sub(B,T),T=n.add(L,j),M=n.add(D,q),T=n.mul(T,M),M=n.add(S,I),T=n.sub(T,M),b=n.mul(m,B),M=n.mul(p,I),b=n.add(M,b),M=n.sub(S,b),b=n.add(S,b),E=n.mul(M,b),S=n.add(y,y),S=n.add(S,y),I=n.mul(m,I),B=n.mul(p,B),S=n.add(S,I),I=n.sub(y,I),I=n.mul(m,I),B=n.add(B,I),y=n.mul(S,B),E=n.add(E,y),y=n.mul(T,B),M=n.mul(O,M),M=n.sub(M,y),y=n.mul(O,S),b=n.mul(T,b),b=n.add(b,y),new w(M,E,b)}subtract(_){return this.add(_.negate())}is0(){return this.equals(w.ZERO)}wNAF(_){return C.wNAFCached(this,_,w.normalizeZ)}multiplyUnsafe(_){const{endo:R,n:L}=t;_r("scalar",_,_t,L);const j=w.ZERO;if(_===_t)return j;if(this.is0()||_===ce)return this;if(!R||C.hasPrecomputes(this))return C.wNAFCachedUnsafe(this,_,w.normalizeZ);let{k1neg:U,k1:D,k2neg:q,k2:M}=R.splitScalar(_),E=j,b=j,m=this;for(;D>_t||M>_t;)D&ce&&(E=E.add(m)),M&ce&&(b=b.add(m)),m=m.double(),D>>=ce,M>>=ce;return U&&(E=E.negate()),q&&(b=b.negate()),b=new w(n.mul(b.px,R.beta),b.py,b.pz),E.add(b)}multiply(_){const{endo:R,n:L}=t;_r("scalar",_,ce,L);let j,U;if(R){const{k1neg:D,k1:q,k2neg:M,k2:E}=R.splitScalar(_);let{p:b,f:m}=this.wNAF(q),{p,f:y}=this.wNAF(E);b=C.constTimeNegate(D,b),p=C.constTimeNegate(M,p),p=new w(n.mul(p.px,R.beta),p.py,p.pz),j=b.add(p),U=m.add(y)}else{const{p:D,f:q}=this.wNAF(_);j=D,U=q}return w.normalizeZ([j,U])[0]}multiplyAndAddUnsafe(_,R,L){const j=w.BASE,U=(q,M)=>M===_t||M===ce||!q.equals(j)?q.multiplyUnsafe(M):q.multiply(M),D=U(this,R).add(U(_,L));return D.is0()?void 0:D}toAffine(_){return l(this,_)}isTorsionFree(){const{h:_,isTorsionFree:R}=t;if(_===ce)return!0;if(R)return R(w,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:_,clearCofactor:R}=t;return _===ce?this:R?R(w,this):this.multiplyUnsafe(t.h)}toRawBytes(_=!0){return ii("isCompressed",_),this.assertValidity(),i(w,this,_)}toHex(_=!0){return ii("isCompressed",_),Hn(this.toRawBytes(_))}}w.BASE=new w(t.Gx,t.Gy,n.ONE),w.ZERO=new w(n.ZERO,n.ONE,n.ZERO);const{endo:v,nBitLength:A}=t,C=Nv(w,v?Math.ceil(A/2):A);return{CURVE:t,ProjectivePoint:w,normPrivateKeyToScalar:d,weierstrassEquation:o,isWithinCurveOrder:u}}function Lv(e){const t=Ah(e);return oi(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function Uv(e){const t=Lv(e),{Fp:n,n:r,nByteLength:i,nBitLength:s}=t,o=n.BYTES+1,a=2*n.BYTES+1;function c(p){return Me(p,r)}function f(p){return ya(p,r)}const{ProjectivePoint:u,normPrivateKeyToScalar:d,weierstrassEquation:h,isWithinCurveOrder:l}=Oa({...t,toBytes(p,y,S){const I=y.toAffine(),O=n.toBytes(I.x),B=pe;return ii("isCompressed",S),S?B(Uint8Array.from([y.hasEvenY()?2:3]),O):B(Uint8Array.from([4]),O,n.toBytes(I.y))},fromBytes(p){const y=p.length,S=p[0],I=p.subarray(1);if(y===o&&(S===2||S===3)){const O=je(I);if(!ca(O,ce,n.ORDER))throw new Error("Point is not on curve");const B=h(O);let T;try{T=n.sqrt(B)}catch(F){const N=F instanceof Error?": "+F.message:"";throw new Error("Point is not on curve"+N)}const $=(T&ce)===ce;return(S&1)===1!==$&&(T=n.neg(T)),{x:O,y:T}}else if(y===a&&S===4){const O=n.fromBytes(I.subarray(0,n.BYTES)),B=n.fromBytes(I.subarray(n.BYTES,2*n.BYTES));return{x:O,y:B}}else{const O=o,B=a;throw new Error("invalid Point, expected length of "+O+", or uncompressed "+B+", got "+y)}}});function g(p){const y=r>>ce;return p>y}function w(p){return g(p)?c(-p):p}const v=(p,y,S)=>je(p.slice(y,S));class A{constructor(y,S,I){_r("r",y,ce,r),_r("s",S,ce,r),this.r=y,this.s=S,I!=null&&(this.recovery=I),Object.freeze(this)}static fromCompact(y){const S=i;return y=Ne("compactSignature",y,S*2),new A(v(y,0,S),v(y,S,2*S))}static fromDER(y){const{r:S,s:I}=Yt.toSig(Ne("DER",y));return new A(S,I)}assertValidity(){}addRecoveryBit(y){return new A(this.r,this.s,y)}recoverPublicKey(y){const{r:S,s:I,recovery:O}=this,B=j(Ne("msgHash",y));if(O==null||![0,1,2,3].includes(O))throw new Error("recovery id invalid");const T=O===2||O===3?S+t.n:S;if(T>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const $=(O&1)===0?"02":"03",P=u.fromHex($+Sa(T,n.BYTES)),F=f(T),N=c(-B*F),k=c(I*F),z=u.BASE.multiplyAndAddUnsafe(P,N,k);if(!z)throw new Error("point at infinify");return z.assertValidity(),z}hasHighS(){return g(this.s)}normalizeS(){return this.hasHighS()?new A(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return ps(this.toDERHex())}toDERHex(){return Yt.hexFromSig(this)}toCompactRawBytes(){return ps(this.toCompactHex())}toCompactHex(){const y=i;return Sa(this.r,y)+Sa(this.s,y)}}const C={isValidPrivateKey(p){try{return d(p),!0}catch{return!1}},normPrivateKeyToScalar:d,randomPrivateKey:()=>{const p=wa(t.n);return xh(t.randomBytes(p),t.n)},precompute(p=8,y=u.BASE){return y._setWindowSize(p),y.multiply(BigInt(3)),y}};function x(p,y=!0){return u.fromPrivateKey(p).toRawBytes(y)}function _(p){if(typeof p=="bigint")return!1;if(p instanceof u)return!0;const S=Ne("key",p).length,I=n.BYTES,O=I+1,B=2*I+1;if(!(t.allowedPrivateKeyLengths||i===O))return S===O||S===B}function R(p,y,S=!0){if(_(p)===!0)throw new Error("first arg must be private key");if(_(y)===!1)throw new Error("second arg must be public key");return u.fromHex(y).multiply(d(p)).toRawBytes(S)}const L=t.bits2int||function(p){if(p.length>8192)throw new Error("input is too large");const y=je(p),S=p.length*8-s;return S>0?y>>BigInt(S):y},j=t.bits2int_modN||function(p){return c(L(p))},U=Vn(s);function D(p){return _r("num < 2^"+s,p,_t,U),me(p,i)}function q(p,y,S=M){if(["recovered","canonical"].some(H=>H in S))throw new Error("sign() legacy options not supported");const{hash:I,randomBytes:O}=t;let{lowS:B,prehash:T,extraEntropy:$}=S;B==null&&(B=!0),p=Ne("msgHash",p),Dh(S),T&&(p=Ne("prehashed msgHash",I(p)));const P=j(p),F=d(y),N=[D(F),D(P)];if($!=null&&$!==!1){const H=$===!0?O(n.BYTES):$;N.push(Ne("extraEntropy",H))}const k=pe(...N),z=P;function G(H){const K=L(H);if(!l(K))return;const J=f(K),ee=u.BASE.multiply(K).toAffine(),re=c(ee.x);if(re===_t)return;const he=c(J*c(z+re*F));if(he===_t)return;let de=(ee.x===re?0:2)|Number(ee.y&ce),cn=he;return B&&g(he)&&(cn=w(he),de^=1),new A(re,cn,de)}return{seed:k,k2sig:G}}const M={lowS:t.lowS,prehash:!1},E={lowS:t.lowS,prehash:!1};function b(p,y,S=M){const{seed:I,k2sig:O}=q(p,y,S),B=t;return GE(B.hash.outputLen,B.nByteLength,B.hmac)(I,O)}u.BASE._setWindowSize(8);function m(p,y,S,I=E){const O=p;y=Ne("msgHash",y),S=Ne("publicKey",S);const{lowS:B,prehash:T,format:$}=I;if(Dh(I),"strict"in I)throw new Error("options.strict was renamed to lowS");if($!==void 0&&$!=="compact"&&$!=="der")throw new Error("format must be compact or der");const P=typeof O=="string"||ri(O),F=!P&&!$&&typeof O=="object"&&O!==null&&typeof O.r=="bigint"&&typeof O.s=="bigint";if(!P&&!F)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let N,k;try{if(F&&(N=new A(O.r,O.s)),P){try{$!=="compact"&&(N=A.fromDER(O))}catch(de){if(!(de instanceof Yt.Err))throw de}!N&&$!=="der"&&(N=A.fromCompact(O))}k=u.fromHex(S)}catch{return!1}if(!N||B&&N.hasHighS())return!1;T&&(y=t.hash(y));const{r:z,s:G}=N,H=j(y),K=f(G),J=c(H*K),ee=c(z*K),re=u.BASE.multiplyAndAddUnsafe(k,J,ee)?.toAffine();return re?c(re.x)===z:!1}return{CURVE:t,getPublicKey:x,getSharedSecret:R,sign:b,verify:m,ProjectivePoint:u,Signature:A,utils:C}}function Fv(e,t){const n=e.ORDER;let r=_t;for(let g=n-ce;g%wn===_t;g/=wn)r+=ce;const i=r,s=wn<<i-ce-ce,o=s*wn,a=(n-ce)/o,c=(a-ce)/wn,f=o-ce,u=s,d=e.pow(t,a),h=e.pow(t,(a+ce)/wn);let l=(g,w)=>{let v=d,A=e.pow(w,f),C=e.sqr(A);C=e.mul(C,w);let x=e.mul(g,C);x=e.pow(x,c),x=e.mul(x,A),A=e.mul(x,w),C=e.mul(x,g);let _=e.mul(C,A);x=e.pow(_,u);let R=e.eql(x,e.ONE);A=e.mul(C,h),x=e.mul(_,v),C=e.cmov(A,C,R),_=e.cmov(x,_,R);for(let L=i;L>ce;L--){let j=L-wn;j=wn<<j-ce;let U=e.pow(_,j);const D=e.eql(U,e.ONE);A=e.mul(C,v),v=e.mul(v,v),U=e.mul(_,v),C=e.cmov(A,C,D),_=e.cmov(U,_,D)}return{isValid:R,value:C}};if(e.ORDER%Ia===ai){const g=(e.ORDER-ai)/Ia,w=e.sqrt(e.neg(t));l=(v,A)=>{let C=e.sqr(A);const x=e.mul(v,A);C=e.mul(C,x);let _=e.pow(C,g);_=e.mul(_,x);const R=e.mul(_,w),L=e.mul(e.sqr(_),A),j=e.eql(L,v);let U=e.cmov(R,_,j);return{isValid:j,value:U}}}return l}function Th(e,t){if(Eh(e),!e.isValid(t.A)||!e.isValid(t.B)||!e.isValid(t.Z))throw new Error("mapToCurveSimpleSWU: invalid opts");const n=Fv(e,t.Z);if(!e.isOdd)throw new Error("Fp.isOdd is not implemented!");return r=>{let i,s,o,a,c,f,u,d;i=e.sqr(r),i=e.mul(i,t.Z),s=e.sqr(i),s=e.add(s,i),o=e.add(s,e.ONE),o=e.mul(o,t.B),a=e.cmov(t.Z,e.neg(s),!e.eql(s,e.ZERO)),a=e.mul(a,t.A),s=e.sqr(o),f=e.sqr(a),c=e.mul(f,t.A),s=e.add(s,c),s=e.mul(s,o),f=e.mul(f,a),c=e.mul(f,t.B),s=e.add(s,c),u=e.mul(i,o);const{isValid:h,value:l}=n(s,f);d=e.mul(i,r),d=e.mul(d,l),u=e.cmov(u,o,h),d=e.cmov(d,l,h);const g=e.isOdd(r)===e.isOdd(d);d=e.cmov(e.neg(d),d,g);const w=Gn(e,[a],!0)[0];return u=e.mul(u,w),{x:u,y:d}}}function jv(e){return{hash:e,hmac:(t,...n)=>ba(e,t,Ht(...n)),randomBytes:fs}}function ms(e,t){const n=r=>Uv({...e,...jv(r)});return{...n(t),create:n}}const kv=je;function mn(e,t){if(ci(e),ci(t),e<0||e>=1<<8*t)throw new Error("invalid I2OSP input: "+e);const n=Array.from({length:t}).fill(0);for(let r=t-1;r>=0;r--)n[r]=e&255,e>>>=8;return new Uint8Array(n)}function Mv(e,t){const n=new Uint8Array(e.length);for(let r=0;r<e.length;r++)n[r]=e[r]^t[r];return n}function ci(e){if(!Number.isSafeInteger(e))throw new Error("number expected")}function zv(e,t,n,r){bn(e),bn(t),ci(n),t.length>255&&(t=r(pe(oa("H2C-OVERSIZE-DST-"),t)));const{outputLen:i,blockLen:s}=r,o=Math.ceil(n/i);if(n>65535||o>255)throw new Error("expand_message_xmd: invalid lenInBytes");const a=pe(t,mn(t.length,1)),c=mn(0,s),f=mn(n,2),u=new Array(o),d=r(pe(c,e,f,mn(0,1),a));u[0]=r(pe(d,mn(1,1),a));for(let l=1;l<=o;l++){const g=[Mv(d,u[l-1]),mn(l+1,1),a];u[l]=r(pe(...g))}return pe(...u).slice(0,n)}function qv(e,t,n,r,i){if(bn(e),bn(t),ci(n),t.length>255){const s=Math.ceil(2*r/8);t=i.create({dkLen:s}).update(oa("H2C-OVERSIZE-DST-")).update(t).digest()}if(n>65535||t.length>255)throw new Error("expand_message_xof: invalid lenInBytes");return i.create({dkLen:n}).update(e).update(mn(n,2)).update(t).update(mn(t.length,1)).digest()}function Rh(e,t,n){oi(n,{DST:"stringOrUint8Array",p:"bigint",m:"isSafeInteger",k:"isSafeInteger",hash:"hash"});const{p:r,k:i,m:s,hash:o,expand:a,DST:c}=n;bn(e),ci(t);const f=typeof c=="string"?oa(c):c,u=r.toString(2).length,d=Math.ceil((u+i)/8),h=t*s*d;let l;if(a==="xmd")l=zv(e,f,h,o);else if(a==="xof")l=qv(e,f,h,i,o);else if(a==="_internal_pass")l=e;else throw new Error('expand must be "xmd" or "xof"');const g=new Array(t);for(let w=0;w<t;w++){const v=new Array(s);for(let A=0;A<s;A++){const C=d*(A+w*s),x=l.subarray(C,C+d);v[A]=Me(kv(x),r)}g[w]=v}return g}function Nh(e,t){const n=t.map(r=>Array.from(r).reverse());return(r,i)=>{const[s,o,a,c]=n.map(d=>d.reduce((h,l)=>e.add(e.mul(h,r),l))),[f,u]=Gn(e,[o,c],!0);return r=e.mul(s,f),i=e.mul(i,e.mul(a,u)),{x:r,y:i}}}function Ch(e,t,n){if(typeof t!="function")throw new Error("mapToCurve() must be defined");function r(s){return e.fromAffine(t(s))}function i(s){const o=s.clearCofactor();return o.equals(e.ZERO)?e.ZERO:(o.assertValidity(),o)}return{defaults:n,hashToCurve(s,o){const a=Rh(s,2,{...n,DST:n.DST,...o}),c=r(a[0]),f=r(a[1]);return i(c.add(f))},encodeToCurve(s,o){const a=Rh(s,1,{...n,DST:n.encodeDST,...o});return i(r(a[0]))},mapToCurve(s){if(!Array.isArray(s))throw new Error("expected array of bigints");for(const o of s)if(typeof o!="bigint")throw new Error("expected array of bigints");return i(r(s))}}}const Ph=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),$h=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Hv=BigInt(0),Vv=BigInt(1),Ba=BigInt(2),Lh=(e,t)=>(e+t/Ba)/t;function Kv(e){const t=Ph,n=BigInt(3),r=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),f=e*e*e%t,u=f*f*e%t,d=gt(u,n,t)*u%t,h=gt(d,n,t)*u%t,l=gt(h,Ba,t)*f%t,g=gt(l,i,t)*l%t,w=gt(g,s,t)*g%t,v=gt(w,a,t)*w%t,A=gt(v,c,t)*v%t,C=gt(A,a,t)*w%t,x=gt(C,n,t)*u%t,_=gt(x,o,t)*g%t,R=gt(_,r,t)*f%t,L=gt(R,Ba,t);if(!Aa.eql(Aa.sqr(L),e))throw new Error("Cannot find square root");return L}const Aa=yn(Ph,void 0,void 0,{sqrt:Kv});ms({a:Hv,b:BigInt(7),Fp:Aa,n:$h,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{const t=$h,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-Vv*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,o=BigInt("0x100000000000000000000000000000000"),a=Lh(s*e,t),c=Lh(-r*e,t);let f=Me(e-a*n-c*i,t),u=Me(-a*r-c*s,t);const d=f>o,h=u>o;if(d&&(f=t-f),h&&(u=t-u),f>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:d,k1:f,k2neg:h,k2:u}}}},vr),Object.freeze({1:0n,2:1n,3:2n,4:3n,5:4n,6:5n,7:6n,8:7n,9:8n,A:9n,B:10n,C:11n,D:12n,E:13n,F:14n,G:15n,H:16n,J:17n,K:18n,L:19n,M:20n,N:21n,P:22n,Q:23n,R:24n,S:25n,T:26n,U:27n,V:28n,W:29n,X:30n,Y:31n,Z:32n,a:33n,b:34n,c:35n,d:36n,e:37n,f:38n,g:39n,h:40n,i:41n,j:42n,k:43n,m:44n,n:45n,o:46n,p:47n,q:48n,r:49n,s:50n,t:51n,u:52n,v:53n,w:54n,x:55n,y:56n,z:57n}),Array.from("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/").map((e,t)=>[t,e.charCodeAt(0)]),{...Object.fromEntries(Array.from("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/").map((e,t)=>[e.charCodeAt(0),t]))},Vt.slice();const Gv=BigInt(0),Es=BigInt(1),Uh=BigInt(2),xr=BigInt(3);function Zv(e){const t=[];for(;e>Es;e>>=Es)(e&Es)===Gv?t.unshift(0):(e&xr)===xr?(t.unshift(-1),e+=Es):t.unshift(1);return t}function Yv(e){const{Fp:t,Fr:n,Fp2:r,Fp6:i,Fp12:s}=e.fields,o=e.params.xNegative,a=e.params.twistType,c=Oa({n:n.ORDER,...e.G1}),f=Object.assign(c,Ch(c.ProjectivePoint,e.G1.mapToCurve,{...e.htfDefaults,...e.G1.htfDefaults})),u=Oa({n:n.ORDER,...e.G2}),d=Object.assign(u,Ch(u.ProjectivePoint,e.G2.mapToCurve,{...e.htfDefaults,...e.G2.htfDefaults}));let h;if(a==="multiplicative")h=(P,F,N,k,z,G)=>s.mul014(k,P,r.mul(F,z),r.mul(N,G));else if(a==="divisive")h=(P,F,N,k,z,G)=>s.mul034(k,r.mul(N,G),r.mul(F,z),P);else throw new Error("bls: unknown twist type");const l=r.div(r.ONE,r.mul(r.ONE,Uh));function g(P,F,N,k){const z=r.sqr(N),G=r.sqr(k),H=r.mulByB(r.mul(G,xr)),K=r.mul(H,xr),J=r.sub(r.sub(r.sqr(r.add(N,k)),G),z),ee=r.sub(H,z),re=r.mul(r.sqr(F),xr),he=r.neg(J);return P.push([ee,re,he]),F=r.mul(r.mul(r.mul(r.sub(z,K),F),N),l),N=r.sub(r.sqr(r.mul(r.add(z,K),l)),r.mul(r.sqr(H),xr)),k=r.mul(z,J),{Rx:F,Ry:N,Rz:k}}function w(P,F,N,k,z,G){const H=r.sub(N,r.mul(G,k)),K=r.sub(F,r.mul(z,k)),J=r.sub(r.mul(H,z),r.mul(K,G)),ee=r.neg(H),re=K;P.push([J,ee,re]);const he=r.sqr(K),de=r.mul(he,K),cn=r.mul(he,F),ao=r.add(r.sub(de,r.mul(cn,Uh)),r.mul(r.sqr(H),k));return F=r.mul(K,ao),N=r.sub(r.mul(r.sub(cn,ao),H),r.mul(de,N)),k=r.mul(k,de),{Rx:F,Ry:N,Rz:k}}const v=Zv(e.params.ateLoopSize),A=ua(P=>{const F=P,{x:N,y:k}=F.toAffine(),z=N,G=k,H=r.neg(k);let K=z,J=G,ee=r.ONE;const re=[];for(const he of v){const de=[];({Rx:K,Ry:J,Rz:ee}=g(de,K,J,ee)),he&&({Rx:K,Ry:J,Rz:ee}=w(de,K,J,ee,z,he===-1?H:G)),re.push(de)}if(e.postPrecompute){const he=re[re.length-1];e.postPrecompute(K,J,ee,z,G,w.bind(null,he))}return re});function C(P,F=!1){let N=s.ONE;if(P.length){const k=P[0][0].length;for(let z=0;z<k;z++){N=s.sqr(N);for(const[G,H,K]of P)for(const[J,ee,re]of G[z])N=h(J,ee,re,N,H,K)}}return o&&(N=s.conjugate(N)),F?s.finalExponentiate(N):N}function x(P,F=!0){const N=[];f.ProjectivePoint.normalizeZ(P.map(({g1:k})=>k)),d.ProjectivePoint.normalizeZ(P.map(({g2:k})=>k));for(const{g1:k,g2:z}of P){if(k.equals(f.ProjectivePoint.ZERO)||z.equals(d.ProjectivePoint.ZERO))throw new Error("pairing is not available for ZERO point");k.assertValidity(),z.assertValidity();const G=k.toAffine();N.push([A(z),G.x,G.y])}return C(N,F)}function _(P,F,N=!0){return x([{g1:P,g2:F}],N)}const R={randomPrivateKey:()=>{const P=wa(n.ORDER);return xh(e.randomBytes(P),n.ORDER)},calcPairingPrecomputes:A},{ShortSignature:L}=e.G1,{Signature:j}=e.G2;function U(P){return P instanceof f.ProjectivePoint?P:f.ProjectivePoint.fromHex(P)}function D(P,F){return P instanceof f.ProjectivePoint?P:f.hashToCurve(Ne("point",P),F)}function q(P){return P instanceof d.ProjectivePoint?P:j.fromHex(P)}function M(P,F){return P instanceof d.ProjectivePoint?P:d.hashToCurve(Ne("point",P),F)}function E(P){return f.ProjectivePoint.fromPrivateKey(P).toRawBytes(!0)}function b(P){return d.ProjectivePoint.fromPrivateKey(P).toRawBytes(!0)}function m(P,F,N){const k=M(P,N);k.assertValidity();const z=k.multiply(f.normPrivateKeyToScalar(F));return P instanceof d.ProjectivePoint?z:j.toRawBytes(z)}function p(P,F,N){const k=D(P,N);k.assertValidity();const z=k.multiply(f.normPrivateKeyToScalar(F));return P instanceof f.ProjectivePoint?z:L.toRawBytes(z)}function y(P,F,N,k){const z=U(N),G=M(F,k),H=f.ProjectivePoint.BASE,K=q(P),J=x([{g1:z.negate(),g2:G},{g1:H,g2:K}]);return s.eql(J,s.ONE)}function S(P,F,N,k){const z=q(N),G=D(F,k),H=d.ProjectivePoint.BASE,K=U(P),J=x([{g1:G,g2:z},{g1:K,g2:H.negate()}]);return s.eql(J,s.ONE)}function I(P){if(!Array.isArray(P)||P.length===0)throw new Error("expected non-empty array")}function O(P){I(P);const N=P.map(U).reduce((k,z)=>k.add(z),f.ProjectivePoint.ZERO);return P[0]instanceof f.ProjectivePoint?(N.assertValidity(),N):N.toRawBytes(!0)}function B(P){I(P);const N=P.map(q).reduce((k,z)=>k.add(z),d.ProjectivePoint.ZERO);return P[0]instanceof d.ProjectivePoint?(N.assertValidity(),N):j.toRawBytes(N)}function T(P){I(P);const N=P.map(U).reduce((k,z)=>k.add(z),f.ProjectivePoint.ZERO);return P[0]instanceof f.ProjectivePoint?(N.assertValidity(),N):L.toRawBytes(N)}function $(P,F,N,k){if(I(F),N.length!==F.length)throw new Error("amount of public keys and messages should be equal");const z=q(P),G=F.map(ee=>M(ee,k)),H=N.map(U),K=new Map;for(let ee=0;ee<H.length;ee++){const re=H[ee],he=G[ee];let de=K.get(he);de===void 0&&(de=[],K.set(he,de)),de.push(re)}const J=[];try{for(const[ee,re]of K){const he=re.reduce((de,cn)=>de.add(cn));J.push({g1:he,g2:ee})}return J.push({g1:f.ProjectivePoint.BASE.negate(),g2:z}),s.eql(x(J),s.ONE)}catch{return!1}}return f.ProjectivePoint.BASE._setWindowSize(4),{getPublicKey:E,getPublicKeyForShortSignatures:b,sign:m,signShortSignature:p,verify:y,verifyBatch:$,verifyShortSignature:S,aggregatePublicKeys:O,aggregateSignatures:B,aggregateShortSignatures:T,millerLoopBatch:C,pairing:_,pairingBatch:x,G1:f,G2:d,Signature:j,ShortSignature:L,fields:{Fr:n,Fp:t,Fp2:r,Fp6:i,Fp12:s},params:{ateLoopSize:e.params.ateLoopSize,r:e.params.r,G1b:e.G1.b,G2b:e.G2.b},utils:R}}const Wv=BigInt(0),Sr=BigInt(1),Wt=BigInt(2),Fh=BigInt(3);function Da(e,t,n,r,i=1,s){const o=BigInt(s===void 0?r:s),a=n**BigInt(r),c=[];for(let f=0;f<i;f++){const u=BigInt(f+1),d=[];for(let h=0,l=Sr;h<r;h++){const g=(u*l-u)/o%a;d.push(e.pow(t,g)),l*=n}c.push(d)}return c}function Xv(e,t,n){const r=t.pow(n,(e.ORDER-Sr)/Fh),i=t.pow(n,(e.ORDER-Sr)/Wt);function s(h,l){const g=t.mul(t.frobeniusMap(h,1),r),w=t.mul(t.frobeniusMap(l,1),i);return[g,w]}const o=t.pow(n,(e.ORDER**Wt-Sr)/Fh),a=t.pow(n,(e.ORDER**Wt-Sr)/Wt);if(!t.eql(a,t.neg(t.ONE)))throw new Error("psiFrobenius: PSI2_Y!==-1");function c(h,l){return[t.mul(h,o),t.neg(l)]}const f=h=>(l,g)=>{const w=g.toAffine(),v=h(w.x,w.y);return l.fromAffine({x:v[0],y:v[1]})},u=f(s),d=f(c);return{psi:s,psi2:c,G2psi:u,G2psi2:d,PSI_X:r,PSI_Y:i,PSI2_X:o,PSI2_Y:a}}function Jv(e){const{ORDER:t}=e,n=yn(t),r=n.create(e.NONRESIDUE||BigInt(-1)),i=n.div(n.ONE,Wt),s=Da(n,r,n.ORDER,2)[0],o=({c0:E,c1:b},{c0:m,c1:p})=>({c0:n.add(E,m),c1:n.add(b,p)}),a=({c0:E,c1:b},{c0:m,c1:p})=>({c0:n.sub(E,m),c1:n.sub(b,p)}),c=({c0:E,c1:b},m)=>{if(typeof m=="bigint")return{c0:n.mul(E,m),c1:n.mul(b,m)};const{c0:p,c1:y}=m;let S=n.mul(E,p),I=n.mul(b,y);const O=n.sub(S,I),B=n.sub(n.mul(n.add(E,b),n.add(p,y)),n.add(S,I));return{c0:O,c1:B}},f=({c0:E,c1:b})=>{const m=n.add(E,b),p=n.sub(E,b),y=n.add(E,E);return{c0:n.mul(m,p),c1:n.mul(y,b)}},u=E=>{if(E.length!==2)throw new Error("invalid tuple");const b=E.map(m=>n.create(m));return{c0:b[0],c1:b[1]}},d=t*t,h=u(e.FP2_NONRESIDUE),l={ORDER:d,isLE:n.isLE,NONRESIDUE:h,BITS:si(d),BYTES:Math.ceil(si(d)/8),MASK:Vn(si(d)),ZERO:{c0:n.ZERO,c1:n.ZERO},ONE:{c0:n.ONE,c1:n.ZERO},create:E=>E,isValid:({c0:E,c1:b})=>typeof E=="bigint"&&typeof b=="bigint",is0:({c0:E,c1:b})=>n.is0(E)&&n.is0(b),eql:({c0:E,c1:b},{c0:m,c1:p})=>n.eql(E,m)&&n.eql(b,p),neg:({c0:E,c1:b})=>({c0:n.neg(E),c1:n.neg(b)}),pow:(E,b)=>ys(l,E,b),invertBatch:E=>Gn(l,E),add:o,sub:a,mul:c,sqr:f,addN:o,subN:a,mulN:c,sqrN:f,div:(E,b)=>l.mul(E,typeof b=="bigint"?n.inv(n.create(b)):l.inv(b)),inv:({c0:E,c1:b})=>{const m=n.inv(n.create(E*E+b*b));return{c0:n.mul(m,n.create(E)),c1:n.mul(m,n.create(-b))}},sqrt:E=>{if(e.Fp2sqrt)return e.Fp2sqrt(E);const{c0:b,c1:m}=E;if(n.is0(m))return ws(n,b)===1?l.create({c0:n.sqrt(b),c1:n.ZERO}):l.create({c0:n.ZERO,c1:n.sqrt(n.div(b,r))});const p=n.sqrt(n.sub(n.sqr(b),n.mul(n.sqr(m),r)));let y=n.mul(n.add(p,b),i);ws(n,y)===-1&&(y=n.sub(y,p));const I=n.sqrt(y),O=l.create({c0:I,c1:n.div(n.mul(m,i),I)});if(!l.eql(l.sqr(O),E))throw new Error("Cannot find square root");const B=O,T=l.neg(B),{re:$,im:P}=l.reim(B),{re:F,im:N}=l.reim(T);return P>N||P===N&&$>F?B:T},isOdd:E=>{const{re:b,im:m}=l.reim(E),p=b%Wt,y=b===Wv,S=m%Wt;return BigInt(p||y&&S)==Sr},fromBytes(E){if(E.length!==l.BYTES)throw new Error("fromBytes invalid length="+E.length);return{c0:n.fromBytes(E.subarray(0,n.BYTES)),c1:n.fromBytes(E.subarray(n.BYTES))}},toBytes:({c0:E,c1:b})=>pe(n.toBytes(E),n.toBytes(b)),cmov:({c0:E,c1:b},{c0:m,c1:p},y)=>({c0:n.cmov(E,m,y),c1:n.cmov(b,p,y)}),reim:({c0:E,c1:b})=>({re:E,im:b}),mulByNonresidue:({c0:E,c1:b})=>l.mul({c0:E,c1:b},h),mulByB:e.Fp2mulByB,fromBigTuple:u,frobeniusMap:({c0:E,c1:b},m)=>({c0:E,c1:n.mul(b,s[m%2])})},g=({c0:E,c1:b,c2:m},{c0:p,c1:y,c2:S})=>({c0:l.add(E,p),c1:l.add(b,y),c2:l.add(m,S)}),w=({c0:E,c1:b,c2:m},{c0:p,c1:y,c2:S})=>({c0:l.sub(E,p),c1:l.sub(b,y),c2:l.sub(m,S)}),v=({c0:E,c1:b,c2:m},p)=>{if(typeof p=="bigint")return{c0:l.mul(E,p),c1:l.mul(b,p),c2:l.mul(m,p)};const{c0:y,c1:S,c2:I}=p,O=l.mul(E,y),B=l.mul(b,S),T=l.mul(m,I);return{c0:l.add(O,l.mulByNonresidue(l.sub(l.mul(l.add(b,m),l.add(S,I)),l.add(B,T)))),c1:l.add(l.sub(l.mul(l.add(E,b),l.add(y,S)),l.add(O,B)),l.mulByNonresidue(T)),c2:l.sub(l.add(B,l.mul(l.add(E,m),l.add(y,I))),l.add(O,T))}},A=({c0:E,c1:b,c2:m})=>{let p=l.sqr(E),y=l.mul(l.mul(E,b),Wt),S=l.mul(l.mul(b,m),Wt),I=l.sqr(m);return{c0:l.add(l.mulByNonresidue(S),p),c1:l.add(l.mulByNonresidue(I),y),c2:l.sub(l.sub(l.add(l.add(y,l.sqr(l.add(l.sub(E,b),m))),S),p),I)}},[C,x]=Da(l,h,n.ORDER,6,2,3),_={ORDER:l.ORDER,isLE:l.isLE,BITS:3*l.BITS,BYTES:3*l.BYTES,MASK:Vn(3*l.BITS),ZERO:{c0:l.ZERO,c1:l.ZERO,c2:l.ZERO},ONE:{c0:l.ONE,c1:l.ZERO,c2:l.ZERO},create:E=>E,isValid:({c0:E,c1:b,c2:m})=>l.isValid(E)&&l.isValid(b)&&l.isValid(m),is0:({c0:E,c1:b,c2:m})=>l.is0(E)&&l.is0(b)&&l.is0(m),neg:({c0:E,c1:b,c2:m})=>({c0:l.neg(E),c1:l.neg(b),c2:l.neg(m)}),eql:({c0:E,c1:b,c2:m},{c0:p,c1:y,c2:S})=>l.eql(E,p)&&l.eql(b,y)&&l.eql(m,S),sqrt:ah,div:(E,b)=>_.mul(E,typeof b=="bigint"?n.inv(n.create(b)):_.inv(b)),pow:(E,b)=>ys(_,E,b),invertBatch:E=>Gn(_,E),add:g,sub:w,mul:v,sqr:A,addN:g,subN:w,mulN:v,sqrN:A,inv:({c0:E,c1:b,c2:m})=>{let p=l.sub(l.sqr(E),l.mulByNonresidue(l.mul(m,b))),y=l.sub(l.mulByNonresidue(l.sqr(m)),l.mul(E,b)),S=l.sub(l.sqr(b),l.mul(E,m)),I=l.inv(l.add(l.mulByNonresidue(l.add(l.mul(m,y),l.mul(b,S))),l.mul(E,p)));return{c0:l.mul(I,p),c1:l.mul(I,y),c2:l.mul(I,S)}},fromBytes:E=>{if(E.length!==_.BYTES)throw new Error("fromBytes invalid length="+E.length);return{c0:l.fromBytes(E.subarray(0,l.BYTES)),c1:l.fromBytes(E.subarray(l.BYTES,2*l.BYTES)),c2:l.fromBytes(E.subarray(2*l.BYTES))}},toBytes:({c0:E,c1:b,c2:m})=>pe(l.toBytes(E),l.toBytes(b),l.toBytes(m)),cmov:({c0:E,c1:b,c2:m},{c0:p,c1:y,c2:S},I)=>({c0:l.cmov(E,p,I),c1:l.cmov(b,y,I),c2:l.cmov(m,S,I)}),fromBigSix:E=>{if(!Array.isArray(E)||E.length!==6)throw new Error("invalid Fp6 usage");return{c0:l.fromBigTuple(E.slice(0,2)),c1:l.fromBigTuple(E.slice(2,4)),c2:l.fromBigTuple(E.slice(4,6))}},frobeniusMap:({c0:E,c1:b,c2:m},p)=>({c0:l.frobeniusMap(E,p),c1:l.mul(l.frobeniusMap(b,p),C[p%6]),c2:l.mul(l.frobeniusMap(m,p),x[p%6])}),mulByFp2:({c0:E,c1:b,c2:m},p)=>({c0:l.mul(E,p),c1:l.mul(b,p),c2:l.mul(m,p)}),mulByNonresidue:({c0:E,c1:b,c2:m})=>({c0:l.mulByNonresidue(m),c1:E,c2:b}),mul1:({c0:E,c1:b,c2:m},p)=>({c0:l.mulByNonresidue(l.mul(m,p)),c1:l.mul(E,p),c2:l.mul(b,p)}),mul01({c0:E,c1:b,c2:m},p,y){let S=l.mul(E,p),I=l.mul(b,y);return{c0:l.add(l.mulByNonresidue(l.sub(l.mul(l.add(b,m),y),I)),S),c1:l.sub(l.sub(l.mul(l.add(p,y),l.add(E,b)),S),I),c2:l.add(l.sub(l.mul(l.add(E,m),p),S),I)}}},R=Da(l,h,n.ORDER,12,1,6)[0],L=({c0:E,c1:b},{c0:m,c1:p})=>({c0:_.add(E,m),c1:_.add(b,p)}),j=({c0:E,c1:b},{c0:m,c1:p})=>({c0:_.sub(E,m),c1:_.sub(b,p)}),U=({c0:E,c1:b},m)=>{if(typeof m=="bigint")return{c0:_.mul(E,m),c1:_.mul(b,m)};let{c0:p,c1:y}=m,S=_.mul(E,p),I=_.mul(b,y);return{c0:_.add(S,_.mulByNonresidue(I)),c1:_.sub(_.mul(_.add(E,b),_.add(p,y)),_.add(S,I))}},D=({c0:E,c1:b})=>{let m=_.mul(E,b);return{c0:_.sub(_.sub(_.mul(_.add(_.mulByNonresidue(b),E),_.add(E,b)),m),_.mulByNonresidue(m)),c1:_.add(m,m)}};function q(E,b){const m=l.sqr(E),p=l.sqr(b);return{first:l.add(l.mulByNonresidue(p),m),second:l.sub(l.sub(l.sqr(l.add(E,b)),m),p)}}const M={ORDER:l.ORDER,isLE:_.isLE,BITS:2*_.BITS,BYTES:2*_.BYTES,MASK:Vn(2*_.BITS),ZERO:{c0:_.ZERO,c1:_.ZERO},ONE:{c0:_.ONE,c1:_.ZERO},create:E=>E,isValid:({c0:E,c1:b})=>_.isValid(E)&&_.isValid(b),is0:({c0:E,c1:b})=>_.is0(E)&&_.is0(b),neg:({c0:E,c1:b})=>({c0:_.neg(E),c1:_.neg(b)}),eql:({c0:E,c1:b},{c0:m,c1:p})=>_.eql(E,m)&&_.eql(b,p),sqrt:ah,inv:({c0:E,c1:b})=>{let m=_.inv(_.sub(_.sqr(E),_.mulByNonresidue(_.sqr(b))));return{c0:_.mul(E,m),c1:_.neg(_.mul(b,m))}},div:(E,b)=>M.mul(E,typeof b=="bigint"?n.inv(n.create(b)):M.inv(b)),pow:(E,b)=>ys(M,E,b),invertBatch:E=>Gn(M,E),add:L,sub:j,mul:U,sqr:D,addN:L,subN:j,mulN:U,sqrN:D,fromBytes:E=>{if(E.length!==M.BYTES)throw new Error("fromBytes invalid length="+E.length);return{c0:_.fromBytes(E.subarray(0,_.BYTES)),c1:_.fromBytes(E.subarray(_.BYTES))}},toBytes:({c0:E,c1:b})=>pe(_.toBytes(E),_.toBytes(b)),cmov:({c0:E,c1:b},{c0:m,c1:p},y)=>({c0:_.cmov(E,m,y),c1:_.cmov(b,p,y)}),fromBigTwelve:E=>({c0:_.fromBigSix(E.slice(0,6)),c1:_.fromBigSix(E.slice(6,12))}),frobeniusMap(E,b){const{c0:m,c1:p,c2:y}=_.frobeniusMap(E.c1,b),S=R[b%12];return{c0:_.frobeniusMap(E.c0,b),c1:_.create({c0:l.mul(m,S),c1:l.mul(p,S),c2:l.mul(y,S)})}},mulByFp2:({c0:E,c1:b},m)=>({c0:_.mulByFp2(E,m),c1:_.mulByFp2(b,m)}),conjugate:({c0:E,c1:b})=>({c0:E,c1:_.neg(b)}),mul014:({c0:E,c1:b},m,p,y)=>{let S=_.mul01(E,m,p),I=_.mul1(b,y);return{c0:_.add(_.mulByNonresidue(I),S),c1:_.sub(_.sub(_.mul01(_.add(b,E),m,l.add(p,y)),S),I)}},mul034:({c0:E,c1:b},m,p,y)=>{const S=_.create({c0:l.mul(E.c0,m),c1:l.mul(E.c1,m),c2:l.mul(E.c2,m)}),I=_.mul01(b,p,y),O=_.mul01(_.add(E,b),l.add(m,p),y);return{c0:_.add(_.mulByNonresidue(I),S),c1:_.sub(O,_.add(S,I))}},_cyclotomicSquare:e.Fp12cyclotomicSquare,_cyclotomicExp:e.Fp12cyclotomicExp,finalExponentiate:e.Fp12finalExponentiate};return{Fp:n,Fp2:l,Fp6:_,Fp4Square:q,Fp12:M}}const ze=BigInt(0),vs=BigInt(1),xe=BigInt(2),_s=BigInt(3),fi=BigInt(4),En=BigInt("0xd201000000010000"),Qv=si(En),{Fp:Y,Fp2:X,Fp6:Ta,Fp4Square:Ra,Fp12:te}=Jv({ORDER:BigInt("0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaaab"),FP2_NONRESIDUE:[vs,vs],Fp2mulByB:({c0:e,c1:t})=>{const n=Y.mul(e,fi),r=Y.mul(t,fi);return{c0:Y.sub(n,r),c1:Y.add(n,r)}},Fp12cyclotomicSquare:({c0:e,c1:t})=>{const{c0:n,c1:r,c2:i}=e,{c0:s,c1:o,c2:a}=t,{first:c,second:f}=Ra(n,o),{first:u,second:d}=Ra(s,i),{first:h,second:l}=Ra(r,a),g=X.mulByNonresidue(l);return{c0:Ta.create({c0:X.add(X.mul(X.sub(c,n),xe),c),c1:X.add(X.mul(X.sub(u,r),xe),u),c2:X.add(X.mul(X.sub(h,i),xe),h)}),c1:Ta.create({c0:X.add(X.mul(X.add(g,s),xe),g),c1:X.add(X.mul(X.add(f,o),xe),f),c2:X.add(X.mul(X.add(d,a),xe),d)})}},Fp12cyclotomicExp(e,t){let n=te.ONE;for(let r=Qv-1;r>=0;r--)n=te._cyclotomicSquare(n),KE(t,r)&&(n=te.mul(n,e));return n},Fp12finalExponentiate:e=>{const t=En,n=te.div(te.frobeniusMap(e,6),e),r=te.mul(te.frobeniusMap(n,2),n),i=te.conjugate(te._cyclotomicExp(r,t)),s=te.mul(te.conjugate(te._cyclotomicSquare(r)),i),o=te.conjugate(te._cyclotomicExp(s,t)),a=te.conjugate(te._cyclotomicExp(o,t)),c=te.mul(te.conjugate(te._cyclotomicExp(a,t)),te._cyclotomicSquare(i)),f=te.conjugate(te._cyclotomicExp(c,t)),u=te.frobeniusMap(te.mul(i,a),2),d=te.frobeniusMap(te.mul(o,r),3),h=te.frobeniusMap(te.mul(c,te.conjugate(r)),1),l=te.mul(te.mul(f,te.conjugate(s)),r);return te.mul(te.mul(te.mul(u,d),h),l)}}),jh=yn(BigInt("0x73eda753299d7d483339d80809a1d80553bda402fffe5bfeffffffff00000001")),e3=Nh(X,[[["0x5c759507e8e333ebb5b7a9a47d7ed8532c52d39fd3a042a88b58423c50ae15d5c2638e343d9c71c6238aaaaaaaa97d6","0x5c759507e8e333ebb5b7a9a47d7ed8532c52d39fd3a042a88b58423c50ae15d5c2638e343d9c71c6238aaaaaaaa97d6"],["0x0","0x11560bf17baa99bc32126fced787c88f984f87adf7ae0c7f9a208c6b4f20a4181472aaa9cb8d555526a9ffffffffc71a"],["0x11560bf17baa99bc32126fced787c88f984f87adf7ae0c7f9a208c6b4f20a4181472aaa9cb8d555526a9ffffffffc71e","0x8ab05f8bdd54cde190937e76bc3e447cc27c3d6fbd7063fcd104635a790520c0a395554e5c6aaaa9354ffffffffe38d"],["0x171d6541fa38ccfaed6dea691f5fb614cb14b4e7f4e810aa22d6108f142b85757098e38d0f671c7188e2aaaaaaaa5ed1","0x0"]],[["0x0","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaa63"],["0xc","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaa9f"],["0x1","0x0"]],[["0x1530477c7ab4113b59a4c18b076d11930f7da5d4a07f649bf54439d87d27e500fc8c25ebf8c92f6812cfc71c71c6d706","0x1530477c7ab4113b59a4c18b076d11930f7da5d4a07f649bf54439d87d27e500fc8c25ebf8c92f6812cfc71c71c6d706"],["0x0","0x5c759507e8e333ebb5b7a9a47d7ed8532c52d39fd3a042a88b58423c50ae15d5c2638e343d9c71c6238aaaaaaaa97be"],["0x11560bf17baa99bc32126fced787c88f984f87adf7ae0c7f9a208c6b4f20a4181472aaa9cb8d555526a9ffffffffc71c","0x8ab05f8bdd54cde190937e76bc3e447cc27c3d6fbd7063fcd104635a790520c0a395554e5c6aaaa9354ffffffffe38f"],["0x124c9ad43b6cf79bfbf7043de3811ad0761b0f37a1e26286b0e977c69aa274524e79097a56dc4bd9e1b371c71c718b10","0x0"]],[["0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffa8fb","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffa8fb"],["0x0","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffa9d3"],["0x12","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaa99"],["0x1","0x0"]]].map(e=>e.map(t=>X.fromBigTuple(t.map(BigInt))))),t3=Nh(Y,[["0x11a05f2b1e833340b809101dd99815856b303e88a2d7005ff2627b56cdb4e2c85610c2d5f2e62d6eaeac1662734649b7","0x17294ed3e943ab2f0588bab22147a81c7c17e75b2f6a8417f565e33c70d1e86b4838f2a6f318c356e834eef1b3cb83bb","0xd54005db97678ec1d1048c5d10a9a1bce032473295983e56878e501ec68e25c958c3e3d2a09729fe0179f9dac9edcb0","0x1778e7166fcc6db74e0609d307e55412d7f5e4656a8dbf25f1b33289f1b330835336e25ce3107193c5b388641d9b6861","0xe99726a3199f4436642b4b3e4118e5499db995a1257fb3f086eeb65982fac18985a286f301e77c451154ce9ac8895d9","0x1630c3250d7313ff01d1201bf7a74ab5db3cb17dd952799b9ed3ab9097e68f90a0870d2dcae73d19cd13c1c66f652983","0xd6ed6553fe44d296a3726c38ae652bfb11586264f0f8ce19008e218f9c86b2a8da25128c1052ecaddd7f225a139ed84","0x17b81e7701abdbe2e8743884d1117e53356de5ab275b4db1a682c62ef0f2753339b7c8f8c8f475af9ccb5618e3f0c88e","0x80d3cf1f9a78fc47b90b33563be990dc43b756ce79f5574a2c596c928c5d1de4fa295f296b74e956d71986a8497e317","0x169b1f8e1bcfa7c42e0c37515d138f22dd2ecb803a0c5c99676314baf4bb1b7fa3190b2edc0327797f241067be390c9e","0x10321da079ce07e272d8ec09d2565b0dfa7dccdde6787f96d50af36003b14866f69b771f8c285decca67df3f1605fb7b","0x6e08c248e260e70bd1e962381edee3d31d79d7e22c837bc23c0bf1bc24c6b68c24b1b80b64d391fa9c8ba2e8ba2d229"],["0x8ca8d548cff19ae18b2e62f4bd3fa6f01d5ef4ba35b48ba9c9588617fc8ac62b558d681be343df8993cf9fa40d21b1c","0x12561a5deb559c4348b4711298e536367041e8ca0cf0800c0126c2588c48bf5713daa8846cb026e9e5c8276ec82b3bff","0xb2962fe57a3225e8137e629bff2991f6f89416f5a718cd1fca64e00b11aceacd6a3d0967c94fedcfcc239ba5cb83e19","0x3425581a58ae2fec83aafef7c40eb545b08243f16b1655154cca8abc28d6fd04976d5243eecf5c4130de8938dc62cd8","0x13a8e162022914a80a6f1d5f43e7a07dffdfc759a12062bb8d6b44e833b306da9bd29ba81f35781d539d395b3532a21e","0xe7355f8e4e667b955390f7f0506c6e9395735e9ce9cad4d0a43bcef24b8982f7400d24bc4228f11c02df9a29f6304a5","0x772caacf16936190f3e0c63e0596721570f5799af53a1894e2e073062aede9cea73b3538f0de06cec2574496ee84a3a","0x14a7ac2a9d64a8b230b3f5b074cf01996e7f63c21bca68a81996e1cdf9822c580fa5b9489d11e2d311f7d99bbdcc5a5e","0xa10ecf6ada54f825e920b3dafc7a3cce07f8d1d7161366b74100da67f39883503826692abba43704776ec3a79a1d641","0x95fc13ab9e92ad4476d6e3eb3a56680f682b4ee96f7d03776df533978f31c1593174e4b4b7865002d6384d168ecdd0a","0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"],["0x90d97c81ba24ee0259d1f094980dcfa11ad138e48a869522b52af6c956543d3cd0c7aee9b3ba3c2be9845719707bb33","0x134996a104ee5811d51036d776fb46831223e96c254f383d0f906343eb67ad34d6c56711962fa8bfe097e75a2e41c696","0xcc786baa966e66f4a384c86a3b49942552e2d658a31ce2c344be4b91400da7d26d521628b00523b8dfe240c72de1f6","0x1f86376e8981c217898751ad8746757d42aa7b90eeb791c09e4a3ec03251cf9de405aba9ec61deca6355c77b0e5f4cb","0x8cc03fdefe0ff135caf4fe2a21529c4195536fbe3ce50b879833fd221351adc2ee7f8dc099040a841b6daecf2e8fedb","0x16603fca40634b6a2211e11db8f0a6a074a7d0d4afadb7bd76505c3d3ad5544e203f6326c95a807299b23ab13633a5f0","0x4ab0b9bcfac1bbcb2c977d027796b3ce75bb8ca2be184cb5231413c4d634f3747a87ac2460f415ec961f8855fe9d6f2","0x987c8d5333ab86fde9926bd2ca6c674170a05bfe3bdd81ffd038da6c26c842642f64550fedfe935a15e4ca31870fb29","0x9fc4018bd96684be88c9e221e4da1bb8f3abd16679dc26c1e8b6e6a1f20cabe69d65201c78607a360370e577bdba587","0xe1bba7a1186bdb5223abde7ada14a23c42a0ca7915af6fe06985e7ed1e4d43b9b3f7055dd4eba6f2bafaaebca731c30","0x19713e47937cd1be0dfd0b8f1d43fb93cd2fcbcb6caf493fd1183e416389e61031bf3a5cce3fbafce813711ad011c132","0x18b46a908f36f6deb918c143fed2edcc523559b8aaf0c2462e6bfe7f911f643249d9cdf41b44d606ce07c8a4d0074d8e","0xb182cac101b9399d155096004f53f447aa7b12a3426b08ec02710e807b4633f06c851c1919211f20d4c04f00b971ef8","0x245a394ad1eca9b72fc00ae7be315dc757b3b080d4c158013e6632d3c40659cc6cf90ad1c232a6442d9d3f5db980133","0x5c129645e44cf1102a159f748c4a3fc5e673d81d7e86568d9ab0f5d396a7ce46ba1049b6579afb7866b1e715475224b","0x15e6be4e990f03ce4ea50b3b42df2eb5cb181d8f84965a3957add4fa95af01b2b665027efec01c7704b456be69c8b604"],["0x16112c4c3a9c98b252181140fad0eae9601a6de578980be6eec3232b5be72e7a07f3688ef60c206d01479253b03663c1","0x1962d75c2381201e1a0cbd6c43c348b885c84ff731c4d59ca4a10356f453e01f78a4260763529e3532f6102c2e49a03d","0x58df3306640da276faaae7d6e8eb15778c4855551ae7f310c35a5dd279cd2eca6757cd636f96f891e2538b53dbf67f2","0x16b7d288798e5395f20d23bf89edb4d1d115c5dbddbcd30e123da489e726af41727364f2c28297ada8d26d98445f5416","0xbe0e079545f43e4b00cc912f8228ddcc6d19c9f0f69bbb0542eda0fc9dec916a20b15dc0fd2ededda39142311a5001d","0x8d9e5297186db2d9fb266eaac783182b70152c65550d881c5ecd87b6f0f5a6449f38db9dfa9cce202c6477faaf9b7ac","0x166007c08a99db2fc3ba8734ace9824b5eecfdfa8d0cf8ef5dd365bc400a0051d5fa9c01a58b1fb93d1a1399126a775c","0x16a3ef08be3ea7ea03bcddfabba6ff6ee5a4375efa1f4fd7feb34fd206357132b920f5b00801dee460ee415a15812ed9","0x1866c8ed336c61231a1be54fd1d74cc4f9fb0ce4c6af5920abc5750c4bf39b4852cfe2f7bb9248836b233d9d55535d4a","0x167a55cda70a6e1cea820597d94a84903216f763e13d87bb5308592e7ea7d4fbc7385ea3d529b35e346ef48bb8913f55","0x4d2f259eea405bd48f010a01ad2911d9c6dd039bb61a6290e591b36e636a5c871a5c29f4f83060400f8b49cba8f6aa8","0xaccbb67481d033ff5852c1e48c50c477f94ff8aefce42d28c0f9a88cea7913516f968986f7ebbea9684b529e2561092","0xad6b9514c767fe3c3613144b45f1496543346d98adf02267d5ceef9a00d9b8693000763e3b90ac11e99b138573345cc","0x2660400eb2e4f3b628bdd0d53cd76f2bf565b94e72927c1cb748df27942480e420517bd8714cc80d1fadc1326ed06f7","0xe0fa1d816ddc03e6b24255e0d7819c171c40f65e273b853324efcd6356caa205ca2f570f13497804415473a1d634b8f","0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"]].map(e=>e.map(t=>BigInt(t)))),n3=Th(X,{A:X.create({c0:Y.create(ze),c1:Y.create(BigInt(240))}),B:X.create({c0:Y.create(BigInt(1012)),c1:Y.create(BigInt(1012))}),Z:X.create({c0:Y.create(BigInt(-2)),c1:Y.create(BigInt(-1))})}),r3=Th(Y,{A:Y.create(BigInt("0x144698a3b8e9433d693a02c96d4982b0ea985383ee66a8d8e8981aefd881ac98936f8da0e0f97f5cf428082d584c1d")),B:Y.create(BigInt("0x12e2908d11688030018b12e8753eee3b2016c1f0f24f4070a0b9c14fcef35ef55a23215a316ceaa5d1cc48e98e172be0")),Z:Y.create(BigInt(11))}),{G2psi:kh,G2psi2:i3}=Xv(Y,X,X.div(X.ONE,X.NONRESIDUE)),Na=Object.freeze({DST:"BLS_SIG_BLS12381G2_XMD:SHA-256_SSWU_RO_NUL_",encodeDST:"BLS_SIG_BLS12381G2_XMD:SHA-256_SSWU_RO_NUL_",p:Y.ORDER,m:2,k:128,expand:"xmd",hash:vr}),xs=ui(Y.toBytes(ze),{infinity:!0,compressed:!0});function Ss(e){e=e.slice();const t=e[0]&224,n=!!(t>>7&1),r=!!(t>>6&1),i=!!(t>>5&1);return e[0]&=31,{compressed:n,infinity:r,sort:i,value:e}}function ui(e,t){if(e[0]&224)throw new Error("setMask: non-empty mask");return t.compressed&&(e[0]|=128),t.infinity&&(e[0]|=64),t.sort&&(e[0]|=32),e}function Mh(e){e.assertValidity();const t=e.equals(xt.G1.ProjectivePoint.ZERO),{x:n,y:r}=e.toAffine();if(t)return xs.slice();const i=Y.ORDER,s=!!(r*xe/i);return ui(me(n,Y.BYTES),{compressed:!0,sort:s})}function zh(e){e.assertValidity();const t=Y.BYTES;if(e.equals(xt.G2.ProjectivePoint.ZERO))return pe(xs,me(ze,t));const{x:n,y:r}=e.toAffine(),{re:i,im:s}=X.reim(n),{re:o,im:a}=X.reim(r),f=!!((a>ze?a*xe:o*xe)/Y.ORDER&vs),u=i;return pe(ui(me(s,t),{sort:f,compressed:!0}),me(u,t))}const xt=Yv({fields:{Fp:Y,Fp2:X,Fp6:Ta,Fp12:te,Fr:jh},G1:{Fp:Y,h:BigInt("0x396c8c005555e1568c00aaab0000aaab"),Gx:BigInt("0x17f1d3a73197d7942695638c4fa9ac0fc3688c4f9774b905a14e3a3f171bac586c55e83ff97a1aeffb3af00adb22c6bb"),Gy:BigInt("0x08b3f481e3aaa0f1a09e30ed741d8ae4fcf5e095d5d00af600db18cb2c04b3edd03cc744a2888ae40caa232946c5e7e1"),a:Y.ZERO,b:fi,htfDefaults:{...Na,m:1,DST:"BLS_SIG_BLS12381G1_XMD:SHA-256_SSWU_RO_NUL_"},wrapPrivateKey:!0,allowInfinityPoint:!0,isTorsionFree:(e,t)=>{const n=BigInt("0x5f19672fdf76ce51ba69c6076a0f77eaddb3a93be6f89688de17d813620a00022e01fffffffefffe"),r=new e(Y.mul(t.px,n),t.py,t.pz);return t.multiplyUnsafe(En).negate().multiplyUnsafe(En).equals(r)},clearCofactor:(e,t)=>t.multiplyUnsafe(En).add(t),mapToCurve:e=>{const{x:t,y:n}=r3(Y.create(e[0]));return t3(t,n)},fromBytes:e=>{const{compressed:t,infinity:n,sort:r,value:i}=Ss(e);if(i.length===48&&t){const s=Y.ORDER,o=je(i),a=Y.create(o&Y.MASK);if(n){if(a!==ze)throw new Error("G1: non-empty compressed point at infinity");return{x:ze,y:ze}}const c=Y.add(Y.pow(a,_s),Y.create(xt.params.G1b));let f=Y.sqrt(c);if(!f)throw new Error("invalid compressed G1 point");return f*xe/s!==BigInt(r)&&(f=Y.neg(f)),{x:Y.create(a),y:Y.create(f)}}else if(i.length===96&&!t){const s=je(i.subarray(0,Y.BYTES)),o=je(i.subarray(Y.BYTES));if(n){if(s!==ze||o!==ze)throw new Error("G1: non-empty point at infinity");return xt.G1.ProjectivePoint.ZERO.toAffine()}return{x:Y.create(s),y:Y.create(o)}}else throw new Error("invalid point G1, expected 48/96 bytes")},toBytes:(e,t,n)=>{const r=t.equals(e.ZERO),{x:i,y:s}=t.toAffine();if(n){if(r)return xs.slice();const o=Y.ORDER,a=!!(s*xe/o);return ui(me(i,Y.BYTES),{compressed:!0,sort:a})}else return r?pe(new Uint8Array([64]),new Uint8Array(2*Y.BYTES-1)):pe(me(i,Y.BYTES),me(s,Y.BYTES))},ShortSignature:{fromHex(e){const{infinity:t,sort:n,value:r}=Ss(Ne("signatureHex",e,48)),i=Y.ORDER,s=je(r);if(t)return xt.G1.ProjectivePoint.ZERO;const o=Y.create(s&Y.MASK),a=Y.add(Y.pow(o,_s),Y.create(xt.params.G1b));let c=Y.sqrt(a);if(!c)throw new Error("invalid compressed G1 point");const f=BigInt(n);c*xe/i!==f&&(c=Y.neg(c));const u=xt.G1.ProjectivePoint.fromAffine({x:o,y:c});return u.assertValidity(),u},toRawBytes(e){return Mh(e)},toHex(e){return Hn(Mh(e))}}},G2:{Fp:X,h:BigInt("0x5d543a95414e7f1091d50792876a202cd91de4547085abaa68a205b2e5a7ddfa628f1cb4d9e82ef21537e293a6691ae1616ec6e786f0c70cf1c38e31c7238e5"),Gx:X.fromBigTuple([BigInt("0x024aa2b2f08f0a91260805272dc51051c6e47ad4fa403b02b4510b647ae3d1770bac0326a805bbefd48056c8c121bdb8"),BigInt("0x13e02b6052719f607dacd3a088274f65596bd0d09920b61ab5da61bbdc7f5049334cf11213945d57e5ac7d055d042b7e")]),Gy:X.fromBigTuple([BigInt("0x0ce5d527727d6e118cc9cdc6da2e351aadfd9baa8cbdd3a76d429a695160d12c923ac9cc3baca289e193548608b82801"),BigInt("0x0606c4a02ea734cc32acd2b02bc28b99cb3e287e85a763af267492ab572e99ab3f370d275cec1da1aaa9075ff05f79be")]),a:X.ZERO,b:X.fromBigTuple([fi,fi]),hEff:BigInt("0xbc69f08f2ee75b3584c6a0ea91b352888e2a8e9145ad7689986ff031508ffe1329c2f178731db956d82bf015d1212b02ec0ec69d7477c1ae954cbc06689f6a359894c0adebbf6b4e8020005aaa95551"),htfDefaults:{...Na},wrapPrivateKey:!0,allowInfinityPoint:!0,mapToCurve:e=>{const{x:t,y:n}=n3(X.fromBigTuple(e));return e3(t,n)},isTorsionFree:(e,t)=>t.multiplyUnsafe(En).negate().equals(kh(e,t)),clearCofactor:(e,t)=>{const n=En;let r=t.multiplyUnsafe(n).negate(),i=kh(e,t),s=t.double();return s=i3(e,s),s=s.subtract(i),i=r.add(i),i=i.multiplyUnsafe(n).negate(),s=s.add(i),s=s.subtract(r),s.subtract(t)},fromBytes:e=>{const{compressed:t,infinity:n,sort:r,value:i}=Ss(e);if(!t&&!n&&r||!t&&n&&r||r&&n&&t)throw new Error("invalid encoding flag: "+(e[0]&224));const s=Y.BYTES,o=(a,c,f)=>je(a.slice(c,f));if(i.length===96&&t){const a=xt.params.G2b,c=Y.ORDER;if(n){if(i.reduce((w,v)=>w!==0?v+1:v,0)>0)throw new Error("invalid compressed G2 point");return{x:X.ZERO,y:X.ZERO}}const f=o(i,0,s),u=o(i,s,2*s),d=X.create({c0:Y.create(u),c1:Y.create(f)}),h=X.add(X.pow(d,_s),a);let l=X.sqrt(h);const g=l.c1===ze?l.c0*xe/c:l.c1*xe/c?vs:ze;return l=r&&g>0?l:X.neg(l),{x:d,y:l}}else if(i.length===192&&!t){if(n){if(i.reduce((d,h)=>d!==0?h+1:h,0)>0)throw new Error("invalid uncompressed G2 point");return{x:X.ZERO,y:X.ZERO}}const a=o(i,0,s),c=o(i,s,2*s),f=o(i,2*s,3*s),u=o(i,3*s,4*s);return{x:X.fromBigTuple([c,a]),y:X.fromBigTuple([u,f])}}else throw new Error("invalid point G2, expected 96/192 bytes")},toBytes:(e,t,n)=>{const{BYTES:r,ORDER:i}=Y,s=t.equals(e.ZERO),{x:o,y:a}=t.toAffine();if(n){if(s)return pe(xs,me(ze,r));const c=!!(a.c1===ze?a.c0*xe/i:a.c1*xe/i);return pe(ui(me(o.c1,r),{compressed:!0,sort:c}),me(o.c0,r))}else{if(s)return pe(new Uint8Array([64]),new Uint8Array(4*r-1));const{re:c,im:f}=X.reim(o),{re:u,im:d}=X.reim(a);return pe(me(f,r),me(c,r),me(d,r),me(u,r))}},Signature:{fromHex(e){const{infinity:t,sort:n,value:r}=Ss(Ne("signatureHex",e)),i=Y.ORDER,s=r.length/2;if(s!==48&&s!==96)throw new Error("invalid compressed signature length, must be 96 or 192");const o=je(r.slice(0,s)),a=je(r.slice(s));if(t)return xt.G2.ProjectivePoint.ZERO;const c=Y.create(o&Y.MASK),f=Y.create(a),u=X.create({c0:f,c1:c}),d=X.add(X.pow(u,_s),xt.params.G2b);let h=X.sqrt(d);if(!h)throw new Error("Failed to find a square root");const{re:l,im:g}=X.reim(h),w=BigInt(n),v=g>ze&&g*xe/i!==w,A=g===ze&&l*xe/i!==w;(v||A)&&(h=X.neg(h));const C=xt.G2.ProjectivePoint.fromAffine({x:u,y:h});return C.assertValidity(),C},toRawBytes(e){return zh(e)},toHex(e){return Hn(zh(e))}}},params:{ateLoopSize:En,r:jh.ORDER,xNegative:!0,twistType:"multiplicative"},htfDefaults:Na,hash:vr,randomBytes:fs});BigInt(0),BigInt(1),BigInt(2),BigInt(8),BigInt(0),BigInt(1),BigInt(2),BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),BigInt(0),BigInt(1),BigInt(2),BigInt(3),BigInt(5),BigInt(8);const Ca=BigInt(0),Pa=BigInt(1);function Is(e,t=""){if(typeof e!="boolean"){const n=t&&`"${t}"`;throw new Error(n+"expected boolean, got type="+typeof e)}return e}function Zn(e,t,n=""){const r=ss(e),i=e?.length,s=t!==void 0;if(!r||s&&i!==t){const o=n&&`"${n}" `,a=s?` of length ${t}`:"",c=r?`length=${i}`:`type=${typeof e}`;throw new Error(o+"expected Uint8Array"+a+", got "+c)}return e}function Os(e){const t=e.toString(16);return t.length&1?"0"+t:t}function qh(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return e===""?Ca:BigInt("0x"+e)}function Bs(e){return qh(wr(e))}function Hh(e){return zt(e),qh(wr(Uint8Array.from(e).reverse()))}function $a(e,t){return os(e.toString(16).padStart(t*2,"0"))}function Vh(e,t){return $a(e,t).reverse()}function Xe(e,t,n){let r;if(typeof t=="string")try{r=os(t)}catch(s){throw new Error(e+" must be hex string or Uint8Array, cause: "+s)}else if(ss(t))r=Uint8Array.from(t);else throw new Error(e+" must be hex string or Uint8Array");const i=r.length;if(typeof n=="number"&&i!==n)throw new Error(e+" of length "+n+" expected, got "+i);return r}const La=e=>typeof e=="bigint"&&Ca<=e;function s3(e,t,n){return La(e)&&La(t)&&La(n)&&t<=e&&e<n}function o3(e,t,n,r){if(!s3(t,n,r))throw new Error("expected valid "+e+": "+n+" <= n < "+r+", got "+t)}function Kh(e){let t;for(t=0;e>Ca;e>>=Pa,t+=1);return t}const li=e=>(Pa<<BigInt(e))-Pa;function a3(e,t,n){if(typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");const r=l=>new Uint8Array(l),i=l=>Uint8Array.of(l);let s=r(e),o=r(e),a=0;const c=()=>{s.fill(1),o.fill(0),a=0},f=(...l)=>n(o,s,...l),u=(l=r(0))=>{o=f(i(0),l),s=f(),l.length!==0&&(o=f(i(1),l),s=f())},d=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let l=0;const g=[];for(;l<t;){s=f();const w=s.slice();g.push(w),l+=s.length}return Ht(...g)};return(l,g)=>{c(),u(l);let w;for(;!(w=g(d()));)u();return c(),w}}function Ua(e,t,n={}){if(!e||typeof e!="object")throw new Error("expected valid options object");function r(i,s,o){const a=e[i];if(o&&a===void 0)return;const c=typeof a;if(c!==s||a===null)throw new Error(`param "${i}" is invalid: expected ${s}, got ${c}`)}Object.entries(t).forEach(([i,s])=>r(i,s,!1)),Object.entries(n).forEach(([i,s])=>r(i,s,!0))}function Gh(e){const t=new WeakMap;return(n,...r)=>{const i=t.get(n);if(i!==void 0)return i;const s=e(n,...r);return t.set(n,s),s}}const Je=BigInt(0),qe=BigInt(1),Yn=BigInt(2),Zh=BigInt(3),Yh=BigInt(4),Wh=BigInt(5),c3=BigInt(7),Xh=BigInt(8),f3=BigInt(9),Jh=BigInt(16);function St(e,t){const n=e%t;return n>=Je?n:t+n}function pt(e,t,n){let r=e;for(;t-- >Je;)r*=r,r%=n;return r}function Qh(e,t){if(e===Je)throw new Error("invert: expected non-zero number");if(t<=Je)throw new Error("invert: expected positive modulus, got "+t);let n=St(e,t),r=t,i=Je,s=qe;for(;n!==Je;){const a=r/n,c=r%n,f=i-s*a;r=n,n=c,i=s,s=f}if(r!==qe)throw new Error("invert: does not exist");return St(i,t)}function Fa(e,t,n){if(!e.eql(e.sqr(t),n))throw new Error("Cannot find square root")}function ed(e,t){const n=(e.ORDER+qe)/Yh,r=e.pow(t,n);return Fa(e,r,t),r}function u3(e,t){const n=(e.ORDER-Wh)/Xh,r=e.mul(t,Yn),i=e.pow(r,n),s=e.mul(t,i),o=e.mul(e.mul(s,Yn),i),a=e.mul(s,e.sub(o,e.ONE));return Fa(e,a,t),a}function l3(e){const t=hi(e),n=td(e),r=n(t,t.neg(t.ONE)),i=n(t,r),s=n(t,t.neg(r)),o=(e+c3)/Jh;return(a,c)=>{let f=a.pow(c,o),u=a.mul(f,r);const d=a.mul(f,i),h=a.mul(f,s),l=a.eql(a.sqr(u),c),g=a.eql(a.sqr(d),c);f=a.cmov(f,u,l),u=a.cmov(h,d,g);const w=a.eql(a.sqr(u),c),v=a.cmov(f,u,w);return Fa(a,v,c),v}}function td(e){if(e<Zh)throw new Error("sqrt is not defined for small field");let t=e-qe,n=0;for(;t%Yn===Je;)t/=Yn,n++;let r=Yn;const i=hi(e);for(;rd(i,r)===1;)if(r++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(n===1)return ed;let s=i.pow(r,t);const o=(t+qe)/Yn;return function(c,f){if(c.is0(f))return f;if(rd(c,f)!==1)throw new Error("Cannot find square root");let u=n,d=c.mul(c.ONE,s),h=c.pow(f,t),l=c.pow(f,o);for(;!c.eql(h,c.ONE);){if(c.is0(h))return c.ZERO;let g=1,w=c.sqr(h);for(;!c.eql(w,c.ONE);)if(g++,w=c.sqr(w),g===u)throw new Error("Cannot find square root");const v=qe<<BigInt(u-g-1),A=c.pow(d,v);u=g,d=c.sqr(A),h=c.mul(h,d),l=c.mul(l,A)}return l}}function h3(e){return e%Yh===Zh?ed:e%Xh===Wh?u3:e%Jh===f3?l3(e):td(e)}const d3=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function g3(e){const t={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},n=d3.reduce((r,i)=>(r[i]="function",r),t);return Ua(e,n),e}function p3(e,t,n){if(n<Je)throw new Error("invalid exponent, negatives unsupported");if(n===Je)return e.ONE;if(n===qe)return t;let r=e.ONE,i=t;for(;n>Je;)n&qe&&(r=e.mul(r,i)),i=e.sqr(i),n>>=qe;return r}function nd(e,t,n=!1){const r=new Array(t.length).fill(n?e.ZERO:void 0),i=t.reduce((o,a,c)=>e.is0(a)?o:(r[c]=o,e.mul(o,a)),e.ONE),s=e.inv(i);return t.reduceRight((o,a,c)=>e.is0(a)?o:(r[c]=e.mul(o,r[c]),e.mul(o,a)),s),r}function rd(e,t){const n=(e.ORDER-qe)/Yn,r=e.pow(t,n),i=e.eql(r,e.ONE),s=e.eql(r,e.ZERO),o=e.eql(r,e.neg(e.ONE));if(!i&&!s&&!o)throw new Error("invalid Legendre symbol result");return i?1:s?0:-1}function id(e,t){t!==void 0&&br(t);const n=t!==void 0?t:e.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function hi(e,t,n=!1,r={}){if(e<=Je)throw new Error("invalid field: expected ORDER > 0, got "+e);let i,s,o=!1,a;if(typeof t=="object"&&t!=null){if(r.sqrt||n)throw new Error("cannot specify opts in two arguments");const h=t;h.BITS&&(i=h.BITS),h.sqrt&&(s=h.sqrt),typeof h.isLE=="boolean"&&(n=h.isLE),typeof h.modFromBytes=="boolean"&&(o=h.modFromBytes),a=h.allowedLengths}else typeof t=="number"&&(i=t),r.sqrt&&(s=r.sqrt);const{nBitLength:c,nByteLength:f}=id(e,i);if(f>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let u;const d=Object.freeze({ORDER:e,isLE:n,BITS:c,BYTES:f,MASK:li(c),ZERO:Je,ONE:qe,allowedLengths:a,create:h=>St(h,e),isValid:h=>{if(typeof h!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof h);return Je<=h&&h<e},is0:h=>h===Je,isValidNot0:h=>!d.is0(h)&&d.isValid(h),isOdd:h=>(h&qe)===qe,neg:h=>St(-h,e),eql:(h,l)=>h===l,sqr:h=>St(h*h,e),add:(h,l)=>St(h+l,e),sub:(h,l)=>St(h-l,e),mul:(h,l)=>St(h*l,e),pow:(h,l)=>p3(d,h,l),div:(h,l)=>St(h*Qh(l,e),e),sqrN:h=>h*h,addN:(h,l)=>h+l,subN:(h,l)=>h-l,mulN:(h,l)=>h*l,inv:h=>Qh(h,e),sqrt:s||(h=>(u||(u=h3(e)),u(d,h))),toBytes:h=>n?Vh(h,f):$a(h,f),fromBytes:(h,l=!0)=>{if(a){if(!a.includes(h.length)||h.length>f)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+h.length);const w=new Uint8Array(f);w.set(h,n?0:w.length-h.length),h=w}if(h.length!==f)throw new Error("Field.fromBytes: expected "+f+" bytes, got "+h.length);let g=n?Hh(h):Bs(h);if(o&&(g=St(g,e)),!l&&!d.isValid(g))throw new Error("invalid field element: outside of range 0..ORDER");return g},invertBatch:h=>nd(d,h),cmov:(h,l,g)=>g?l:h});return Object.freeze(d)}function sd(e){if(typeof e!="bigint")throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function od(e){const t=sd(e);return t+Math.ceil(t/2)}function b3(e,t,n=!1){const r=e.length,i=sd(t),s=od(t);if(r<16||r<s||r>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+r);const o=n?Hh(e):Bs(e),a=St(o,t-qe)+qe;return n?Vh(a,i):$a(a,i)}const Ir=BigInt(0),Wn=BigInt(1);function As(e,t){const n=t.negate();return e?n:t}function ja(e,t){const n=nd(e.Fp,t.map(r=>r.Z));return t.map((r,i)=>e.fromAffine(r.toAffine(n[i])))}function ad(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function ka(e,t){ad(e,t);const n=Math.ceil(t/e)+1,r=2**(e-1),i=2**e,s=li(e),o=BigInt(e);return{windows:n,windowSize:r,mask:s,maxNumber:i,shiftBy:o}}function cd(e,t,n){const{windowSize:r,mask:i,maxNumber:s,shiftBy:o}=n;let a=Number(e&i),c=e>>o;a>r&&(a-=s,c+=Wn);const f=t*r,u=f+Math.abs(a)-1,d=a===0,h=a<0,l=t%2!==0;return{nextN:c,offset:u,isZero:d,isNeg:h,isNegF:l,offsetF:f}}function y3(e,t){if(!Array.isArray(e))throw new Error("array expected");e.forEach((n,r)=>{if(!(n instanceof t))throw new Error("invalid point at index "+r)})}function w3(e,t){if(!Array.isArray(e))throw new Error("array of scalars expected");e.forEach((n,r)=>{if(!t.isValid(n))throw new Error("invalid scalar at index "+r)})}const Ma=new WeakMap,fd=new WeakMap;function za(e){return fd.get(e)||1}function ud(e){if(e!==Ir)throw new Error("invalid wNAF")}class m3{constructor(t,n){this.BASE=t.BASE,this.ZERO=t.ZERO,this.Fn=t.Fn,this.bits=n}_unsafeLadder(t,n,r=this.ZERO){let i=t;for(;n>Ir;)n&Wn&&(r=r.add(i)),i=i.double(),n>>=Wn;return r}precomputeWindow(t,n){const{windows:r,windowSize:i}=ka(n,this.bits),s=[];let o=t,a=o;for(let c=0;c<r;c++){a=o,s.push(a);for(let f=1;f<i;f++)a=a.add(o),s.push(a);o=a.double()}return s}wNAF(t,n,r){if(!this.Fn.isValid(r))throw new Error("invalid scalar");let i=this.ZERO,s=this.BASE;const o=ka(t,this.bits);for(let a=0;a<o.windows;a++){const{nextN:c,offset:f,isZero:u,isNeg:d,isNegF:h,offsetF:l}=cd(r,a,o);r=c,u?s=s.add(As(h,n[l])):i=i.add(As(d,n[f]))}return ud(r),{p:i,f:s}}wNAFUnsafe(t,n,r,i=this.ZERO){const s=ka(t,this.bits);for(let o=0;o<s.windows&&r!==Ir;o++){const{nextN:a,offset:c,isZero:f,isNeg:u}=cd(r,o,s);if(r=a,!f){const d=n[c];i=i.add(u?d.negate():d)}}return ud(r),i}getPrecomputes(t,n,r){let i=Ma.get(n);return i||(i=this.precomputeWindow(n,t),t!==1&&(typeof r=="function"&&(i=r(i)),Ma.set(n,i))),i}cached(t,n,r){const i=za(t);return this.wNAF(i,this.getPrecomputes(i,t,r),n)}unsafe(t,n,r,i){const s=za(t);return s===1?this._unsafeLadder(t,n,i):this.wNAFUnsafe(s,this.getPrecomputes(s,t,r),n,i)}createCache(t,n){ad(n,this.bits),fd.set(t,n),Ma.delete(t)}hasCache(t){return za(t)!==1}}function E3(e,t,n,r){let i=t,s=e.ZERO,o=e.ZERO;for(;n>Ir||r>Ir;)n&Wn&&(s=s.add(i)),r&Wn&&(o=o.add(i)),i=i.double(),n>>=Wn,r>>=Wn;return{p1:s,p2:o}}function v3(e,t,n,r){y3(n,e),w3(r,t);const i=n.length,s=r.length;if(i!==s)throw new Error("arrays of points and scalars must have equal length");const o=e.ZERO,a=Kh(BigInt(i));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const f=li(c),u=new Array(Number(f)+1).fill(o),d=Math.floor((t.BITS-1)/c)*c;let h=o;for(let l=d;l>=0;l-=c){u.fill(o);for(let w=0;w<s;w++){const v=r[w],A=Number(v>>BigInt(l)&f);u[A]=u[A].add(n[w])}let g=o;for(let w=u.length-1,v=o;w>0;w--)v=v.add(u[w]),g=g.add(v);if(h=h.add(g),l!==0)for(let w=0;w<c;w++)h=h.double()}return h}function ld(e,t,n){if(t){if(t.ORDER!==e)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return g3(t),t}else return hi(e,{isLE:n})}function _3(e,t,n={},r){if(r===void 0&&(r=e==="edwards"),!t||typeof t!="object")throw new Error(`expected valid ${e} CURVE object`);for(const c of["p","n","h"]){const f=t[c];if(!(typeof f=="bigint"&&f>Ir))throw new Error(`CURVE.${c} must be positive bigint`)}const i=ld(t.p,n.Fp,r),s=ld(t.n,n.Fn,r),a=["Gx","Gy","a",e==="weierstrass"?"b":"d"];for(const c of a)if(!i.isValid(t[c]))throw new Error(`CURVE.${c} must be valid field element of CURVE.Fp`);return t=Object.freeze(Object.assign({},t)),{CURVE:t,Fp:i,Fn:s}}const hd=(e,t)=>(e+(e>=0?t:-t)/dd)/t;function x3(e,t,n){const[[r,i],[s,o]]=t,a=hd(o*e,n),c=hd(-i*e,n);let f=e-a*r-c*s,u=-a*i-c*o;const d=f<Jt,h=u<Jt;d&&(f=-f),h&&(u=-u);const l=li(Math.ceil(Kh(n)/2))+Or;if(f<Jt||f>=l||u<Jt||u>=l)throw new Error("splitScalar (endomorphism): failed, k="+e);return{k1neg:d,k1:f,k2neg:h,k2:u}}function qa(e){if(!["compact","recovered","der"].includes(e))throw new Error('Signature format must be "compact", "recovered", or "der"');return e}function Ha(e,t){const n={};for(let r of Object.keys(t))n[r]=e[r]===void 0?t[r]:e[r];return Is(n.lowS,"lowS"),Is(n.prehash,"prehash"),n.format!==void 0&&qa(n.format),n}class S3 extends Error{constructor(t=""){super(t)}}const Xt={Err:S3,_tlv:{encode:(e,t)=>{const{Err:n}=Xt;if(e<0||e>256)throw new n("tlv.encode: wrong tag");if(t.length&1)throw new n("tlv.encode: unpadded data");const r=t.length/2,i=Os(r);if(i.length/2&128)throw new n("tlv.encode: long form length too big");const s=r>127?Os(i.length/2|128):"";return Os(e)+s+i+t},decode(e,t){const{Err:n}=Xt;let r=0;if(e<0||e>256)throw new n("tlv.encode: wrong tag");if(t.length<2||t[r++]!==e)throw new n("tlv.decode: wrong tlv");const i=t[r++],s=!!(i&128);let o=0;if(!s)o=i;else{const c=i&127;if(!c)throw new n("tlv.decode(long): indefinite length not supported");if(c>4)throw new n("tlv.decode(long): byte length is too big");const f=t.subarray(r,r+c);if(f.length!==c)throw new n("tlv.decode: length bytes not complete");if(f[0]===0)throw new n("tlv.decode(long): zero leftmost byte");for(const u of f)o=o<<8|u;if(r+=c,o<128)throw new n("tlv.decode(long): not minimal encoding")}const a=t.subarray(r,r+o);if(a.length!==o)throw new n("tlv.decode: wrong value length");return{v:a,l:t.subarray(r+o)}}},_int:{encode(e){const{Err:t}=Xt;if(e<Jt)throw new t("integer: negative integers are not allowed");let n=Os(e);if(Number.parseInt(n[0],16)&8&&(n="00"+n),n.length&1)throw new t("unexpected DER parsing assertion: unpadded hex");return n},decode(e){const{Err:t}=Xt;if(e[0]&128)throw new t("invalid signature integer: negative");if(e[0]===0&&!(e[1]&128))throw new t("invalid signature integer: unnecessary leading zero");return Bs(e)}},toSig(e){const{Err:t,_int:n,_tlv:r}=Xt,i=Xe("signature",e),{v:s,l:o}=r.decode(48,i);if(o.length)throw new t("invalid signature: left bytes after parsing");const{v:a,l:c}=r.decode(2,s),{v:f,l:u}=r.decode(2,c);if(u.length)throw new t("invalid signature: left bytes after parsing");return{r:n.decode(a),s:n.decode(f)}},hexFromSig(e){const{_tlv:t,_int:n}=Xt,r=t.encode(2,n.encode(e.r)),i=t.encode(2,n.encode(e.s)),s=r+i;return t.encode(48,s)}},Jt=BigInt(0),Or=BigInt(1),dd=BigInt(2),Ds=BigInt(3),I3=BigInt(4);function Br(e,t){const{BYTES:n}=e;let r;if(typeof t=="bigint")r=t;else{let i=Xe("private key",t);try{r=e.fromBytes(i)}catch{throw new Error(`invalid private key: expected ui8a of size ${n}, got ${typeof t}`)}}if(!e.isValidNot0(r))throw new Error("invalid private key: out of range [1..N-1]");return r}function O3(e,t={}){const n=_3("weierstrass",e,t),{Fp:r,Fn:i}=n;let s=n.CURVE;const{h:o,n:a}=s;Ua(t,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:c}=t;if(c&&(!r.is0(s.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const f=pd(r,i);function u(){if(!r.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function d(E,b,m){const{x:p,y}=b.toAffine(),S=r.toBytes(p);if(Is(m,"isCompressed"),m){u();const I=!r.isOdd(y);return Ht(gd(I),S)}else return Ht(Uint8Array.of(4),S,r.toBytes(y))}function h(E){Zn(E,void 0,"Point");const{publicKey:b,publicKeyUncompressed:m}=f,p=E.length,y=E[0],S=E.subarray(1);if(p===b&&(y===2||y===3)){const I=r.fromBytes(S);if(!r.isValid(I))throw new Error("bad point: is not on curve, wrong x");const O=w(I);let B;try{B=r.sqrt(O)}catch(P){const F=P instanceof Error?": "+P.message:"";throw new Error("bad point: is not on curve, sqrt error"+F)}u();const T=r.isOdd(B);return(y&1)===1!==T&&(B=r.neg(B)),{x:I,y:B}}else if(p===m&&y===4){const I=r.BYTES,O=r.fromBytes(S.subarray(0,I)),B=r.fromBytes(S.subarray(I,I*2));if(!v(O,B))throw new Error("bad point: is not on curve");return{x:O,y:B}}else throw new Error(`bad point: got length ${p}, expected compressed=${b} or uncompressed=${m}`)}const l=t.toBytes||d,g=t.fromBytes||h;function w(E){const b=r.sqr(E),m=r.mul(b,E);return r.add(r.add(m,r.mul(E,s.a)),s.b)}function v(E,b){const m=r.sqr(b),p=w(E);return r.eql(m,p)}if(!v(s.Gx,s.Gy))throw new Error("bad curve params: generator point");const A=r.mul(r.pow(s.a,Ds),I3),C=r.mul(r.sqr(s.b),BigInt(27));if(r.is0(r.add(A,C)))throw new Error("bad curve params: a or b");function x(E,b,m=!1){if(!r.isValid(b)||m&&r.is0(b))throw new Error(`bad point coordinate ${E}`);return b}function _(E){if(!(E instanceof D))throw new Error("ProjectivePoint expected")}function R(E){if(!c||!c.basises)throw new Error("no endo");return x3(E,c.basises,i.ORDER)}const L=Gh((E,b)=>{const{X:m,Y:p,Z:y}=E;if(r.eql(y,r.ONE))return{x:m,y:p};const S=E.is0();b==null&&(b=S?r.ONE:r.inv(y));const I=r.mul(m,b),O=r.mul(p,b),B=r.mul(y,b);if(S)return{x:r.ZERO,y:r.ZERO};if(!r.eql(B,r.ONE))throw new Error("invZ was invalid");return{x:I,y:O}}),j=Gh(E=>{if(E.is0()){if(t.allowInfinityPoint&&!r.is0(E.Y))return;throw new Error("bad point: ZERO")}const{x:b,y:m}=E.toAffine();if(!r.isValid(b)||!r.isValid(m))throw new Error("bad point: x or y not field elements");if(!v(b,m))throw new Error("bad point: equation left != right");if(!E.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function U(E,b,m,p,y){return m=new D(r.mul(m.X,E),m.Y,m.Z),b=As(p,b),m=As(y,m),b.add(m)}class D{constructor(b,m,p){this.X=x("x",b),this.Y=x("y",m,!0),this.Z=x("z",p),Object.freeze(this)}static CURVE(){return s}static fromAffine(b){const{x:m,y:p}=b||{};if(!b||!r.isValid(m)||!r.isValid(p))throw new Error("invalid affine point");if(b instanceof D)throw new Error("projective point not allowed");return r.is0(m)&&r.is0(p)?D.ZERO:new D(m,p,r.ONE)}static fromBytes(b){const m=D.fromAffine(g(Zn(b,void 0,"point")));return m.assertValidity(),m}static fromHex(b){return D.fromBytes(Xe("pointHex",b))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(b=8,m=!0){return M.createCache(this,b),m||this.multiply(Ds),this}assertValidity(){j(this)}hasEvenY(){const{y:b}=this.toAffine();if(!r.isOdd)throw new Error("Field doesn't support isOdd");return!r.isOdd(b)}equals(b){_(b);const{X:m,Y:p,Z:y}=this,{X:S,Y:I,Z:O}=b,B=r.eql(r.mul(m,O),r.mul(S,y)),T=r.eql(r.mul(p,O),r.mul(I,y));return B&&T}negate(){return new D(this.X,r.neg(this.Y),this.Z)}double(){const{a:b,b:m}=s,p=r.mul(m,Ds),{X:y,Y:S,Z:I}=this;let O=r.ZERO,B=r.ZERO,T=r.ZERO,$=r.mul(y,y),P=r.mul(S,S),F=r.mul(I,I),N=r.mul(y,S);return N=r.add(N,N),T=r.mul(y,I),T=r.add(T,T),O=r.mul(b,T),B=r.mul(p,F),B=r.add(O,B),O=r.sub(P,B),B=r.add(P,B),B=r.mul(O,B),O=r.mul(N,O),T=r.mul(p,T),F=r.mul(b,F),N=r.sub($,F),N=r.mul(b,N),N=r.add(N,T),T=r.add($,$),$=r.add(T,$),$=r.add($,F),$=r.mul($,N),B=r.add(B,$),F=r.mul(S,I),F=r.add(F,F),$=r.mul(F,N),O=r.sub(O,$),T=r.mul(F,P),T=r.add(T,T),T=r.add(T,T),new D(O,B,T)}add(b){_(b);const{X:m,Y:p,Z:y}=this,{X:S,Y:I,Z:O}=b;let B=r.ZERO,T=r.ZERO,$=r.ZERO;const P=s.a,F=r.mul(s.b,Ds);let N=r.mul(m,S),k=r.mul(p,I),z=r.mul(y,O),G=r.add(m,p),H=r.add(S,I);G=r.mul(G,H),H=r.add(N,k),G=r.sub(G,H),H=r.add(m,y);let K=r.add(S,O);return H=r.mul(H,K),K=r.add(N,z),H=r.sub(H,K),K=r.add(p,y),B=r.add(I,O),K=r.mul(K,B),B=r.add(k,z),K=r.sub(K,B),$=r.mul(P,H),B=r.mul(F,z),$=r.add(B,$),B=r.sub(k,$),$=r.add(k,$),T=r.mul(B,$),k=r.add(N,N),k=r.add(k,N),z=r.mul(P,z),H=r.mul(F,H),k=r.add(k,z),z=r.sub(N,z),z=r.mul(P,z),H=r.add(H,z),N=r.mul(k,H),T=r.add(T,N),N=r.mul(K,H),B=r.mul(G,B),B=r.sub(B,N),N=r.mul(G,k),$=r.mul(K,$),$=r.add($,N),new D(B,T,$)}subtract(b){return this.add(b.negate())}is0(){return this.equals(D.ZERO)}multiply(b){const{endo:m}=t;if(!i.isValidNot0(b))throw new Error("invalid scalar: out of range");let p,y;const S=I=>M.cached(this,I,O=>ja(D,O));if(m){const{k1neg:I,k1:O,k2neg:B,k2:T}=R(b),{p:$,f:P}=S(O),{p:F,f:N}=S(T);y=P.add(N),p=U(m.beta,$,F,I,B)}else{const{p:I,f:O}=S(b);p=I,y=O}return ja(D,[p,y])[0]}multiplyUnsafe(b){const{endo:m}=t,p=this;if(!i.isValid(b))throw new Error("invalid scalar: out of range");if(b===Jt||p.is0())return D.ZERO;if(b===Or)return p;if(M.hasCache(this))return this.multiply(b);if(m){const{k1neg:y,k1:S,k2neg:I,k2:O}=R(b),{p1:B,p2:T}=E3(D,p,S,O);return U(m.beta,B,T,y,I)}else return M.unsafe(p,b)}multiplyAndAddUnsafe(b,m,p){const y=this.multiplyUnsafe(m).add(b.multiplyUnsafe(p));return y.is0()?void 0:y}toAffine(b){return L(this,b)}isTorsionFree(){const{isTorsionFree:b}=t;return o===Or?!0:b?b(D,this):M.unsafe(this,a).is0()}clearCofactor(){const{clearCofactor:b}=t;return o===Or?this:b?b(D,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes(b=!0){return Is(b,"isCompressed"),this.assertValidity(),l(D,this,b)}toHex(b=!0){return wr(this.toBytes(b))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(b=!0){return this.toBytes(b)}_setWindowSize(b){this.precompute(b)}static normalizeZ(b){return ja(D,b)}static msm(b,m){return v3(D,i,b,m)}static fromPrivateKey(b){return D.BASE.multiply(Br(i,b))}}D.BASE=new D(s.Gx,s.Gy,r.ONE),D.ZERO=new D(r.ZERO,r.ONE,r.ZERO),D.Fp=r,D.Fn=i;const q=i.BITS,M=new m3(D,t.endo?Math.ceil(q/2):q);return D.BASE.precompute(8),D}function gd(e){return Uint8Array.of(e?2:3)}function pd(e,t){return{secretKey:t.BYTES,publicKey:1+e.BYTES,publicKeyUncompressed:1+2*e.BYTES,publicKeyHasPrefix:!0,signature:2*t.BYTES}}function B3(e,t={}){const{Fn:n}=e,r=t.randomBytes||fs,i=Object.assign(pd(e.Fp,n),{seed:od(n.ORDER)});function s(l){try{return!!Br(n,l)}catch{return!1}}function o(l,g){const{publicKey:w,publicKeyUncompressed:v}=i;try{const A=l.length;return g===!0&&A!==w||g===!1&&A!==v?!1:!!e.fromBytes(l)}catch{return!1}}function a(l=r(i.seed)){return b3(Zn(l,i.seed,"seed"),n.ORDER)}function c(l,g=!0){return e.BASE.multiply(Br(n,l)).toBytes(g)}function f(l){const g=a(l);return{secretKey:g,publicKey:c(g)}}function u(l){if(typeof l=="bigint")return!1;if(l instanceof e)return!0;const{secretKey:g,publicKey:w,publicKeyUncompressed:v}=i;if(n.allowedLengths||g===w)return;const A=Xe("key",l).length;return A===w||A===v}function d(l,g,w=!0){if(u(l)===!0)throw new Error("first arg must be private key");if(u(g)===!1)throw new Error("second arg must be public key");const v=Br(n,l);return e.fromHex(g).multiply(v).toBytes(w)}return Object.freeze({getPublicKey:c,getSharedSecret:d,keygen:f,Point:e,utils:{isValidSecretKey:s,isValidPublicKey:o,randomSecretKey:a,isValidPrivateKey:s,randomPrivateKey:a,normPrivateKeyToScalar:l=>Br(n,l),precompute(l=8,g=e.BASE){return g.precompute(l,!1)}},lengths:i})}function A3(e,t,n={}){Ul(t),Ua(n,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const r=n.randomBytes||fs,i=n.hmac||((m,...p)=>ba(t,m,Ht(...p))),{Fp:s,Fn:o}=e,{ORDER:a,BITS:c}=o,{keygen:f,getPublicKey:u,getSharedSecret:d,utils:h,lengths:l}=B3(e,n),g={prehash:!1,lowS:typeof n.lowS=="boolean"?n.lowS:!1,format:void 0,extraEntropy:!1},w="compact";function v(m){const p=a>>Or;return m>p}function A(m,p){if(!o.isValidNot0(p))throw new Error(`invalid signature ${m}: out of range 1..Point.Fn.ORDER`);return p}function C(m,p){qa(p);const y=l.signature,S=p==="compact"?y:p==="recovered"?y+1:void 0;return Zn(m,S,`${p} signature`)}class x{constructor(p,y,S){this.r=A("r",p),this.s=A("s",y),S!=null&&(this.recovery=S),Object.freeze(this)}static fromBytes(p,y=w){C(p,y);let S;if(y==="der"){const{r:T,s:$}=Xt.toSig(Zn(p));return new x(T,$)}y==="recovered"&&(S=p[0],y="compact",p=p.subarray(1));const I=o.BYTES,O=p.subarray(0,I),B=p.subarray(I,I*2);return new x(o.fromBytes(O),o.fromBytes(B),S)}static fromHex(p,y){return this.fromBytes(os(p),y)}addRecoveryBit(p){return new x(this.r,this.s,p)}recoverPublicKey(p){const y=s.ORDER,{r:S,s:I,recovery:O}=this;if(O==null||![0,1,2,3].includes(O))throw new Error("recovery id invalid");if(a*dd<y&&O>1)throw new Error("recovery id is ambiguous for h>1 curve");const T=O===2||O===3?S+a:S;if(!s.isValid(T))throw new Error("recovery id 2 or 3 invalid");const $=s.toBytes(T),P=e.fromBytes(Ht(gd((O&1)===0),$)),F=o.inv(T),N=R(Xe("msgHash",p)),k=o.create(-N*F),z=o.create(I*F),G=e.BASE.multiplyUnsafe(k).add(P.multiplyUnsafe(z));if(G.is0())throw new Error("point at infinify");return G.assertValidity(),G}hasHighS(){return v(this.s)}toBytes(p=w){if(qa(p),p==="der")return os(Xt.hexFromSig(this));const y=o.toBytes(this.r),S=o.toBytes(this.s);if(p==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return Ht(Uint8Array.of(this.recovery),y,S)}return Ht(y,S)}toHex(p){return wr(this.toBytes(p))}assertValidity(){}static fromCompact(p){return x.fromBytes(Xe("sig",p),"compact")}static fromDER(p){return x.fromBytes(Xe("sig",p),"der")}normalizeS(){return this.hasHighS()?new x(this.r,o.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return wr(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return wr(this.toBytes("compact"))}}const _=n.bits2int||function(p){if(p.length>8192)throw new Error("input is too large");const y=Bs(p),S=p.length*8-c;return S>0?y>>BigInt(S):y},R=n.bits2int_modN||function(p){return o.create(_(p))},L=li(c);function j(m){return o3("num < 2^"+c,m,Jt,L),o.toBytes(m)}function U(m,p){return Zn(m,void 0,"message"),p?Zn(t(m),void 0,"prehashed message"):m}function D(m,p,y){if(["recovered","canonical"].some(k=>k in y))throw new Error("sign() legacy options not supported");const{lowS:S,prehash:I,extraEntropy:O}=Ha(y,g);m=U(m,I);const B=R(m),T=Br(o,p),$=[j(T),j(B)];if(O!=null&&O!==!1){const k=O===!0?r(l.secretKey):O;$.push(Xe("extraEntropy",k))}const P=Ht(...$),F=B;function N(k){const z=_(k);if(!o.isValidNot0(z))return;const G=o.inv(z),H=e.BASE.multiply(z).toAffine(),K=o.create(H.x);if(K===Jt)return;const J=o.create(G*o.create(F+K*T));if(J===Jt)return;let ee=(H.x===K?0:2)|Number(H.y&Or),re=J;return S&&v(J)&&(re=o.neg(J),ee^=1),new x(K,re,ee)}return{seed:P,k2sig:N}}function q(m,p,y={}){m=Xe("message",m);const{seed:S,k2sig:I}=D(m,p,y);return a3(t.outputLen,o.BYTES,i)(S,I)}function M(m){let p;const y=typeof m=="string"||ss(m),S=!y&&m!==null&&typeof m=="object"&&typeof m.r=="bigint"&&typeof m.s=="bigint";if(!y&&!S)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(S)p=new x(m.r,m.s);else if(y){try{p=x.fromBytes(Xe("sig",m),"der")}catch(I){if(!(I instanceof Xt.Err))throw I}if(!p)try{p=x.fromBytes(Xe("sig",m),"compact")}catch{return!1}}return p||!1}function E(m,p,y,S={}){const{lowS:I,prehash:O,format:B}=Ha(S,g);if(y=Xe("publicKey",y),p=U(Xe("message",p),O),"strict"in S)throw new Error("options.strict was renamed to lowS");const T=B===void 0?M(m):x.fromBytes(Xe("sig",m),B);if(T===!1)return!1;try{const $=e.fromBytes(y);if(I&&T.hasHighS())return!1;const{r:P,s:F}=T,N=R(p),k=o.inv(F),z=o.create(N*k),G=o.create(P*k),H=e.BASE.multiplyUnsafe(z).add($.multiplyUnsafe(G));return H.is0()?!1:o.create(H.x)===P}catch{return!1}}function b(m,p,y={}){const{prehash:S}=Ha(y,g);return p=U(p,S),x.fromBytes(m,"recovered").recoverPublicKey(p).toBytes()}return Object.freeze({keygen:f,getPublicKey:u,getSharedSecret:d,utils:h,lengths:l,Point:e,sign:q,verify:E,recoverPublicKey:b,Signature:x,hash:t})}function D3(e){const t={a:e.a,b:e.b,p:e.Fp.ORDER,n:e.n,h:e.h,Gx:e.Gx,Gy:e.Gy},n=e.Fp;let r=e.allowedPrivateKeyLengths?Array.from(new Set(e.allowedPrivateKeyLengths.map(o=>Math.ceil(o/2)))):void 0;const i=hi(t.n,{BITS:e.nBitLength,allowedLengths:r,modFromBytes:e.wrapPrivateKey}),s={Fp:n,Fn:i,allowInfinityPoint:e.allowInfinityPoint,endo:e.endo,isTorsionFree:e.isTorsionFree,clearCofactor:e.clearCofactor,fromBytes:e.fromBytes,toBytes:e.toBytes};return{CURVE:t,curveOpts:s}}function T3(e){const{CURVE:t,curveOpts:n}=D3(e),r={hmac:e.hmac,randomBytes:e.randomBytes,lowS:e.lowS,bits2int:e.bits2int,bits2int_modN:e.bits2int_modN};return{CURVE:t,curveOpts:n,hash:e.hash,ecdsaOpts:r}}function R3(e,t){const n=t.Point;return Object.assign({},t,{ProjectivePoint:n,CURVE:Object.assign({},e,id(n.Fn.ORDER,n.Fn.BITS))})}function N3(e){const{CURVE:t,curveOpts:n,hash:r,ecdsaOpts:i}=T3(e),s=O3(t,n),o=A3(s,r,i);return R3(e,o)}function C3(e,t){const n=r=>N3({...e,hash:r});return{...n(t),create:n}}na("HashToScalar-");const Va={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},P3={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),basises:[[BigInt("0x3086d221a7d46bcde86c90e49284eb15"),-BigInt("0xe4437ed6010e88286f547fa90abfe4c3")],[BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),BigInt("0x3086d221a7d46bcde86c90e49284eb15")]]},bd=BigInt(2);function $3(e){const t=Va.p,n=BigInt(3),r=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),f=e*e*e%t,u=f*f*e%t,d=pt(u,n,t)*u%t,h=pt(d,n,t)*u%t,l=pt(h,bd,t)*f%t,g=pt(l,i,t)*l%t,w=pt(g,s,t)*g%t,v=pt(w,a,t)*w%t,A=pt(v,c,t)*v%t,C=pt(A,a,t)*w%t,x=pt(C,n,t)*u%t,_=pt(x,o,t)*g%t,R=pt(_,r,t)*f%t,L=pt(R,bd,t);if(!Ka.eql(Ka.sqr(L),e))throw new Error("Cannot find square root");return L}const Ka=hi(Va.p,{sqrt:$3});C3({...Va,Fp:Ka,lowS:!0,endo:P3},vr);/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Ar(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function Ga(e,...t){if(!Ar(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function yd(e,t){return Array.isArray(t)?t.length===0?!0:e?t.every(n=>typeof n=="string"):t.every(n=>Number.isSafeInteger(n)):!1}function Za(e){if(typeof e!="function")throw new Error("function expected");return!0}function vn(e,t){if(typeof t!="string")throw new Error(`${e}: string expected`);return!0}function Dr(e){if(!Number.isSafeInteger(e))throw new Error(`invalid integer: ${e}`)}function Ts(e){if(!Array.isArray(e))throw new Error("array expected")}function Rs(e,t){if(!yd(!0,t))throw new Error(`${e}: array of strings expected`)}function Ya(e,t){if(!yd(!1,t))throw new Error(`${e}: array of numbers expected`)}function Qe(...e){const t=s=>s,n=(s,o)=>a=>s(o(a)),r=e.map(s=>s.encode).reduceRight(n,t),i=e.map(s=>s.decode).reduce(n,t);return{encode:r,decode:i}}function at(e){const t=typeof e=="string"?e.split(""):e,n=t.length;Rs("alphabet",t);const r=new Map(t.map((i,s)=>[i,s]));return{encode:i=>(Ts(i),i.map(s=>{if(!Number.isSafeInteger(s)||s<0||s>=n)throw new Error(`alphabet.encode: digit index outside alphabet "${s}". Allowed: ${e}`);return t[s]})),decode:i=>(Ts(i),i.map(s=>{vn("alphabet.decode",s);const o=r.get(s);if(o===void 0)throw new Error(`Unknown letter: "${s}". Allowed: ${e}`);return o}))}}function ct(e=""){return vn("join",e),{encode:t=>(Rs("join.decode",t),t.join(e)),decode:t=>(vn("join.decode",t),t.split(e))}}function Ns(e,t="="){return Dr(e),vn("padding",t),{encode(n){for(Rs("padding.encode",n);n.length*e%8;)n.push(t);return n},decode(n){Rs("padding.decode",n);let r=n.length;if(r*e%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;r>0&&n[r-1]===t;r--)if((r-1)*e%8===0)throw new Error("padding: invalid, string has too much padding");return n.slice(0,r)}}}function wd(e){return Za(e),{encode:t=>t,decode:t=>e(t)}}function md(e,t,n){if(t<2)throw new Error(`convertRadix: invalid from=${t}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: invalid to=${n}, base cannot be less than 2`);if(Ts(e),!e.length)return[];let r=0;const i=[],s=Array.from(e,a=>{if(Dr(a),a<0||a>=t)throw new Error(`invalid integer: ${a}`);return a}),o=s.length;for(;;){let a=0,c=!0;for(let f=r;f<o;f++){const u=s[f],d=t*a,h=d+u;if(!Number.isSafeInteger(h)||d/t!==a||h-u!==d)throw new Error("convertRadix: carry overflow");const l=h/n;a=h%n;const g=Math.floor(l);if(s[f]=g,!Number.isSafeInteger(g)||g*n+a!==h)throw new Error("convertRadix: carry overflow");if(c)g?c=!1:r=f;else continue}if(i.push(a),c)break}for(let a=0;a<e.length-1&&e[a]===0;a++)i.push(0);return i.reverse()}const Ed=(e,t)=>t===0?e:Ed(t,e%t),Cs=(e,t)=>e+(t-Ed(e,t)),Ps=(()=>{let e=[];for(let t=0;t<40;t++)e.push(2**t);return e})();function Wa(e,t,n,r){if(Ts(e),t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(Cs(t,n)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${n} carryBits=${Cs(t,n)}`);let i=0,s=0;const o=Ps[t],a=Ps[n]-1,c=[];for(const f of e){if(Dr(f),f>=o)throw new Error(`convertRadix2: invalid data word=${f} from=${t}`);if(i=i<<t|f,s+t>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${t}`);for(s+=t;s>=n;s-=n)c.push((i>>s-n&a)>>>0);const u=Ps[s];if(u===void 0)throw new Error("invalid carry");i&=u-1}if(i=i<<n-s&a,!r&&s>=t)throw new Error("Excess padding");if(!r&&i>0)throw new Error(`Non-zero padding: ${i}`);return r&&s>0&&c.push(i>>>0),c}function L3(e){Dr(e);const t=2**8;return{encode:n=>{if(!Ar(n))throw new Error("radix.encode input should be Uint8Array");return md(Array.from(n),t,e)},decode:n=>(Ya("radix.decode",n),Uint8Array.from(md(n,e,t)))}}function bt(e,t=!1){if(Dr(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(Cs(8,e)>32||Cs(e,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!Ar(n))throw new Error("radix2.encode input should be Uint8Array");return Wa(Array.from(n),8,e,!t)},decode:n=>(Ya("radix2.decode",n),Uint8Array.from(Wa(n,e,8,t)))}}function vd(e){return Za(e),function(...t){try{return e.apply(null,t)}catch{}}}function U3(e,t){return Dr(e),Za(t),{encode(n){if(!Ar(n))throw new Error("checksum.encode: input should be Uint8Array");const r=t(n).slice(0,e),i=new Uint8Array(n.length+e);return i.set(n),i.set(r,n.length),i},decode(n){if(!Ar(n))throw new Error("checksum.decode: input should be Uint8Array");const r=n.slice(0,-e),i=n.slice(-e),s=t(r).slice(0,e);for(let o=0;o<e;o++)if(s[o]!==i[o])throw new Error("Invalid checksum");return r}}}const _d=typeof Uint8Array.from([]).toBase64=="function"&&typeof Uint8Array.fromBase64=="function",xd=(e,t)=>{vn("base64",e);const n=t?/^[A-Za-z0-9=_-]+$/:/^[A-Za-z0-9=+/]+$/,r=t?"base64url":"base64";if(e.length>0&&!n.test(e))throw new Error("invalid base64");return Uint8Array.fromBase64(e,{alphabet:r,lastChunkHandling:"strict"})},Xa=e=>Qe(L3(58),at(e),ct("")),F3=Xa("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),j3=e=>Qe(U3(4,t=>e(e(t))),F3),Ja=Qe(at("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),ct("")),Sd=[996825010,642813549,513874426,1027748829,705979059];function di(e){const t=e>>25;let n=(e&33554431)<<5;for(let r=0;r<Sd.length;r++)(t>>r&1)===1&&(n^=Sd[r]);return n}function Id(e,t,n=1){const r=e.length;let i=1;for(let s=0;s<r;s++){const o=e.charCodeAt(s);if(o<33||o>126)throw new Error(`Invalid prefix (${e})`);i=di(i)^o>>5}i=di(i);for(let s=0;s<r;s++)i=di(i)^e.charCodeAt(s)&31;for(let s of t)i=di(i)^s;for(let s=0;s<6;s++)i=di(i);return i^=n,Ja.encode(Wa([i%Ps[30]],30,5,!1))}function Od(e){const t=e==="bech32"?1:734539939,n=bt(5),r=n.decode,i=n.encode,s=vd(r);function o(d,h,l=90){vn("bech32.encode prefix",d),Ar(h)&&(h=Array.from(h)),Ya("bech32.encode",h);const g=d.length;if(g===0)throw new TypeError(`Invalid prefix length ${g}`);const w=g+7+h.length;if(l!==!1&&w>l)throw new TypeError(`Length ${w} exceeds limit ${l}`);const v=d.toLowerCase(),A=Id(v,h,t);return`${v}1${Ja.encode(h)}${A}`}function a(d,h=90){vn("bech32.decode input",d);const l=d.length;if(l<8||h!==!1&&l>h)throw new TypeError(`invalid string length: ${l} (${d}). Expected (8..${h})`);const g=d.toLowerCase();if(d!==g&&d!==d.toUpperCase())throw new Error("String must be lowercase or uppercase");const w=g.lastIndexOf("1");if(w===0||w===-1)throw new Error('Letter "1" must be present between prefix and data only');const v=g.slice(0,w),A=g.slice(w+1);if(A.length<6)throw new Error("Data must be at least 6 characters long");const C=Ja.decode(A).slice(0,-6),x=Id(v,C,t);if(!A.endsWith(x))throw new Error(`Invalid checksum in ${d}: expected "${x}"`);return{prefix:v,words:C}}const c=vd(a);function f(d){const{prefix:h,words:l}=a(d,!1);return{prefix:h,words:l,bytes:r(l)}}function u(d,h){return o(d,i(h))}return{encode:o,decode:a,encodeFromBytes:u,decodeToBytes:f,decodeUnsafe:c,fromWords:r,fromWordsUnsafe:s,toWords:i}}const k3=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",M3={encode(e){return Ga(e),e.toHex()},decode(e){return vn("hex",e),Uint8Array.fromHex(e)}};j3(vr),na("Bitcoin seed");/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */function Bd(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function $s(e,...t){if(!Bd(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function Ls(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Ad(e,t){$s(e);const n=t.outputLen;if(e.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function gi(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function Qa(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function z3(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function q3(e){if(typeof e!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}function pi(e){if(typeof e=="string")e=q3(e);else if(Bd(e))e=Dd(e);else throw new Error("Uint8Array expected, got "+typeof e);return e}function Dd(e){return Uint8Array.from(e)}const Qt=16,ec=new Uint8Array(16),$t=gi(ec),H3=225,V3=(e,t,n,r)=>{const i=r&1;return{s3:n<<31|r>>>1,s2:t<<31|n>>>1,s1:e<<31|t>>>1,s0:e>>>1^H3<<24&-(i&1)}},yt=e=>(e>>>0&255)<<24|(e>>>8&255)<<16|(e>>>16&255)<<8|e>>>24&255|0;function K3(e){e.reverse();const t=e[15]&1;let n=0;for(let r=0;r<e.length;r++){const i=e[r];e[r]=i>>>1|n,n=(i&1)<<7}return e[0]^=-t&225,e}const G3=e=>e>64*1024?8:e>1024?4:2;class Td{constructor(t,n){this.blockLen=Qt,this.outputLen=Qt,this.s0=0,this.s1=0,this.s2=0,this.s3=0,this.finished=!1,t=pi(t),$s(t,16);const r=z3(t);let i=r.getUint32(0,!1),s=r.getUint32(4,!1),o=r.getUint32(8,!1),a=r.getUint32(12,!1);const c=[];for(let g=0;g<128;g++)c.push({s0:yt(i),s1:yt(s),s2:yt(o),s3:yt(a)}),{s0:i,s1:s,s2:o,s3:a}=V3(i,s,o,a);const f=G3(n||1024);if(![1,2,4,8].includes(f))throw new Error("ghash: invalid window size, expected 2, 4 or 8");this.W=f;const d=128/f,h=this.windowSize=2**f,l=[];for(let g=0;g<d;g++)for(let w=0;w<h;w++){let v=0,A=0,C=0,x=0;for(let _=0;_<f;_++){if(!(w>>>f-_-1&1))continue;const{s0:L,s1:j,s2:U,s3:D}=c[f*g+_];v^=L,A^=j,C^=U,x^=D}l.push({s0:v,s1:A,s2:C,s3:x})}this.t=l}_updateBlock(t,n,r,i){t^=this.s0,n^=this.s1,r^=this.s2,i^=this.s3;const{W:s,t:o,windowSize:a}=this;let c=0,f=0,u=0,d=0;const h=(1<<s)-1;let l=0;for(const g of[t,n,r,i])for(let w=0;w<4;w++){const v=g>>>8*w&255;for(let A=8/s-1;A>=0;A--){const C=v>>>s*A&h,{s0:x,s1:_,s2:R,s3:L}=o[l*a+C];c^=x,f^=_,u^=R,d^=L,l+=1}}this.s0=c,this.s1=f,this.s2=u,this.s3=d}update(t){Ls(this),t=pi(t),$s(t);const n=gi(t),r=Math.floor(t.length/Qt),i=t.length%Qt;for(let s=0;s<r;s++)this._updateBlock(n[s*4+0],n[s*4+1],n[s*4+2],n[s*4+3]);return i&&(ec.set(t.subarray(r*Qt)),this._updateBlock($t[0],$t[1],$t[2],$t[3]),Qa($t)),this}destroy(){const{t}=this;for(const n of t)n.s0=0,n.s1=0,n.s2=0,n.s3=0}digestInto(t){Ls(this),Ad(t,this),this.finished=!0;const{s0:n,s1:r,s2:i,s3:s}=this,o=gi(t);return o[0]=n,o[1]=r,o[2]=i,o[3]=s,t}digest(){const t=new Uint8Array(Qt);return this.digestInto(t),this.destroy(),t}}class Z3 extends Td{constructor(t,n){t=pi(t),$s(t);const r=K3(Dd(t));super(r,n),Qa(r)}update(t){t=pi(t),Ls(this);const n=gi(t),r=t.length%Qt,i=Math.floor(t.length/Qt);for(let s=0;s<i;s++)this._updateBlock(yt(n[s*4+3]),yt(n[s*4+2]),yt(n[s*4+1]),yt(n[s*4+0]));return r&&(ec.set(t.subarray(i*Qt)),this._updateBlock(yt($t[3]),yt($t[2]),yt($t[1]),yt($t[0])),Qa($t)),this}digestInto(t){Ls(this),Ad(t,this),this.finished=!0;const{s0:n,s1:r,s2:i,s3:s}=this,o=gi(t);return o[0]=n,o[1]=r,o[2]=i,o[3]=s,t.reverse()}}function Rd(e){const t=(r,i)=>e(i,r.length).update(pi(r)).digest(),n=e(new Uint8Array(16),0);return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=(r,i)=>e(r,i),t}Rd((e,t)=>new Td(e,t)),Rd((e,t)=>new Z3(e,t));const Nd=yn(BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff")),Y3=Nd.create(BigInt("-3")),W3=BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b");ms({a:Y3,b:W3,Fp:Nd,n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),h:BigInt(1),lowS:!1},vr);const Cd=yn(BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff")),X3=Cd.create(BigInt("-3")),J3=BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef");ms({a:X3,b:J3,Fp:Cd,n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f"),h:BigInt(1),lowS:!1},HE);const Pd=yn(BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff")),Q3=Pd.create(BigInt("-3")),e8=BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00");ms({a:Q3,b:e8,Fp:Pd,n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650"),h:BigInt(1),lowS:!1,allowedPrivateKeyLengths:[130,131,132]},qE);var t8={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,n="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(n=!1));function i(c,f,u){this.fn=c,this.context=f,this.once=u||!1}function s(c,f,u,d,h){if(typeof u!="function")throw new TypeError("The listener must be a function");var l=new i(u,d||c,h),g=n?n+f:f;return c._events[g]?c._events[g].fn?c._events[g]=[c._events[g],l]:c._events[g].push(l):(c._events[g]=l,c._eventsCount++),c}function o(c,f){--c._eventsCount===0?c._events=new r:delete c._events[f]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var f=[],u,d;if(this._eventsCount===0)return f;for(d in u=this._events)t.call(u,d)&&f.push(n?d.slice(1):d);return Object.getOwnPropertySymbols?f.concat(Object.getOwnPropertySymbols(u)):f},a.prototype.listeners=function(f){var u=n?n+f:f,d=this._events[u];if(!d)return[];if(d.fn)return[d.fn];for(var h=0,l=d.length,g=new Array(l);h<l;h++)g[h]=d[h].fn;return g},a.prototype.listenerCount=function(f){var u=n?n+f:f,d=this._events[u];return d?d.fn?1:d.length:0},a.prototype.emit=function(f,u,d,h,l,g){var w=n?n+f:f;if(!this._events[w])return!1;var v=this._events[w],A=arguments.length,C,x;if(v.fn){switch(v.once&&this.removeListener(f,v.fn,void 0,!0),A){case 1:return v.fn.call(v.context),!0;case 2:return v.fn.call(v.context,u),!0;case 3:return v.fn.call(v.context,u,d),!0;case 4:return v.fn.call(v.context,u,d,h),!0;case 5:return v.fn.call(v.context,u,d,h,l),!0;case 6:return v.fn.call(v.context,u,d,h,l,g),!0}for(x=1,C=new Array(A-1);x<A;x++)C[x-1]=arguments[x];v.fn.apply(v.context,C)}else{var _=v.length,R;for(x=0;x<_;x++)switch(v[x].once&&this.removeListener(f,v[x].fn,void 0,!0),A){case 1:v[x].fn.call(v[x].context);break;case 2:v[x].fn.call(v[x].context,u);break;case 3:v[x].fn.call(v[x].context,u,d);break;case 4:v[x].fn.call(v[x].context,u,d,h);break;default:if(!C)for(R=1,C=new Array(A-1);R<A;R++)C[R-1]=arguments[R];v[x].fn.apply(v[x].context,C)}}return!0},a.prototype.on=function(f,u,d){return s(this,f,u,d,!1)},a.prototype.once=function(f,u,d){return s(this,f,u,d,!0)},a.prototype.removeListener=function(f,u,d,h){var l=n?n+f:f;if(!this._events[l])return this;if(!u)return o(this,l),this;var g=this._events[l];if(g.fn)g.fn===u&&(!h||g.once)&&(!d||g.context===d)&&o(this,l);else{for(var w=0,v=[],A=g.length;w<A;w++)(g[w].fn!==u||h&&!g[w].once||d&&g[w].context!==d)&&v.push(g[w]);v.length?this._events[l]=v.length===1?v[0]:v:o(this,l)}return this},a.prototype.removeAllListeners=function(f){var u;return f?(u=n?n+f:f,this._events[u]&&o(this,u)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,e.exports=a})(t8);function n8(e){if(e.length>=255)throw new TypeError("Alphabet too long");const t=new Uint8Array(256);for(let f=0;f<t.length;f++)t[f]=255;for(let f=0;f<e.length;f++){const u=e.charAt(f),d=u.charCodeAt(0);if(t[d]!==255)throw new TypeError(u+" is ambiguous");t[d]=f}const n=e.length,r=e.charAt(0),i=Math.log(n)/Math.log(256),s=Math.log(256)/Math.log(n);function o(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";let u=0,d=0,h=0;const l=f.length;for(;h!==l&&f[h]===0;)h++,u++;const g=(l-h)*s+1>>>0,w=new Uint8Array(g);for(;h!==l;){let C=f[h],x=0;for(let _=g-1;(C!==0||x<d)&&_!==-1;_--,x++)C+=256*w[_]>>>0,w[_]=C%n>>>0,C=C/n>>>0;if(C!==0)throw new Error("Non-zero carry");d=x,h++}let v=g-d;for(;v!==g&&w[v]===0;)v++;let A=r.repeat(u);for(;v<g;++v)A+=e.charAt(w[v]);return A}function a(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;let u=0,d=0,h=0;for(;f[u]===r;)d++,u++;const l=(f.length-u)*i+1>>>0,g=new Uint8Array(l);for(;u<f.length;){const C=f.charCodeAt(u);if(C>255)return;let x=t[C];if(x===255)return;let _=0;for(let R=l-1;(x!==0||_<h)&&R!==-1;R--,_++)x+=n*g[R]>>>0,g[R]=x%256>>>0,x=x/256>>>0;if(x!==0)throw new Error("Non-zero carry");h=_,u++}let w=l-h;for(;w!==l&&g[w]===0;)w++;const v=new Uint8Array(d+(l-w));let A=d;for(;w!==l;)v[A++]=g[w++];return v}function c(f){const u=a(f);if(u)return u;throw new Error("Non-base"+n+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var r8="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";n8(r8);function bi(e,t){t||(t=e.reduce((i,s)=>i+s.length,0));const n=Il(t);let r=0;for(const i of e)n.set(i,r),r+=i.length;return Xo(n)}function et(e,t="utf8"){const n=Al[t];if(!n)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8"):n.encoder.encode(e).substring(1)}const i8={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}};var s8=Object.defineProperty,o8=Object.defineProperties,a8=Object.getOwnPropertyDescriptors,$d=Object.getOwnPropertySymbols,c8=Object.prototype.hasOwnProperty,f8=Object.prototype.propertyIsEnumerable,Ld=(e,t,n)=>t in e?s8(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Tr=(e,t)=>{for(var n in t||(t={}))c8.call(t,n)&&Ld(e,n,t[n]);if($d)for(var n of $d(t))f8.call(t,n)&&Ld(e,n,t[n]);return e},yi=(e,t)=>o8(e,a8(t));const u8="ReactNative",It={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},l8="js";function Us(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Xn(){return!gr()&&!!Qo()&&navigator.product===u8}function h8(){return Xn()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function d8(){return Xn()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function wi(){return!Us()&&!!Qo()&&!!gr()}function Fs(){return Xn()?It.reactNative:Us()?It.node:wi()?It.browser:It.unknown}function Ud(){var e;try{return Xn()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(e=global.Application)==null?void 0:e.applicationId:void 0}catch{return}}function g8(e,t){const n=new URLSearchParams(e);return Object.entries(t).sort(([r],[i])=>r.localeCompare(i)).forEach(([r,i])=>{i!=null&&n.set(r,String(i))}),n.toString()}function p8(){return Pl()||{name:"",description:"",url:"",icons:[""]}}function b8(){if(Fs()===It.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:n,Version:r}=global.Platform;return[n,r].join("-")}const e=V2();if(e===null)return"unknown";const t=e.os?e.os.replace(" ","").toLowerCase():"unknown";return e.type==="browser"?[t,e.name,e.version].join("-"):[t,e.version].join("-")}function y8(){var e;const t=Fs();return t===It.browser?[t,((e=Cl())==null?void 0:e.host)||"unknown"].join(":"):t}function Fd(e,t,n){const r=b8(),i=y8();return[[e,t].join("-"),[l8,n].join("-"),r,i].join("/")}function w8({protocol:e,version:t,relayUrl:n,sdkVersion:r,auth:i,projectId:s,useOnCloseEvent:o,bundleId:a,packageName:c}){const f=n.split("?"),u=Fd(e,t,r),d={auth:i,ua:u,projectId:s,useOnCloseEvent:o||void 0,packageName:c||void 0,bundleId:a||void 0},h=g8(f[1]||"",d);return f[0]+"?"+h}function tc(e){return Object.fromEntries(e.entries())}function nc(e){return new Map(Object.entries(e))}function m8(e=W.FIVE_MINUTES,t){const n=W.toMiliseconds(e||W.FIVE_MINUTES);let r,i,s,o;return{resolve:a=>{s&&r&&(clearTimeout(s),r(a),o=Promise.resolve(a))},reject:a=>{s&&i&&(clearTimeout(s),i(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);s=setTimeout(()=>{const f=new Error(t);o=Promise.reject(f),c(f)},n),r=a,i=c})}}function Lt(e,t,n){return new Promise(async(r,i)=>{const s=setTimeout(()=>i(new Error(n)),t);try{const o=await e;r(o)}catch(o){i(o)}clearTimeout(s)})}function jd(e,t){if(typeof t=="string"&&t.startsWith(`${e}:`))return t;if(e.toLowerCase()==="topic"){if(typeof t!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${t}`}else if(e.toLowerCase()==="id"){if(typeof t!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${t}`}throw new Error(`Unknown expirer target type: ${e}`)}function E8(e){return jd("topic",e)}function v8(e){return jd("id",e)}function _8(e){const[t,n]=e.split(":"),r={id:void 0,topic:void 0};if(t==="topic"&&typeof n=="string")r.topic=n;else if(t==="id"&&Number.isInteger(Number(n)))r.id=Number(n);else throw new Error(`Invalid target, expected id:number or topic:string, got ${t}:${n}`);return r}function mi(e,t){return W.fromMiliseconds((t||Date.now())+W.toMiliseconds(e))}function kd(e){return Date.now()>=W.toMiliseconds(e)}function rc(e,t){return`${e}${t?`:${t}`:""}`}function Md(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,e=>{const t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}function zd(){return typeof process<"u"&&process.env.IS_VITEST==="true"}function qd(e){return Buffer.from(e,"base64").toString("utf-8")}function x8(e){return new Promise(t=>setTimeout(t,e))}const js=BigInt(2**32-1),Hd=BigInt(32);function Vd(e,t=!1){return t?{h:Number(e&js),l:Number(e>>Hd&js)}:{h:Number(e>>Hd&js)|0,l:Number(e&js)|0}}function Kd(e,t=!1){const n=e.length;let r=new Uint32Array(n),i=new Uint32Array(n);for(let s=0;s<n;s++){const{h:o,l:a}=Vd(e[s],t);[r[s],i[s]]=[o,a]}return[r,i]}const Gd=(e,t,n)=>e>>>n,Zd=(e,t,n)=>e<<32-n|t>>>n,_n=(e,t,n)=>e>>>n|t<<32-n,xn=(e,t,n)=>e<<32-n|t>>>n,Ei=(e,t,n)=>e<<64-n|t>>>n-32,vi=(e,t,n)=>e>>>n-32|t<<64-n,S8=(e,t)=>t,I8=(e,t)=>e,O8=(e,t,n)=>e<<n|t>>>32-n,B8=(e,t,n)=>t<<n|e>>>32-n,A8=(e,t,n)=>t<<n-32|e>>>64-n,D8=(e,t,n)=>e<<n-32|t>>>64-n;function Ot(e,t,n,r){const i=(t>>>0)+(r>>>0);return{h:e+n+(i/2**32|0)|0,l:i|0}}const ic=(e,t,n)=>(e>>>0)+(t>>>0)+(n>>>0),sc=(e,t,n,r)=>t+n+r+(e/2**32|0)|0,T8=(e,t,n,r)=>(e>>>0)+(t>>>0)+(n>>>0)+(r>>>0),R8=(e,t,n,r,i)=>t+n+r+i+(e/2**32|0)|0,N8=(e,t,n,r,i)=>(e>>>0)+(t>>>0)+(n>>>0)+(r>>>0)+(i>>>0),C8=(e,t,n,r,i,s)=>t+n+r+i+s+(e/2**32|0)|0,Rr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function ks(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function en(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function Bt(e,...t){if(!ks(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function Ms(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");en(e.outputLen),en(e.blockLen)}function Sn(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function oc(e,t){Bt(e);const n=t.outputLen;if(e.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function _i(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function wt(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function ac(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function Ut(e,t){return e<<32-t|e>>>t}const Yd=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Wd(e){return e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255}const tn=Yd?e=>e:e=>Wd(e);function P8(e){for(let t=0;t<e.length;t++)e[t]=Wd(e[t]);return e}const In=Yd?e=>e:P8,Xd=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",$8=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Nr(e){if(Bt(e),Xd)return e.toHex();let t="";for(let n=0;n<e.length;n++)t+=$8[e[n]];return t}const nn={_0:48,_9:57,A:65,F:70,a:97,f:102};function Jd(e){if(e>=nn._0&&e<=nn._9)return e-nn._0;if(e>=nn.A&&e<=nn.F)return e-(nn.A-10);if(e>=nn.a&&e<=nn.f)return e-(nn.a-10)}function zs(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);if(Xd)return Uint8Array.fromHex(e);const t=e.length,n=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const r=new Uint8Array(n);for(let i=0,s=0;i<n;i++,s+=2){const o=Jd(e.charCodeAt(s)),a=Jd(e.charCodeAt(s+1));if(o===void 0||a===void 0){const c=e[s]+e[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}r[i]=o*16+a}return r}function Qd(e){if(typeof e!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}function At(e){return typeof e=="string"&&(e=Qd(e)),Bt(e),e}function On(...e){let t=0;for(let r=0;r<e.length;r++){const i=e[r];Bt(i),t+=i.length}const n=new Uint8Array(t);for(let r=0,i=0;r<e.length;r++){const s=e[r];n.set(s,i),i+=s.length}return n}class qs{}function xi(e){const t=r=>e().update(At(r)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function L8(e){const t=(r,i)=>e(i).update(At(r)).digest(),n=e({});return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=r=>e(r),t}function Jn(e=32){if(Rr&&typeof Rr.getRandomValues=="function")return Rr.getRandomValues(new Uint8Array(e));if(Rr&&typeof Rr.randomBytes=="function")return Uint8Array.from(Rr.randomBytes(e));throw new Error("crypto.getRandomValues must be defined")}const U8=BigInt(0),Si=BigInt(1),F8=BigInt(2),j8=BigInt(7),k8=BigInt(256),M8=BigInt(113),e0=[],t0=[],n0=[];for(let e=0,t=Si,n=1,r=0;e<24;e++){[n,r]=[r,(2*n+3*r)%5],e0.push(2*(5*r+n)),t0.push((e+1)*(e+2)/2%64);let i=U8;for(let s=0;s<7;s++)t=(t<<Si^(t>>j8)*M8)%k8,t&F8&&(i^=Si<<(Si<<BigInt(s))-Si);n0.push(i)}const r0=Kd(n0,!0),z8=r0[0],q8=r0[1],i0=(e,t,n)=>n>32?A8(e,t,n):O8(e,t,n),s0=(e,t,n)=>n>32?D8(e,t,n):B8(e,t,n);function H8(e,t=24){const n=new Uint32Array(10);for(let r=24-t;r<24;r++){for(let o=0;o<10;o++)n[o]=e[o]^e[o+10]^e[o+20]^e[o+30]^e[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,f=n[c],u=n[c+1],d=i0(f,u,1)^n[a],h=s0(f,u,1)^n[a+1];for(let l=0;l<50;l+=10)e[o+l]^=d,e[o+l+1]^=h}let i=e[2],s=e[3];for(let o=0;o<24;o++){const a=t0[o],c=i0(i,s,a),f=s0(i,s,a),u=e0[o];i=e[u],s=e[u+1],e[u]=c,e[u+1]=f}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)n[a]=e[o+a];for(let a=0;a<10;a++)e[o+a]^=~n[(a+2)%10]&n[(a+4)%10]}e[0]^=z8[r],e[1]^=q8[r]}wt(n)}class cc extends qs{constructor(t,n,r,i=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=t,this.suffix=n,this.outputLen=r,this.enableXOF=i,this.rounds=s,en(r),!(0<t&&t<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=_i(this.state)}clone(){return this._cloneInto()}keccak(){In(this.state32),H8(this.state32,this.rounds),In(this.state32),this.posOut=0,this.pos=0}update(t){Sn(this),t=At(t),Bt(t);const{blockLen:n,state:r}=this,i=t.length;for(let s=0;s<i;){const o=Math.min(n-this.pos,i-s);for(let a=0;a<o;a++)r[this.pos++]^=t[s++];this.pos===n&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:t,suffix:n,pos:r,blockLen:i}=this;t[r]^=n,(n&128)!==0&&r===i-1&&this.keccak(),t[i-1]^=128,this.keccak()}writeInto(t){Sn(this,!1),Bt(t),this.finish();const n=this.state,{blockLen:r}=this;for(let i=0,s=t.length;i<s;){this.posOut>=r&&this.keccak();const o=Math.min(r-this.posOut,s-i);t.set(n.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return t}xofInto(t){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(t)}xof(t){return en(t),this.xofInto(new Uint8Array(t))}digestInto(t){if(oc(t,this),this.finished)throw new Error("digest() was already called");return this.writeInto(t),this.destroy(),t}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,wt(this.state)}_cloneInto(t){const{blockLen:n,suffix:r,outputLen:i,rounds:s,enableXOF:o}=this;return t||(t=new cc(n,r,i,o,s)),t.state32.set(this.state32),t.pos=this.pos,t.posOut=this.posOut,t.finished=this.finished,t.rounds=s,t.suffix=r,t.outputLen=i,t.enableXOF=o,t.destroyed=this.destroyed,t}}((e,t,n)=>xi(()=>new cc(t,e,n)))(1,136,256/8);function V8(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),c=r?4:0,f=r?0:4;e.setUint32(t+c,o,r),e.setUint32(t+f,a,r)}function K8(e,t,n){return e&t^~e&n}function G8(e,t,n){return e&t^e&n^t&n}class o0 extends qs{constructor(t,n,r,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=t,this.outputLen=n,this.padOffset=r,this.isLE=i,this.buffer=new Uint8Array(t),this.view=ac(this.buffer)}update(t){Sn(this),t=At(t),Bt(t);const{view:n,buffer:r,blockLen:i}=this,s=t.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=ac(t);for(;i<=s-o;o+=i)this.process(c,o);continue}r.set(t.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){Sn(this),oc(t,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,wt(this.buffer.subarray(o)),this.padOffset>i-o&&(this.process(r,0),o=0);for(let d=o;d<i;d++)n[d]=0;V8(r,i-8,BigInt(this.length*8),s),this.process(r,0);const a=ac(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const f=c/4,u=this.get();if(f>u.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<f;d++)a.setUint32(4*d,u[d],s)}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const r=t.slice(0,n);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return t.destroyed=o,t.finished=s,t.length=i,t.pos=a,i%n&&t.buffer.set(r),t}clone(){return this._cloneInto()}}const Bn=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ce=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),Pe=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),Z8=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),An=new Uint32Array(64);class Y8 extends o0{constructor(t=32){super(64,t,8,!1),this.A=Bn[0]|0,this.B=Bn[1]|0,this.C=Bn[2]|0,this.D=Bn[3]|0,this.E=Bn[4]|0,this.F=Bn[5]|0,this.G=Bn[6]|0,this.H=Bn[7]|0}get(){const{A:t,B:n,C:r,D:i,E:s,F:o,G:a,H:c}=this;return[t,n,r,i,s,o,a,c]}set(t,n,r,i,s,o,a,c){this.A=t|0,this.B=n|0,this.C=r|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(t,n){for(let d=0;d<16;d++,n+=4)An[d]=t.getUint32(n,!1);for(let d=16;d<64;d++){const h=An[d-15],l=An[d-2],g=Ut(h,7)^Ut(h,18)^h>>>3,w=Ut(l,17)^Ut(l,19)^l>>>10;An[d]=w+An[d-7]+g+An[d-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:c,G:f,H:u}=this;for(let d=0;d<64;d++){const h=Ut(a,6)^Ut(a,11)^Ut(a,25),l=u+h+K8(a,c,f)+Z8[d]+An[d]|0,g=(Ut(r,2)^Ut(r,13)^Ut(r,22))+G8(r,i,s)|0;u=f,f=c,c=a,a=o+l|0,o=s,s=i,i=r,r=l+g|0}r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,f=f+this.G|0,u=u+this.H|0,this.set(r,i,s,o,a,c,f,u)}roundClean(){wt(An)}destroy(){this.set(0,0,0,0,0,0,0,0),wt(this.buffer)}}const a0=Kd(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))),W8=a0[0],X8=a0[1],Dn=new Uint32Array(80),Tn=new Uint32Array(80);class fc extends o0{constructor(t=64){super(128,t,16,!1),this.Ah=Pe[0]|0,this.Al=Pe[1]|0,this.Bh=Pe[2]|0,this.Bl=Pe[3]|0,this.Ch=Pe[4]|0,this.Cl=Pe[5]|0,this.Dh=Pe[6]|0,this.Dl=Pe[7]|0,this.Eh=Pe[8]|0,this.El=Pe[9]|0,this.Fh=Pe[10]|0,this.Fl=Pe[11]|0,this.Gh=Pe[12]|0,this.Gl=Pe[13]|0,this.Hh=Pe[14]|0,this.Hl=Pe[15]|0}get(){const{Ah:t,Al:n,Bh:r,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:f,El:u,Fh:d,Fl:h,Gh:l,Gl:g,Hh:w,Hl:v}=this;return[t,n,r,i,s,o,a,c,f,u,d,h,l,g,w,v]}set(t,n,r,i,s,o,a,c,f,u,d,h,l,g,w,v){this.Ah=t|0,this.Al=n|0,this.Bh=r|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=f|0,this.El=u|0,this.Fh=d|0,this.Fl=h|0,this.Gh=l|0,this.Gl=g|0,this.Hh=w|0,this.Hl=v|0}process(t,n){for(let x=0;x<16;x++,n+=4)Dn[x]=t.getUint32(n),Tn[x]=t.getUint32(n+=4);for(let x=16;x<80;x++){const _=Dn[x-15]|0,R=Tn[x-15]|0,L=_n(_,R,1)^_n(_,R,8)^Gd(_,R,7),j=xn(_,R,1)^xn(_,R,8)^Zd(_,R,7),U=Dn[x-2]|0,D=Tn[x-2]|0,q=_n(U,D,19)^Ei(U,D,61)^Gd(U,D,6),M=xn(U,D,19)^vi(U,D,61)^Zd(U,D,6),E=T8(j,M,Tn[x-7],Tn[x-16]),b=R8(E,L,q,Dn[x-7],Dn[x-16]);Dn[x]=b|0,Tn[x]=E|0}let{Ah:r,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:f,Dl:u,Eh:d,El:h,Fh:l,Fl:g,Gh:w,Gl:v,Hh:A,Hl:C}=this;for(let x=0;x<80;x++){const _=_n(d,h,14)^_n(d,h,18)^Ei(d,h,41),R=xn(d,h,14)^xn(d,h,18)^vi(d,h,41),L=d&l^~d&w,j=h&g^~h&v,U=N8(C,R,j,X8[x],Tn[x]),D=C8(U,A,_,L,W8[x],Dn[x]),q=U|0,M=_n(r,i,28)^Ei(r,i,34)^Ei(r,i,39),E=xn(r,i,28)^vi(r,i,34)^vi(r,i,39),b=r&s^r&a^s&a,m=i&o^i&c^o&c;A=w|0,C=v|0,w=l|0,v=g|0,l=d|0,g=h|0,{h:d,l:h}=Ot(f|0,u|0,D|0,q|0),f=a|0,u=c|0,a=s|0,c=o|0,s=r|0,o=i|0;const p=ic(q,E,m);r=sc(p,D,M,b),i=p|0}({h:r,l:i}=Ot(this.Ah|0,this.Al|0,r|0,i|0)),{h:s,l:o}=Ot(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=Ot(this.Ch|0,this.Cl|0,a|0,c|0),{h:f,l:u}=Ot(this.Dh|0,this.Dl|0,f|0,u|0),{h:d,l:h}=Ot(this.Eh|0,this.El|0,d|0,h|0),{h:l,l:g}=Ot(this.Fh|0,this.Fl|0,l|0,g|0),{h:w,l:v}=Ot(this.Gh|0,this.Gl|0,w|0,v|0),{h:A,l:C}=Ot(this.Hh|0,this.Hl|0,A|0,C|0),this.set(r,i,s,o,a,c,f,u,d,h,l,g,w,v,A,C)}roundClean(){wt(Dn,Tn)}destroy(){wt(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class J8 extends fc{constructor(){super(48),this.Ah=Ce[0]|0,this.Al=Ce[1]|0,this.Bh=Ce[2]|0,this.Bl=Ce[3]|0,this.Ch=Ce[4]|0,this.Cl=Ce[5]|0,this.Dh=Ce[6]|0,this.Dl=Ce[7]|0,this.Eh=Ce[8]|0,this.El=Ce[9]|0,this.Fh=Ce[10]|0,this.Fl=Ce[11]|0,this.Gh=Ce[12]|0,this.Gl=Ce[13]|0,this.Hh=Ce[14]|0,this.Hl=Ce[15]|0}}const $e=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class Q8 extends fc{constructor(){super(32),this.Ah=$e[0]|0,this.Al=$e[1]|0,this.Bh=$e[2]|0,this.Bl=$e[3]|0,this.Ch=$e[4]|0,this.Cl=$e[5]|0,this.Dh=$e[6]|0,this.Dl=$e[7]|0,this.Eh=$e[8]|0,this.El=$e[9]|0,this.Fh=$e[10]|0,this.Fl=$e[11]|0,this.Gh=$e[12]|0,this.Gl=$e[13]|0,this.Hh=$e[14]|0,this.Hl=$e[15]|0}}const c0=xi(()=>new Y8),e6=xi(()=>new fc),t6=xi(()=>new J8);xi(()=>new Q8);const n6=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),Ee=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),Z=new Uint32Array(32);function Rn(e,t,n,r,i,s){const o=i[s],a=i[s+1];let c=Z[2*e],f=Z[2*e+1],u=Z[2*t],d=Z[2*t+1],h=Z[2*n],l=Z[2*n+1],g=Z[2*r],w=Z[2*r+1],v=ic(c,u,o);f=sc(v,f,d,a),c=v|0,{Dh:w,Dl:g}={Dh:w^f,Dl:g^c},{Dh:w,Dl:g}={Dh:S8(w,g),Dl:I8(w)},{h:l,l:h}=Ot(l,h,w,g),{Bh:d,Bl:u}={Bh:d^l,Bl:u^h},{Bh:d,Bl:u}={Bh:_n(d,u,24),Bl:xn(d,u,24)},Z[2*e]=c,Z[2*e+1]=f,Z[2*t]=u,Z[2*t+1]=d,Z[2*n]=h,Z[2*n+1]=l,Z[2*r]=g,Z[2*r+1]=w}function Nn(e,t,n,r,i,s){const o=i[s],a=i[s+1];let c=Z[2*e],f=Z[2*e+1],u=Z[2*t],d=Z[2*t+1],h=Z[2*n],l=Z[2*n+1],g=Z[2*r],w=Z[2*r+1],v=ic(c,u,o);f=sc(v,f,d,a),c=v|0,{Dh:w,Dl:g}={Dh:w^f,Dl:g^c},{Dh:w,Dl:g}={Dh:_n(w,g,16),Dl:xn(w,g,16)},{h:l,l:h}=Ot(l,h,w,g),{Bh:d,Bl:u}={Bh:d^l,Bl:u^h},{Bh:d,Bl:u}={Bh:Ei(d,u,63),Bl:vi(d,u,63)},Z[2*e]=c,Z[2*e+1]=f,Z[2*t]=u,Z[2*t+1]=d,Z[2*n]=h,Z[2*n+1]=l,Z[2*r]=g,Z[2*r+1]=w}function r6(e,t={},n,r,i){if(en(n),e<0||e>n)throw new Error("outputLen bigger than keyLen");const{key:s,salt:o,personalization:a}=t;if(s!==void 0&&(s.length<1||s.length>n))throw new Error("key length must be undefined or 1.."+n);if(o!==void 0&&o.length!==r)throw new Error("salt must be undefined or "+r);if(a!==void 0&&a.length!==i)throw new Error("personalization must be undefined or "+i)}class i6 extends qs{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,en(t),en(n),this.blockLen=t,this.outputLen=n,this.buffer=new Uint8Array(t),this.buffer32=_i(this.buffer)}update(t){Sn(this),t=At(t),Bt(t);const{blockLen:n,buffer:r,buffer32:i}=this,s=t.length,o=t.byteOffset,a=t.buffer;for(let c=0;c<s;){this.pos===n&&(In(i),this.compress(i,0,!1),In(i),this.pos=0);const f=Math.min(n-this.pos,s-c),u=o+c;if(f===n&&!(u%4)&&c+f<s){const d=new Uint32Array(a,u,Math.floor((s-c)/4));In(d);for(let h=0;c+n<s;h+=i.length,c+=n)this.length+=n,this.compress(d,h,!1);In(d);continue}r.set(t.subarray(c,c+f),this.pos),this.pos+=f,this.length+=f,c+=f}return this}digestInto(t){Sn(this),oc(t,this);const{pos:n,buffer32:r}=this;this.finished=!0,wt(this.buffer.subarray(n)),In(r),this.compress(r,0,!0),In(r);const i=_i(t);this.get().forEach((s,o)=>i[o]=tn(s))}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const r=t.slice(0,n);return this.destroy(),r}_cloneInto(t){const{buffer:n,length:r,finished:i,destroyed:s,outputLen:o,pos:a}=this;return t||(t=new this.constructor({dkLen:o})),t.set(...this.get()),t.buffer.set(n),t.destroyed=s,t.finished=i,t.length=r,t.pos=a,t.outputLen=o,t}clone(){return this._cloneInto()}}class s6 extends i6{constructor(t={}){const n=t.dkLen===void 0?64:t.dkLen;super(128,n),this.v0l=Ee[0]|0,this.v0h=Ee[1]|0,this.v1l=Ee[2]|0,this.v1h=Ee[3]|0,this.v2l=Ee[4]|0,this.v2h=Ee[5]|0,this.v3l=Ee[6]|0,this.v3h=Ee[7]|0,this.v4l=Ee[8]|0,this.v4h=Ee[9]|0,this.v5l=Ee[10]|0,this.v5h=Ee[11]|0,this.v6l=Ee[12]|0,this.v6h=Ee[13]|0,this.v7l=Ee[14]|0,this.v7h=Ee[15]|0,r6(n,t,64,16,16);let{key:r,personalization:i,salt:s}=t,o=0;if(r!==void 0&&(r=At(r),o=r.length),this.v0l^=this.outputLen|o<<8|65536|1<<24,s!==void 0){s=At(s);const a=_i(s);this.v4l^=tn(a[0]),this.v4h^=tn(a[1]),this.v5l^=tn(a[2]),this.v5h^=tn(a[3])}if(i!==void 0){i=At(i);const a=_i(i);this.v6l^=tn(a[0]),this.v6h^=tn(a[1]),this.v7l^=tn(a[2]),this.v7h^=tn(a[3])}if(r!==void 0){const a=new Uint8Array(this.blockLen);a.set(r),this.update(a)}}get(){let{v0l:t,v0h:n,v1l:r,v1h:i,v2l:s,v2h:o,v3l:a,v3h:c,v4l:f,v4h:u,v5l:d,v5h:h,v6l:l,v6h:g,v7l:w,v7h:v}=this;return[t,n,r,i,s,o,a,c,f,u,d,h,l,g,w,v]}set(t,n,r,i,s,o,a,c,f,u,d,h,l,g,w,v){this.v0l=t|0,this.v0h=n|0,this.v1l=r|0,this.v1h=i|0,this.v2l=s|0,this.v2h=o|0,this.v3l=a|0,this.v3h=c|0,this.v4l=f|0,this.v4h=u|0,this.v5l=d|0,this.v5h=h|0,this.v6l=l|0,this.v6h=g|0,this.v7l=w|0,this.v7h=v|0}compress(t,n,r){this.get().forEach((c,f)=>Z[f]=c),Z.set(Ee,16);let{h:i,l:s}=Vd(BigInt(this.length));Z[24]=Ee[8]^s,Z[25]=Ee[9]^i,r&&(Z[28]=~Z[28],Z[29]=~Z[29]);let o=0;const a=n6;for(let c=0;c<12;c++)Rn(0,4,8,12,t,n+2*a[o++]),Nn(0,4,8,12,t,n+2*a[o++]),Rn(1,5,9,13,t,n+2*a[o++]),Nn(1,5,9,13,t,n+2*a[o++]),Rn(2,6,10,14,t,n+2*a[o++]),Nn(2,6,10,14,t,n+2*a[o++]),Rn(3,7,11,15,t,n+2*a[o++]),Nn(3,7,11,15,t,n+2*a[o++]),Rn(0,5,10,15,t,n+2*a[o++]),Nn(0,5,10,15,t,n+2*a[o++]),Rn(1,6,11,12,t,n+2*a[o++]),Nn(1,6,11,12,t,n+2*a[o++]),Rn(2,7,8,13,t,n+2*a[o++]),Nn(2,7,8,13,t,n+2*a[o++]),Rn(3,4,9,14,t,n+2*a[o++]),Nn(3,4,9,14,t,n+2*a[o++]);this.v0l^=Z[0]^Z[16],this.v0h^=Z[1]^Z[17],this.v1l^=Z[2]^Z[18],this.v1h^=Z[3]^Z[19],this.v2l^=Z[4]^Z[20],this.v2h^=Z[5]^Z[21],this.v3l^=Z[6]^Z[22],this.v3h^=Z[7]^Z[23],this.v4l^=Z[8]^Z[24],this.v4h^=Z[9]^Z[25],this.v5l^=Z[10]^Z[26],this.v5h^=Z[11]^Z[27],this.v6l^=Z[12]^Z[28],this.v6h^=Z[13]^Z[29],this.v7l^=Z[14]^Z[30],this.v7h^=Z[15]^Z[31],wt(Z)}destroy(){this.destroyed=!0,wt(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}L8(e=>new s6(e));/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */function f0(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function uc(e){if(typeof e!="boolean")throw new Error(`boolean expected, not ${e}`)}function lc(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function tt(e,...t){if(!f0(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function u0(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function o6(e,t){tt(e);const n=t.outputLen;if(e.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function Cn(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function Cr(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function a6(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}const c6=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function f6(e){if(typeof e!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}function hc(e){if(typeof e=="string")e=f6(e);else if(f0(e))e=dc(e);else throw new Error("Uint8Array expected, got "+typeof e);return e}function u6(e,t){if(t==null||typeof t!="object")throw new Error("options must be defined");return Object.assign(e,t)}function l6(e,t){if(e.length!==t.length)return!1;let n=0;for(let r=0;r<e.length;r++)n|=e[r]^t[r];return n===0}const h6=(e,t)=>{function n(r,...i){if(tt(r),!c6)throw new Error("Non little-endian hardware is not yet supported");if(e.nonceLength!==void 0){const f=i[0];if(!f)throw new Error("nonce / iv required");e.varSizeNonce?tt(f):tt(f,e.nonceLength)}const s=e.tagLength;s&&i[1]!==void 0&&tt(i[1]);const o=t(r,...i),a=(f,u)=>{if(u!==void 0){if(f!==2)throw new Error("cipher output not supported");tt(u)}};let c=!1;return{encrypt(f,u){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,tt(f),a(o.encrypt.length,u),o.encrypt(f,u)},decrypt(f,u){if(tt(f),s&&f.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return a(o.decrypt.length,u),o.decrypt(f,u)}}}return Object.assign(n,e),n};function l0(e,t,n=!0){if(t===void 0)return new Uint8Array(e);if(t.length!==e)throw new Error("invalid output length, expected "+e+", got: "+t.length);if(n&&!g6(t))throw new Error("invalid output, must be aligned");return t}function h0(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),c=r?4:0,f=r?0:4;e.setUint32(t+c,o,r),e.setUint32(t+f,a,r)}function d6(e,t,n){uc(n);const r=new Uint8Array(16),i=a6(r);return h0(i,0,BigInt(t),n),h0(i,8,BigInt(e),n),r}function g6(e){return e.byteOffset%4===0}function dc(e){return Uint8Array.from(e)}const d0=e=>Uint8Array.from(e.split("").map(t=>t.charCodeAt(0))),p6=d0("expand 16-byte k"),b6=d0("expand 32-byte k"),y6=Cn(p6),w6=Cn(b6);function ie(e,t){return e<<t|e>>>32-t}function gc(e){return e.byteOffset%4===0}const Hs=64,m6=16,g0=2**32-1,p0=new Uint32Array;function E6(e,t,n,r,i,s,o,a){const c=i.length,f=new Uint8Array(Hs),u=Cn(f),d=gc(i)&&gc(s),h=d?Cn(i):p0,l=d?Cn(s):p0;for(let g=0;g<c;o++){if(e(t,n,r,u,o,a),o>=g0)throw new Error("arx: counter overflow");const w=Math.min(Hs,c-g);if(d&&w===Hs){const v=g/4;if(g%4!==0)throw new Error("arx: invalid block position");for(let A=0,C;A<m6;A++)C=v+A,l[C]=h[C]^u[A];g+=Hs;continue}for(let v=0,A;v<w;v++)A=g+v,s[A]=i[A]^f[v];g+=w}}function v6(e,t){const{allowShortKeys:n,extendNonceFn:r,counterLength:i,counterRight:s,rounds:o}=u6({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if(typeof e!="function")throw new Error("core must be a function");return lc(i),lc(o),uc(s),uc(n),(a,c,f,u,d=0)=>{tt(a),tt(c),tt(f);const h=f.length;if(u===void 0&&(u=new Uint8Array(h)),tt(u),lc(d),d<0||d>=g0)throw new Error("arx: counter overflow");if(u.length<h)throw new Error(`arx: output (${u.length}) is shorter than data (${h})`);const l=[];let g=a.length,w,v;if(g===32)l.push(w=dc(a)),v=w6;else if(g===16&&n)w=new Uint8Array(32),w.set(a),w.set(a,16),v=y6,l.push(w);else throw new Error(`arx: invalid 32-byte key, got length=${g}`);gc(c)||l.push(c=dc(c));const A=Cn(w);if(r){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(v,A,Cn(c.subarray(0,16)),A),c=c.subarray(16)}const C=16-i;if(C!==c.length)throw new Error(`arx: nonce must be ${C} or 16 bytes`);if(C!==12){const _=new Uint8Array(12);_.set(c,s?0:12-c.length),c=_,l.push(c)}const x=Cn(c);return E6(e,v,A,x,f,u,d,o),Cr(...l),u}}const Be=(e,t)=>e[t++]&255|(e[t++]&255)<<8;class _6{constructor(t){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,t=hc(t),tt(t,32);const n=Be(t,0),r=Be(t,2),i=Be(t,4),s=Be(t,6),o=Be(t,8),a=Be(t,10),c=Be(t,12),f=Be(t,14);this.r[0]=n&8191,this.r[1]=(n>>>13|r<<3)&8191,this.r[2]=(r>>>10|i<<6)&7939,this.r[3]=(i>>>7|s<<9)&8191,this.r[4]=(s>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|f<<8)&8191,this.r[9]=f>>>5&127;for(let u=0;u<8;u++)this.pad[u]=Be(t,16+2*u)}process(t,n,r=!1){const i=r?0:2048,{h:s,r:o}=this,a=o[0],c=o[1],f=o[2],u=o[3],d=o[4],h=o[5],l=o[6],g=o[7],w=o[8],v=o[9],A=Be(t,n+0),C=Be(t,n+2),x=Be(t,n+4),_=Be(t,n+6),R=Be(t,n+8),L=Be(t,n+10),j=Be(t,n+12),U=Be(t,n+14);let D=s[0]+(A&8191),q=s[1]+((A>>>13|C<<3)&8191),M=s[2]+((C>>>10|x<<6)&8191),E=s[3]+((x>>>7|_<<9)&8191),b=s[4]+((_>>>4|R<<12)&8191),m=s[5]+(R>>>1&8191),p=s[6]+((R>>>14|L<<2)&8191),y=s[7]+((L>>>11|j<<5)&8191),S=s[8]+((j>>>8|U<<8)&8191),I=s[9]+(U>>>5|i),O=0,B=O+D*a+q*(5*v)+M*(5*w)+E*(5*g)+b*(5*l);O=B>>>13,B&=8191,B+=m*(5*h)+p*(5*d)+y*(5*u)+S*(5*f)+I*(5*c),O+=B>>>13,B&=8191;let T=O+D*c+q*a+M*(5*v)+E*(5*w)+b*(5*g);O=T>>>13,T&=8191,T+=m*(5*l)+p*(5*h)+y*(5*d)+S*(5*u)+I*(5*f),O+=T>>>13,T&=8191;let $=O+D*f+q*c+M*a+E*(5*v)+b*(5*w);O=$>>>13,$&=8191,$+=m*(5*g)+p*(5*l)+y*(5*h)+S*(5*d)+I*(5*u),O+=$>>>13,$&=8191;let P=O+D*u+q*f+M*c+E*a+b*(5*v);O=P>>>13,P&=8191,P+=m*(5*w)+p*(5*g)+y*(5*l)+S*(5*h)+I*(5*d),O+=P>>>13,P&=8191;let F=O+D*d+q*u+M*f+E*c+b*a;O=F>>>13,F&=8191,F+=m*(5*v)+p*(5*w)+y*(5*g)+S*(5*l)+I*(5*h),O+=F>>>13,F&=8191;let N=O+D*h+q*d+M*u+E*f+b*c;O=N>>>13,N&=8191,N+=m*a+p*(5*v)+y*(5*w)+S*(5*g)+I*(5*l),O+=N>>>13,N&=8191;let k=O+D*l+q*h+M*d+E*u+b*f;O=k>>>13,k&=8191,k+=m*c+p*a+y*(5*v)+S*(5*w)+I*(5*g),O+=k>>>13,k&=8191;let z=O+D*g+q*l+M*h+E*d+b*u;O=z>>>13,z&=8191,z+=m*f+p*c+y*a+S*(5*v)+I*(5*w),O+=z>>>13,z&=8191;let G=O+D*w+q*g+M*l+E*h+b*d;O=G>>>13,G&=8191,G+=m*u+p*f+y*c+S*a+I*(5*v),O+=G>>>13,G&=8191;let H=O+D*v+q*w+M*g+E*l+b*h;O=H>>>13,H&=8191,H+=m*d+p*u+y*f+S*c+I*a,O+=H>>>13,H&=8191,O=(O<<2)+O|0,O=O+B|0,B=O&8191,O=O>>>13,T+=O,s[0]=B,s[1]=T,s[2]=$,s[3]=P,s[4]=F,s[5]=N,s[6]=k,s[7]=z,s[8]=G,s[9]=H}finalize(){const{h:t,pad:n}=this,r=new Uint16Array(10);let i=t[1]>>>13;t[1]&=8191;for(let a=2;a<10;a++)t[a]+=i,i=t[a]>>>13,t[a]&=8191;t[0]+=i*5,i=t[0]>>>13,t[0]&=8191,t[1]+=i,i=t[1]>>>13,t[1]&=8191,t[2]+=i,r[0]=t[0]+5,i=r[0]>>>13,r[0]&=8191;for(let a=1;a<10;a++)r[a]=t[a]+i,i=r[a]>>>13,r[a]&=8191;r[9]-=8192;let s=(i^1)-1;for(let a=0;a<10;a++)r[a]&=s;s=~s;for(let a=0;a<10;a++)t[a]=t[a]&s|r[a];t[0]=(t[0]|t[1]<<13)&65535,t[1]=(t[1]>>>3|t[2]<<10)&65535,t[2]=(t[2]>>>6|t[3]<<7)&65535,t[3]=(t[3]>>>9|t[4]<<4)&65535,t[4]=(t[4]>>>12|t[5]<<1|t[6]<<14)&65535,t[5]=(t[6]>>>2|t[7]<<11)&65535,t[6]=(t[7]>>>5|t[8]<<8)&65535,t[7]=(t[8]>>>8|t[9]<<5)&65535;let o=t[0]+n[0];t[0]=o&65535;for(let a=1;a<8;a++)o=(t[a]+n[a]|0)+(o>>>16)|0,t[a]=o&65535;Cr(r)}update(t){u0(this),t=hc(t),tt(t);const{buffer:n,blockLen:r}=this,i=t.length;for(let s=0;s<i;){const o=Math.min(r-this.pos,i-s);if(o===r){for(;r<=i-s;s+=r)this.process(t,s);continue}n.set(t.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===r&&(this.process(n,0,!1),this.pos=0)}return this}destroy(){Cr(this.h,this.r,this.buffer,this.pad)}digestInto(t){u0(this),o6(t,this),this.finished=!0;const{buffer:n,h:r}=this;let{pos:i}=this;if(i){for(n[i++]=1;i<16;i++)n[i]=0;this.process(n,0,!0)}this.finalize();let s=0;for(let o=0;o<8;o++)t[s++]=r[o]>>>0,t[s++]=r[o]>>>8;return t}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const r=t.slice(0,n);return this.destroy(),r}}function x6(e){const t=(r,i)=>e(i).update(hc(r)).digest(),n=e(new Uint8Array(32));return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=r=>e(r),t}const S6=x6(e=>new _6(e));function I6(e,t,n,r,i,s=20){let o=e[0],a=e[1],c=e[2],f=e[3],u=t[0],d=t[1],h=t[2],l=t[3],g=t[4],w=t[5],v=t[6],A=t[7],C=i,x=n[0],_=n[1],R=n[2],L=o,j=a,U=c,D=f,q=u,M=d,E=h,b=l,m=g,p=w,y=v,S=A,I=C,O=x,B=_,T=R;for(let P=0;P<s;P+=2)L=L+q|0,I=ie(I^L,16),m=m+I|0,q=ie(q^m,12),L=L+q|0,I=ie(I^L,8),m=m+I|0,q=ie(q^m,7),j=j+M|0,O=ie(O^j,16),p=p+O|0,M=ie(M^p,12),j=j+M|0,O=ie(O^j,8),p=p+O|0,M=ie(M^p,7),U=U+E|0,B=ie(B^U,16),y=y+B|0,E=ie(E^y,12),U=U+E|0,B=ie(B^U,8),y=y+B|0,E=ie(E^y,7),D=D+b|0,T=ie(T^D,16),S=S+T|0,b=ie(b^S,12),D=D+b|0,T=ie(T^D,8),S=S+T|0,b=ie(b^S,7),L=L+M|0,T=ie(T^L,16),y=y+T|0,M=ie(M^y,12),L=L+M|0,T=ie(T^L,8),y=y+T|0,M=ie(M^y,7),j=j+E|0,I=ie(I^j,16),S=S+I|0,E=ie(E^S,12),j=j+E|0,I=ie(I^j,8),S=S+I|0,E=ie(E^S,7),U=U+b|0,O=ie(O^U,16),m=m+O|0,b=ie(b^m,12),U=U+b|0,O=ie(O^U,8),m=m+O|0,b=ie(b^m,7),D=D+q|0,B=ie(B^D,16),p=p+B|0,q=ie(q^p,12),D=D+q|0,B=ie(B^D,8),p=p+B|0,q=ie(q^p,7);let $=0;r[$++]=o+L|0,r[$++]=a+j|0,r[$++]=c+U|0,r[$++]=f+D|0,r[$++]=u+q|0,r[$++]=d+M|0,r[$++]=h+E|0,r[$++]=l+b|0,r[$++]=g+m|0,r[$++]=w+p|0,r[$++]=v+y|0,r[$++]=A+S|0,r[$++]=C+I|0,r[$++]=x+O|0,r[$++]=_+B|0,r[$++]=R+T|0}const O6=v6(I6,{counterRight:!1,counterLength:4,allowShortKeys:!1}),B6=new Uint8Array(16),b0=(e,t)=>{e.update(t);const n=t.length%16;n&&e.update(B6.subarray(n))},A6=new Uint8Array(32);function y0(e,t,n,r,i){const s=e(t,n,A6),o=S6.create(s);i&&b0(o,i),b0(o,r);const a=d6(r.length,i?i.length:0,!0);o.update(a);const c=o.digest();return Cr(s,a),c}const D6=e=>(t,n,r)=>({encrypt(i,s){const o=i.length;s=l0(o+16,s,!1),s.set(i);const a=s.subarray(0,-16);e(t,n,a,a,1);const c=y0(e,t,n,a,r);return s.set(c,o),Cr(c),s},decrypt(i,s){s=l0(i.length-16,s,!1);const o=i.subarray(0,-16),a=i.subarray(-16),c=y0(e,t,n,o,r);if(!l6(a,c))throw new Error("invalid tag");return s.set(i.subarray(0,-16)),e(t,n,s,s,1),Cr(c),s}}),w0=h6({blockSize:64,nonceLength:12,tagLength:16},D6(O6));class m0 extends qs{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,Ms(t);const r=At(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?t.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=t.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),wt(s)}update(t){return Sn(this),this.iHash.update(t),this}digestInto(t){Sn(this),Bt(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return t=t,t.finished=i,t.destroyed=s,t.blockLen=o,t.outputLen=a,t.oHash=n._cloneInto(t.oHash),t.iHash=r._cloneInto(t.iHash),t}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Vs=(e,t,n)=>new m0(e,t).update(n).digest();Vs.create=(e,t)=>new m0(e,t);function T6(e,t,n){return Ms(e),n===void 0&&(n=new Uint8Array(e.outputLen)),Vs(e,At(n),At(t))}const pc=Uint8Array.from([0]),E0=Uint8Array.of();function R6(e,t,n,r=32){Ms(e),en(r);const i=e.outputLen;if(r>255*i)throw new Error("Length should be <= 255*HashLen");const s=Math.ceil(r/i);n===void 0&&(n=E0);const o=new Uint8Array(s*i),a=Vs.create(e,t),c=a._cloneInto(),f=new Uint8Array(a.outputLen);for(let u=0;u<s;u++)pc[0]=u+1,c.update(u===0?E0:f).update(n).update(pc).digestInto(f),o.set(f,i*u),a._cloneInto(c);return a.destroy(),c.destroy(),wt(f,pc),o.slice(0,r)}const N6=(e,t,n,r,i)=>R6(e,T6(e,t,n),r,i),Ks=c0,bc=BigInt(0),yc=BigInt(1);function Gs(e,t=""){if(typeof e!="boolean"){const n=t&&`"${t}"`;throw new Error(n+"expected boolean, got type="+typeof e)}return e}function Qn(e,t,n=""){const r=ks(e),i=e?.length,s=t!==void 0;if(!r||s&&i!==t){const o=n&&`"${n}" `,a=s?` of length ${t}`:"",c=r?`length=${i}`:`type=${typeof e}`;throw new Error(o+"expected Uint8Array"+a+", got "+c)}return e}function Zs(e){const t=e.toString(16);return t.length&1?"0"+t:t}function v0(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return e===""?bc:BigInt("0x"+e)}function Ys(e){return v0(Nr(e))}function Ws(e){return Bt(e),v0(Nr(Uint8Array.from(e).reverse()))}function wc(e,t){return zs(e.toString(16).padStart(t*2,"0"))}function mc(e,t){return wc(e,t).reverse()}function Le(e,t,n){let r;if(typeof t=="string")try{r=zs(t)}catch(s){throw new Error(e+" must be hex string or Uint8Array, cause: "+s)}else if(ks(t))r=Uint8Array.from(t);else throw new Error(e+" must be hex string or Uint8Array");const i=r.length;if(typeof n=="number"&&i!==n)throw new Error(e+" of length "+n+" expected, got "+i);return r}const Ec=e=>typeof e=="bigint"&&bc<=e;function C6(e,t,n){return Ec(e)&&Ec(t)&&Ec(n)&&t<=e&&e<n}function vc(e,t,n,r){if(!C6(t,n,r))throw new Error("expected valid "+e+": "+n+" <= n < "+r+", got "+t)}function _0(e){let t;for(t=0;e>bc;e>>=yc,t+=1);return t}const Ii=e=>(yc<<BigInt(e))-yc;function P6(e,t,n){if(typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");const r=h=>new Uint8Array(h),i=h=>Uint8Array.of(h);let s=r(e),o=r(e),a=0;const c=()=>{s.fill(1),o.fill(0),a=0},f=(...h)=>n(o,s,...h),u=(h=r(0))=>{o=f(i(0),h),s=f(),h.length!==0&&(o=f(i(1),h),s=f())},d=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let h=0;const l=[];for(;h<t;){s=f();const g=s.slice();l.push(g),h+=s.length}return On(...l)};return(h,l)=>{c(),u(h);let g;for(;!(g=l(d()));)u();return c(),g}}function Xs(e,t,n={}){if(!e||typeof e!="object")throw new Error("expected valid options object");function r(i,s,o){const a=e[i];if(o&&a===void 0)return;const c=typeof a;if(c!==s||a===null)throw new Error(`param "${i}" is invalid: expected ${s}, got ${c}`)}Object.entries(t).forEach(([i,s])=>r(i,s,!1)),Object.entries(n).forEach(([i,s])=>r(i,s,!0))}function x0(e){const t=new WeakMap;return(n,...r)=>{const i=t.get(n);if(i!==void 0)return i;const s=e(n,...r);return t.set(n,s),s}}const nt=BigInt(0),He=BigInt(1),er=BigInt(2),S0=BigInt(3),I0=BigInt(4),O0=BigInt(5),$6=BigInt(7),B0=BigInt(8),L6=BigInt(9),A0=BigInt(16);function ft(e,t){const n=e%t;return n>=nt?n:t+n}function Dt(e,t,n){let r=e;for(;t-- >nt;)r*=r,r%=n;return r}function D0(e,t){if(e===nt)throw new Error("invert: expected non-zero number");if(t<=nt)throw new Error("invert: expected positive modulus, got "+t);let n=ft(e,t),r=t,i=nt,s=He;for(;n!==nt;){const o=r/n,a=r%n,c=i-s*o;r=n,n=a,i=s,s=c}if(r!==He)throw new Error("invert: does not exist");return ft(i,t)}function _c(e,t,n){if(!e.eql(e.sqr(t),n))throw new Error("Cannot find square root")}function T0(e,t){const n=(e.ORDER+He)/I0,r=e.pow(t,n);return _c(e,r,t),r}function U6(e,t){const n=(e.ORDER-O0)/B0,r=e.mul(t,er),i=e.pow(r,n),s=e.mul(t,i),o=e.mul(e.mul(s,er),i),a=e.mul(s,e.sub(o,e.ONE));return _c(e,a,t),a}function F6(e){const t=Pn(e),n=R0(e),r=n(t,t.neg(t.ONE)),i=n(t,r),s=n(t,t.neg(r)),o=(e+$6)/A0;return(a,c)=>{let f=a.pow(c,o),u=a.mul(f,r);const d=a.mul(f,i),h=a.mul(f,s),l=a.eql(a.sqr(u),c),g=a.eql(a.sqr(d),c);f=a.cmov(f,u,l),u=a.cmov(h,d,g);const w=a.eql(a.sqr(u),c),v=a.cmov(f,u,w);return _c(a,v,c),v}}function R0(e){if(e<S0)throw new Error("sqrt is not defined for small field");let t=e-He,n=0;for(;t%er===nt;)t/=er,n++;let r=er;const i=Pn(e);for(;C0(i,r)===1;)if(r++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(n===1)return T0;let s=i.pow(r,t);const o=(t+He)/er;return function(a,c){if(a.is0(c))return c;if(C0(a,c)!==1)throw new Error("Cannot find square root");let f=n,u=a.mul(a.ONE,s),d=a.pow(c,t),h=a.pow(c,o);for(;!a.eql(d,a.ONE);){if(a.is0(d))return a.ZERO;let l=1,g=a.sqr(d);for(;!a.eql(g,a.ONE);)if(l++,g=a.sqr(g),l===f)throw new Error("Cannot find square root");const w=He<<BigInt(f-l-1),v=a.pow(u,w);f=l,u=a.sqr(v),d=a.mul(d,u),h=a.mul(h,v)}return h}}function j6(e){return e%I0===S0?T0:e%B0===O0?U6:e%A0===L6?F6(e):R0(e)}const k6=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function M6(e){const t={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},n=k6.reduce((r,i)=>(r[i]="function",r),t);return Xs(e,n),e}function z6(e,t,n){if(n<nt)throw new Error("invalid exponent, negatives unsupported");if(n===nt)return e.ONE;if(n===He)return t;let r=e.ONE,i=t;for(;n>nt;)n&He&&(r=e.mul(r,i)),i=e.sqr(i),n>>=He;return r}function N0(e,t,n=!1){const r=new Array(t.length).fill(n?e.ZERO:void 0),i=t.reduce((o,a,c)=>e.is0(a)?o:(r[c]=o,e.mul(o,a)),e.ONE),s=e.inv(i);return t.reduceRight((o,a,c)=>e.is0(a)?o:(r[c]=e.mul(o,r[c]),e.mul(o,a)),s),r}function C0(e,t){const n=(e.ORDER-He)/er,r=e.pow(t,n),i=e.eql(r,e.ONE),s=e.eql(r,e.ZERO),o=e.eql(r,e.neg(e.ONE));if(!i&&!s&&!o)throw new Error("invalid Legendre symbol result");return i?1:s?0:-1}function P0(e,t){t!==void 0&&en(t);const n=t!==void 0?t:e.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function Pn(e,t,n=!1,r={}){if(e<=nt)throw new Error("invalid field: expected ORDER > 0, got "+e);let i,s,o=!1,a;if(typeof t=="object"&&t!=null){if(r.sqrt||n)throw new Error("cannot specify opts in two arguments");const h=t;h.BITS&&(i=h.BITS),h.sqrt&&(s=h.sqrt),typeof h.isLE=="boolean"&&(n=h.isLE),typeof h.modFromBytes=="boolean"&&(o=h.modFromBytes),a=h.allowedLengths}else typeof t=="number"&&(i=t),r.sqrt&&(s=r.sqrt);const{nBitLength:c,nByteLength:f}=P0(e,i);if(f>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let u;const d=Object.freeze({ORDER:e,isLE:n,BITS:c,BYTES:f,MASK:Ii(c),ZERO:nt,ONE:He,allowedLengths:a,create:h=>ft(h,e),isValid:h=>{if(typeof h!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof h);return nt<=h&&h<e},is0:h=>h===nt,isValidNot0:h=>!d.is0(h)&&d.isValid(h),isOdd:h=>(h&He)===He,neg:h=>ft(-h,e),eql:(h,l)=>h===l,sqr:h=>ft(h*h,e),add:(h,l)=>ft(h+l,e),sub:(h,l)=>ft(h-l,e),mul:(h,l)=>ft(h*l,e),pow:(h,l)=>z6(d,h,l),div:(h,l)=>ft(h*D0(l,e),e),sqrN:h=>h*h,addN:(h,l)=>h+l,subN:(h,l)=>h-l,mulN:(h,l)=>h*l,inv:h=>D0(h,e),sqrt:s||(h=>(u||(u=j6(e)),u(d,h))),toBytes:h=>n?mc(h,f):wc(h,f),fromBytes:(h,l=!0)=>{if(a){if(!a.includes(h.length)||h.length>f)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+h.length);const w=new Uint8Array(f);w.set(h,n?0:w.length-h.length),h=w}if(h.length!==f)throw new Error("Field.fromBytes: expected "+f+" bytes, got "+h.length);let g=n?Ws(h):Ys(h);if(o&&(g=ft(g,e)),!l&&!d.isValid(g))throw new Error("invalid field element: outside of range 0..ORDER");return g},invertBatch:h=>N0(d,h),cmov:(h,l,g)=>g?l:h});return Object.freeze(d)}function $0(e){if(typeof e!="bigint")throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function L0(e){const t=$0(e);return t+Math.ceil(t/2)}function q6(e,t,n=!1){const r=e.length,i=$0(t),s=L0(t);if(r<16||r<s||r>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+r);const o=n?Ws(e):Ys(e),a=ft(o,t-He)+He;return n?mc(a,i):wc(a,i)}const Pr=BigInt(0),tr=BigInt(1);function Js(e,t){const n=t.negate();return e?n:t}function xc(e,t){const n=N0(e.Fp,t.map(r=>r.Z));return t.map((r,i)=>e.fromAffine(r.toAffine(n[i])))}function U0(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function Sc(e,t){U0(e,t);const n=Math.ceil(t/e)+1,r=2**(e-1),i=2**e,s=Ii(e),o=BigInt(e);return{windows:n,windowSize:r,mask:s,maxNumber:i,shiftBy:o}}function F0(e,t,n){const{windowSize:r,mask:i,maxNumber:s,shiftBy:o}=n;let a=Number(e&i),c=e>>o;a>r&&(a-=s,c+=tr);const f=t*r,u=f+Math.abs(a)-1,d=a===0,h=a<0,l=t%2!==0;return{nextN:c,offset:u,isZero:d,isNeg:h,isNegF:l,offsetF:f}}function H6(e,t){if(!Array.isArray(e))throw new Error("array expected");e.forEach((n,r)=>{if(!(n instanceof t))throw new Error("invalid point at index "+r)})}function V6(e,t){if(!Array.isArray(e))throw new Error("array of scalars expected");e.forEach((n,r)=>{if(!t.isValid(n))throw new Error("invalid scalar at index "+r)})}const Ic=new WeakMap,j0=new WeakMap;function Oc(e){return j0.get(e)||1}function k0(e){if(e!==Pr)throw new Error("invalid wNAF")}class K6{constructor(t,n){this.BASE=t.BASE,this.ZERO=t.ZERO,this.Fn=t.Fn,this.bits=n}_unsafeLadder(t,n,r=this.ZERO){let i=t;for(;n>Pr;)n&tr&&(r=r.add(i)),i=i.double(),n>>=tr;return r}precomputeWindow(t,n){const{windows:r,windowSize:i}=Sc(n,this.bits),s=[];let o=t,a=o;for(let c=0;c<r;c++){a=o,s.push(a);for(let f=1;f<i;f++)a=a.add(o),s.push(a);o=a.double()}return s}wNAF(t,n,r){if(!this.Fn.isValid(r))throw new Error("invalid scalar");let i=this.ZERO,s=this.BASE;const o=Sc(t,this.bits);for(let a=0;a<o.windows;a++){const{nextN:c,offset:f,isZero:u,isNeg:d,isNegF:h,offsetF:l}=F0(r,a,o);r=c,u?s=s.add(Js(h,n[l])):i=i.add(Js(d,n[f]))}return k0(r),{p:i,f:s}}wNAFUnsafe(t,n,r,i=this.ZERO){const s=Sc(t,this.bits);for(let o=0;o<s.windows&&r!==Pr;o++){const{nextN:a,offset:c,isZero:f,isNeg:u}=F0(r,o,s);if(r=a,!f){const d=n[c];i=i.add(u?d.negate():d)}}return k0(r),i}getPrecomputes(t,n,r){let i=Ic.get(n);return i||(i=this.precomputeWindow(n,t),t!==1&&(typeof r=="function"&&(i=r(i)),Ic.set(n,i))),i}cached(t,n,r){const i=Oc(t);return this.wNAF(i,this.getPrecomputes(i,t,r),n)}unsafe(t,n,r,i){const s=Oc(t);return s===1?this._unsafeLadder(t,n,i):this.wNAFUnsafe(s,this.getPrecomputes(s,t,r),n,i)}createCache(t,n){U0(n,this.bits),j0.set(t,n),Ic.delete(t)}hasCache(t){return Oc(t)!==1}}function G6(e,t,n,r){let i=t,s=e.ZERO,o=e.ZERO;for(;n>Pr||r>Pr;)n&tr&&(s=s.add(i)),r&tr&&(o=o.add(i)),i=i.double(),n>>=tr,r>>=tr;return{p1:s,p2:o}}function Z6(e,t,n,r){H6(n,e),V6(r,t);const i=n.length,s=r.length;if(i!==s)throw new Error("arrays of points and scalars must have equal length");const o=e.ZERO,a=_0(BigInt(i));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const f=Ii(c),u=new Array(Number(f)+1).fill(o),d=Math.floor((t.BITS-1)/c)*c;let h=o;for(let l=d;l>=0;l-=c){u.fill(o);for(let w=0;w<s;w++){const v=r[w],A=Number(v>>BigInt(l)&f);u[A]=u[A].add(n[w])}let g=o;for(let w=u.length-1,v=o;w>0;w--)v=v.add(u[w]),g=g.add(v);if(h=h.add(g),l!==0)for(let w=0;w<c;w++)h=h.double()}return h}function M0(e,t,n){if(t){if(t.ORDER!==e)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return M6(t),t}else return Pn(e,{isLE:n})}function Y6(e,t,n={},r){if(r===void 0&&(r=e==="edwards"),!t||typeof t!="object")throw new Error(`expected valid ${e} CURVE object`);for(const a of["p","n","h"]){const c=t[a];if(!(typeof c=="bigint"&&c>Pr))throw new Error(`CURVE.${a} must be positive bigint`)}const i=M0(t.p,n.Fp,r),s=M0(t.n,n.Fn,r),o=["Gx","Gy","a",e==="weierstrass"?"b":"d"];for(const a of o)if(!i.isValid(t[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return t=Object.freeze(Object.assign({},t)),{CURVE:t,Fp:i,Fn:s}}BigInt(0),BigInt(1),BigInt(2),BigInt(8),Qd("HashToScalar-");const Oi=BigInt(0),$r=BigInt(1),Qs=BigInt(2);function W6(e){return Xs(e,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze(Tr({},e))}function X6(e){const t=W6(e),{P:n,type:r,adjustScalarBytes:i,powPminus2:s,randomBytes:o}=t,a=r==="x25519";if(!a&&r!=="x448")throw new Error("invalid type");const c=o||Jn,f=a?255:448,u=a?32:56,d=BigInt(a?9:5),h=BigInt(a?121665:39081),l=a?Qs**BigInt(254):Qs**BigInt(447),g=a?BigInt(8)*Qs**BigInt(251)-$r:BigInt(4)*Qs**BigInt(445)-$r,w=l+g+$r,v=E=>ft(E,n),A=C(d);function C(E){return mc(v(E),u)}function x(E){const b=Le("u coordinate",E,u);return a&&(b[31]&=127),v(Ws(b))}function _(E){return Ws(i(Le("scalar",E,u)))}function R(E,b){const m=U(x(b),_(E));if(m===Oi)throw new Error("invalid private or public key received");return C(m)}function L(E){return R(E,A)}function j(E,b,m){const p=v(E*(b-m));return b=v(b-p),m=v(m+p),{x_2:b,x_3:m}}function U(E,b){vc("u",E,Oi,n),vc("scalar",b,l,w);const m=b,p=E;let y=$r,S=Oi,I=E,O=$r,B=Oi;for(let $=BigInt(f-1);$>=Oi;$--){const P=m>>$&$r;B^=P,{x_2:y,x_3:I}=j(B,y,I),{x_2:S,x_3:O}=j(B,S,O),B=P;const F=y+S,N=v(F*F),k=y-S,z=v(k*k),G=N-z,H=I+O,K=I-O,J=v(K*F),ee=v(H*k),re=J+ee,he=J-ee;I=v(re*re),O=v(p*v(he*he)),y=v(N*z),S=v(G*(N+v(h*G)))}({x_2:y,x_3:I}=j(B,y,I)),{x_2:S,x_3:O}=j(B,S,O);const T=s(S);return v(y*T)}const D={secretKey:u,publicKey:u,seed:u},q=(E=c(u))=>(Bt(E,D.seed),E);function M(E){const b=q(E);return{secretKey:b,publicKey:L(b)}}return{keygen:M,getSharedSecret:(E,b)=>R(E,b),getPublicKey:E=>L(E),scalarMult:R,scalarMultBase:L,utils:{randomSecretKey:q,randomPrivateKey:q},GuBytes:A.slice(),lengths:D}}const J6=BigInt(1),z0=BigInt(2),Q6=BigInt(3),e4=BigInt(5),t4=BigInt(8),q0=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),n4={p:q0,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:t4,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function r4(e){const t=BigInt(10),n=BigInt(20),r=BigInt(40),i=BigInt(80),s=q0,o=e*e%s*e%s,a=Dt(o,z0,s)*o%s,c=Dt(a,J6,s)*e%s,f=Dt(c,e4,s)*c%s,u=Dt(f,t,s)*f%s,d=Dt(u,n,s)*u%s,h=Dt(d,r,s)*d%s,l=Dt(h,i,s)*h%s,g=Dt(l,i,s)*h%s,w=Dt(g,t,s)*f%s;return{pow_p_5_8:Dt(w,z0,s)*e%s,b2:o}}function i4(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}const s4=Pn(n4.p,{isLE:!0}),Bc=(()=>{const e=s4.ORDER;return X6({P:e,type:"x25519",powPminus2:t=>{const{pow_p_5_8:n,b2:r}=r4(t);return ft(Dt(n,Q6,e)*r,e)},adjustScalarBytes:i4})})(),H0=(e,t)=>(e+(e>=0?t:-t)/V0)/t;function o4(e,t,n){const[[r,i],[s,o]]=t,a=H0(o*e,n),c=H0(-i*e,n);let f=e-a*r-c*s,u=-a*i-c*o;const d=f<sn,h=u<sn;d&&(f=-f),h&&(u=-u);const l=Ii(Math.ceil(_0(n)/2))+Lr;if(f<sn||f>=l||u<sn||u>=l)throw new Error("splitScalar (endomorphism): failed, k="+e);return{k1neg:d,k1:f,k2neg:h,k2:u}}function Ac(e){if(!["compact","recovered","der"].includes(e))throw new Error('Signature format must be "compact", "recovered", or "der"');return e}function Dc(e,t){const n={};for(let r of Object.keys(t))n[r]=e[r]===void 0?t[r]:e[r];return Gs(n.lowS,"lowS"),Gs(n.prehash,"prehash"),n.format!==void 0&&Ac(n.format),n}class a4 extends Error{constructor(t=""){super(t)}}const rn={Err:a4,_tlv:{encode:(e,t)=>{const{Err:n}=rn;if(e<0||e>256)throw new n("tlv.encode: wrong tag");if(t.length&1)throw new n("tlv.encode: unpadded data");const r=t.length/2,i=Zs(r);if(i.length/2&128)throw new n("tlv.encode: long form length too big");const s=r>127?Zs(i.length/2|128):"";return Zs(e)+s+i+t},decode(e,t){const{Err:n}=rn;let r=0;if(e<0||e>256)throw new n("tlv.encode: wrong tag");if(t.length<2||t[r++]!==e)throw new n("tlv.decode: wrong tlv");const i=t[r++],s=!!(i&128);let o=0;if(!s)o=i;else{const c=i&127;if(!c)throw new n("tlv.decode(long): indefinite length not supported");if(c>4)throw new n("tlv.decode(long): byte length is too big");const f=t.subarray(r,r+c);if(f.length!==c)throw new n("tlv.decode: length bytes not complete");if(f[0]===0)throw new n("tlv.decode(long): zero leftmost byte");for(const u of f)o=o<<8|u;if(r+=c,o<128)throw new n("tlv.decode(long): not minimal encoding")}const a=t.subarray(r,r+o);if(a.length!==o)throw new n("tlv.decode: wrong value length");return{v:a,l:t.subarray(r+o)}}},_int:{encode(e){const{Err:t}=rn;if(e<sn)throw new t("integer: negative integers are not allowed");let n=Zs(e);if(Number.parseInt(n[0],16)&8&&(n="00"+n),n.length&1)throw new t("unexpected DER parsing assertion: unpadded hex");return n},decode(e){const{Err:t}=rn;if(e[0]&128)throw new t("invalid signature integer: negative");if(e[0]===0&&!(e[1]&128))throw new t("invalid signature integer: unnecessary leading zero");return Ys(e)}},toSig(e){const{Err:t,_int:n,_tlv:r}=rn,i=Le("signature",e),{v:s,l:o}=r.decode(48,i);if(o.length)throw new t("invalid signature: left bytes after parsing");const{v:a,l:c}=r.decode(2,s),{v:f,l:u}=r.decode(2,c);if(u.length)throw new t("invalid signature: left bytes after parsing");return{r:n.decode(a),s:n.decode(f)}},hexFromSig(e){const{_tlv:t,_int:n}=rn,r=t.encode(2,n.encode(e.r)),i=t.encode(2,n.encode(e.s)),s=r+i;return t.encode(48,s)}},sn=BigInt(0),Lr=BigInt(1),V0=BigInt(2),eo=BigInt(3),c4=BigInt(4);function Ur(e,t){const{BYTES:n}=e;let r;if(typeof t=="bigint")r=t;else{let i=Le("private key",t);try{r=e.fromBytes(i)}catch{throw new Error(`invalid private key: expected ui8a of size ${n}, got ${typeof t}`)}}if(!e.isValidNot0(r))throw new Error("invalid private key: out of range [1..N-1]");return r}function f4(e,t={}){const n=Y6("weierstrass",e,t),{Fp:r,Fn:i}=n;let s=n.CURVE;const{h:o,n:a}=s;Xs(t,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:c}=t;if(c&&(!r.is0(s.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const f=G0(r,i);function u(){if(!r.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function d(E,b,m){const{x:p,y}=b.toAffine(),S=r.toBytes(p);if(Gs(m,"isCompressed"),m){u();const I=!r.isOdd(y);return On(K0(I),S)}else return On(Uint8Array.of(4),S,r.toBytes(y))}function h(E){Qn(E,void 0,"Point");const{publicKey:b,publicKeyUncompressed:m}=f,p=E.length,y=E[0],S=E.subarray(1);if(p===b&&(y===2||y===3)){const I=r.fromBytes(S);if(!r.isValid(I))throw new Error("bad point: is not on curve, wrong x");const O=w(I);let B;try{B=r.sqrt(O)}catch($){const P=$ instanceof Error?": "+$.message:"";throw new Error("bad point: is not on curve, sqrt error"+P)}u();const T=r.isOdd(B);return(y&1)===1!==T&&(B=r.neg(B)),{x:I,y:B}}else if(p===m&&y===4){const I=r.BYTES,O=r.fromBytes(S.subarray(0,I)),B=r.fromBytes(S.subarray(I,I*2));if(!v(O,B))throw new Error("bad point: is not on curve");return{x:O,y:B}}else throw new Error(`bad point: got length ${p}, expected compressed=${b} or uncompressed=${m}`)}const l=t.toBytes||d,g=t.fromBytes||h;function w(E){const b=r.sqr(E),m=r.mul(b,E);return r.add(r.add(m,r.mul(E,s.a)),s.b)}function v(E,b){const m=r.sqr(b),p=w(E);return r.eql(m,p)}if(!v(s.Gx,s.Gy))throw new Error("bad curve params: generator point");const A=r.mul(r.pow(s.a,eo),c4),C=r.mul(r.sqr(s.b),BigInt(27));if(r.is0(r.add(A,C)))throw new Error("bad curve params: a or b");function x(E,b,m=!1){if(!r.isValid(b)||m&&r.is0(b))throw new Error(`bad point coordinate ${E}`);return b}function _(E){if(!(E instanceof D))throw new Error("ProjectivePoint expected")}function R(E){if(!c||!c.basises)throw new Error("no endo");return o4(E,c.basises,i.ORDER)}const L=x0((E,b)=>{const{X:m,Y:p,Z:y}=E;if(r.eql(y,r.ONE))return{x:m,y:p};const S=E.is0();b==null&&(b=S?r.ONE:r.inv(y));const I=r.mul(m,b),O=r.mul(p,b),B=r.mul(y,b);if(S)return{x:r.ZERO,y:r.ZERO};if(!r.eql(B,r.ONE))throw new Error("invZ was invalid");return{x:I,y:O}}),j=x0(E=>{if(E.is0()){if(t.allowInfinityPoint&&!r.is0(E.Y))return;throw new Error("bad point: ZERO")}const{x:b,y:m}=E.toAffine();if(!r.isValid(b)||!r.isValid(m))throw new Error("bad point: x or y not field elements");if(!v(b,m))throw new Error("bad point: equation left != right");if(!E.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function U(E,b,m,p,y){return m=new D(r.mul(m.X,E),m.Y,m.Z),b=Js(p,b),m=Js(y,m),b.add(m)}class D{constructor(b,m,p){this.X=x("x",b),this.Y=x("y",m,!0),this.Z=x("z",p),Object.freeze(this)}static CURVE(){return s}static fromAffine(b){const{x:m,y:p}=b||{};if(!b||!r.isValid(m)||!r.isValid(p))throw new Error("invalid affine point");if(b instanceof D)throw new Error("projective point not allowed");return r.is0(m)&&r.is0(p)?D.ZERO:new D(m,p,r.ONE)}static fromBytes(b){const m=D.fromAffine(g(Qn(b,void 0,"point")));return m.assertValidity(),m}static fromHex(b){return D.fromBytes(Le("pointHex",b))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(b=8,m=!0){return M.createCache(this,b),m||this.multiply(eo),this}assertValidity(){j(this)}hasEvenY(){const{y:b}=this.toAffine();if(!r.isOdd)throw new Error("Field doesn't support isOdd");return!r.isOdd(b)}equals(b){_(b);const{X:m,Y:p,Z:y}=this,{X:S,Y:I,Z:O}=b,B=r.eql(r.mul(m,O),r.mul(S,y)),T=r.eql(r.mul(p,O),r.mul(I,y));return B&&T}negate(){return new D(this.X,r.neg(this.Y),this.Z)}double(){const{a:b,b:m}=s,p=r.mul(m,eo),{X:y,Y:S,Z:I}=this;let O=r.ZERO,B=r.ZERO,T=r.ZERO,$=r.mul(y,y),P=r.mul(S,S),F=r.mul(I,I),N=r.mul(y,S);return N=r.add(N,N),T=r.mul(y,I),T=r.add(T,T),O=r.mul(b,T),B=r.mul(p,F),B=r.add(O,B),O=r.sub(P,B),B=r.add(P,B),B=r.mul(O,B),O=r.mul(N,O),T=r.mul(p,T),F=r.mul(b,F),N=r.sub($,F),N=r.mul(b,N),N=r.add(N,T),T=r.add($,$),$=r.add(T,$),$=r.add($,F),$=r.mul($,N),B=r.add(B,$),F=r.mul(S,I),F=r.add(F,F),$=r.mul(F,N),O=r.sub(O,$),T=r.mul(F,P),T=r.add(T,T),T=r.add(T,T),new D(O,B,T)}add(b){_(b);const{X:m,Y:p,Z:y}=this,{X:S,Y:I,Z:O}=b;let B=r.ZERO,T=r.ZERO,$=r.ZERO;const P=s.a,F=r.mul(s.b,eo);let N=r.mul(m,S),k=r.mul(p,I),z=r.mul(y,O),G=r.add(m,p),H=r.add(S,I);G=r.mul(G,H),H=r.add(N,k),G=r.sub(G,H),H=r.add(m,y);let K=r.add(S,O);return H=r.mul(H,K),K=r.add(N,z),H=r.sub(H,K),K=r.add(p,y),B=r.add(I,O),K=r.mul(K,B),B=r.add(k,z),K=r.sub(K,B),$=r.mul(P,H),B=r.mul(F,z),$=r.add(B,$),B=r.sub(k,$),$=r.add(k,$),T=r.mul(B,$),k=r.add(N,N),k=r.add(k,N),z=r.mul(P,z),H=r.mul(F,H),k=r.add(k,z),z=r.sub(N,z),z=r.mul(P,z),H=r.add(H,z),N=r.mul(k,H),T=r.add(T,N),N=r.mul(K,H),B=r.mul(G,B),B=r.sub(B,N),N=r.mul(G,k),$=r.mul(K,$),$=r.add($,N),new D(B,T,$)}subtract(b){return this.add(b.negate())}is0(){return this.equals(D.ZERO)}multiply(b){const{endo:m}=t;if(!i.isValidNot0(b))throw new Error("invalid scalar: out of range");let p,y;const S=I=>M.cached(this,I,O=>xc(D,O));if(m){const{k1neg:I,k1:O,k2neg:B,k2:T}=R(b),{p:$,f:P}=S(O),{p:F,f:N}=S(T);y=P.add(N),p=U(m.beta,$,F,I,B)}else{const{p:I,f:O}=S(b);p=I,y=O}return xc(D,[p,y])[0]}multiplyUnsafe(b){const{endo:m}=t,p=this;if(!i.isValid(b))throw new Error("invalid scalar: out of range");if(b===sn||p.is0())return D.ZERO;if(b===Lr)return p;if(M.hasCache(this))return this.multiply(b);if(m){const{k1neg:y,k1:S,k2neg:I,k2:O}=R(b),{p1:B,p2:T}=G6(D,p,S,O);return U(m.beta,B,T,y,I)}else return M.unsafe(p,b)}multiplyAndAddUnsafe(b,m,p){const y=this.multiplyUnsafe(m).add(b.multiplyUnsafe(p));return y.is0()?void 0:y}toAffine(b){return L(this,b)}isTorsionFree(){const{isTorsionFree:b}=t;return o===Lr?!0:b?b(D,this):M.unsafe(this,a).is0()}clearCofactor(){const{clearCofactor:b}=t;return o===Lr?this:b?b(D,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes(b=!0){return Gs(b,"isCompressed"),this.assertValidity(),l(D,this,b)}toHex(b=!0){return Nr(this.toBytes(b))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(b=!0){return this.toBytes(b)}_setWindowSize(b){this.precompute(b)}static normalizeZ(b){return xc(D,b)}static msm(b,m){return Z6(D,i,b,m)}static fromPrivateKey(b){return D.BASE.multiply(Ur(i,b))}}D.BASE=new D(s.Gx,s.Gy,r.ONE),D.ZERO=new D(r.ZERO,r.ONE,r.ZERO),D.Fp=r,D.Fn=i;const q=i.BITS,M=new K6(D,t.endo?Math.ceil(q/2):q);return D.BASE.precompute(8),D}function K0(e){return Uint8Array.of(e?2:3)}function G0(e,t){return{secretKey:t.BYTES,publicKey:1+e.BYTES,publicKeyUncompressed:1+2*e.BYTES,publicKeyHasPrefix:!0,signature:2*t.BYTES}}function u4(e,t={}){const{Fn:n}=e,r=t.randomBytes||Jn,i=Object.assign(G0(e.Fp,n),{seed:L0(n.ORDER)});function s(h){try{return!!Ur(n,h)}catch{return!1}}function o(h,l){const{publicKey:g,publicKeyUncompressed:w}=i;try{const v=h.length;return l===!0&&v!==g||l===!1&&v!==w?!1:!!e.fromBytes(h)}catch{return!1}}function a(h=r(i.seed)){return q6(Qn(h,i.seed,"seed"),n.ORDER)}function c(h,l=!0){return e.BASE.multiply(Ur(n,h)).toBytes(l)}function f(h){const l=a(h);return{secretKey:l,publicKey:c(l)}}function u(h){if(typeof h=="bigint")return!1;if(h instanceof e)return!0;const{secretKey:l,publicKey:g,publicKeyUncompressed:w}=i;if(n.allowedLengths||l===g)return;const v=Le("key",h).length;return v===g||v===w}function d(h,l,g=!0){if(u(h)===!0)throw new Error("first arg must be private key");if(u(l)===!1)throw new Error("second arg must be public key");const w=Ur(n,h);return e.fromHex(l).multiply(w).toBytes(g)}return Object.freeze({getPublicKey:c,getSharedSecret:d,keygen:f,Point:e,utils:{isValidSecretKey:s,isValidPublicKey:o,randomSecretKey:a,isValidPrivateKey:s,randomPrivateKey:a,normPrivateKeyToScalar:h=>Ur(n,h),precompute(h=8,l=e.BASE){return l.precompute(h,!1)}},lengths:i})}function l4(e,t,n={}){Ms(t),Xs(n,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const r=n.randomBytes||Jn,i=n.hmac||((m,...p)=>Vs(t,m,On(...p))),{Fp:s,Fn:o}=e,{ORDER:a,BITS:c}=o,{keygen:f,getPublicKey:u,getSharedSecret:d,utils:h,lengths:l}=u4(e,n),g={prehash:!1,lowS:typeof n.lowS=="boolean"?n.lowS:!1,format:void 0,extraEntropy:!1},w="compact";function v(m){const p=a>>Lr;return m>p}function A(m,p){if(!o.isValidNot0(p))throw new Error(`invalid signature ${m}: out of range 1..Point.Fn.ORDER`);return p}function C(m,p){Ac(p);const y=l.signature,S=p==="compact"?y:p==="recovered"?y+1:void 0;return Qn(m,S,`${p} signature`)}class x{constructor(p,y,S){this.r=A("r",p),this.s=A("s",y),S!=null&&(this.recovery=S),Object.freeze(this)}static fromBytes(p,y=w){C(p,y);let S;if(y==="der"){const{r:T,s:$}=rn.toSig(Qn(p));return new x(T,$)}y==="recovered"&&(S=p[0],y="compact",p=p.subarray(1));const I=o.BYTES,O=p.subarray(0,I),B=p.subarray(I,I*2);return new x(o.fromBytes(O),o.fromBytes(B),S)}static fromHex(p,y){return this.fromBytes(zs(p),y)}addRecoveryBit(p){return new x(this.r,this.s,p)}recoverPublicKey(p){const y=s.ORDER,{r:S,s:I,recovery:O}=this;if(O==null||![0,1,2,3].includes(O))throw new Error("recovery id invalid");if(a*V0<y&&O>1)throw new Error("recovery id is ambiguous for h>1 curve");const B=O===2||O===3?S+a:S;if(!s.isValid(B))throw new Error("recovery id 2 or 3 invalid");const T=s.toBytes(B),$=e.fromBytes(On(K0((O&1)===0),T)),P=o.inv(B),F=R(Le("msgHash",p)),N=o.create(-F*P),k=o.create(I*P),z=e.BASE.multiplyUnsafe(N).add($.multiplyUnsafe(k));if(z.is0())throw new Error("point at infinify");return z.assertValidity(),z}hasHighS(){return v(this.s)}toBytes(p=w){if(Ac(p),p==="der")return zs(rn.hexFromSig(this));const y=o.toBytes(this.r),S=o.toBytes(this.s);if(p==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return On(Uint8Array.of(this.recovery),y,S)}return On(y,S)}toHex(p){return Nr(this.toBytes(p))}assertValidity(){}static fromCompact(p){return x.fromBytes(Le("sig",p),"compact")}static fromDER(p){return x.fromBytes(Le("sig",p),"der")}normalizeS(){return this.hasHighS()?new x(this.r,o.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return Nr(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return Nr(this.toBytes("compact"))}}const _=n.bits2int||function(m){if(m.length>8192)throw new Error("input is too large");const p=Ys(m),y=m.length*8-c;return y>0?p>>BigInt(y):p},R=n.bits2int_modN||function(m){return o.create(_(m))},L=Ii(c);function j(m){return vc("num < 2^"+c,m,sn,L),o.toBytes(m)}function U(m,p){return Qn(m,void 0,"message"),p?Qn(t(m),void 0,"prehashed message"):m}function D(m,p,y){if(["recovered","canonical"].some(k=>k in y))throw new Error("sign() legacy options not supported");const{lowS:S,prehash:I,extraEntropy:O}=Dc(y,g);m=U(m,I);const B=R(m),T=Ur(o,p),$=[j(T),j(B)];if(O!=null&&O!==!1){const k=O===!0?r(l.secretKey):O;$.push(Le("extraEntropy",k))}const P=On(...$),F=B;function N(k){const z=_(k);if(!o.isValidNot0(z))return;const G=o.inv(z),H=e.BASE.multiply(z).toAffine(),K=o.create(H.x);if(K===sn)return;const J=o.create(G*o.create(F+K*T));if(J===sn)return;let ee=(H.x===K?0:2)|Number(H.y&Lr),re=J;return S&&v(J)&&(re=o.neg(J),ee^=1),new x(K,re,ee)}return{seed:P,k2sig:N}}function q(m,p,y={}){m=Le("message",m);const{seed:S,k2sig:I}=D(m,p,y);return P6(t.outputLen,o.BYTES,i)(S,I)}function M(m){let p;const y=typeof m=="string"||ks(m),S=!y&&m!==null&&typeof m=="object"&&typeof m.r=="bigint"&&typeof m.s=="bigint";if(!y&&!S)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(S)p=new x(m.r,m.s);else if(y){try{p=x.fromBytes(Le("sig",m),"der")}catch(I){if(!(I instanceof rn.Err))throw I}if(!p)try{p=x.fromBytes(Le("sig",m),"compact")}catch{return!1}}return p||!1}function E(m,p,y,S={}){const{lowS:I,prehash:O,format:B}=Dc(S,g);if(y=Le("publicKey",y),p=U(Le("message",p),O),"strict"in S)throw new Error("options.strict was renamed to lowS");const T=B===void 0?M(m):x.fromBytes(Le("sig",m),B);if(T===!1)return!1;try{const $=e.fromBytes(y);if(I&&T.hasHighS())return!1;const{r:P,s:F}=T,N=R(p),k=o.inv(F),z=o.create(N*k),G=o.create(P*k),H=e.BASE.multiplyUnsafe(z).add($.multiplyUnsafe(G));return H.is0()?!1:o.create(H.x)===P}catch{return!1}}function b(m,p,y={}){const{prehash:S}=Dc(y,g);return p=U(p,S),x.fromBytes(m,"recovered").recoverPublicKey(p).toBytes()}return Object.freeze({keygen:f,getPublicKey:u,getSharedSecret:d,utils:h,lengths:l,Point:e,sign:q,verify:E,recoverPublicKey:b,Signature:x,hash:t})}function h4(e){const t={a:e.a,b:e.b,p:e.Fp.ORDER,n:e.n,h:e.h,Gx:e.Gx,Gy:e.Gy},n=e.Fp;let r=e.allowedPrivateKeyLengths?Array.from(new Set(e.allowedPrivateKeyLengths.map(o=>Math.ceil(o/2)))):void 0;const i=Pn(t.n,{BITS:e.nBitLength,allowedLengths:r,modFromBytes:e.wrapPrivateKey}),s={Fp:n,Fn:i,allowInfinityPoint:e.allowInfinityPoint,endo:e.endo,isTorsionFree:e.isTorsionFree,clearCofactor:e.clearCofactor,fromBytes:e.fromBytes,toBytes:e.toBytes};return{CURVE:t,curveOpts:s}}function d4(e){const{CURVE:t,curveOpts:n}=h4(e),r={hmac:e.hmac,randomBytes:e.randomBytes,lowS:e.lowS,bits2int:e.bits2int,bits2int_modN:e.bits2int_modN};return{CURVE:t,curveOpts:n,hash:e.hash,ecdsaOpts:r}}function g4(e,t){const n=t.Point;return Object.assign({},t,{ProjectivePoint:n,CURVE:Object.assign({},e,P0(n.Fn.ORDER,n.Fn.BITS))})}function p4(e){const{CURVE:t,curveOpts:n,hash:r,ecdsaOpts:i}=d4(e),s=f4(t,n),o=l4(s,r,i);return g4(e,o)}function Tc(e,t){const n=r=>p4(yi(Tr({},e),{hash:r}));return yi(Tr({},n(t)),{create:n})}const Z0={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},Y0={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},W0={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},b4=Pn(Z0.p),y4=Pn(Y0.p),w4=Pn(W0.p),m4=Tc(yi(Tr({},Z0),{Fp:b4,lowS:!1}),c0);Tc(yi(Tr({},Y0),{Fp:y4,lowS:!1}),t6),Tc(yi(Tr({},W0),{Fp:w4,lowS:!1,allowedPrivateKeyLengths:[130,131,132]}),e6);const E4=m4,X0="base10",Ve="base16",nr="base64pad",Rc="base64url",Bi="utf8",J0=0,Fr=1,to=2,v4=0,Q0=1,Ai=12,Nc=32;function _4(){const e=Bc.utils.randomPrivateKey(),t=Bc.getPublicKey(e);return{privateKey:et(e,Ve),publicKey:et(t,Ve)}}function Cc(){const e=Jn(Nc);return et(e,Ve)}function x4(e,t){const n=Bc.getSharedSecret(ot(e,Ve),ot(t,Ve)),r=N6(Ks,n,void 0,void 0,Nc);return et(r,Ve)}function S4(e){const t=Ks(ot(e,Ve));return et(t,Ve)}function no(e){const t=Ks(ot(e,Bi));return et(t,Ve)}function eg(e){return ot(`${e}`,X0)}function rr(e){return Number(et(e,X0))}function tg(e){return e.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function ng(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),n=(4-t.length%4)%4;return t+"=".repeat(n)}function I4(e){const t=eg(typeof e.type<"u"?e.type:J0);if(rr(t)===Fr&&typeof e.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const n=typeof e.senderPublicKey<"u"?ot(e.senderPublicKey,Ve):void 0,r=typeof e.iv<"u"?ot(e.iv,Ve):Jn(Ai),i=ot(e.symKey,Ve),s=w0(i,r).encrypt(ot(e.message,Bi)),o=rg({type:t,sealed:s,iv:r,senderPublicKey:n});return e.encoding===Rc?tg(o):o}function O4(e){const t=ot(e.symKey,Ve),{sealed:n,iv:r}=Di({encoded:e.encoded,encoding:e.encoding}),i=w0(t,r).decrypt(n);if(i===null)throw new Error("Failed to decrypt");return et(i,Bi)}function B4(e,t){const n=eg(to),r=Jn(Ai),i=ot(e,Bi),s=rg({type:n,sealed:i,iv:r});return t===Rc?tg(s):s}function A4(e,t){const{sealed:n}=Di({encoded:e,encoding:t});return et(n,Bi)}function rg(e){if(rr(e.type)===to)return et(bi([e.type,e.sealed]),nr);if(rr(e.type)===Fr){if(typeof e.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return et(bi([e.type,e.senderPublicKey,e.iv,e.sealed]),nr)}return et(bi([e.type,e.iv,e.sealed]),nr)}function Di(e){const t=(e.encoding||nr)===Rc?ng(e.encoded):e.encoded,n=ot(t,nr),r=n.slice(v4,Q0),i=Q0;if(rr(r)===Fr){const c=i+Nc,f=c+Ai,u=n.slice(i,c),d=n.slice(c,f),h=n.slice(f);return{type:r,sealed:h,iv:d,senderPublicKey:u}}if(rr(r)===to){const c=n.slice(i),f=Jn(Ai);return{type:r,sealed:c,iv:f}}const s=i+Ai,o=n.slice(i,s),a=n.slice(s);return{type:r,sealed:a,iv:o}}function D4(e,t){const n=Di({encoded:e,encoding:t?.encoding});return ig({type:rr(n.type),senderPublicKey:typeof n.senderPublicKey<"u"?et(n.senderPublicKey,Ve):void 0,receiverPublicKey:t?.receiverPublicKey})}function ig(e){const t=e?.type||J0;if(t===Fr){if(typeof e?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof e?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:t,senderPublicKey:e?.senderPublicKey,receiverPublicKey:e?.receiverPublicKey}}function sg(e){return e.type===Fr&&typeof e.senderPublicKey=="string"&&typeof e.receiverPublicKey=="string"}function og(e){return e.type===to}function T4(e){const t=Buffer.from(e.x,"base64"),n=Buffer.from(e.y,"base64");return bi([new Uint8Array([4]),t,n])}function R4(e,t){const[n,r,i]=e.split("."),s=Buffer.from(ng(i),"base64");if(s.length!==64)throw new Error("Invalid signature length");const o=s.slice(0,32),a=s.slice(32,64),c=`${n}.${r}`,f=Ks(c),u=T4(t);if(!E4.verify(bi([o,a]),f,u))throw new Error("Invalid signature");return Zo(e).payload}const N4="irn";function ro(e){return e?.relay||{protocol:N4}}function jr(e){const t=i8[e];if(typeof t>"u")throw new Error(`Relay Protocol not supported: ${e}`);return t}var C4=Object.defineProperty,P4=Object.defineProperties,$4=Object.getOwnPropertyDescriptors,ag=Object.getOwnPropertySymbols,L4=Object.prototype.hasOwnProperty,U4=Object.prototype.propertyIsEnumerable,cg=(e,t,n)=>t in e?C4(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Pc=(e,t)=>{for(var n in t||(t={}))L4.call(t,n)&&cg(e,n,t[n]);if(ag)for(var n of ag(t))U4.call(t,n)&&cg(e,n,t[n]);return e},F4=(e,t)=>P4(e,$4(t));function j4(e,t="-"){const n={},r="relay"+t;return Object.keys(e).forEach(i=>{if(i.startsWith(r)){const s=i.replace(r,""),o=e[i];n[s]=o}}),n}function fg(e){if(!e.includes("wc:")){const f=qd(e);f!=null&&f.includes("wc:")&&(e=f)}e=e.includes("wc://")?e.replace("wc://",""):e,e=e.includes("wc:")?e.replace("wc:",""):e;const t=e.indexOf(":"),n=e.indexOf("?")!==-1?e.indexOf("?"):void 0,r=e.substring(0,t),i=e.substring(t+1,n).split("@"),s=typeof n<"u"?e.substring(n):"",o=new URLSearchParams(s),a=Object.fromEntries(o.entries()),c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:r,topic:k4(i[0]),version:parseInt(i[1],10),symKey:a.symKey,relay:j4(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function k4(e){return e.startsWith("//")?e.substring(2):e}function M4(e,t="-"){const n="relay",r={};return Object.keys(e).forEach(i=>{const s=i,o=n+t+s;e[s]&&(r[o]=e[s])}),r}function ug(e){const t=new URLSearchParams,n=Pc(Pc(F4(Pc({},M4(e.relay)),{symKey:e.symKey}),e.expiryTimestamp&&{expiryTimestamp:e.expiryTimestamp.toString()}),e.methods&&{methods:e.methods.join(",")});return Object.entries(n).sort(([r],[i])=>r.localeCompare(i)).forEach(([r,i])=>{i!==void 0&&t.append(r,String(i))}),`${e.protocol}:${e.topic}@${e.version}?${t}`}const z4={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},q4={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function oe(e,t){const{message:n,code:r}=q4[e];return{message:t?`${n} ${t}`:n,code:r}}function Ti(e,t){const{message:n,code:r}=z4[e];return{message:t?`${n} ${t}`:n,code:r}}function kr(e){return typeof e>"u"}function lg(e,t){return t&&kr(e)?!0:typeof e=="string"&&!!e.trim().length}function H4(e){function t(n){try{return typeof new URL(n)<"u"}catch{return!1}}try{if(lg(e,!1)){if(t(e))return!0;const n=qd(e);return t(n)}}catch{}return!1}function V4(e){var t;return(t=e?.proposer)==null?void 0:t.publicKey}function K4(e){return e?.topic}function $c(e){return typeof e<"u"&&typeof e!==null}function hg(){const e=Fs();return new Promise(t=>{switch(e){case It.browser:t(G4());break;case It.reactNative:t(Z4());break;case It.node:t(Y4());break;default:t(!0)}})}function G4(){return wi()&&navigator?.onLine}async function Z4(){if(Xn()&&typeof global<"u"&&global!=null&&global.NetInfo){const e=await(global==null?void 0:global.NetInfo.fetch());return e?.isConnected}return!0}function Y4(){return!0}function W4(e){switch(Fs()){case It.browser:X4(e);break;case It.reactNative:J4(e);break}}function X4(e){!Xn()&&wi()&&(window.addEventListener("online",()=>e(!0)),window.addEventListener("offline",()=>e(!1)))}function J4(e){Xn()&&typeof global<"u"&&global!=null&&global.NetInfo&&global?.NetInfo.addEventListener(t=>e(t?.isConnected))}function Q4(){var e;return wi()&&gr()?((e=gr())==null?void 0:e.visibilityState)==="visible":!0}var e5=Object.defineProperty,t5=(e,t,n)=>t in e?e5(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ft=(e,t,n)=>t5(e,typeof t!="symbol"?t+"":t,n);class dg{constructor(t,n){this.core=t,this.logger=n,Ft(this,"keychain",new Map),Ft(this,"name",kf),Ft(this,"version",Mf),Ft(this,"initialized",!1),Ft(this,"storagePrefix",Et),Ft(this,"init",async()=>{if(!this.initialized){const r=await this.getKeyChain();typeof r<"u"&&(this.keychain=r),this.initialized=!0}}),Ft(this,"has",r=>(this.isInitialized(),this.keychain.has(r))),Ft(this,"set",async(r,i)=>{this.isInitialized(),this.keychain.set(r,i),await this.persist()}),Ft(this,"get",r=>{this.isInitialized();const i=this.keychain.get(r);if(typeof i>"u"){const{message:s}=oe("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(s)}return i}),Ft(this,"del",async r=>{this.isInitialized(),this.keychain.delete(r),await this.persist()}),this.core=t,this.logger=Ge(n,this.name)}get context(){return it(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(t){await this.core.storage.setItem(this.storageKey,tc(t))}async getKeyChain(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?nc(t):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:t}=oe("NOT_INITIALIZED",this.name);throw new Error(t)}}}var n5=Object.defineProperty,r5=(e,t,n)=>t in e?n5(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ae=(e,t,n)=>r5(e,typeof t!="symbol"?t+"":t,n);class gg{constructor(t,n,r){this.core=t,this.logger=n,Ae(this,"name",Ff),Ae(this,"keychain"),Ae(this,"randomSessionIdentifier",Cc()),Ae(this,"initialized",!1),Ae(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),Ae(this,"hasKeys",i=>(this.isInitialized(),this.keychain.has(i))),Ae(this,"getClientId",async()=>{this.isInitialized();const i=await this.getClientSeed(),s=ul(i);return fl(s.publicKey)}),Ae(this,"generateKeyPair",()=>{this.isInitialized();const i=_4();return this.setPrivateKey(i.publicKey,i.privateKey)}),Ae(this,"signJWT",async i=>{this.isInitialized();const s=await this.getClientSeed(),o=ul(s),a=this.randomSessionIdentifier;return await ym(a,i,jf,o)}),Ae(this,"generateSharedKey",(i,s,o)=>{this.isInitialized();const a=this.getPrivateKey(i),c=x4(a,s);return this.setSymKey(c,o)}),Ae(this,"setSymKey",async(i,s)=>{this.isInitialized();const o=s||S4(i);return await this.keychain.set(o,i),o}),Ae(this,"deleteKeyPair",async i=>{this.isInitialized(),await this.keychain.del(i)}),Ae(this,"deleteSymKey",async i=>{this.isInitialized(),await this.keychain.del(i)}),Ae(this,"encode",async(i,s,o)=>{this.isInitialized();const a=ig(o),c=kn(s);if(og(a))return B4(c,o?.encoding);if(sg(a)){const h=a.senderPublicKey,l=a.receiverPublicKey;i=await this.generateSharedKey(h,l)}const f=this.getSymKey(i),{type:u,senderPublicKey:d}=a;return I4({type:u,symKey:f,message:c,senderPublicKey:d,encoding:o?.encoding})}),Ae(this,"decode",async(i,s,o)=>{this.isInitialized();const a=D4(s,o);if(og(a)){const c=A4(s,o?.encoding);return or(c)}if(sg(a)){const c=a.receiverPublicKey,f=a.senderPublicKey;i=await this.generateSharedKey(c,f)}try{const c=this.getSymKey(i),f=O4({symKey:c,encoded:s,encoding:o?.encoding});return or(f)}catch(c){this.logger.error(`Failed to decode message from topic: '${i}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),Ae(this,"getPayloadType",(i,s=nr)=>{const o=Di({encoded:i,encoding:s});return rr(o.type)}),Ae(this,"getPayloadSenderPublicKey",(i,s=nr)=>{const o=Di({encoded:i,encoding:s});return o.senderPublicKey?et(o.senderPublicKey,Ve):void 0}),this.core=t,this.logger=Ge(n,this.name),this.keychain=r||new dg(this.core,this.logger)}get context(){return it(this.logger)}async setPrivateKey(t,n){return await this.keychain.set(t,n),t}getPrivateKey(t){return this.keychain.get(t)}async getClientSeed(){let t="";try{t=this.keychain.get(Io)}catch{t=Cc(),await this.keychain.set(Io,t)}return ot(t,"base16")}getSymKey(t){return this.keychain.get(t)}isInitialized(){if(!this.initialized){const{message:t}=oe("NOT_INITIALIZED",this.name);throw new Error(t)}}}var i5=Object.defineProperty,s5=Object.defineProperties,o5=Object.getOwnPropertyDescriptors,pg=Object.getOwnPropertySymbols,a5=Object.prototype.hasOwnProperty,c5=Object.prototype.propertyIsEnumerable,Lc=(e,t,n)=>t in e?i5(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,f5=(e,t)=>{for(var n in t||(t={}))a5.call(t,n)&&Lc(e,n,t[n]);if(pg)for(var n of pg(t))c5.call(t,n)&&Lc(e,n,t[n]);return e},u5=(e,t)=>s5(e,o5(t)),ut=(e,t,n)=>Lc(e,typeof t!="symbol"?t+"":t,n);class bg extends cb{constructor(t,n){super(t,n),this.logger=t,this.core=n,ut(this,"messages",new Map),ut(this,"messagesWithoutClientAck",new Map),ut(this,"name",zf),ut(this,"version",qf),ut(this,"initialized",!1),ut(this,"storagePrefix",Et),ut(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const r=await this.getRelayerMessages();typeof r<"u"&&(this.messages=r);const i=await this.getRelayerMessagesWithoutClientAck();typeof i<"u"&&(this.messagesWithoutClientAck=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(r){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(r)}finally{this.initialized=!0}}}),ut(this,"set",async(r,i,s)=>{this.isInitialized();const o=no(i);let a=this.messages.get(r);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=i,this.messages.set(r,a),s===Xr.inbound){const c=this.messagesWithoutClientAck.get(r)||{};this.messagesWithoutClientAck.set(r,u5(f5({},c),{[o]:i}))}return await this.persist(),o}),ut(this,"get",r=>{this.isInitialized();let i=this.messages.get(r);return typeof i>"u"&&(i={}),i}),ut(this,"getWithoutAck",r=>{this.isInitialized();const i={};for(const s of r){const o=this.messagesWithoutClientAck.get(s)||{};i[s]=Object.values(o)}return i}),ut(this,"has",(r,i)=>{this.isInitialized();const s=this.get(r),o=no(i);return typeof s[o]<"u"}),ut(this,"ack",async(r,i)=>{this.isInitialized();const s=this.messagesWithoutClientAck.get(r);if(typeof s>"u")return;const o=no(i);delete s[o],Object.keys(s).length===0?this.messagesWithoutClientAck.delete(r):this.messagesWithoutClientAck.set(r,s),await this.persist()}),ut(this,"del",async r=>{this.isInitialized(),this.messages.delete(r),this.messagesWithoutClientAck.delete(r),await this.persist()}),this.logger=Ge(t,this.name),this.core=n}get context(){return it(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(t){await this.core.storage.setItem(this.storageKey,tc(t))}async setRelayerMessagesWithoutClientAck(t){await this.core.storage.setItem(this.storageKeyWithoutClientAck,tc(t))}async getRelayerMessages(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?nc(t):void 0}async getRelayerMessagesWithoutClientAck(){const t=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof t<"u"?nc(t):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:t}=oe("NOT_INITIALIZED",this.name);throw new Error(t)}}}const l5="PARSE_ERROR",h5="INVALID_REQUEST",d5="METHOD_NOT_FOUND",g5="INVALID_PARAMS",yg="INTERNAL_ERROR",Uc="SERVER_ERROR",p5=[-32700,-32600,-32601,-32602,-32603],Ri={[l5]:{code:-32700,message:"Parse error"},[h5]:{code:-32600,message:"Invalid Request"},[d5]:{code:-32601,message:"Method not found"},[g5]:{code:-32602,message:"Invalid params"},[yg]:{code:-32603,message:"Internal error"},[Uc]:{code:-32e3,message:"Server error"}},wg=Uc;function b5(e){return p5.includes(e)}function mg(e){return Object.keys(Ri).includes(e)?Ri[e]:Ri[wg]}function y5(e){const t=Object.values(Ri).find(n=>n.code===e);return t||Ri[wg]}function w5(e,t,n){return e.message.includes("getaddrinfo ENOTFOUND")||e.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${n} RPC url at ${t}`):e}var Eg={};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var Fc=function(e,t){return Fc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)r.hasOwnProperty(i)&&(n[i]=r[i])},Fc(e,t)};function m5(e,t){Fc(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}var jc=function(){return jc=Object.assign||function(t){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},jc.apply(this,arguments)};function E5(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n}function v5(e,t,n,r){var i=arguments.length,s=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s}function _5(e,t){return function(n,r){t(n,r,e)}}function x5(e,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(e,t)}function S5(e,t,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{f(r.next(u))}catch(d){o(d)}}function c(u){try{f(r.throw(u))}catch(d){o(d)}}function f(u){u.done?s(u.value):i(u.value).then(a,c)}f((r=r.apply(e,t||[])).next())})}function I5(e,t){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(f){return function(u){return c([f,u])}}function c(f){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(s=f[0]&2?i.return:f[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,f[1])).done)return s;switch(i=0,s&&(f=[f[0]&2,s.value]),f[0]){case 0:case 1:s=f;break;case 4:return n.label++,{value:f[1],done:!1};case 5:n.label++,i=f[1],f=[0];continue;case 7:f=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(f[0]===6||f[0]===2)){n=0;continue}if(f[0]===3&&(!s||f[1]>s[0]&&f[1]<s[3])){n.label=f[1];break}if(f[0]===6&&n.label<s[1]){n.label=s[1],s=f;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(f);break}s[2]&&n.ops.pop(),n.trys.pop();continue}f=t.call(e,n)}catch(u){f=[6,u],i=0}finally{r=s=0}if(f[0]&5)throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}}function O5(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]}function B5(e,t){for(var n in e)n!=="default"&&!t.hasOwnProperty(n)&&(t[n]=e[n])}function kc(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function vg(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,s=[],o;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}function A5(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(vg(arguments[t]));return e}function D5(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var r=Array(e),i=0,t=0;t<n;t++)for(var s=arguments[t],o=0,a=s.length;o<a;o++,i++)r[i]=s[o];return r}function Ni(e){return this instanceof Ni?(this.v=e,this):new Ni(e)}function T5(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(e,t||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(h){r[h]&&(i[h]=function(l){return new Promise(function(g,w){s.push([h,l,g,w])>1||a(h,l)})})}function a(h,l){try{c(r[h](l))}catch(g){d(s[0][3],g)}}function c(h){h.value instanceof Ni?Promise.resolve(h.value.v).then(f,u):d(s[0][2],h)}function f(h){a("next",h)}function u(h){a("throw",h)}function d(h,l){h(l),s.shift(),s.length&&a(s[0][0],s[0][1])}}function R5(e){var t,n;return t={},r("next"),r("throw",function(i){throw i}),r("return"),t[Symbol.iterator]=function(){return this},t;function r(i,s){t[i]=e[i]?function(o){return(n=!n)?{value:Ni(e[i](o)),done:i==="return"}:s?s(o):o}:s}}function N5(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],n;return t?t.call(e):(e=typeof kc=="function"?kc(e):e[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=e[s]&&function(o){return new Promise(function(a,c){o=e[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(f){s({value:f,done:a})},o)}}function C5(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}function P5(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function $5(e){return e&&e.__esModule?e:{default:e}}function L5(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)}function U5(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n}var F5=Object.freeze({__proto__:null,__extends:m5,get __assign(){return jc},__rest:E5,__decorate:v5,__param:_5,__metadata:x5,__awaiter:S5,__generator:I5,__createBinding:O5,__exportStar:B5,__values:kc,__read:vg,__spread:A5,__spreadArrays:D5,__await:Ni,__asyncGenerator:T5,__asyncDelegator:R5,__asyncValues:N5,__makeTemplateObject:C5,__importStar:P5,__importDefault:$5,__classPrivateFieldGet:L5,__classPrivateFieldSet:U5}),j5=Jc(F5),on={},_g;function k5(){if(_g)return on;_g=1,Object.defineProperty(on,"__esModule",{value:!0}),on.isBrowserCryptoAvailable=on.getSubtleCrypto=on.getBrowerCrypto=void 0;function e(){return Tt?.crypto||Tt?.msCrypto||{}}on.getBrowerCrypto=e;function t(){const r=e();return r.subtle||r.webkitSubtle}on.getSubtleCrypto=t;function n(){return!!e()&&!!t()}return on.isBrowserCryptoAvailable=n,on}var an={},xg;function M5(){if(xg)return an;xg=1,Object.defineProperty(an,"__esModule",{value:!0}),an.isBrowser=an.isNode=an.isReactNative=void 0;function e(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}an.isReactNative=e;function t(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}an.isNode=t;function n(){return!e()&&!t()}return an.isBrowser=n,an}(function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=j5;t.__exportStar(k5(),e),t.__exportStar(M5(),e)})(Eg);function Sg(e=3){const t=Date.now()*Math.pow(10,e),n=Math.floor(Math.random()*Math.pow(10,e));return t+n}function io(e=6){return BigInt(Sg(e))}function Mc(e,t,n){return{id:n||Sg(),jsonrpc:"2.0",method:e,params:t}}function Ig(e,t){return{id:e,jsonrpc:"2.0",result:t}}function Og(e,t,n){return{id:e,jsonrpc:"2.0",error:z5(t,n)}}function z5(e,t){return typeof e>"u"?mg(yg):(typeof e=="string"&&(e=Object.assign(Object.assign({},mg(Uc)),{message:e})),typeof t<"u"&&(e.data=t),b5(e.code)&&(e=y5(e.code)),e)}class q5{}class H5 extends q5{constructor(){super()}}class V5 extends H5{constructor(t){super()}}const K5="^wss?:";function G5(e){const t=e.match(new RegExp(/^\w+:/,"gi"));if(!(!t||!t.length))return t[0]}function Z5(e,t){const n=G5(e);return typeof n>"u"?!1:new RegExp(t).test(n)}function Bg(e){return Z5(e,K5)}function Y5(e){return new RegExp("wss?://localhost(:d{2,5})?").test(e)}function Ag(e){return typeof e=="object"&&"id"in e&&"jsonrpc"in e&&e.jsonrpc==="2.0"}function Dg(e){return Ag(e)&&"method"in e}function zc(e){return Ag(e)&&(Tg(e)||so(e))}function Tg(e){return"result"in e}function so(e){return"error"in e}class W5 extends V5{constructor(t){super(t),this.events=new lt.exports.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(t),this.connection.connected&&this.registerEventListeners()}async connect(t=this.connection){await this.open(t)}async disconnect(){await this.close()}on(t,n){this.events.on(t,n)}once(t,n){this.events.once(t,n)}off(t,n){this.events.off(t,n)}removeListener(t,n){this.events.removeListener(t,n)}async request(t,n){return this.requestStrict(Mc(t.method,t.params||[],t.id||io().toString()),n)}async requestStrict(t,n){return new Promise(async(r,i)=>{if(!this.connection.connected)try{await this.open()}catch(s){i(s)}this.events.on(`${t.id}`,s=>{so(s)?i(s.error):r(s.result)});try{await this.connection.send(t,n)}catch(s){i(s)}})}setConnection(t=this.connection){return t}onPayload(t){this.events.emit("payload",t),zc(t)?this.events.emit(`${t.id}`,t):this.events.emit("message",{type:t.method,data:t.params})}onClose(t){t&&t.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${t.code} ${t.reason?`(${t.reason})`:""}`)),this.events.emit("disconnect")}async open(t=this.connection){this.connection===t&&this.connection.connected||(this.connection.connected&&this.close(),typeof t=="string"&&(await this.connection.open(t),t=this.connection),this.connection=this.setConnection(t),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",t=>this.onPayload(t)),this.connection.on("close",t=>this.onClose(t)),this.connection.on("error",t=>this.events.emit("error",t)),this.connection.on("register_error",t=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const X5=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),J5=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Rg=e=>e.split("?")[0],Ng=10,Q5=X5();class e_{constructor(t){if(this.url=t,this.events=new lt.exports.EventEmitter,this.registering=!1,!Bg(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);this.url=t}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(t,n){this.events.on(t,n)}once(t,n){this.events.once(t,n)}off(t,n){this.events.off(t,n)}removeListener(t,n){this.events.removeListener(t,n)}async open(t=this.url){await this.register(t)}async close(){return new Promise((t,n)=>{if(typeof this.socket>"u"){n(new Error("Connection already closed"));return}this.socket.onclose=r=>{this.onClose(r),t()},this.socket.close()})}async send(t){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(kn(t))}catch(n){this.onError(t.id,n)}}register(t=this.url){if(!Bg(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);if(this.registering){const n=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=n||this.events.listenerCount("open")>=n)&&this.events.setMaxListeners(n+1),new Promise((r,i)=>{this.events.once("register_error",s=>{this.resetMaxListeners(),i(s)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return i(new Error("WebSocket connection is missing or invalid"));r(this.socket)})})}return this.url=t,this.registering=!0,new Promise((n,r)=>{const i=Eg.isReactNative()?void 0:{rejectUnauthorized:!Y5(t)},s=new Q5(t,[],i);J5()?s.onerror=o=>{const a=o;r(this.emitError(a.error))}:s.on("error",o=>{r(this.emitError(o))}),s.onopen=()=>{this.onOpen(s),n(s)}})}onOpen(t){t.onmessage=n=>this.onPayload(n),t.onclose=n=>this.onClose(n),this.socket=t,this.registering=!1,this.events.emit("open")}onClose(t){this.socket=void 0,this.registering=!1,this.events.emit("close",t)}onPayload(t){if(typeof t.data>"u")return;const n=typeof t.data=="string"?or(t.data):t.data;this.events.emit("payload",n)}onError(t,n){const r=this.parseError(n),i=r.message||r.toString(),s=Og(t,i);this.events.emit("payload",s)}parseError(t,n=this.url){return w5(t,Rg(n),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Ng&&this.events.setMaxListeners(Ng)}emitError(t){const n=this.parseError(new Error(t?.message||`WebSocket connection failed for host: ${Rg(this.url)}`));return this.events.emit("register_error",n),n}}var t_=Object.defineProperty,n_=Object.defineProperties,r_=Object.getOwnPropertyDescriptors,Cg=Object.getOwnPropertySymbols,i_=Object.prototype.hasOwnProperty,s_=Object.prototype.propertyIsEnumerable,qc=(e,t,n)=>t in e?t_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Mr=(e,t)=>{for(var n in t||(t={}))i_.call(t,n)&&qc(e,n,t[n]);if(Cg)for(var n of Cg(t))s_.call(t,n)&&qc(e,n,t[n]);return e},Pg=(e,t)=>n_(e,r_(t)),mt=(e,t,n)=>qc(e,typeof t!="symbol"?t+"":t,n);class o_ extends fb{constructor(t,n){super(t,n),this.relayer=t,this.logger=n,mt(this,"events",new lt.exports.EventEmitter),mt(this,"name",Vf),mt(this,"queue",new Map),mt(this,"publishTimeout",W.toMiliseconds(W.ONE_MINUTE)),mt(this,"initialPublishTimeout",W.toMiliseconds(W.ONE_SECOND*15)),mt(this,"needsTransportRestart",!1),mt(this,"publish",async(r,i,s)=>{var o,a,c,f,u;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:r,message:i,opts:s}});const d=s?.ttl||Hf,h=s?.prompt||!1,l=s?.tag||0,g=s?.id||io().toString(),w=jr(ro().protocol),v={id:g,method:s?.publishMethod||w.publish,params:Mr({topic:r,message:i,ttl:d,prompt:h,tag:l,attestation:s?.attestation},s?.tvf)},A=`Failed to publish payload, please try again. id:${g} tag:${l}`;try{kr((o=v.params)==null?void 0:o.prompt)&&((a=v.params)==null||delete a.prompt),kr((c=v.params)==null?void 0:c.tag)&&((f=v.params)==null||delete f.tag);const C=new Promise(async x=>{const _=({id:L})=>{var j;((j=v.id)==null?void 0:j.toString())===L.toString()&&(this.removeRequestFromQueue(L),this.relayer.events.removeListener(be.publish,_),x())};this.relayer.events.on(be.publish,_);const R=Lt(new Promise((L,j)=>{this.rpcPublish(v,s).then(L).catch(U=>{this.logger.warn(U,U?.message),j(U)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${g} tag:${l}`);try{await R,this.events.removeListener(be.publish,_)}catch(L){this.queue.set(g,{request:v,opts:s,attempt:1}),this.logger.warn(L,L?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:g,topic:r,message:i,opts:s}}),await Lt(C,this.publishTimeout,A)}catch(C){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(C),(u=s?.internal)!=null&&u.throwOnFailedPublish)throw C}finally{this.queue.delete(g)}}),mt(this,"publishCustom",async r=>{var i,s,o,a,c;this.logger.debug("Publishing custom payload"),this.logger.trace({type:"method",method:"publishCustom",params:r});const{payload:f,opts:u={}}=r,{attestation:d,tvf:h,publishMethod:l,prompt:g,tag:w,ttl:v=W.FIVE_MINUTES}=u,A=u.id||io().toString(),C=jr(ro().protocol),x=l||C.publish,_={id:A,method:x,params:Mr(Pg(Mr({},f),{ttl:v,prompt:g,tag:w,attestation:d}),h)},R=`Failed to publish custom payload, please try again. id:${A} tag:${w}`;try{kr((i=_.params)==null?void 0:i.prompt)&&((s=_.params)==null||delete s.prompt),kr((o=_.params)==null?void 0:o.tag)&&((a=_.params)==null||delete a.tag);const L=new Promise(async j=>{const U=({id:q})=>{var M;((M=_.id)==null?void 0:M.toString())===q.toString()&&(this.removeRequestFromQueue(q),this.relayer.events.removeListener(be.publish,U),j())};this.relayer.events.on(be.publish,U);const D=Lt(new Promise((q,M)=>{this.rpcPublish(_,u).then(q).catch(E=>{this.logger.warn(E,E?.message),M(E)})}),this.initialPublishTimeout,`Failed initial custom payload publish, retrying.... method:${x} id:${A} tag:${w}`);try{await D,this.events.removeListener(be.publish,U)}catch(q){this.queue.set(A,{request:_,opts:u,attempt:1}),this.logger.warn(q,q?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:A,payload:f,opts:u}}),await Lt(L,this.publishTimeout,R)}catch(L){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(L),(c=u?.internal)!=null&&c.throwOnFailedPublish)throw L}finally{this.queue.delete(A)}}),mt(this,"on",(r,i)=>{this.events.on(r,i)}),mt(this,"once",(r,i)=>{this.events.once(r,i)}),mt(this,"off",(r,i)=>{this.events.off(r,i)}),mt(this,"removeListener",(r,i)=>{this.events.removeListener(r,i)}),this.relayer=t,this.logger=Ge(n,this.name),this.registerEventListeners()}get context(){return it(this.logger)}async rpcPublish(t,n){this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:t});const r=await this.relayer.request(t);return this.relayer.events.emit(be.publish,Mr(Mr({},t),n)),this.logger.debug("Successfully Published Payload"),r}removeRequestFromQueue(t){this.queue.delete(t)}checkQueue(){this.queue.forEach(async(t,n)=>{var r;const i=t.attempt+1;this.queue.set(n,Pg(Mr({},t),{attempt:i})),this.logger.warn({},`Publisher: queue->publishing: ${t.request.id}, tag: ${(r=t.request.params)==null?void 0:r.tag}, attempt: ${i}`),await this.rpcPublish(t.request,t.opts),this.logger.warn({},`Publisher: queue->published: ${t.request.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(Fn.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(be.connection_stalled);return}this.checkQueue()}),this.relayer.on(be.message_ack,t=>{this.removeRequestFromQueue(t.id.toString())})}}var a_=Object.defineProperty,c_=(e,t,n)=>t in e?a_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,zr=(e,t,n)=>c_(e,typeof t!="symbol"?t+"":t,n);class f_{constructor(){zr(this,"map",new Map),zr(this,"set",(t,n)=>{const r=this.get(t);this.exists(t,n)||this.map.set(t,[...r,n])}),zr(this,"get",t=>this.map.get(t)||[]),zr(this,"exists",(t,n)=>this.get(t).includes(n)),zr(this,"delete",(t,n)=>{if(typeof n>"u"){this.map.delete(t);return}if(!this.map.has(t))return;const r=this.get(t);if(!this.exists(t,n))return;const i=r.filter(s=>s!==n);if(!i.length){this.map.delete(t);return}this.map.set(t,i)}),zr(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var u_=Object.defineProperty,l_=Object.defineProperties,h_=Object.getOwnPropertyDescriptors,$g=Object.getOwnPropertySymbols,d_=Object.prototype.hasOwnProperty,g_=Object.prototype.propertyIsEnumerable,Hc=(e,t,n)=>t in e?u_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ci=(e,t)=>{for(var n in t||(t={}))d_.call(t,n)&&Hc(e,n,t[n]);if($g)for(var n of $g(t))g_.call(t,n)&&Hc(e,n,t[n]);return e},Vc=(e,t)=>l_(e,h_(t)),fe=(e,t,n)=>Hc(e,typeof t!="symbol"?t+"":t,n);class Lg extends hb{constructor(t,n){super(t,n),this.relayer=t,this.logger=n,fe(this,"subscriptions",new Map),fe(this,"topicMap",new f_),fe(this,"events",new lt.exports.EventEmitter),fe(this,"name",Qf),fe(this,"version",eu),fe(this,"pending",new Map),fe(this,"cached",[]),fe(this,"initialized",!1),fe(this,"storagePrefix",Et),fe(this,"subscribeTimeout",W.toMiliseconds(W.ONE_MINUTE)),fe(this,"initialSubscribeTimeout",W.toMiliseconds(W.ONE_SECOND*15)),fe(this,"clientId"),fe(this,"batchSubscribeTopicsLimit",500),fe(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),fe(this,"subscribe",async(r,i)=>{var s;this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:r,opts:i}});try{const o=ro(i),a={topic:r,relay:o,transportType:i?.transportType};(s=i?.internal)!=null&&s.skipSubscribe||this.pending.set(r,a);const c=await this.rpcSubscribe(r,o,i);return typeof c=="string"&&(this.onSubscribe(c,a),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:r,opts:i}})),c}catch(o){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(o),o}}),fe(this,"unsubscribe",async(r,i)=>{this.isInitialized(),typeof i?.id<"u"?await this.unsubscribeById(r,i.id,i):await this.unsubscribeByTopic(r,i)}),fe(this,"isSubscribed",r=>new Promise(i=>{i(this.topicMap.topics.includes(r))})),fe(this,"isKnownTopic",r=>new Promise(i=>{i(this.topicMap.topics.includes(r)||this.pending.has(r)||this.cached.some(s=>s.topic===r))})),fe(this,"on",(r,i)=>{this.events.on(r,i)}),fe(this,"once",(r,i)=>{this.events.once(r,i)}),fe(this,"off",(r,i)=>{this.events.off(r,i)}),fe(this,"removeListener",(r,i)=>{this.events.removeListener(r,i)}),fe(this,"start",async()=>{await this.onConnect()}),fe(this,"stop",async()=>{await this.onDisconnect()}),fe(this,"restart",async()=>{await this.restore(),await this.onRestart()}),fe(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const r=[];this.pending.forEach(i=>{r.push(i)}),await this.batchSubscribe(r)}),fe(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(Fn.pulse,async()=>{await this.checkPending()}),this.events.on(Ze.created,async r=>{const i=Ze.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),await this.persist()}),this.events.on(Ze.deleted,async r=>{const i=Ze.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),await this.persist()})}),this.relayer=t,this.logger=Ge(n,this.name),this.clientId=""}get context(){return it(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(t,n){let r=!1;try{r=this.getSubscription(t).topic===n}catch{}return r}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(t,n){const r=this.topicMap.get(t);await Promise.all(r.map(async i=>await this.unsubscribeById(t,i,n)))}async unsubscribeById(t,n,r){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:n,opts:r}});try{const i=ro(r);await this.restartToComplete({topic:t,id:n,relay:i}),await this.rpcUnsubscribe(t,n,i);const s=Ti("USER_DISCONNECTED",`${this.name}, ${t}`);await this.onUnsubscribe(t,n,s),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:n,opts:r}})}catch(i){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(i),i}}async rpcSubscribe(t,n,r){var i,s;const o=await this.getSubscriptionId(t);if((i=r?.internal)!=null&&i.skipSubscribe)return o;(!r||r?.transportType===Mn.relay)&&await this.restartToComplete({topic:t,id:t,relay:n});const a={method:jr(n.protocol).subscribe,params:{topic:t}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a});const c=(s=r?.internal)==null?void 0:s.throwOnFailedPublish;try{if(r?.transportType===Mn.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(a).catch(d=>this.logger.warn(d))},W.toMiliseconds(W.ONE_SECOND)),o;const f=new Promise(async d=>{const h=l=>{l.topic===t&&(this.events.removeListener(Ze.created,h),d(l.id))};this.events.on(Ze.created,h);try{const l=await Lt(new Promise((g,w)=>{this.relayer.request(a).catch(v=>{this.logger.warn(v,v?.message),w(v)}).then(g)}),this.initialSubscribeTimeout,`Subscribing to ${t} failed, please try again`);this.events.removeListener(Ze.created,h),d(l)}catch{}}),u=await Lt(f,this.subscribeTimeout,`Subscribing to ${t} failed, please try again`);if(!u&&c)throw new Error(`Subscribing to ${t} failed, please try again`);return u?o:null}catch(f){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(be.connection_stalled),c)throw f}return null}async rpcBatchSubscribe(t){if(!t.length)return;const n=t[0].relay,r={method:jr(n.protocol).batchSubscribe,params:{topics:t.map(i=>i.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});try{await await Lt(new Promise(i=>{this.relayer.request(r).catch(s=>this.logger.warn(s)).then(i)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(be.connection_stalled)}}async rpcBatchFetchMessages(t){if(!t.length)return;const n=t[0].relay,r={method:jr(n.protocol).batchFetchMessages,params:{topics:t.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});let i;try{i=await await Lt(new Promise((s,o)=>{this.relayer.request(r).catch(a=>{this.logger.warn(a),o(a)}).then(s)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(be.connection_stalled)}return i}rpcUnsubscribe(t,n,r){const i={method:jr(r.protocol).unsubscribe,params:{topic:t,id:n}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i}),this.relayer.request(i)}onSubscribe(t,n){this.setSubscription(t,Vc(Ci({},n),{id:t})),this.pending.delete(n.topic)}onBatchSubscribe(t){t.length&&t.forEach(n=>{this.setSubscription(n.id,Ci({},n)),this.pending.delete(n.topic)})}async onUnsubscribe(t,n,r){this.events.removeAllListeners(n),this.hasSubscription(n,t)&&this.deleteSubscription(n,r),await this.relayer.messages.del(t)}async setRelayerSubscriptions(t){await this.relayer.core.storage.setItem(this.storageKey,t)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(t,n){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:t,subscription:n}),this.addSubscription(t,n)}addSubscription(t,n){this.subscriptions.set(t,Ci({},n)),this.topicMap.set(n.topic,t),this.events.emit(Ze.created,n)}getSubscription(t){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:t});const n=this.subscriptions.get(t);if(!n){const{message:r}=oe("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(r)}return n}deleteSubscription(t,n){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:t,reason:n});const r=this.getSubscription(t);this.subscriptions.delete(t),this.topicMap.delete(r.topic,t),this.events.emit(Ze.deleted,Vc(Ci({},r),{reason:n}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Ze.sync)}async onRestart(){if(this.cached.length){const t=[...this.cached],n=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<n;r++){const i=t.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(i)}}this.events.emit(Ze.resubscribed)}async restore(){try{const t=await this.getRelayerSubscriptions();if(typeof t>"u"||!t.length)return;if(this.subscriptions.size&&!t.every(n=>{var r;return n.topic===((r=this.subscriptions.get(n.id))==null?void 0:r.topic)})){const{message:n}=oe("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(n),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(n)}this.cached=t,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(t){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(t)}}async batchSubscribe(t){t.length&&(await this.rpcBatchSubscribe(t),this.onBatchSubscribe(await Promise.all(t.map(async n=>Vc(Ci({},n),{id:await this.getSubscriptionId(n.topic)})))))}async batchFetchMessages(t){if(!t.length)return;this.logger.trace(`Fetching batch messages for ${t.length} subscriptions`);const n=await this.rpcBatchFetchMessages(t);n&&n.messages&&(await x8(W.toMiliseconds(W.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(n.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:t}=oe("NOT_INITIALIZED",this.name);throw new Error(t)}}async restartToComplete(t){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(t),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(t){return no(t+await this.getClientId())}}var p_=Object.defineProperty,Ug=Object.getOwnPropertySymbols,b_=Object.prototype.hasOwnProperty,y_=Object.prototype.propertyIsEnumerable,Kc=(e,t,n)=>t in e?p_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Fg=(e,t)=>{for(var n in t||(t={}))b_.call(t,n)&&Kc(e,n,t[n]);if(Ug)for(var n of Ug(t))y_.call(t,n)&&Kc(e,n,t[n]);return e},se=(e,t,n)=>Kc(e,typeof t!="symbol"?t+"":t,n);class jg extends ub{constructor(t){super(t),se(this,"protocol","wc"),se(this,"version",2),se(this,"core"),se(this,"logger"),se(this,"events",new lt.exports.EventEmitter),se(this,"provider"),se(this,"messages"),se(this,"subscriber"),se(this,"publisher"),se(this,"name",Zf),se(this,"transportExplicitlyClosed",!1),se(this,"initialized",!1),se(this,"connectionAttemptInProgress",!1),se(this,"relayUrl"),se(this,"projectId"),se(this,"packageName"),se(this,"bundleId"),se(this,"hasExperiencedNetworkDisruption",!1),se(this,"pingTimeout"),se(this,"heartBeatTimeout",W.toMiliseconds(W.THIRTY_SECONDS+W.FIVE_SECONDS)),se(this,"reconnectTimeout"),se(this,"connectPromise"),se(this,"reconnectInProgress",!1),se(this,"requestsInFlight",[]),se(this,"connectTimeout",W.toMiliseconds(W.ONE_SECOND*15)),se(this,"request",async n=>{var r,i;this.logger.debug("Publishing Request Payload");const s=n.id||io().toString();await this.toEstablishConnection();try{this.logger.trace({id:s,method:n.method,topic:(r=n.params)==null?void 0:r.topic},"relayer.request - publishing...");const o=`${s}:${((i=n.params)==null?void 0:i.tag)||""}`;this.requestsInFlight.push(o);const a=await this.provider.request(n);return this.requestsInFlight=this.requestsInFlight.filter(c=>c!==o),a}catch(o){throw this.logger.debug(`Failed to Publish Request: ${s}`),o}}),se(this,"resetPingTimeout",()=>{Us()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var n,r,i,s;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(s=(i=(r=(n=this.provider)==null?void 0:n.connection)==null?void 0:r.socket)==null?void 0:i.terminate)==null||s.call(i)}catch(o){this.logger.warn(o,o?.message)}},this.heartBeatTimeout))}),se(this,"onPayloadHandler",n=>{this.onProviderPayload(n),this.resetPingTimeout()}),se(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected \u{1F6DC}"),this.startPingTimeout(),this.events.emit(be.connect)}),se(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected \u{1F6D1}"),this.requestsInFlight=[],this.onProviderDisconnect()}),se(this,"onProviderErrorHandler",n=>{this.logger.fatal(`Fatal socket error: ${n.message}`),this.events.emit(be.error,n),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),se(this,"registerProviderListeners",()=>{this.provider.on(st.payload,this.onPayloadHandler),this.provider.on(st.connect,this.onConnectHandler),this.provider.on(st.disconnect,this.onDisconnectHandler),this.provider.on(st.error,this.onProviderErrorHandler)}),this.core=t.core,this.logger=typeof t.logger<"u"&&typeof t.logger!="string"?Ge(t.logger,this.name):fn(Pf({level:t.logger||Gf})),this.messages=new bg(this.logger,t.core),this.subscriber=new Lg(this,this.logger),this.publisher=new o_(this,this.logger),this.projectId=t?.projectId,this.relayUrl=t?.relayUrl||Oo,h8()?this.packageName=Ud():d8()&&(this.bundleId=Ud()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(t=>this.logger.warn(t,t?.message))}get context(){return it(this.logger)}get connected(){var t,n,r;return((r=(n=(t=this.provider)==null?void 0:t.connection)==null?void 0:n.socket)==null?void 0:r.readyState)===1||!1}get connecting(){var t,n,r;return((r=(n=(t=this.provider)==null?void 0:t.connection)==null?void 0:n.socket)==null?void 0:r.readyState)===0||this.connectPromise!==void 0||!1}async publish(t,n,r){this.isInitialized(),await this.publisher.publish(t,n,r),await this.recordMessageEvent({topic:t,message:n,publishedAt:Date.now(),transportType:Mn.relay},Xr.outbound)}async publishCustom(t){this.isInitialized(),await this.publisher.publishCustom(t)}async subscribe(t,n){var r,i,s;this.isInitialized(),(!(n!=null&&n.transportType)||n?.transportType==="relay")&&await this.toEstablishConnection();const o=typeof((r=n?.internal)==null?void 0:r.throwOnFailedPublish)>"u"?!0:(i=n?.internal)==null?void 0:i.throwOnFailedPublish;let a=((s=this.subscriber.topicMap.get(t))==null?void 0:s[0])||"",c;const f=u=>{u.topic===t&&(this.subscriber.off(Ze.created,f),c())};return await Promise.all([new Promise(u=>{c=u,this.subscriber.on(Ze.created,f)}),new Promise(async(u,d)=>{a=await this.subscriber.subscribe(t,Fg({internal:{throwOnFailedPublish:o}},n)).catch(h=>{o&&d(h)})||a,u()})]),a}async unsubscribe(t,n){this.isInitialized(),await this.subscriber.unsubscribe(t,n)}on(t,n){this.events.on(t,n)}once(t,n){this.events.once(t,n)}off(t,n){this.events.off(t,n)}removeListener(t,n){this.events.removeListener(t,n)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await Lt(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(t){if(!this.subscriber.hasAnyTopics){this.logger.info("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(n,r)=>{await this.connect(t).then(n).catch(r).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(t){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=t||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await hg())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(t){if(t?.length===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const n=t.sort((r,i)=>r.publishedAt-i.publishedAt);this.logger.debug(`Batch of ${n.length} message events sorted`);for(const r of n)try{await this.onMessageEvent(r)}catch(i){this.logger.warn(i,"Error while processing batch message event: "+i?.message)}this.logger.trace(`Batch of ${n.length} message events processed`)}async onLinkMessageEvent(t,n){const{topic:r}=t;if(!n.sessionExists){const i=mi(W.FIVE_MINUTES),s={topic:r,expiry:i,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(r,s)}this.events.emit(be.message,t),await this.recordMessageEvent(t,Xr.inbound)}async connect(t){await this.confirmOnlineStateOrThrow(),t&&t!==this.relayUrl&&(this.relayUrl=t,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let n=1;for(;n<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${n}...`),await this.createProvider(),await new Promise(async(r,i)=>{const s=()=>{i(new Error("Connection interrupted while trying to connect"))};this.provider.once(st.disconnect,s),await Lt(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{i(o)}).finally(()=>{this.provider.off(st.disconnect,s),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const c=()=>{i(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(st.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(st.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,r()})}catch(r){await this.subscriber.stop();const i=r;this.logger.warn({},i.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${n}`);break}await new Promise(r=>setTimeout(r,W.toMiliseconds(n*1))),n++}}startPingTimeout(){var t,n,r,i,s;if(Us())try{(n=(t=this.provider)==null?void 0:t.connection)!=null&&n.socket&&((s=(i=(r=this.provider)==null?void 0:r.connection)==null?void 0:i.socket)==null||s.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o?.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const t=await this.core.crypto.signJWT(this.relayUrl);this.provider=new W5(new e_(w8({sdkVersion:Zi,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:t,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(t,n){const{topic:r,message:i}=t;await this.messages.set(r,i,n)}async shouldIgnoreMessageEvent(t){const{topic:n,message:r}=t;if(!r||r.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${r}`),!0;if(!await this.subscriber.isKnownTopic(n))return this.logger.warn(`Ignoring message for unknown topic ${n}`),!0;const i=this.messages.has(n,r);return i&&this.logger.warn(`Ignoring duplicate message: ${r}`),i}async onProviderPayload(t){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:t}),Dg(t)){if(!t.method.endsWith(Yf))return;const n=t.params,{topic:r,message:i,publishedAt:s,attestation:o}=n.data,a={topic:r,message:i,publishedAt:s,transportType:Mn.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Fg({type:"event",event:n.id},a)),this.events.emit(n.id,a),await this.acknowledgePayload(t),await this.onMessageEvent(a)}else zc(t)&&this.events.emit(be.message_ack,t)}async onMessageEvent(t){await this.shouldIgnoreMessageEvent(t)||(await this.recordMessageEvent(t,Xr.inbound),this.events.emit(be.message,t))}async acknowledgePayload(t){const n=Ig(t.id,!0);await this.provider.connection.send(n)}unregisterProviderListeners(){this.provider.off(st.payload,this.onPayloadHandler),this.provider.off(st.connect,this.onConnectHandler),this.provider.off(st.disconnect,this.onDisconnectHandler),this.provider.off(st.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let t=await hg();W4(async n=>{t!==n&&(t=n,n?await this.transportOpen().catch(r=>this.logger.error(r,r?.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(Fn.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&Q4())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(n){this.logger.warn(n,n?.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(be.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(t=>this.logger.error(t,t?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},W.toMiliseconds(Wf)))))}isInitialized(){if(!this.initialized){const{message:t}=oe("NOT_INITIALIZED",this.name);throw new Error(t)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}}function w_(e,t){return e===t||Number.isNaN(e)&&Number.isNaN(t)}function kg(e){return Object.getOwnPropertySymbols(e).filter(t=>Object.prototype.propertyIsEnumerable.call(e,t))}function Mg(e){return e==null?e===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}const m_="[object RegExp]",E_="[object String]",v_="[object Number]",__="[object Boolean]",zg="[object Arguments]",x_="[object Symbol]",S_="[object Date]",I_="[object Map]",O_="[object Set]",B_="[object Array]",A_="[object Function]",D_="[object ArrayBuffer]",Gc="[object Object]",T_="[object Error]",R_="[object DataView]",N_="[object Uint8Array]",C_="[object Uint8ClampedArray]",P_="[object Uint16Array]",$_="[object Uint32Array]",L_="[object BigUint64Array]",U_="[object Int8Array]",F_="[object Int16Array]",j_="[object Int32Array]",k_="[object BigInt64Array]",M_="[object Float32Array]",z_="[object Float64Array]";function q_(){}function qg(e){if(!e||typeof e!="object")return!1;const t=Object.getPrototypeOf(e);return t===null||t===Object.prototype||Object.getPrototypeOf(t)===null?Object.prototype.toString.call(e)==="[object Object]":!1}function H_(e,t,n){return Pi(e,t,void 0,void 0,void 0,void 0,n)}function Pi(e,t,n,r,i,s,o){const a=o(e,t,n,r,i,s);if(a!==void 0)return a;if(typeof e==typeof t)switch(typeof e){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return e===t;case"number":return e===t||Object.is(e,t);case"function":return e===t;case"object":return $i(e,t,s,o)}return $i(e,t,s,o)}function $i(e,t,n,r){if(Object.is(e,t))return!0;let i=Mg(e),s=Mg(t);if(i===zg&&(i=Gc),s===zg&&(s=Gc),i!==s)return!1;switch(i){case E_:return e.toString()===t.toString();case v_:{const c=e.valueOf(),f=t.valueOf();return w_(c,f)}case __:case S_:case x_:return Object.is(e.valueOf(),t.valueOf());case m_:return e.source===t.source&&e.flags===t.flags;case A_:return e===t}n=n??new Map;const o=n.get(e),a=n.get(t);if(o!=null&&a!=null)return o===t;n.set(e,t),n.set(t,e);try{switch(i){case I_:{if(e.size!==t.size)return!1;for(const[c,f]of e.entries())if(!t.has(c)||!Pi(f,t.get(c),c,e,t,n,r))return!1;return!0}case O_:{if(e.size!==t.size)return!1;const c=Array.from(e.values()),f=Array.from(t.values());for(let u=0;u<c.length;u++){const d=c[u],h=f.findIndex(l=>Pi(d,l,void 0,e,t,n,r));if(h===-1)return!1;f.splice(h,1)}return!0}case B_:case N_:case C_:case P_:case $_:case L_:case U_:case F_:case j_:case k_:case M_:case z_:{if(typeof Buffer<"u"&&Buffer.isBuffer(e)!==Buffer.isBuffer(t)||e.length!==t.length)return!1;for(let c=0;c<e.length;c++)if(!Pi(e[c],t[c],c,e,t,n,r))return!1;return!0}case D_:return e.byteLength!==t.byteLength?!1:$i(new Uint8Array(e),new Uint8Array(t),n,r);case R_:return e.byteLength!==t.byteLength||e.byteOffset!==t.byteOffset?!1:$i(new Uint8Array(e),new Uint8Array(t),n,r);case T_:return e.name===t.name&&e.message===t.message;case Gc:{if(!($i(e.constructor,t.constructor,n,r)||qg(e)&&qg(t)))return!1;const f=[...Object.keys(e),...kg(e)],u=[...Object.keys(t),...kg(t)];if(f.length!==u.length)return!1;for(let d=0;d<f.length;d++){const h=f[d],l=e[h];if(!Object.hasOwn(t,h))return!1;const g=t[h];if(!Pi(l,g,h,e,t,n,r))return!1}return!0}default:return!1}}finally{n.delete(e),n.delete(t)}}function V_(e,t){return H_(e,t,q_)}var K_=Object.defineProperty,Hg=Object.getOwnPropertySymbols,G_=Object.prototype.hasOwnProperty,Z_=Object.prototype.propertyIsEnumerable,Zc=(e,t,n)=>t in e?K_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Vg=(e,t)=>{for(var n in t||(t={}))G_.call(t,n)&&Zc(e,n,t[n]);if(Hg)for(var n of Hg(t))Z_.call(t,n)&&Zc(e,n,t[n]);return e},rt=(e,t,n)=>Zc(e,typeof t!="symbol"?t+"":t,n);class Kg extends lb{constructor(t,n,r,i=Et,s=void 0){super(t,n,r,i),this.core=t,this.logger=n,this.name=r,rt(this,"map",new Map),rt(this,"version",Xf),rt(this,"cached",[]),rt(this,"initialized",!1),rt(this,"getKey"),rt(this,"storagePrefix",Et),rt(this,"recentlyDeleted",[]),rt(this,"recentlyDeletedLimit",200),rt(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!kr(o)?this.map.set(this.getKey(o),o):V4(o)?this.map.set(o.id,o):K4(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),rt(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),rt(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),rt(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>V_(a[c],o[c]))):this.values)),rt(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const c=Vg(Vg({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),rt(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=Ge(n,this.name),this.storagePrefix=i,this.getKey=s}get context(){return it(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(t){this.recentlyDeleted.push(t),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(t){await this.core.storage.setItem(this.storageKey,t)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(t){const n=this.map.get(t);if(!n){if(this.recentlyDeleted.includes(t)){const{message:i}=oe("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${t}`);throw this.logger.error(i),new Error(i)}const{message:r}=oe("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(r),new Error(r)}return n}async persist(){await this.setDataStore(this.values)}async restore(){try{const t=await this.getDataStore();if(typeof t>"u"||!t.length)return;if(this.map.size){const{message:n}=oe("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(n),new Error(n)}this.cached=t,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(t){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(t)}}isInitialized(){if(!this.initialized){const{message:t}=oe("NOT_INITIALIZED",this.name);throw new Error(t)}}}var Y_=Object.defineProperty,W_=(e,t,n)=>t in e?Y_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,ne=(e,t,n)=>W_(e,typeof t!="symbol"?t+"":t,n);class Gg{constructor(t,n){this.core=t,this.logger=n,ne(this,"name",tu),ne(this,"version",nu),ne(this,"events",new lt.exports),ne(this,"pairings"),ne(this,"initialized",!1),ne(this,"storagePrefix",Et),ne(this,"ignoredPayloadTypes",[Fr]),ne(this,"registeredMethods",[]),ne(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),ne(this,"register",({methods:r})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...r])]}),ne(this,"create",async r=>{this.isInitialized();const i=Cc(),s=await this.core.crypto.setSymKey(i),o=mi(W.FIVE_MINUTES),a={protocol:Kf},c={topic:s,expiry:o,relay:a,active:!1,methods:r?.methods},f=ug({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:i,relay:a,expiryTimestamp:o,methods:r?.methods});return this.events.emit(ur.create,c),this.core.expirer.set(s,o),await this.pairings.set(s,c),await this.core.relayer.subscribe(s,{transportType:r?.transportType,internal:r?.internal}),{topic:s,uri:f}}),ne(this,"pair",async r=>{this.isInitialized();const i=this.core.eventClient.createEvent({properties:{topic:r?.uri,trace:[Nt.pairing_started]}});this.isValidPair(r,i);const{topic:s,symKey:o,relay:a,expiryTimestamp:c,methods:f}=fg(r.uri);i.props.properties.topic=s,i.addTrace(Nt.pairing_uri_validation_success),i.addTrace(Nt.pairing_uri_not_expired);let u;if(this.pairings.keys.includes(s)){if(u=this.pairings.get(s),i.addTrace(Nt.existing_pairing),u.active)throw i.setError(jt.active_pairing_already_exists),new Error(`Pairing already exists: ${s}. Please try again with a new connection URI.`);i.addTrace(Nt.pairing_not_expired)}const d=c||mi(W.FIVE_MINUTES),h={topic:s,relay:a,expiry:d,active:!1,methods:f};this.core.expirer.set(s,d),await this.pairings.set(s,h),i.addTrace(Nt.store_new_pairing),r.activatePairing&&await this.activate({topic:s}),this.events.emit(ur.create,h),i.addTrace(Nt.emit_inactive_pairing),this.core.crypto.keychain.has(s)||await this.core.crypto.setSymKey(o,s),i.addTrace(Nt.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{i.setError(jt.no_internet_connection)}try{await this.core.relayer.subscribe(s,{relay:a})}catch(l){throw i.setError(jt.subscribe_pairing_topic_failure),l}return i.addTrace(Nt.subscribe_pairing_topic_success),h}),ne(this,"activate",async({topic:r})=>{this.isInitialized();const i=mi(W.FIVE_MINUTES);this.core.expirer.set(r,i),await this.pairings.update(r,{active:!0,expiry:i})}),ne(this,"ping",async r=>{this.isInitialized(),await this.isValidPing(r),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:i}=r;if(this.pairings.keys.includes(i)){const s=await this.sendRequest(i,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=m8();this.events.once(rc("pairing_ping",s),({error:f})=>{f?c(f):a()}),await o()}}),ne(this,"updateExpiry",async({topic:r,expiry:i})=>{this.isInitialized(),await this.pairings.update(r,{expiry:i})}),ne(this,"updateMetadata",async({topic:r,metadata:i})=>{this.isInitialized(),await this.pairings.update(r,{peerMetadata:i})}),ne(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),ne(this,"disconnect",async r=>{this.isInitialized(),await this.isValidDisconnect(r);const{topic:i}=r;this.pairings.keys.includes(i)&&(await this.sendRequest(i,"wc_pairingDelete",Ti("USER_DISCONNECTED")),await this.deletePairing(i))}),ne(this,"formatUriFromPairing",r=>{this.isInitialized();const{topic:i,relay:s,expiry:o,methods:a}=r,c=this.core.crypto.keychain.get(i);return ug({protocol:this.core.protocol,version:this.core.version,topic:i,symKey:c,relay:s,expiryTimestamp:o,methods:a})}),ne(this,"sendRequest",async(r,i,s)=>{const o=Mc(i,s),a=await this.core.crypto.encode(r,o),c=fr[i].req;return this.core.history.set(r,o),this.core.relayer.publish(r,a,c),o.id}),ne(this,"sendResult",async(r,i,s)=>{const o=Ig(r,s),a=await this.core.crypto.encode(i,o),c=(await this.core.history.get(i,r)).request.method,f=fr[c].res;await this.core.relayer.publish(i,a,f),await this.core.history.resolve(o)}),ne(this,"sendError",async(r,i,s)=>{const o=Og(r,s),a=await this.core.crypto.encode(i,o),c=(await this.core.history.get(i,r)).request.method,f=fr[c]?fr[c].res:fr.unregistered_method.res;await this.core.relayer.publish(i,a,f),await this.core.history.resolve(o)}),ne(this,"deletePairing",async(r,i)=>{await this.core.relayer.unsubscribe(r),await Promise.all([this.pairings.delete(r,Ti("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(r),i?Promise.resolve():this.core.expirer.del(r)])}),ne(this,"cleanup",async()=>{const r=this.pairings.getAll().filter(i=>kd(i.expiry));await Promise.all(r.map(i=>this.deletePairing(i.topic)))}),ne(this,"onRelayEventRequest",async r=>{const{topic:i,payload:s}=r;switch(s.method){case"wc_pairingPing":return await this.onPairingPingRequest(i,s);case"wc_pairingDelete":return await this.onPairingDeleteRequest(i,s);default:return await this.onUnknownRpcMethodRequest(i,s)}}),ne(this,"onRelayEventResponse",async r=>{const{topic:i,payload:s}=r,o=(await this.core.history.get(i,s.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(i,s);default:return this.onUnknownRpcMethodResponse(o)}}),ne(this,"onPairingPingRequest",async(r,i)=>{const{id:s}=i;try{this.isValidPing({topic:r}),await this.sendResult(s,r,!0),this.events.emit(ur.ping,{id:s,topic:r})}catch(o){await this.sendError(s,r,o),this.logger.error(o)}}),ne(this,"onPairingPingResponse",(r,i)=>{const{id:s}=i;setTimeout(()=>{Tg(i)?this.events.emit(rc("pairing_ping",s),{}):so(i)&&this.events.emit(rc("pairing_ping",s),{error:i.error})},500)}),ne(this,"onPairingDeleteRequest",async(r,i)=>{const{id:s}=i;try{this.isValidDisconnect({topic:r}),await this.deletePairing(r),this.events.emit(ur.delete,{id:s,topic:r})}catch(o){await this.sendError(s,r,o),this.logger.error(o)}}),ne(this,"onUnknownRpcMethodRequest",async(r,i)=>{const{id:s,method:o}=i;try{if(this.registeredMethods.includes(o))return;const a=Ti("WC_METHOD_UNSUPPORTED",o);await this.sendError(s,r,a),this.logger.error(a)}catch(a){await this.sendError(s,r,a),this.logger.error(a)}}),ne(this,"onUnknownRpcMethodResponse",r=>{this.registeredMethods.includes(r)||this.logger.error(Ti("WC_METHOD_UNSUPPORTED",r))}),ne(this,"isValidPair",(r,i)=>{var s;if(!$c(r)){const{message:a}=oe("MISSING_OR_INVALID",`pair() params: ${r}`);throw i.setError(jt.malformed_pairing_uri),new Error(a)}if(!H4(r.uri)){const{message:a}=oe("MISSING_OR_INVALID",`pair() uri: ${r.uri}`);throw i.setError(jt.malformed_pairing_uri),new Error(a)}const o=fg(r?.uri);if(!((s=o?.relay)!=null&&s.protocol)){const{message:a}=oe("MISSING_OR_INVALID","pair() uri#relay-protocol");throw i.setError(jt.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){const{message:a}=oe("MISSING_OR_INVALID","pair() uri#symKey");throw i.setError(jt.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&W.toMiliseconds(o?.expiryTimestamp)<Date.now()){i.setError(jt.pairing_expired);const{message:a}=oe("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),ne(this,"isValidPing",async r=>{if(!$c(r)){const{message:s}=oe("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(s)}const{topic:i}=r;await this.isValidPairingTopic(i)}),ne(this,"isValidDisconnect",async r=>{if(!$c(r)){const{message:s}=oe("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(s)}const{topic:i}=r;await this.isValidPairingTopic(i)}),ne(this,"isValidPairingTopic",async r=>{if(!lg(r,!1)){const{message:i}=oe("MISSING_OR_INVALID",`pairing topic should be a string: ${r}`);throw new Error(i)}if(!this.pairings.keys.includes(r)){const{message:i}=oe("NO_MATCHING_KEY",`pairing topic doesn't exist: ${r}`);throw new Error(i)}if(kd(this.pairings.get(r).expiry)){await this.deletePairing(r);const{message:i}=oe("EXPIRED",`pairing topic: ${r}`);throw new Error(i)}}),this.core=t,this.logger=Ge(n,this.name),this.pairings=new Kg(this.core,this.logger,this.name,this.storagePrefix)}get context(){return it(this.logger)}isInitialized(){if(!this.initialized){const{message:t}=oe("NOT_INITIALIZED",this.name);throw new Error(t)}}registerRelayerEvents(){this.core.relayer.on(be.message,async t=>{const{topic:n,message:r,transportType:i}=t;if(this.pairings.keys.includes(n)&&i!==Mn.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(r)))try{const s=await this.core.crypto.decode(n,r);Dg(s)?(this.core.history.set(n,s),await this.onRelayEventRequest({topic:n,payload:s})):zc(s)&&(await this.core.history.resolve(s),await this.onRelayEventResponse({topic:n,payload:s}),this.core.history.delete(n,s.id)),await this.core.relayer.messages.ack(n,r)}catch(s){this.logger.error(s)}})}registerExpirerEvents(){this.core.expirer.on(dt.expired,async t=>{const{topic:n}=_8(t.target);n&&this.pairings.keys.includes(n)&&(await this.deletePairing(n,!0),this.events.emit(ur.expire,{topic:n}))})}}var X_=Object.defineProperty,J_=(e,t,n)=>t in e?X_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,De=(e,t,n)=>J_(e,typeof t!="symbol"?t+"":t,n);class Zg extends ab{constructor(t,n){super(t,n),this.core=t,this.logger=n,De(this,"records",new Map),De(this,"events",new lt.exports.EventEmitter),De(this,"name",ru),De(this,"version",iu),De(this,"cached",[]),De(this,"initialized",!1),De(this,"storagePrefix",Et),De(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(r=>this.records.set(r.id,r)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),De(this,"set",(r,i,s)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:r,request:i,chainId:s}),this.records.has(i.id))return;const o={id:i.id,topic:r,request:{method:i.method,params:i.params||null},chainId:s,expiry:mi(W.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(ht.created,o)}),De(this,"resolve",async r=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:r}),!this.records.has(r.id))return;const i=await this.getRecord(r.id);typeof i.response>"u"&&(i.response=so(r)?{error:r.error}:{result:r.result},this.records.set(i.id,i),this.persist(),this.events.emit(ht.updated,i))}),De(this,"get",async(r,i)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:r,id:i}),await this.getRecord(i))),De(this,"delete",(r,i)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:i}),this.values.forEach(s=>{if(s.topic===r){if(typeof i<"u"&&s.id!==i)return;this.records.delete(s.id),this.events.emit(ht.deleted,s)}}),this.persist()}),De(this,"exists",async(r,i)=>(this.isInitialized(),this.records.has(i)?(await this.getRecord(i)).topic===r:!1)),De(this,"on",(r,i)=>{this.events.on(r,i)}),De(this,"once",(r,i)=>{this.events.once(r,i)}),De(this,"off",(r,i)=>{this.events.off(r,i)}),De(this,"removeListener",(r,i)=>{this.events.removeListener(r,i)}),this.logger=Ge(n,this.name)}get context(){return it(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const t=[];return this.values.forEach(n=>{if(typeof n.response<"u")return;const r={topic:n.topic,request:Mc(n.request.method,n.request.params,n.id),chainId:n.chainId};return t.push(r)}),t}async setJsonRpcRecords(t){await this.core.storage.setItem(this.storageKey,t)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(t){this.isInitialized();const n=this.records.get(t);if(!n){const{message:r}=oe("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(r)}return n}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(ht.sync)}async restore(){try{const t=await this.getJsonRpcRecords();if(typeof t>"u"||!t.length)return;if(this.records.size){const{message:n}=oe("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(n),new Error(n)}this.cached=t,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(t){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(t)}}registerEventListeners(){this.events.on(ht.created,t=>{const n=ht.created;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,record:t})}),this.events.on(ht.updated,t=>{const n=ht.updated;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,record:t})}),this.events.on(ht.deleted,t=>{const n=ht.deleted;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,record:t})}),this.core.heartbeat.on(Fn.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let t=!1;this.records.forEach(n=>{W.toMiliseconds(n.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${n.id}`),this.records.delete(n.id),this.events.emit(ht.deleted,n,!1),t=!0)}),t&&this.persist()}catch(t){this.logger.warn(t)}}isInitialized(){if(!this.initialized){const{message:t}=oe("NOT_INITIALIZED",this.name);throw new Error(t)}}}var Q_=Object.defineProperty,ex=(e,t,n)=>t in e?Q_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ue=(e,t,n)=>ex(e,typeof t!="symbol"?t+"":t,n);class Yg extends db{constructor(t,n){super(t,n),this.core=t,this.logger=n,Ue(this,"expirations",new Map),Ue(this,"events",new lt.exports.EventEmitter),Ue(this,"name",su),Ue(this,"version",ou),Ue(this,"cached",[]),Ue(this,"initialized",!1),Ue(this,"storagePrefix",Et),Ue(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(r=>this.expirations.set(r.target,r)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Ue(this,"has",r=>{try{const i=this.formatTarget(r);return typeof this.getExpiration(i)<"u"}catch{return!1}}),Ue(this,"set",(r,i)=>{this.isInitialized();const s=this.formatTarget(r),o={target:s,expiry:i};this.expirations.set(s,o),this.checkExpiry(s,o),this.events.emit(dt.created,{target:s,expiration:o})}),Ue(this,"get",r=>{this.isInitialized();const i=this.formatTarget(r);return this.getExpiration(i)}),Ue(this,"del",r=>{if(this.isInitialized(),this.has(r)){const i=this.formatTarget(r),s=this.getExpiration(i);this.expirations.delete(i),this.events.emit(dt.deleted,{target:i,expiration:s})}}),Ue(this,"on",(r,i)=>{this.events.on(r,i)}),Ue(this,"once",(r,i)=>{this.events.once(r,i)}),Ue(this,"off",(r,i)=>{this.events.off(r,i)}),Ue(this,"removeListener",(r,i)=>{this.events.removeListener(r,i)}),this.logger=Ge(n,this.name)}get context(){return it(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(t){if(typeof t=="string")return E8(t);if(typeof t=="number")return v8(t);const{message:n}=oe("UNKNOWN_TYPE",`Target type: ${typeof t}`);throw new Error(n)}async setExpirations(t){await this.core.storage.setItem(this.storageKey,t)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(dt.sync)}async restore(){try{const t=await this.getExpirations();if(typeof t>"u"||!t.length)return;if(this.expirations.size){const{message:n}=oe("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(n),new Error(n)}this.cached=t,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(t){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(t)}}getExpiration(t){const n=this.expirations.get(t);if(!n){const{message:r}=oe("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.warn(r),new Error(r)}return n}checkExpiry(t,n){const{expiry:r}=n;W.toMiliseconds(r)-Date.now()<=0&&this.expire(t,n)}expire(t,n){this.expirations.delete(t),this.events.emit(dt.expired,{target:t,expiration:n})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((t,n)=>this.checkExpiry(n,t))}registerEventListeners(){this.core.heartbeat.on(Fn.pulse,()=>this.checkExpirations()),this.events.on(dt.created,t=>{const n=dt.created;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:t}),this.persist()}),this.events.on(dt.expired,t=>{const n=dt.expired;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:t}),this.persist()}),this.events.on(dt.deleted,t=>{const n=dt.deleted;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:t}),this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=oe("NOT_INITIALIZED",this.name);throw new Error(t)}}}var tx=Object.defineProperty,nx=(e,t,n)=>t in e?tx(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,ye=(e,t,n)=>nx(e,typeof t!="symbol"?t+"":t,n);class Wg extends gb{constructor(t,n,r){super(t,n,r),this.core=t,this.logger=n,this.store=r,ye(this,"name",au),ye(this,"abortController"),ye(this,"isDevEnv"),ye(this,"verifyUrlV3",fu),ye(this,"storagePrefix",Et),ye(this,"version",So),ye(this,"publicKey"),ye(this,"fetchPromise"),ye(this,"init",async()=>{var i;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&W.toMiliseconds((i=this.publicKey)==null?void 0:i.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),ye(this,"register",async i=>{if(!wi()||this.isDevEnv)return;const s=window.location.origin,{id:o,decryptedId:a}=i,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${s}&id=${o}&decryptedId=${a}`;try{const f=gr(),u=this.startAbortTimer(W.ONE_SECOND*5),d=await new Promise((h,l)=>{const g=()=>{window.removeEventListener("message",v),f.body.removeChild(w),l("attestation aborted")};this.abortController.signal.addEventListener("abort",g);const w=f.createElement("iframe");w.src=c,w.style.display="none",w.addEventListener("error",g,{signal:this.abortController.signal});const v=A=>{if(A.data&&typeof A.data=="string")try{const C=JSON.parse(A.data);if(C.type==="verify_attestation"){if(Zo(C.attestation).payload.id!==o)return;clearInterval(u),f.body.removeChild(w),this.abortController.signal.removeEventListener("abort",g),window.removeEventListener("message",v),h(C.attestation===null?"":C.attestation)}}catch(C){this.logger.warn(C)}};f.body.appendChild(w),window.addEventListener("message",v,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",d),d}catch(f){this.logger.warn(f)}return""}),ye(this,"resolve",async i=>{if(this.isDevEnv)return"";const{attestationId:s,hash:o,encryptedId:a}=i;if(s===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(s){if(Zo(s).payload.id!==a)return;const f=await this.isValidJwtAttestation(s);if(f){if(!f.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return f}}if(!o)return;const c=this.getVerifyUrl(i?.verifyUrl);return this.fetchAttestation(o,c)}),ye(this,"fetchAttestation",async(i,s)=>{this.logger.debug(`resolving attestation: ${i} from url: ${s}`);const o=this.startAbortTimer(W.ONE_SECOND*5),a=await fetch(`${s}/attestation/${i}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),ye(this,"getVerifyUrl",i=>{let s=i||Jr;return uu.includes(s)||(this.logger.info(`verify url: ${s}, not included in trusted list, assigning default: ${Jr}`),s=Jr),s}),ye(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const i=this.startAbortTimer(W.FIVE_SECONDS),s=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(i),await s.json()}catch(i){this.logger.warn(i)}}),ye(this,"persistPublicKey",async i=>{this.logger.debug("persisting public key to local storage",i),await this.store.setItem(this.storeKey,i),this.publicKey=i}),ye(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),ye(this,"isValidJwtAttestation",async i=>{const s=await this.getPublicKey();try{if(s)return this.validateAttestation(i,s)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(i,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),ye(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),ye(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async s=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),s(o))});const i=await this.fetchPromise;return this.fetchPromise=void 0,i}),ye(this,"validateAttestation",(i,s)=>{const o=R4(i,s.publicKey),a={hasExpired:W.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=Ge(n,this.name),this.abortController=new AbortController,this.isDevEnv=zd(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return it(this.logger)}startAbortTimer(t){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),W.toMiliseconds(t))}}var rx=Object.defineProperty,ix=(e,t,n)=>t in e?rx(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Xg=(e,t,n)=>ix(e,typeof t!="symbol"?t+"":t,n);class Jg extends pb{constructor(t,n){super(t,n),this.projectId=t,this.logger=n,Xg(this,"context",lu),Xg(this,"registerDeviceToken",async r=>{const{clientId:i,token:s,notificationType:o,enableEncrypted:a=!1}=r,c=`${hu}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:i,type:o,token:s,always_raw:a})})}),this.logger=Ge(n,this.context)}}var sx=Object.defineProperty,Qg=Object.getOwnPropertySymbols,ox=Object.prototype.hasOwnProperty,ax=Object.prototype.propertyIsEnumerable,Yc=(e,t,n)=>t in e?sx(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Li=(e,t)=>{for(var n in t||(t={}))ox.call(t,n)&&Yc(e,n,t[n]);if(Qg)for(var n of Qg(t))ax.call(t,n)&&Yc(e,n,t[n]);return e},Se=(e,t,n)=>Yc(e,typeof t!="symbol"?t+"":t,n);class ep extends bb{constructor(t,n,r=!0){super(t,n,r),this.core=t,this.logger=n,Se(this,"context",gu),Se(this,"storagePrefix",Et),Se(this,"storageVersion",du),Se(this,"events",new Map),Se(this,"shouldPersist",!1),Se(this,"init",async()=>{if(!zd())try{const i={eventId:Md(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:Fd(this.core.relayer.protocol,this.core.relayer.version,Zi)}}};await this.sendEvent([i])}catch(i){this.logger.warn(i)}}),Se(this,"createEvent",i=>{const{event:s="ERROR",type:o="",properties:{topic:a,trace:c}}=i,f=Md(),u=this.core.projectId||"",d=Date.now(),h=Li({eventId:f,timestamp:d,props:{event:s,type:o,properties:{topic:a,trace:c}},bundleId:u,domain:this.getAppDomain()},this.setMethods(f));return this.telemetryEnabled&&(this.events.set(f,h),this.shouldPersist=!0),h}),Se(this,"getEvent",i=>{const{eventId:s,topic:o}=i;if(s)return this.events.get(s);const a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return Li(Li({},a),this.setMethods(a.eventId))}),Se(this,"deleteEvent",i=>{const{eventId:s}=i;this.events.delete(s),this.shouldPersist=!0}),Se(this,"setEventListeners",()=>{this.core.heartbeat.on(Fn.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(i=>{W.fromMiliseconds(Date.now())-W.fromMiliseconds(i.timestamp)>pu&&(this.events.delete(i.eventId),this.shouldPersist=!0)})})}),Se(this,"setMethods",i=>({addTrace:s=>this.addTrace(i,s),setError:s=>this.setError(i,s)})),Se(this,"addTrace",(i,s)=>{const o=this.events.get(i);o&&(o.props.properties.trace.push(s),this.events.set(i,o),this.shouldPersist=!0)}),Se(this,"setError",(i,s)=>{const o=this.events.get(i);o&&(o.props.type=s,o.timestamp=Date.now(),this.events.set(i,o),this.shouldPersist=!0)}),Se(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),Se(this,"restore",async()=>{try{const i=await this.core.storage.getItem(this.storageKey)||[];if(!i.length)return;i.forEach(s=>{this.events.set(s.eventId,Li(Li({},s),this.setMethods(s.eventId)))})}catch(i){this.logger.warn(i)}}),Se(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const i=[];for(const[s,o]of this.events)o.props.type&&i.push(o);if(i.length!==0)try{if((await this.sendEvent(i)).ok)for(const s of i)this.events.delete(s.eventId),this.shouldPersist=!0}catch(s){this.logger.warn(s)}}),Se(this,"sendEvent",async i=>{const s=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${bu}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${Zi}${s}`,{method:"POST",body:JSON.stringify(i)})}),Se(this,"getAppDomain",()=>p8().url),this.logger=Ge(n,this.context),this.telemetryEnabled=r,r?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var cx=Object.defineProperty,tp=Object.getOwnPropertySymbols,fx=Object.prototype.hasOwnProperty,ux=Object.prototype.propertyIsEnumerable,Wc=(e,t,n)=>t in e?cx(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,np=(e,t)=>{for(var n in t||(t={}))fx.call(t,n)&&Wc(e,n,t[n]);if(tp)for(var n of tp(t))ux.call(t,n)&&Wc(e,n,t[n]);return e},le=(e,t,n)=>Wc(e,typeof t!="symbol"?t+"":t,n);class oo extends rb{constructor(t){var n;super(t),le(this,"protocol",xo),le(this,"version",So),le(this,"name",Wr),le(this,"relayUrl"),le(this,"projectId"),le(this,"customStoragePrefix"),le(this,"events",new lt.exports.EventEmitter),le(this,"logger"),le(this,"heartbeat"),le(this,"relayer"),le(this,"crypto"),le(this,"storage"),le(this,"history"),le(this,"expirer"),le(this,"pairing"),le(this,"verify"),le(this,"echoClient"),le(this,"linkModeSupportedApps"),le(this,"eventClient"),le(this,"initialized",!1),le(this,"logChunkController"),le(this,"on",(a,c)=>this.events.on(a,c)),le(this,"once",(a,c)=>this.events.once(a,c)),le(this,"off",(a,c)=>this.events.off(a,c)),le(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),le(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:f})=>{if(!a||!c)return;const u={topic:a,message:c,publishedAt:Date.now(),transportType:Mn.link_mode};this.relayer.onLinkMessageEvent(u,{sessionExists:f})});const r=this.getGlobalCore(t?.customStoragePrefix);if(r)try{return this.customStoragePrefix=r.customStoragePrefix,this.logger=r.logger,this.heartbeat=r.heartbeat,this.crypto=r.crypto,this.history=r.history,this.expirer=r.expirer,this.storage=r.storage,this.relayer=r.relayer,this.pairing=r.pairing,this.verify=r.verify,this.echoClient=r.echoClient,this.linkModeSupportedApps=r.linkModeSupportedApps,this.eventClient=r.eventClient,this.initialized=r.initialized,this.logChunkController=r.logChunkController,r}catch(a){console.warn("Failed to copy global core",a)}this.projectId=t?.projectId,this.relayUrl=t?.relayUrl||Oo,this.customStoragePrefix=t!=null&&t.customStoragePrefix?`:${t.customStoragePrefix}`:"";const i=Pf({level:typeof t?.logger=="string"&&t.logger?t.logger:Lf.logger,name:Wr}),{logger:s,chunkLoggerController:o}=eb({opts:i,maxSizeInBytes:t?.maxLogBlobSizeInBytes,loggerOverride:t?.logger});this.logChunkController=o,(n=this.logChunkController)!=null&&n.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=Ge(s,this.name),this.heartbeat=new bo,this.crypto=new gg(this,this.logger,t?.keychain),this.history=new Zg(this,this.logger),this.expirer=new Yg(this,this.logger),this.storage=t!=null&&t.storage?t.storage:new O1(np(np({},Uf),t?.storageOptions)),this.relayer=new jg({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new Gg(this,this.logger),this.verify=new Wg(this,this.logger,this.storage),this.echoClient=new Jg(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new ep(this,this.logger,t?.telemetryEnabled),this.setGlobalCore(this)}static async init(t){const n=new oo(t);await n.initialize();const r=await n.crypto.getClientId();return await n.storage.setItem(Jf,r),n}get context(){return it(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var t;return(t=this.logChunkController)==null?void 0:t.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(t){this.linkModeSupportedApps.includes(t)||(this.linkModeSupportedApps.push(t),await this.storage.setItem(Bo,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(Bo)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(t){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,t),this.logger.error(t.message),t}}getGlobalCore(t=""){try{if(this.isGlobalCoreDisabled())return;const n=`_walletConnectCore_${t}`,r=`${n}_count`;return globalThis[r]=(globalThis[r]||0)+1,globalThis[r]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[r]} times.`),globalThis[n]}catch(n){console.warn("Failed to get global WalletConnect core",n);return}}setGlobalCore(t){var n;try{if(this.isGlobalCoreDisabled())return;const r=`_walletConnectCore_${((n=t.opts)==null?void 0:n.customStoragePrefix)||""}`;globalThis[r]=t}catch(r){console.warn("Failed to set global WalletConnect core",r)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&process.env.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}}const lx=oo;V.CORE_CONTEXT=Wr,V.CORE_DEFAULT=Lf,V.CORE_PROTOCOL=xo,V.CORE_STORAGE_OPTIONS=Uf,V.CORE_STORAGE_PREFIX=Et,V.CORE_VERSION=So,V.CRYPTO_CLIENT_SEED=Io,V.CRYPTO_CONTEXT=Ff,V.CRYPTO_JWT_TTL=jf,V.Core=lx,V.Crypto=gg,V.ECHO_CONTEXT=lu,V.ECHO_URL=hu,V.EVENTS_CLIENT_API_URL=bu,V.EVENTS_STORAGE_CLEANUP_INTERVAL=pu,V.EVENTS_STORAGE_CONTEXT=gu,V.EVENTS_STORAGE_VERSION=du,V.EVENT_CLIENT_AUTHENTICATE_ERRORS=Ab,V.EVENT_CLIENT_AUTHENTICATE_TRACES=Bb,V.EVENT_CLIENT_CONTEXT=Sb,V.EVENT_CLIENT_PAIRING_ERRORS=jt,V.EVENT_CLIENT_PAIRING_TRACES=Nt,V.EVENT_CLIENT_SESSION_ERRORS=Ob,V.EVENT_CLIENT_SESSION_TRACES=Ib,V.EXPIRER_CONTEXT=su,V.EXPIRER_DEFAULT_TTL=_b,V.EXPIRER_EVENTS=dt,V.EXPIRER_STORAGE_VERSION=ou,V.EchoClient=Jg,V.EventClient=ep,V.Expirer=Yg,V.HISTORY_CONTEXT=ru,V.HISTORY_EVENTS=ht,V.HISTORY_STORAGE_VERSION=iu,V.JsonRpcHistory=Zg,V.KEYCHAIN_CONTEXT=kf,V.KEYCHAIN_STORAGE_VERSION=Mf,V.KeyChain=dg,V.MESSAGES_CONTEXT=zf,V.MESSAGES_STORAGE_VERSION=qf,V.MESSAGE_DIRECTION=Xr,V.MessageTracker=bg,V.PAIRING_CONTEXT=tu,V.PAIRING_DEFAULT_TTL=vb,V.PAIRING_EVENTS=ur,V.PAIRING_RPC_OPTS=fr,V.PAIRING_STORAGE_VERSION=nu,V.PENDING_SUB_RESOLUTION_TIMEOUT=Eb,V.PUBLISHER_CONTEXT=Vf,V.PUBLISHER_DEFAULT_TTL=Hf,V.Pairing=Gg,V.RELAYER_CONTEXT=Zf,V.RELAYER_DEFAULT_LOGGER=Gf,V.RELAYER_DEFAULT_PROTOCOL=Kf,V.RELAYER_DEFAULT_RELAY_URL=Oo,V.RELAYER_EVENTS=be,V.RELAYER_PROVIDER_EVENTS=st,V.RELAYER_RECONNECT_TIMEOUT=Wf,V.RELAYER_SDK_VERSION=Zi,V.RELAYER_STORAGE_OPTIONS=yb,V.RELAYER_SUBSCRIBER_SUFFIX=Yf,V.RELAYER_TRANSPORT_CUTOFF=wb,V.Relayer=jg,V.STORE_STORAGE_VERSION=Xf,V.SUBSCRIBER_CONTEXT=Qf,V.SUBSCRIBER_DEFAULT_TTL=mb,V.SUBSCRIBER_EVENTS=Ze,V.SUBSCRIBER_STORAGE_VERSION=eu,V.Store=Kg,V.Subscriber=Lg,V.TRANSPORT_TYPES=Mn,V.TRUSTED_VERIFY_URLS=uu,V.VERIFY_CONTEXT=au,V.VERIFY_SERVER=Jr,V.VERIFY_SERVER_V3=fu,V.Verify=Wg,V.WALLETCONNECT_CLIENT_ID=Jf,V.WALLETCONNECT_LINK_MODE_APPS=Bo,V.default=oo,Object.defineProperty(V,"__esModule",{value:!0})});
//# sourceMappingURL=index.umd.js.map
